"use strict";(self.webpackChunkcode_note_blog=self.webpackChunkcode_note_blog||[]).push([[2908],{16035:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>a});var o=r(11527),t=r(88672);const i={},s=void 0,c={id:"Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u7684Environment\u73af\u5883\u53d8\u91cf",title:"Spring\u4e2d\u7684Environment\u73af\u5883\u53d8\u91cf",description:"\u5982\u4eca\uff0c\u81f4\u529b\u4e8e\u5e2e\u52a9\u5f00\u53d1\u8005\u7528\u66f4\u5c11\u7684\u4ee3\u7801\u3001\u66f4\u5feb\u5730\u5199\u51fa\u751f\u4ea7\u7ea7\u7cfb\u7edf\u7684 Spring Boot \u5df2\u7136\u6210\u4e3a Java \u5e94\u7528\u5f00\u53d1\u7684\u4e8b\u5b9e\u6807\u51c6\u3002\u5728 Spring Boot \u63d0\u4f9b\u7684\u4f17\u591a\u7279\u6027\u4e2d\uff0c\u81ea\u52a8\u914d\u7f6e\u65e0\u7591\u662f\u5bf9\u63d0\u5347\u5f00\u53d1\u4f53\u9a8c\u6700\u663e\u8457\u7684\u4e00\u4e2a\u7279\u6027\uff0cSpring Boot \u57fa\u4e8e\u8fd9\u4e00\u7279\u6027\u4e3a\u5f00\u53d1\u4eba\u5458\u81ea\u52a8\u58f0\u660e\u4e86\u82e5\u5e72\u5f00\u7bb1\u5373\u7528\u3001\u5177\u5907\u67d0\u4e00\u529f\u80fd\u7684 Bean\u3002\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u914d\u7f6e\u7684 Bean \u521a\u597d\u80fd\u6ee1\u8db3\u5927\u5bb6\u7684\u9700\u6c42\uff0c\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e0d\u5f97\u4e0d\u5b8c\u6574\u5730\u8986\u76d6\u5b83\u4eec\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ea\u9700\u8981\u91cd\u65b0\u58f0\u660e\u76f8\u5173\u7c7b\u578b\u7684 Bean \u5373\u53ef\uff0c\u56e0\u4e3a\u7edd\u5927\u591a\u6570\u81ea\u52a8\u914d\u7f6e\u7684 Bean \u90fd\u4f1a\u7531@ConditionalOnMissingBean\u6ce8\u89e3\u4fee\u9970\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u5982\u679c\u53ea\u662f\u60f3\u5fae\u8c03\u4e00\u4e9b\u7ec6\u8282\uff0c\u6bd4\u5982\u6539\u6539\u7aef\u53e3\u53f7 (server.port) \u548c\u6570\u636e\u6e90 URL (spring.datasource.url) \uff0c\u90a3\u538b\u6839\u6ca1\u5fc5\u8981\u91cd\u65b0\u58f0\u660eServerProperties\u548cDataSourceProperties\u8fd9\u4fe9 Bean \u6765\u8986\u76d6\u81ea\u52a8\u914d\u7f6e\u7684 Bean\u3002 Spring Boot \u4e3a\u81ea\u52a8\u914d\u7f6e\u7684 Bean \u63d0\u4f9b\u4e861000\u591a\u4e2a\u7528\u4e8e\u5fae\u8c03\u7684\u5c5e\u6027\uff0c\u5f53\u9700\u8981\u8c03\u6574\u8bbe\u7f6e\u65f6\uff0c\u53ea\u9700\u8981\u5728\u73af\u5883\u53d8\u91cf\u3001\u547d\u4ee4\u884c\u53c2\u6570\u6216\u914d\u7f6e\u6587\u4ef6 (application.properties/application.yml) \u4e2d\u8fdb\u884c\u6307\u5b9a\u5373\u53ef\uff0c\u8fd9\u5c31\u662f Spring Boot \u7684Externalized Configuration (\u914d\u7f6e\u5916\u5316) \u7279\u6027\u3002",source:"@site/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u7684Environment\u73af\u5883\u53d8\u91cf.md",sourceDirName:"Spring\u5168\u5bb6\u6876/Spring",slug:"/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u7684Environment\u73af\u5883\u53d8\u91cf",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u7684Environment\u73af\u5883\u53d8\u91cf",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u7684Environment\u73af\u5883\u53d8\u91cf.md",tags:[],version:"current",frontMatter:{},sidebar:"spring",previous:{title:"Spring\u4e2d\u7684\u8d44\u6e90\u7ba1\u7406",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u7684\u8d44\u6e90\u7ba1\u7406"},next:{title:"Spring\u4e2d\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u8bbf\u95ee",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u8bbf\u95ee"}},l={},a=[{value:"1 \u8ba4\u8bc6 Environmnent",id:"1-\u8ba4\u8bc6-environmnent",level:2},{value:"<strong><strong>getProperty()\u5185\u90e8\u6267\u884c\u903b\u8f91</strong></strong>",id:"getproperty\u5185\u90e8\u6267\u884c\u903b\u8f91",level:4},{value:"<strong><strong>PropertySource\u5185\u90e8\u66f4\u65b0\u903b\u8f91</strong></strong>",id:"propertysource\u5185\u90e8\u66f4\u65b0\u903b\u8f91",level:4},{value:"2 Environmnent \u521d\u59cb\u5316\u6d41\u7a0b",id:"2-environmnent-\u521d\u59cb\u5316\u6d41\u7a0b",level:2},{value:"2.1 prepareEnvironment()",id:"21-prepareenvironment",level:3},{value:"2.1.1 getOrCreateEnvironment()",id:"211-getorcreateenvironment",level:4},{value:"2.1.2 configureEnvironment()",id:"212-configureenvironment",level:4},{value:"2.1.3 ConfigurationPropertySources.attach()",id:"213-configurationpropertysourcesattach",level:4},{value:"2.1.4 listeners.environmentPrepared()",id:"214-listenersenvironmentprepared",level:4},{value:"3 jasypt \u6838\u5fc3\u539f\u7406\u89e3\u8bfb",id:"3-jasypt-\u6838\u5fc3\u539f\u7406\u89e3\u8bfb",level:2},{value:"4 \u603b\u7ed3",id:"4-\u603b\u7ed3",level:2}];function p(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["\u5982\u4eca\uff0c\u81f4\u529b\u4e8e\u5e2e\u52a9\u5f00\u53d1\u8005\u7528\u66f4\u5c11\u7684\u4ee3\u7801\u3001\u66f4\u5feb\u5730\u5199\u51fa\u751f\u4ea7\u7ea7\u7cfb\u7edf\u7684 Spring Boot \u5df2\u7136\u6210\u4e3a Java \u5e94\u7528\u5f00\u53d1\u7684\u4e8b\u5b9e\u6807\u51c6\u3002\u5728 Spring Boot \u63d0\u4f9b\u7684\u4f17\u591a\u7279\u6027\u4e2d\uff0c",(0,o.jsx)(n.strong,{children:"\u81ea\u52a8\u914d\u7f6e"}),"\u65e0\u7591\u662f\u5bf9\u63d0\u5347\u5f00\u53d1\u4f53\u9a8c\u6700\u663e\u8457\u7684\u4e00\u4e2a\u7279\u6027\uff0cSpring Boot \u57fa\u4e8e\u8fd9\u4e00\u7279\u6027\u4e3a\u5f00\u53d1\u4eba\u5458\u81ea\u52a8\u58f0\u660e\u4e86\u82e5\u5e72\u5f00\u7bb1\u5373\u7528\u3001\u5177\u5907\u67d0\u4e00\u529f\u80fd\u7684 Bean\u3002\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u914d\u7f6e\u7684 Bean \u521a\u597d\u80fd\u6ee1\u8db3\u5927\u5bb6\u7684\u9700\u6c42\uff0c\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4e0d\u5f97\u4e0d\u5b8c\u6574\u5730\u8986\u76d6\u5b83\u4eec\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ea\u9700\u8981\u91cd\u65b0\u58f0\u660e\u76f8\u5173\u7c7b\u578b\u7684 Bean \u5373\u53ef\uff0c\u56e0\u4e3a\u7edd\u5927\u591a\u6570\u81ea\u52a8\u914d\u7f6e\u7684 Bean \u90fd\u4f1a\u7531",(0,o.jsx)(n.code,{children:"@ConditionalOnMissingBean"}),"\u6ce8\u89e3\u4fee\u9970\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u5982\u679c\u53ea\u662f\u60f3\u5fae\u8c03\u4e00\u4e9b\u7ec6\u8282\uff0c\u6bd4\u5982\u6539\u6539\u7aef\u53e3\u53f7 (server.port) \u548c\u6570\u636e\u6e90 URL (spring.datasource.url) \uff0c\u90a3\u538b\u6839\u6ca1\u5fc5\u8981\u91cd\u65b0\u58f0\u660e",(0,o.jsx)(n.code,{children:"ServerProperties"}),"\u548c",(0,o.jsx)(n.code,{children:"DataSourceProperties"}),"\u8fd9\u4fe9 Bean \u6765\u8986\u76d6\u81ea\u52a8\u914d\u7f6e\u7684 Bean\u3002 Spring Boot \u4e3a\u81ea\u52a8\u914d\u7f6e\u7684 Bean \u63d0\u4f9b\u4e861000\u591a\u4e2a\u7528\u4e8e\u5fae\u8c03\u7684\u5c5e\u6027\uff0c\u5f53\u9700\u8981\u8c03\u6574\u8bbe\u7f6e\u65f6\uff0c\u53ea\u9700\u8981\u5728\u73af\u5883\u53d8\u91cf\u3001\u547d\u4ee4\u884c\u53c2\u6570\u6216\u914d\u7f6e\u6587\u4ef6 (application.properties/application.yml) \u4e2d\u8fdb\u884c\u6307\u5b9a\u5373\u53ef\uff0c\u8fd9\u5c31\u662f Spring Boot \u7684",(0,o.jsx)(n.code,{children:"Externalized Configuration"})," (\u914d\u7f6e\u5916\u5316) \u7279\u6027\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u5f53\u7136\uff0c\u5916\u90e8\u914d\u7f6e\u6e90\u5e76\u4e0d\u5c40\u9650\u4e8e\u73af\u5883\u53d8\u91cf\u3001\u547d\u4ee4\u884c\u53c2\u6570\u548c\u914d\u7f6e\u6587\u4ef6\u8fd9\u4e09\u79cd\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u9605\u8bfb Spring Boot \u5b98\u65b9\u6587\u6863\u3002\u5728 Spring \u4e2d\uff0c",(0,o.jsx)(n.code,{children:"BeanFactory"}),"\u626e\u6f14\u7740 Bean \u5bb9\u5668\u7684\u89d2\u8272\uff0c\u800c",(0,o.jsx)(n.code,{children:"Environment"}),"\u540c\u6837\u5b9a\u4f4d\u4e3a\u4e00\u4e2a\u5bb9\u5668\uff0c\u5373\u5916\u90e8\u914d\u7f6e\u6e90\u4e2d\u7684\u5c5e\u6027\u90fd\u4f1a\u88ab\u6dfb\u52a0\u5230 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u3002",(0,o.jsxs)(n.strong,{children:["\u5728\u5fae\u670d\u52a1\u5927\u884c\u5176\u9053\u7684\u4eca\u5929\uff0c\u5916\u90e8\u914d\u7f6e\u6e90\u53c8\u884d\u751f\u51fa\u4e86_Disconf_\u3001",(0,o.jsx)(n.em,{children:"Apollo"})," \u548c ",(0,o.jsx)(n.em,{children:"Nacos"})," \u7b49\u5206\u5e03\u5f0f\u914d\u7f6e\u4e2d\u5fc3\uff0c\u4f46\u5728 Spring \u7684\u5730\u76d8\uff0c\u8fd8\u662f\u8981\u5165\u4e61\u968f\u4fd7\uff0c\u4ece\u914d\u7f6e\u4e2d\u5fc3\u4e2d\u8bfb\u53d6\u5230\u7684\u5c5e\u6027\u4f9d\u7136\u4f1a\u88ab\u8ffd\u52a0\u5230 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d"]}),"\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u7b14\u8005\u4e4b\u6240\u4ee5\u5199\u8fd9\u7bc7\u6587\u7ae0\uff0c\u662f\u53d7",(0,o.jsx)(n.code,{children:"jasypt"}),"\u7ec4\u4ef6\u7684\u542f\u53d1\u3002\u7b2c\u4e00\u6b21\u63a5\u89e6\u5b83\u662f\u57282018\u5e74\uff0c\u5f53\u65f6\u5c31\u5f88\u597d\u5947\u8fd9\u73a9\u610f\u513f\u7a76\u7adf\u662f\u5982\u4f55\u5b9e\u73b0\u5bf9\u654f\u611f\u5c5e\u6027\u52a0\u89e3\u5bc6\u7684\uff1b\u73b0\u5728\u6765\u770b\uff0c\u8981\u60f3\u5b9e\u73b0\u8fd9\u4e48\u4e00\u4e2a\u4e1c\u4e1c\uff0c\u4e0d\u4ec5\u9700\u8981\u719f\u6089 Bean \u7684\u751f\u547d\u5468\u671f\u3001IoC \u5bb9\u5668\u62d3\u5c55\u70b9 (IoC Container Extension Points) \u548c Spring Boot \u7684\u542f\u52a8\u6d41\u7a0b\u7b49\u77e5\u8bc6\uff0c\u8fd8\u9700\u8981\u638c\u63e1 ",(0,o.jsx)(n.em,{children:"Environment"}),"\u3002"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["jasypt \u4e0a\u624b\u5341\u5206\u7b80\u5355\u3002\u9996\u5148\u901a\u8fc7",(0,o.jsx)(n.code,{children:"jasypt-maven-plugin"}),"\u8fd9\u4e00 maven \u63d2\u4ef6\u4e3a\u654f\u611f\u5c5e\u6027\u503c\u751f\u6210\u5bc6\u6587\uff0c\u7136\u540e\u7528",(0,o.jsx)(n.code,{children:"ENC(\u5bc6\u6587)"}),"\u66ff\u6362\u654f\u611f\u5c5e\u6027\u503c\u5373\u53ef\u3002\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"jasypt.encryptor.password=crimson_typhoon\n\nspring.datasource.url=jdbc:mysql://HOST:PORT/db_sql_boy?characterEncoding=UTF-8\nspring.datasource.hikari.driver-class-name=com.mysql.cj.jdbc.Driver\nspring.datasource.hikari.username=root\nspring.datasource.hikari.password=ENC(qS8+DEIlHxvhPHgn1VaW3oHkn2twrmwNOHewWLIfquAXiCDBrKwvIhDoqalKyhIF)\n\u590d\u5236\u4ee3\u7801\n"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"1-\u8ba4\u8bc6-environmnent",children:"1 \u8ba4\u8bc6 Environmnent"}),"\n",(0,o.jsxs)(n.p,{children:["\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\uff0c\u6211\u4eec\u4e0e ",(0,o.jsx)(n.em,{children:"Environment"})," \u6253\u4ea4\u9053\u7684\u673a\u4f1a\u5e76\u4e0d\u591a\uff1b\u5982\u679c\u4e1a\u52a1 Bean \u786e\u5b9e\u9700\u8981\u83b7\u53d6\u5916\u90e8\u914d\u7f6e\u6e90\u4e2d\u7684\u67d0\u4e00\u5c5e\u6027\u503c\uff0c\u53ef\u4ee5\u624b\u52a8\u5c06 ",(0,o.jsx)(n.em,{children:"Environment"})," \u6ce8\u5165\u5230\u8be5\u4e1a\u52a1 Bean \u4e2d\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5b9e\u73b0",(0,o.jsx)(n.code,{children:"EnvironmentAware"}),"\u63a5\u53e3\uff0c\u5f97\u5230 ",(0,o.jsx)(n.em,{children:"Environment"})," \u7c7b\u578b\u7684 Bean \u5b9e\u4f8b\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7",(0,o.jsx)(n.code,{children:"getProperty()"}),"\u83b7\u53d6\u5177\u4f53\u5c5e\u6027\u503c\u3002",(0,o.jsx)(n.em,{children:"Environment"})," \u63a5\u53e3\u5185\u5bb9\u5982\u4e0b\u6240\u793a\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public interface Environment extends PropertyResolver {\n    String[] getActiveProfiles();\n    String[] getDefaultProfiles();\n    boolean acceptsProfiles(Profiles profiles);\n}\n\npublic interface PropertyResolver {\n    boolean containsProperty(String key);\n    String getProperty(String key);\n    String getProperty(String key, String defaultValue);\n    <T> T getProperty(String key, Class<T> targetType);\n    <T> T getProperty(String key, Class<T> targetType, T defaultValue);\n    String resolvePlaceholders(String text);\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsxs)(n.strong,{children:["\u5927\u5bb6\u4e0d\u8981\u53d7 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d ",(0,o.jsx)(n.em,{children:"getProperty()"})," \u65b9\u6cd5\u7684\u8bef\u5bfc\uff0c\u5916\u90e8\u914d\u7f6e\u6e90\u4e2d\u7684\u5c5e\u6027\u5e76\u4e0d\u662f\u4ee5\u5355\u4e2a\u5c5e\u6027\u4e3a\u7ef4\u5ea6\u88ab\u6dfb\u52a0\u5230 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u7684\uff0c\u800c\u662f\u4ee5",(0,o.jsx)(n.code,{children:"PropertySource"}),"\u4e3a\u7ef4\u5ea6"]}),"\u3002",(0,o.jsx)(n.em,{children:"PropertySource"})," \u662f\u5bf9\u5c5e\u6027\u6e90\u540d\u79f0\u548c\u8be5\u5c5e\u6027\u6e90\u4e2d\u4e00\u7ec4\u5c5e\u6027\u7684\u62bd\u8c61\uff0c",(0,o.jsx)(n.code,{children:"MapPropertySource"}),"\u662f\u4e00\u79cd\u6700\u7b80\u5355\u7684\u5b9e\u73b0\uff0c\u5b83\u901a\u8fc7 ",(0,o.jsx)(n.code,{children:"_Map<String, Object>_ "}),"\u6765\u627f\u8f7d\u76f8\u5173\u7684\u5c5e\u6027\u3002",(0,o.jsx)(n.em,{children:"PropertySource"})," \u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public abstract class PropertySource<T> {\n    protected final String name;\n    protected final T source;\n\n    public PropertySource(String name, T source) {\n        this.name = name;\n        this.source = source;\n    }\n\n    public String getName() { return this.name; }\n    public T getSource() { return this.source; }\n    public abstract Object getProperty(String name);\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u4ece\u4e0a\u8ff0 ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u5185\u5bb9\u6765\u770b\uff0c",(0,o.jsx)(n.em,{children:"PropertySource"})," \u81ea\u8eab\u662f\u5177\u5907\u6839\u636e\u5c5e\u6027\u540d\u83b7\u53d6\u5c5e\u6027\u503c\u8fd9\u4e00\u80fd\u529b\u7684\u3002"]}),"\n",(0,o.jsx)(n.h4,{id:"getproperty\u5185\u90e8\u6267\u884c\u903b\u8f91",children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.strong,{children:"getProperty()\u5185\u90e8\u6267\u884c\u903b\u8f91"})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/QQ%E6%88%AA%E5%9B%BE20230416193319.jpg",alt:""})}),"\n",(0,o.jsxs)(n.p,{children:["\u4e00\u822c\uff0c",(0,o.jsx)(n.em,{children:"Environment"})," \u5b9e\u73b0\u7c7b\u4e2d\u4f1a\u6301\u6709\u4e00\u4e2a",(0,o.jsx)(n.code,{children:"PropertyResolver"}),"\u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\uff0c\u8fdb\u800c\u4ea4\u7531 ",(0,o.jsx)(n.em,{children:"PropertyResolver"})," \u8d1f\u8d23\u6267\u884c ",(0,o.jsx)(n.em,{children:"getProperty()"})," \u903b\u8f91\u3002",(0,o.jsx)(n.em,{children:"PropertyResolver"})," \u5b9e\u73b0\u7c7b\u4e2d\u53c8\u4f1a\u6301\u6709\u4e24\u4e2a\u6210\u5458\u53d8\u91cf\uff0c\u5206\u522b\u662f\uff1a",(0,o.jsx)(n.code,{children:"ConversionService"}),"\u4e0e",(0,o.jsx)(n.code,{children:"PropertySources"}),"\uff1b\u9996\u5148\uff0c",(0,o.jsx)(n.em,{children:"PropertyResolver"})," \u904d\u5386 ",(0,o.jsx)(n.code,{children:"PropertySources"})," \u4e2d\u7684 ",(0,o.jsx)(n.em,{children:"PropertySource"}),"\uff0c\u83b7\u53d6\u539f\u751f\u5c5e\u6027\u503c\uff1b\u7136\u540e\u59d4\u6d3e ",(0,o.jsx)(n.em,{children:"ConversionService"})," \u5bf9\u539f\u751f\u5c5e\u6027\u503c\u8fdb\u884c\u6570\u636e\u7c7b\u578b\u8f6c\u6362 (\u5982\u679c\u6709\u5fc5\u8981\u7684\u8bdd)\u3002",(0,o.jsx)(n.strong,{children:"\u867d\u7136 PropertySource \u81ea\u8eab\u662f\u5177\u5907\u6839\u636e\u5c5e\u6027\u540d\u83b7\u53d6\u5c5e\u6027\u503c\u8fd9\u4e00\u80fd\u529b\u7684\uff0c\u4f46\u4e0d\u5177\u5907\u5360\u4f4d\u7b26\u89e3\u6790\u4e0e\u7c7b\u578b\u8f6c\u6362\u80fd\u529b\uff0c\u4e8e\u662f\u5728\u4e2d\u95f4\u5f15\u5165\u5177\u5907\u8fd9\u4e24\u79cd\u80fd\u529b\u7684 PropertyResolver\uff0c \u8fd9\u4e5f\u5370\u8bc1\u4e86\u4e00\u4e2a\u6bb5\u5b50\uff1a\u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0c\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\u662f\u5728\u4e2d\u95f4\u52a0\u4e00\u5c42\u89e3\u51b3\u4e0d\u4e86\u7684\uff0c\u5982\u679c\u6709\uff0c\u90a3\u5c31\u518d\u52a0\u4e00\u5c42"}),"\u3002"]}),"\n",(0,o.jsx)(n.h4,{id:"propertysource\u5185\u90e8\u66f4\u65b0\u903b\u8f91",children:(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.strong,{children:"PropertySource\u5185\u90e8\u66f4\u65b0\u903b\u8f91"})})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/QQ%E6%88%AA%E5%9B%BE20230416193319.jpg",alt:""})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"Environment"})," \u5b9e\u73b0\u7c7b\u4e2d\u9664\u4e86\u6301\u6709",(0,o.jsx)(n.code,{children:"PropertyResolver"}),"\u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a",(0,o.jsx)(n.code,{children:"MutablePropertySources"}),"\u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\uff0c\u4f46\u5e76\u4e0d\u63d0\u4f9b\u76f4\u63a5\u64cd\u4f5c\u8be5 ",(0,o.jsx)(n.em,{children:"MutablePropertySources"})," \u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u53ea\u80fd\u901a\u8fc7",(0,o.jsx)(n.code,{children:"getPropertySources()"}),"\u65b9\u6cd5\u83b7\u53d6 ",(0,o.jsx)(n.em,{children:"MutablePropertySources"})," \u5b9e\u4f8b\uff0c\u7136\u540e\u501f\u52a9 ",(0,o.jsx)(n.em,{children:"MutablePropertySources"})," \u4e2d\u7684",(0,o.jsx)(n.code,{children:"addFirst()"}),"\u3001",(0,o.jsx)(n.code,{children:"addLast()"}),"\u548c",(0,o.jsx)(n.code,{children:"replace()"}),"\u7b49\u65b9\u6cd5\u53bb\u66f4\u65b0 ",(0,o.jsx)(n.em,{children:"PropertySource"}),"\u3002",(0,o.jsx)(n.em,{children:"MutablePropertySources"})," \u662f ",(0,o.jsx)(n.em,{children:"PropertySources"})," \u552f\u4e00\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230416193420.png",alt:""})}),"\n",(0,o.jsxs)(n.p,{children:["\u603b\u7684\u6765\u8bf4\uff0c",(0,o.jsx)(n.em,{children:"Environment"})," \u662f\u5bf9 ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u548c ",(0,o.jsx)(n.em,{children:"Profile"})," \u7684\u9876\u7ea7\u62bd\u8c61\uff0c\u4e0b\u9762\u4ecb\u7ecd ",(0,o.jsx)(n.em,{children:"Profile"})," \u7684\u6982\u5ff5\u3002\u5f53\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u90e8\u7f72\u5230\u4e0d\u540c\u7684\u8fd0\u884c\u73af\u5883\u65f6\uff0c\u4e00\u4e9b\u5c5e\u6027\u9879\u901a\u5e38\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u6bd4\u5982\uff0c\u6570\u636e\u6e90 URL \u5728\u5f00\u53d1\u73af\u5883\u548c\u6d4b\u8bd5\u73af\u5883\u5c31\u4f1a\u4e0d\u4e00\u6837\u3002Spring \u4ece3.1\u7248\u672c\u5f00\u59cb\u652f\u6301\u57fa\u4e8e ",(0,o.jsx)(n.em,{children:"Profile"})," \u7684\u6761\u4ef6\u5316\u914d\u7f6e\u3002"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Profile in Spring 3.1"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5728 Spring \u53d1\u5e033.1\u7248\u672c\u65f6\uff0cSpring Boot \u8fd8\u672a\u95ee\u4e16\uff0c\u53ef\u4ee5\u8bf4\u6b64\u65f6\u7684 ",(0,o.jsx)(n.em,{children:"Profile"})," \u7279\u6027\u8fd8\u662f\u6709\u4e9b",(0,o.jsx)(n.strong,{children:"\u7455\u75b5"}),"\u7684\uff0c\u4f46\u7455\u4e0d\u63a9\u745c\u3002\u4e3b\u8981\u4f53\u73b0\u5728\uff1a\u9488\u5bf9\u540c\u4e00\u7c7b\u578b\u7684 Bean\uff0c\u5fc5\u987b\u58f0\u660e\u591a\u6b21\u3002\u4e00\u8d77\u6765\u611f\u53d7\u4e0b\u8fd9\u79cd\u5c0f\u7455\u75b5\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'@Configuration(proxyBeanMethods = false)\npublic class DataSourceConfig {\n    @Bean\n    @Profile("dev")\n    public DataSource devDataSource () {\n        return DataSourceBuilder.create()\n                .driverClassName("com.mysql.jdbc.Driver")\n                .url("jdbc:mysql://DEV_HOST:PORT/db_sql_boy?characterEncoding=UTF-8")\n                .username("dev")\n                .password("dev")\n                .build();\n    }\n\n    @Bean\n    @Profile("test")\n    public DataSource testDataSource () {\n        return DataSourceBuilder.create()\n                .driverClassName("com.mysql.jdbc.Driver")\n                .url("jdbc:mysql://TEST_HOST:PORT/db_sql_boy?characterEncoding=UTF-8")\n                .username("test")\n                .password("test")\n                .build();\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Profile in Spring Boot"})}),"\n",(0,o.jsxs)(n.p,{children:["Spring Boot \u53d1\u5e03\u540e\uff0c",(0,o.jsx)(n.code,{children:"@Profile"}),"\u6ce8\u89e3\u53ef\u4ee5\u6254\u5230\u4e5d\u9704\u4e91\u5916\u4e86\u3002\u5b98\u65b9\u5f00\u53d1\u5927\u4f6c\u80af\u5b9a\u4e5f\u610f\u8bc6\u5230 ",(0,o.jsx)(n.em,{children:"Profile in Spring 3.1"})," \u4e2d\u8fd9\u79cd\u7455\u75b5\uff0c\u4e8e\u662f\u5728 Spring Boot \u7684\u7b2c\u4e00\u7248\u672c ",(0,o.jsx)(n.em,{children:"(1.0.0.RELEASE)"})," \u4e2d\u5c31\u8feb\u4e0d\u53ca\u5f85\u5730\u652f\u6301\u4e3a ",(0,o.jsx)(n.em,{children:"application.properties"})," \u548c ",(0,o.jsx)(n.em,{children:"application.yml"})," \u91cc\u7684\u5c5e\u6027\u9879\u914d\u7f6e ",(0,o.jsx)(n.em,{children:"Profile"})," \u4e86\u3002\u6362\u4e2a\u53e3\u5473\uff0c\u4e00\u8d77\u6765\u611f\u53d7\u4e0b\u8fd9\u79cd\u4f18\u96c5\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"@Configuration(proxyBeanMethods = false)\npublic class DataSourceConfig {\n    @Bean\n    public DataSource devDataSource (DataSourceProperties dataSourceProperties) {\n        return DataSourceBuilder.create()\n                .driverClassName(dataSourceProperties.getDriverClassName())\n                .url(dataSourceProperties.getUrl())\n                .username(dataSourceProperties.getUsername())\n                .password(dataSourceProperties.getPassword())\n                .build();\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"application-dev.properties"})," \u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"spring.datasource.url=jdbc:mysql://DEV_HOST:PORT/db_sql_boy?characterEncoding=UTF-8\nspring.datasource.hikari.driver-class-name=com.mysql.jdbc.Driver\nspring.datasource.hikari.password=dev\nspring.datasource.hikari.username=dev\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"application-test.properties"})," \u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"spring.datasource.url=jdbc:mysql://TEST_HOST:PORT/db_sql_boy?characterEncoding=UTF-8\nspring.datasource.hikari.driver-class-name=com.mysql.jdbc.Driver\nspring.datasource.hikari.password=test\nspring.datasource.hikari.username=test\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5728\u539f\u751f Spring 3.1 \u548c Spring Boot \u4e2d\uff0c\u5747\u662f\u901a\u8fc7",(0,o.jsx)(n.code,{children:"spring.profiles.active"}),"\u6765\u4e3a ",(0,o.jsx)(n.em,{children:"Environment"})," \u6307\u5b9a\u6fc0\u6d3b\u7684 ",(0,o.jsx)(n.em,{children:"Profile"}),"\uff0c\u5426\u5219_Environment_ \u4e2d\u9ed8\u8ba4\u6fc0\u6d3b\u7684 ",(0,o.jsx)(n.em,{children:"Profile"})," \u540d\u79f0\u4e3a",(0,o.jsx)(n.code,{children:"default"}),"\u3002\u5199\u5230\u8fd9\u91cc\uff0c\u7b14\u8005\u8111\u6d77\u4e2d\u95ea\u73b0\u4e00\u4e2a\u95ee\u9898\uff1a\u4e00\u822c\uff0c",(0,o.jsx)(n.code,{children:"@Profile"})," \u6ce8\u89e3\u4e3b\u8981\u4e0e ",(0,o.jsx)(n.em,{children:"@Configuration"})," \u6ce8\u89e3\u6216 ",(0,o.jsx)(n.em,{children:"@Bean"})," \u6ce8\u89e3\u642d\u914d\u4f7f\u7528\uff0c\u5982\u679c ",(0,o.jsx)(n.em,{children:"spring.profiles.active"})," \u7684\u503c\u4e3a ",(0,o.jsx)(n.em,{children:"dev"})," \u65f6\uff0c\u90a3\u4e48\u90a3\u4e9b\u7531 ",(0,o.jsx)(n.em,{children:"@Configuration"})," \u6216 ",(0,o.jsx)(n.em,{children:"@Bean"})," \u6ce8\u89e3\u6807\u8bb0 (\u4f46\u6ca1\u6709",(0,o.jsx)(n.code,{children:"@Profile"}),"\u6ce8\u89e3\u7684\u8eab\u5f71\u54c8) \u7684 Bean \u8fd8\u4f1a\u88ab\u89e3\u6790\u4e3a\u82e5\u5e72",(0,o.jsx)(n.code,{children:"BeanDefinition"}),"\u5b9e\u4f8b\u5417\uff1f\u7b54\u6848\u662f\u4f1a\u7684\u3002",(0,o.jsx)(n.code,{children:"ConfigurationClassPostProcessor"}),"\u8d1f\u8d23\u5c06 ",(0,o.jsx)(n.em,{children:"@Configuration"})," \u914d\u7f6e\u7c7b\u89e3\u6790\u4e3a ",(0,o.jsx)(n.em,{children:"BeanDefinition"}),"\uff0c\u5728\u6b64\u8fc7\u7a0b\u4e2d\u4f1a\u6267\u884c",(0,o.jsx)(n.code,{children:"ConditionEvaluator"}),"\u7684",(0,o.jsx)(n.code,{children:"shouldSkip()"}),"\u65b9\u6cd5\uff0c\u4e3b\u8981\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class ConditionEvaluator {\n    public boolean shouldSkip(AnnotatedTypeMetadata metadata, ConfigurationCondition.ConfigurationPhase phase) {\n        if (metadata == null || !metadata.isAnnotated(Conditional.class.getName())) {\n            return false;\n        }\n\n        if (phase == null) {\n            if (metadata instanceof AnnotationMetadata &&\n                    ConfigurationClassUtils.isConfigurationCandidate((AnnotationMetadata) metadata)) {\n                return shouldSkip(metadata, ConfigurationCondition.ConfigurationPhase.PARSE_CONFIGURATION);\n            }\n            return shouldSkip(metadata, ConfigurationCondition.ConfigurationPhase.REGISTER_BEAN);\n        }\n\n        List<Condition> conditions = new ArrayList<>();\n        for (String[] conditionClasses : getConditionClasses(metadata)) {\n            for (String conditionClass : conditionClasses) {\n                Condition condition = getCondition(conditionClass, this.context.getClassLoader());\n                conditions.add(condition);\n            }\n        }\n\n        AnnotationAwareOrderComparator.sort(conditions);\n\n        for (Condition condition : conditions) {\n            ConfigurationCondition.ConfigurationPhase requiredPhase = null;\n            if (condition instanceof ConfigurationCondition) {\n                requiredPhase = ((ConfigurationCondition) condition).getConfigurationPhase();\n            }\n            if ((requiredPhase == null || requiredPhase == phase) && !condition.matches(this.context, metadata)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"shouldSkip()"}),"\u65b9\u6cd5\u7b2c\u4e00\u884c ",(0,o.jsx)(n.em,{children:"if"})," \u8bed\u53e5\u5c31\u662f\u7b54\u6848\uff0c",(0,o.jsx)(n.code,{children:"@Profile"}),"\u6ce8\u89e3\u7531",(0,o.jsx)(n.code,{children:"@Conditional(ProfileCondition.class)"}),"\u4fee\u9970\uff0c\u90a3\u5982\u679c\u4e00\u4e2a\u914d\u7f6e\u7c7b\u5934\u4e0a\u6ca1\u6709",(0,o.jsx)(n.code,{children:"Condition"}),"\u7684\u8eab\u5f71\uff0c\u76f4\u63a5\u8fd4\u56de",(0,o.jsx)(n.code,{children:"false"}),"\u4e86\uff0c\u90a3\u5c31\u662f\u4e0d\u8df3\u8fc7\u8be5\u914d\u7f6e\u7c7b\u7684\u610f\u601d\u55bd\uff01"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u7684\u8fd9\u4e9b ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u7a76\u7adf\u6709\u5565\u7528\u554a\uff1f\u5f53\u7136\u662f\u4e3a\u4e86\u586b\u5145 ",(0,o.jsx)(n.em,{children:"Bean"})," \u55bd\uff0c\u5e9f\u8bdd\u4e0d\u591a\u8bf4\uff0c\u4e0a\u56fe\u3002"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230416193443.png",alt:""})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"\u7b14\u8005\u4ee5\u524d\u90fd\u662f\u7528 visio \u548c processOn \u753b\u56fe\uff0c\u7b2c\u4e00\u6b21\u4f53\u9a8c draw.io\uff0c\u6ca1\u60f3\u5230\u5982\u6b64\u4f18\u79c0\uff0c\u5f3a\u70c8\u5b89\u5229\u4e00\u6ce2\uff01"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"2-environmnent-\u521d\u59cb\u5316\u6d41\u7a0b",children:"2 Environmnent \u521d\u59cb\u5316\u6d41\u7a0b"}),"\n",(0,o.jsxs)(n.p,{children:["\u672c\u8282\u4e3b\u8981\u4ecb\u7ecd Spring Boot \u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\u5411 ",(0,o.jsx)(n.em,{children:"Environmnt"})," \u4e2d\u7a76\u7adf\u6ce8\u518c\u4e86\u54ea\u4e9b ",(0,o.jsx)(n.em,{children:"PropertySource"}),"\u3002\u542f\u52a8\u5165\u53e3\u4f4d\u4e8e",(0,o.jsx)(n.code,{children:"SpringApplication"}),"\u4e2d\u7684",(0,o.jsx)(n.code,{children:"run(String... args)"}),"\u65b9\u6cd5\uff0c\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class SpringApplication {\n    public ConfigurableApplicationContext run(String... args) {\n        StopWatch stopWatch = new StopWatch();\n        stopWatch.start();\n        DefaultBootstrapContext bootstrapContext = createBootstrapContext();\n        ConfigurableApplicationContext context = null;\n        configureHeadlessProperty();\n        SpringApplicationRunListeners listeners = getRunListeners(args);\n        listeners.starting(bootstrapContext, this.mainApplicationClass);\n        try {\n            ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);\n            ConfigurableEnvironment environment = prepareEnvironment(listeners, bootstrapContext, applicationArguments);\n            configureIgnoreBeanInfo(environment);\n            Banner printedBanner = printBanner(environment);\n            context = createApplicationContext();\n            context.setApplicationStartup(this.applicationStartup);\n            prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);\n            refreshContext(context);\n            afterRefresh(context, applicationArguments);\n            stopWatch.stop();\n            if (this.logStartupInfo) {\n                new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);\n            }\n            listeners.started(context);\n            callRunners(context, applicationArguments);\n        } catch (Throwable ex) {\n            handleRunFailure(context, ex, listeners);\n            throw new IllegalStateException(ex);\n        }\n\n        try {\n            listeners.running(context);\n        } catch (Throwable ex) {\n            handleRunFailure(context, ex, null);\n            throw new IllegalStateException(ex);\n        }\n        return context;\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u53ef\u4ee5\u660e\u663e\u770b\u51fa\uff0c",(0,o.jsx)(n.em,{children:"Environmnt"})," \u7684\u521d\u59cb\u5316\u662f\u5728",(0,o.jsx)(n.code,{children:"refreshContext(context)"}),"\u4e4b\u524d\u5b8c\u6210\u7684\uff0c\u8fd9\u662f\u6beb\u65e0\u7591\u95ee\u7684\u3002",(0,o.jsx)(n.em,{children:"run()"})," \u65b9\u6cd5\u5f88\u590d\u6742\uff0c\u4f46\u4e0e\u672c\u6587\u4e3b\u9898\u5951\u5408\u7684\u903b\u8f91\u53ea\u6709",(0,o.jsx)(n.strong,{children:"\u4e00"}),"\u5904\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"prepareEnvironment(listeners, bootstrapContext, applicationArguments);\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u4e0b\u9762\u5206\u522b\u5206\u6790\u8fd9\u4e24\u5904\u6838\u5fc3\u903b\u8f91\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"21-prepareenvironment",children:"2.1 prepareEnvironment()"}),"\n",(0,o.jsxs)(n.p,{children:["\u663e\u7136\uff0c\u6838\u5fc3\u5185\u5bb9\u90fd\u5728",(0,o.jsx)(n.code,{children:"prepareEnvironment()"}),"\u65b9\u6cd5\u5185\uff0c\u4e0b\u9762\u5206\u5c0f\u8282\u9010\u4e00\u5206\u6790\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class SpringApplication {\n    private ConfigurableEnvironment prepareEnvironment(SpringApplicationRunListeners listeners,\n                                                       DefaultBootstrapContext bootstrapContext,\n                                                       ApplicationArguments applicationArguments) {\n        // 2.1.1\n        ConfigurableEnvironment environment = getOrCreateEnvironment();\n        // 2.1.2\n        configureEnvironment(environment, applicationArguments.getSourceArgs());\n        // 2.1.3\n        ConfigurationPropertySources.attach(environment);\n        // 2.1.4\n        listeners.environmentPrepared(bootstrapContext, environment);\n        DefaultPropertiesPropertySource.moveToEnd(environment);\n        bindToSpringApplication(environment);\n        ConfigurationPropertySources.attach(environment);\n        return environment;\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsx)(n.h4,{id:"211-getorcreateenvironment",children:"2.1.1 getOrCreateEnvironment()"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"getOrCreateEnvironment()"}),"\u4e3b\u8981\u8d1f\u8d23\u6784\u5efa ",(0,o.jsx)(n.em,{children:"Environment"})," \u5b9e\u4f8b\u3002\u5982\u679c\u5f53\u524d\u5e94\u7528\u662f\u57fa\u4e8e",(0,o.jsx)(n.code,{children:"\u540c\u6b65\u963b\u585eI/O"}),"\u6a21\u578b\u7684\uff0c\u5219 ",(0,o.jsx)(n.em,{children:"Environment"})," \u9009\u7528",(0,o.jsx)(n.code,{children:"ApplicationServletEnvironment"}),"\uff1b\u76f8\u53cd\u5730\uff0c\u5982\u679c\u5f53\u524d\u5e94\u7528\u662f\u57fa\u4e8e",(0,o.jsx)(n.code,{children:"\u5f02\u6b65\u975e\u963b\u585eI/O"}),"\u6a21\u578b\u7684\uff0c\u5219 ",(0,o.jsx)(n.em,{children:"Environment"})," \u9009\u7528",(0,o.jsx)(n.code,{children:"ApplicationReactiveWebEnvironment"}),"\u3002\u6211\u4eec\u5de5\u4f5c\u4e2d\u57fa\u672c\u90fd\u662f\u57fa\u4e8e Spring MVC \u5f00\u53d1\u5e94\u7528\uff0cSpring MVC \u662f\u4e00\u6b3e\u6784\u5efa\u4e8e",(0,o.jsx)(n.code,{children:"Servlet API"}),"\u4e4b\u4e0a\u3001\u57fa\u4e8e\u540c\u6b65\u963b\u585e I/O \u6a21\u578b\u7684\u4e3b\u6d41 Java Web \u5f00\u53d1\u6846\u67b6\uff0c\u8fd9\u79cd I/O \u6a21\u578b\u610f\u5473\u7740\u4e00\u4e2a HTTP \u8bf7\u6c42\u5bf9\u5e94\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u5373\u6bcf\u4e00\u4e2a HTTP \u8bf7\u6c42\u90fd\u662f\u5728\u5404\u81ea\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u5b8c\u6210\u5904\u7406\u7684\u3002",(0,o.jsx)(n.em,{children:"ApplicationServletEnvironment"})," \u7ee7\u627f\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230416193515.png",alt:""})}),"\n",(0,o.jsxs)(n.p,{children:["\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa ",(0,o.jsx)(n.em,{children:"ApplicationServletEnvironment"})," \u5bb6\u65cf\u76f8\u5f53\u5e9e\u5927\uff0c\u5728\u6267\u884c ",(0,o.jsx)(n.em,{children:"ApplicationServletEnvironment"})," \u6784\u9020\u65b9\u6cd5\u7684\u65f6\u5019\u5fc5\u7136\u4f1a\u89e6\u53d1\u5404\u7ea7\u7236\u7c7b\u6784\u9020\u65b9\u6cd5\u4e2d\u7684\u903b\u8f91\uff0c",(0,o.jsx)(n.strong,{children:"\u4f9d\u6b21\u4e3a"}),"\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public abstract class AbstractEnvironment implements ConfigurableEnvironment {\n    public AbstractEnvironment() {\n        this(new MutablePropertySources());\n    }\n\n    protected AbstractEnvironment(MutablePropertySources propertySources) {\n        this.propertySources = propertySources;\n        // createPropertyResolver(propertySources)\n        // |___ ConfigurationPropertySources.createPropertyResolver(propertySources)\n        //      |___ new ConfigurationPropertySourcesPropertyResolver(propertySources)\n        this.propertyResolver = createPropertyResolver(propertySources);\n        customizePropertySources(propertySources);\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'public class StandardServletEnvironment extends StandardEnvironment implements ConfigurableWebEnvironment {\n    @Override\n    protected void customizePropertySources(MutablePropertySources propertySources) {\n        propertySources.addLast(new StubPropertySource("servletConfigInitParams"));\n        propertySources.addLast(new StubPropertySource("servletContextInitParams"));\n        super.customizePropertySources(propertySources);\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'public class StandardEnvironment extends AbstractEnvironment {\n    @Override\n    protected void customizePropertySources(MutablePropertySources propertySources) {\n        propertySources.addLast(\n                new PropertiesPropertySource("systemProperties", (Map) System.getProperties()));\n        propertySources.addLast(\n                new SystemEnvironmentPropertySource("systemEnvironment", (Map) System.getenv()));\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u968f\u7740 ",(0,o.jsx)(n.em,{children:"ApplicationServletEnvironment"})," \u6784\u9020\u65b9\u6cd5\u7684\u6267\u884c\uff0c\u6b64\u65f6\u5728 ",(0,o.jsx)(n.em,{children:"Environment"})," \u91cc ",(0,o.jsx)(n.em,{children:"MutablePropertySources"})," \u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf",(0,o.jsx)(n.code,{children:"propertySources"}),"\u4e2d\u5df2\u7ecf\u6709\u4e86",(0,o.jsx)(n.strong,{children:"\u56db"}),"\u4e2a ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u4e86\uff0c\u540d\u79f0\u4f9d\u6b21\u662f\uff1a",(0,o.jsx)(n.code,{children:"servletConfigInitParams"}),"\u3001",(0,o.jsx)(n.code,{children:"servletContextInitParams"}),"\u3001",(0,o.jsx)(n.code,{children:"systemProperties"}),"\u548c",(0,o.jsx)(n.code,{children:"systemEnvironment"}),"\u3002\u6b64\u5916\uff0c\u4e5f\u8981\u8bb0\u4f4f ",(0,o.jsx)(n.em,{children:"ApplicationServletEnvironment"})," \u4e2d\u7684\u4e24\u4e2a\u91cd\u8981\u6210\u5458\u53d8\u91cf\uff0c\u5373",(0,o.jsx)(n.code,{children:"MutablePropertySources"}),"\u548c",(0,o.jsx)(n.code,{children:"ConfigurationPropertySourcesPropertyResolver"}),"\u3002"]}),"\n",(0,o.jsx)(n.h4,{id:"212-configureenvironment",children:"2.1.2 configureEnvironment()"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"configureEnvironment()"}),"\u65b9\u6cd5\u4e2d\u7684\u903b\u8f91\u4e5f\u5f88\u7b80\u5355\u54c8\u3002\u9996\u5148\uff0c\u4e3a ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u7684 ",(0,o.jsx)(n.em,{children:"PropertySourcesPropertyResolver"})," \u8bbe\u5b9a ",(0,o.jsx)(n.em,{children:"ConversionService"}),"\uff1b\u7136\u540e\uff0c\u5411 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u7684 ",(0,o.jsx)(n.em,{children:"MutablePropertySources"})," \u8ffd\u52a0\u4e00\u4e2a\u540d\u79f0\u4e3a",(0,o.jsx)(n.code,{children:"commandLineArgs"}),"\u7684 ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u5b9e\u4f8b\uff0c\u6ce8\u610f\u4f7f\u7528\u7684\u662f",(0,o.jsx)(n.code,{children:"addFirst()"}),"\u65b9\u6cd5\u54e6\uff0c\u8fd9\u610f\u5473\u7740\u8fd9\u4e2a\u540d\u79f0\u4e3a",(0,o.jsx)(n.code,{children:"commandLineArgs"}),"\u7684 ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u4f18\u5148\u7ea7\u662f\u6700\u9ad8\u7684\u3002\u4e3b\u8981\u903b\u8f91\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class SpringApplication {\n    protected void configureEnvironment(ConfigurableEnvironment environment, String[] args) {\n        if (this.addConversionService) {\n            environment.getPropertyResolver().setConversionService(new ApplicationConversionService());\n        }\n        if (this.addCommandLineProperties && args.length > 0) {\n            MutablePropertySources sources = environment.getPropertySources();\n            sources.addFirst(new SimpleCommandLinePropertySource(args));\n        }\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u7ee7\u7eed",(0,o.jsx)(n.code,{children:"SimpleCommandLinePropertySource"}),"\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'public class SimpleCommandLinePropertySource extends CommandLinePropertySource<CommandLineArgs> {\n    public SimpleCommandLinePropertySource(String... args) {\n        // \u5176\u7236\u7c7b\u6784\u9020\u65b9\u6cd5\u4e3a\uff1asuper("commandLineArgs", source)\n        super(new SimpleCommandLineArgsParser().parse(args));\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u547d\u4ee4\u884c\u53c2\u6570\u8fd8\u662f\u6bd4\u8f83\u5e38\u7528\u7684\uff0c\u6bd4\u5982\u6211\u4eec\u5728\u542f\u52a8 Spring Boot \u5e94\u7528\u65f6\u4f1a\u8fd9\u6837\u58f0\u660e\u547d\u4ee4\u884c\u53c2\u6570\uff1a",(0,o.jsx)(n.code,{children:"java -jar app.jar --server.port=8088"}),"\u3002"]}),"\n",(0,o.jsx)(n.h4,{id:"213-configurationpropertysourcesattach",children:"2.1.3 ConfigurationPropertySources.attach()"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"attach()"}),"\u65b9\u6cd5\u4e3b\u8981\u5c31\u662f\u5728 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d ",(0,o.jsx)(n.em,{children:"MutablePropertySources"})," \u7684\u5934\u90e8\u4f4d\u7f6e\u63d2\u5165\u52a0\u4e00\u4e2a\u540d\u79f0\u4e3a",(0,o.jsx)(n.code,{children:"configurationProperties"}),"\u7684 ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u5b9e\u4f8b\u3002\u4e3b\u8981\u903b\u8f91\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'public final class ConfigurationPropertySources {\n    public static void attach(org.springframework.core.env.Environment environment) {\n        MutablePropertySources sources = ((ConfigurableEnvironment) environment).getPropertySources();\n        PropertySource<?> attached = getAttached(sources);\n        if (attached != null && attached.getSource() != sources) {\n            sources.remove(ATTACHED_PROPERTY_SOURCE_NAME);\n            attached = null;\n        }\n        if (attached == null) {\n            sources.addFirst(new ConfigurationPropertySourcesPropertySource("configurationProperties", new SpringConfigurationPropertySources(sources)));\n        }\n    }\n\n    static PropertySource<?> getAttached(MutablePropertySources sources) {\n        return (sources != null) ? sources.get("configurationProperties") : null;\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u7b14\u8005\u76ef\u7740\u8fd9\u73a9\u610f\u513f\u770b\u4e86\u597d\u4e45\uff0c\u538b\u6839\u6ca1\u770b\u51fa\u8fd9\u4e2a\u540d\u79f0\u4e3a",(0,o.jsx)(n.code,{children:"configurationProperties"}),"\u7684 ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u7a76\u7adf\u6709\u5565\u7528\u3002\u6700\u540e\uff0c\u8fd8\u662f\u5728\u5b98\u65b9\u6587\u6863\u4e2d\u5173\u4e8e",(0,o.jsx)(n.code,{children:"Relaxed Binding"})," (\u5bbd\u677e\u7ed1\u5b9a) \u7684\u63cf\u8ff0\u4e2d\u731c\u51fa\u4e86\u4e9b\u7aef\u502a\u3002\u8fd8\u662f\u901a\u8fc7\u4ee3\u7801\u6765\u89e3\u8bfb\u6bd4\u8f83\u76f4\u63a5\u3002\u9996\u5148\uff0c\u5728 ",(0,o.jsx)(n.em,{children:"application.properties"})," \u4e2d\u8ffd\u52a0\u4e00\u4e2a\u914d\u7f6e\u9879\uff1a",(0,o.jsx)(n.code,{children:"a.b.my-first-key=hello spring environment"}),"\uff1b\u7136\u540e\uff0c\u901a\u8fc7 ",(0,o.jsx)(n.em,{children:"Environment"})," \u53d6\u51fa\u8fd9\u4e2a\u914d\u7f6e\u9879\u7684\u503c\uff0c\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'@SpringBootApplication\npublic class DemoApplication {\n    public static void main(String[] args) {\n        ConfigurableApplicationContext configurableApplicationContext = SpringApplication.run(DemoApplication.class, args);\n        ConfigurableWebEnvironment environment = (ConfigurableWebEnvironment)\n                configurableApplicationContext.getBean(Environment.class);\n        System.out.println(environment.getProperty("a.b.my-first-key"));\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u542f\u52a8\u5e94\u7528\u540e\uff0c\u63a7\u5236\u53f0\u6253\u5370\u51fa\u4e86 ",(0,o.jsx)(n.em,{children:"hello spring environment"})," \u5b57\u6837\uff0c\u8fd9\u4e0e\u9884\u671f\u662f\u76f8\u7b26\u7684\u3002\u53ef\u5f53\u6211\u4eec\u901a\u8fc7",(0,o.jsx)(n.code,{children:'environment.getProperty("a.b.myfirstkey")'}),"\u6216\u8005",(0,o.jsx)(n.code,{children:'environment.getProperty("a.b.my-firstkey")'}),"\u4f9d\u7136\u80fd\u591f\u83b7\u53d6\u5230\u914d\u7f6e\u9879\u7684\u5185\u5bb9\u3002",(0,o.jsx)(n.code,{children:"a.b.myfirstkey"}),"\u548c",(0,o.jsx)(n.code,{children:"a.b.my-firstkey"}),"\u5e76\u4e0d\u662f\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u5c5e\u6027\u540d\u79f0\uff0c\u53ea\u662f\u76f8\u4f3c\u800c\u5df2\uff0c\u8fd9\u7684\u786e\u5f88",(0,o.jsx)(n.strong,{children:"\u5bbd\u677e"}),"\u554a\uff0c\u54c8\u54c8\u3002\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c DEBUG \u770b\u770b\u5176\u4e2d\u7684\u539f\u7406\u3002"]}),"\n",(0,o.jsx)(n.h4,{id:"214-listenersenvironmentprepared",children:"2.1.4 listeners.environmentPrepared()"}),"\n",(0,o.jsxs)(n.p,{children:["\u6572\u9ed1\u677f\uff0c\u5404\u4f4d\u5927\u4f6c\uff0c\u8fd9\u4e2a\u8981\u8003\u7684 \uff01",(0,o.jsx)(n.code,{children:"environmentPrepared()"}),"\u65b9\u6cd5\u4f1a\u5e7f\u64ad\u4e00\u4e2a",(0,o.jsx)(n.code,{children:"ApplicationEnvironmentPreparedEvent"}),"\u4e8b\u4ef6\uff0c\u63a5\u7740\u7531",(0,o.jsx)(n.code,{children:"EnvironmentPostProcessorApplicationListener"}),"\u54cd\u5e94\u8be5\u4e8b\u4ef6\uff0c\u8fd9\u5e94\u8be5\u662f\u5178\u578b\u7684",(0,o.jsx)(n.strong,{children:"\u89c2\u5bdf\u8005\u6a21\u5f0f"}),"\u3002\u4e3b\u8981\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'public class SpringApplicationRunListeners {\n    private final List<SpringApplicationRunListener> listeners;\n\n    void environmentPrepared(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment) {\n        doWithListeners("spring.boot.application.environment-prepared",\n                (listener) -> listener.environmentPrepared(bootstrapContext, environment));\n    }\n\n    private void doWithListeners(String stepName, Consumer<SpringApplicationRunListener> listenerAction) {\n        StartupStep step = this.applicationStartup.start(stepName);\n        this.listeners.forEach(listenerAction);\n        step.end();\n    }\n}\n\npublic class EventPublishingRunListener implements SpringApplicationRunListener, Ordered {\n    @Override\n    public void environmentPrepared(ConfigurableBootstrapContext bootstrapContext,\n                                    ConfigurableEnvironment environment) {\n        this.initialMulticaster.multicastEvent(\n                new ApplicationEnvironmentPreparedEvent(bootstrapContext, this.application, this.args, environment));\n    }\n}\n\npublic class SimpleApplicationEventMulticaster extends AbstractApplicationEventMulticaster {\n    @Override\n    public void multicastEvent(ApplicationEvent event) {\n        multicastEvent(event, resolveDefaultEventType(event));\n    }\n\n    @Override\n    public void multicastEvent(final ApplicationEvent event, @Nullable ResolvableType eventType) {\n        ResolvableType type = (eventType != null ? eventType : resolveDefaultEventType(event));\n        Executor executor = getTaskExecutor();\n        for (ApplicationListener<?> listener : getApplicationListeners(event, type)) {\n            if (executor != null) {\n                executor.execute(() -> invokeListener(listener, event));\n            } else {\n                invokeListener(listener, event);\n            }\n        }\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u4e0b\u9762\u6765\u770b\u4e00\u4e0b",(0,o.jsx)(n.code,{children:"EnvironmentPostProcessorApplicationListener"}),"\u7684\u5e90\u5c71\u771f\u9762\u76ee\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class EnvironmentPostProcessorApplicationListener implements SmartApplicationListener, Ordered {\n    @Override\n    public void onApplicationEvent(ApplicationEvent event) {\n        if (event instanceof ApplicationEnvironmentPreparedEvent) {\n            onApplicationEnvironmentPreparedEvent((ApplicationEnvironmentPreparedEvent) event);\n        }\n        if (event instanceof ApplicationPreparedEvent) {\n            onApplicationPreparedEvent();\n        }\n        if (event instanceof ApplicationFailedEvent) {\n            onApplicationFailedEvent();\n        }\n    }\n    private void onApplicationEnvironmentPreparedEvent(ApplicationEnvironmentPreparedEvent event) {\n        ConfigurableEnvironment environment = event.getEnvironment();\n        SpringApplication application = event.getSpringApplication();\n        for (EnvironmentPostProcessor postProcessor : getEnvironmentPostProcessors(application.getResourceLoader(), event.getBootstrapContext())) {\n            postProcessor.postProcessEnvironment(environment, application);\n        }\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"EnvironmentPostProcessor"}),"\u662f Spring Boot \u4e3a ",(0,o.jsx)(n.em,{children:"Environment"})," \u91cf\u8eab\u6253\u9020\u7684\u6269\u5c55\u70b9\u3002\u8fd9\u91cc\u5f15\u7528\u5b98\u65b9\u6587\u6863\u4e2d\u6bd4\u8f83\u7cbe\u70bc\u7684\u4e00\u53e5\u8bdd\uff1a",(0,o.jsx)(n.em,{children:"Allows for customization of the application's Environment prior to the application context being refreshed"}),"\u3002",(0,o.jsx)(n.em,{children:"EnvironmentPostProcessor"})," \u662f\u4e00\u4e2a\u51fd\u6570\u6027\u63a5\u53e3\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public interface EnvironmentPostProcessor {\n    void postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application);\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5728\u4e0a\u8ff0 ",(0,o.jsx)(n.em,{children:"EnvironmentPostProcessorApplicationListener"})," \u4e8b\u4ef6\u5904\u7406\u903b\u8f91\u4e2d\uff0c",(0,o.jsx)(n.code,{children:"getEnvironmentPostProcessors"}),"\u8d1f\u8d23\u52a0\u8f7d\u51fa\u6240\u6709\u7684 ",(0,o.jsx)(n.em,{children:"EnvironmentPostProcessor"})," \u3002\u770b\u4e00\u4e0b\u5185\u90e8\u52a0\u8f7d\u903b\u8f91\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public interface EnvironmentPostProcessorsFactory {\n    static EnvironmentPostProcessorsFactory fromSpringFactories(ClassLoader classLoader) {\n        return new ReflectionEnvironmentPostProcessorsFactory(\n                classLoader, \n                SpringFactoriesLoader.loadFactoryNames(EnvironmentPostProcessor.class, classLoader)\n        );\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u7ee7\u7eed\u8fdb\u5165",(0,o.jsx)(n.code,{children:"SpringFactoriesLoader"}),"\u4e00\u63a2\u7a76\u7adf\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'public final class SpringFactoriesLoader {\n\n    public static final String FACTORIES_RESOURCE_LOCATION = "META-INF/spring.factories";\n\n    public static List<String> loadFactoryNames(Class<?> factoryType, ClassLoader classLoader) {\n        ClassLoader classLoaderToUse = classLoader;\n        if (classLoaderToUse == null) {\n            classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();\n        }\n        String factoryTypeName = factoryType.getName();\n        return loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());\n    }\n\n    private static Map<String, List<String>> loadSpringFactories(ClassLoader classLoader) {\n        Map<String, List<String>> result = cache.get(classLoader);\n        if (result != null) {\n            return result;\n        }\n\n        result = new HashMap<>();\n        try {\n            Enumeration<URL> urls = classLoader.getResources(FACTORIES_RESOURCE_LOCATION);\n            while (urls.hasMoreElements()) {\n                URL url = urls.nextElement();\n                UrlResource resource = new UrlResource(url);\n                Properties properties = PropertiesLoaderUtils.loadProperties(resource);\n                for (Map.Entry<?, ?> entry : properties.entrySet()) {\n                    String factoryTypeName = ((String) entry.getKey()).trim();\n                    String[] factoryImplementationNames = StringUtils.commaDelimitedListToStringArray((String) entry.getValue());\n                    for (String factoryImplementationName : factoryImplementationNames) {\n                        result.computeIfAbsent(factoryTypeName, key -> new ArrayList<>())\n                                .add(factoryImplementationName.trim());\n                    }\n                }\n            }\n            result.replaceAll((factoryType, implementations) -> implementations.stream().distinct()\n                    .collect(Collectors.collectingAndThen(Collectors.toList(), Collections::unmodifiableList)));\n            cache.put(classLoader, result);\n        } catch (IOException ex) {\n            throw new IllegalArgumentException("Unable to load factories from location [" + FACTORIES_RESOURCE_LOCATION + "]", ex);\n        }\n        return result;\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Spring SPI"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"SpringFactoriesLoader"})," \u8fd9\u4e00\u5957\u903b\u8f91\u5c31\u662f Spring \u4e2d\u7684",(0,o.jsx)(n.code,{children:"SPI"}),"\u673a\u5236\uff1b\u76f4\u767d\u70b9\u8bf4\uff0c\u5c31\u662f\u4ece",(0,o.jsx)(n.code,{children:"classpath"}),"\u4e0b\u7684",(0,o.jsx)(n.code,{children:"META-INF/spring.factories"})," \u6587\u4ef6\u4e2d\u52a0\u8f7d ",(0,o.jsx)(n.em,{children:"EnvironmentPostProcessor"})," \uff0c\u5982\u679c\u5927\u5bb6\u6709\u9700\u6c42\u5c31\u5c06\u81ea\u5df1\u5b9e\u73b0\u7684 ",(0,o.jsx)(n.em,{children:"EnvironmentPostProcessor"})," \u653e\u5230\u8be5\u6587\u4ef6\u4e2d\u5c31\u884c\u4e86\u3002\u5176\u5b9e\u4e0e",(0,o.jsx)(n.code,{children:"JDK"}),"\u4e2d\u7684",(0,o.jsx)(n.code,{children:"SPI"}),"\u673a\u5236\u5f88\u7c7b\u4f3c\u54c8\u3002"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["\u5728\u5f53\u524d\u7248\u672c\uff0cSpring Boot \u5185\u7f6e\u4e867\u4e2a ",(0,o.jsx)(n.em,{children:"EnvironmentPostProcessor"})," \u5b9e\u73b0\u7c7b\u3002\u63a5\u4e0b\u6765\u6311\u51e0\u4e2a\u6bd4\u8f83\u5178\u578b\u7684\u5206\u6790\u4e0b\u3002"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"RandomValuePropertySourceEnvironmentPostProcessor"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"RandomValuePropertySourceEnvironmentPostProcessor"}),"\u5411 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u8ffd\u52a0\u4e86\u4e00\u4e2a\u540d\u79f0\u4e3a",(0,o.jsx)(n.code,{children:"random"}),"\u7684 ",(0,o.jsx)(n.em,{children:"PropertySource"}),"\uff0c\u5373",(0,o.jsx)(n.code,{children:"RandomValuePropertySource"}),"\u3002\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class RandomValuePropertySourceEnvironmentPostProcessor implements EnvironmentPostProcessor, Ordered {\n    public static final int ORDER = Ordered.HIGHEST_PRECEDENCE + 1;\n    private final Log logger;\n\n    public RandomValuePropertySourceEnvironmentPostProcessor(Log logger) {\n        this.logger = logger;\n    }\n\n    @Override\n    public int getOrder() {\n        return ORDER;\n    }\n\n    @Override\n    public void postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application) {\n        RandomValuePropertySource.addToEnvironment(environment, this.logger);\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u90a3\u4e48\u8fd9\u4e2a ",(0,o.jsx)(n.em,{children:"RandomValuePropertySource"})," \u6709\u5565\u4f5c\u7528\u5462\uff1f\u4e3b\u8981\u5c31\u662f\u7528\u4e8e\u751f\u6210\u968f\u673a\u6570\uff0c\u6bd4\u5982\uff1a",(0,o.jsx)(n.code,{children:'environment.getProperty("random.int(5,10)")'}),"\u53ef\u4ee5\u83b7\u53d6\u4e00\u4e2a\u968f\u673a\u6570\u3002\u4ee5",(0,o.jsx)(n.code,{children:"random.int"}),"\u4e3a\u5c5e\u6027\u540d\u53ef\u4ee5\u83b7\u53d6\u4e00\u4e2a ",(0,o.jsx)(n.em,{children:"int"})," \u7c7b\u578b\u7684\u968f\u673a\u6570\uff1b\u4ee5",(0,o.jsx)(n.code,{children:"random.long"}),"\u4e3a\u5c5e\u6027\u540d\u53ef\u4ee5\u83b7\u53d6\u4e00\u4e2a ",(0,o.jsx)(n.em,{children:"long"})," \u7c7b\u578b\u7684\u968f\u673a\u6570\uff1b\u4ee5",(0,o.jsx)(n.code,{children:"random.int(5,10)"}),"\u4e3a\u5c5e\u6027\u540d\u53ef\u4ee5\u83b7\u53d6\u4e00\u4e2a ",(0,o.jsx)(n.em,{children:"[5, 10}"})," \u533a\u95f4\u5185 ",(0,o.jsx)(n.em,{children:"int"})," \u7c7b\u578b\u7684\u968f\u673a\u6570\uff0c\u66f4\u591a\u73a9\u6cd5\u5927\u5bb6\u81ea\u884c\u63a2\u7d22\u3002"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"SystemEnvironmentPropertySourceEnvironmentPostProcessor"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5f53\u524d\uff0c",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u5df2\u7ecf\u5b58\u5728\u4e00\u4e2a\u540d\u79f0\u4e3a",(0,o.jsx)(n.code,{children:"systemEnvironment"}),"\u7684 ",(0,o.jsx)(n.em,{children:"PropertySource"}),"\uff0c\u5373",(0,o.jsx)(n.code,{children:"SystemEnvironmentPropertySource"}),"\u3002",(0,o.jsx)(n.code,{children:"SystemEnvironmentPropertySourceEnvironmentPostProcessor"}),"\u7528\u4e8e\u5c06\u8be5 ",(0,o.jsx)(n.em,{children:"SystemEnvironmentPropertySource"})," \u66ff\u6362\u4e3a",(0,o.jsx)(n.code,{children:"OriginAwareSystemEnvironmentPropertySource"}),"\uff0c\u548b\u6709\u70b9\u201c\u8131\u88e4\u5b50\u653e\u5c41\uff0c\u591a\u6b64\u4e00\u4e3e\u201d\u7684\u611f\u89c9\u5462\uff0c\u54c8\u54c8\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'public class SystemEnvironmentPropertySourceEnvironmentPostProcessor implements EnvironmentPostProcessor, Ordered {\n    public static final int DEFAULT_ORDER = SpringApplicationJsonEnvironmentPostProcessor.DEFAULT_ORDER - 1;\n    private int order = DEFAULT_ORDER;\n\n    @Override\n    public int getOrder() {\n        return this.order;\n    }\n\n    @Override\n    public void postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application) {\n        String sourceName = "systemEnvironment";\n        PropertySource<?> propertySource = environment.getPropertySources().get(sourceName);\n        if (propertySource != null) {\n            replacePropertySource(environment, sourceName, propertySource, application.getEnvironmentPrefix());\n        }\n    }\n    private void replacePropertySource(ConfigurableEnvironment environment, String sourceName,\n                                       PropertySource<?> propertySource, String environmentPrefix) {\n        Map<String, Object> originalSource = (Map<String, Object>) propertySource.getSource();\n        SystemEnvironmentPropertySource source = new OriginAwareSystemEnvironmentPropertySource(sourceName, originalSource, environmentPrefix);\n        environment.getPropertySources().replace(sourceName, source);\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"SpringApplicationJsonEnvironmentPostProcessor"})}),"\n",(0,o.jsxs)(n.p,{children:["\u6211\u4eec\u5728\u901a\u8fc7",(0,o.jsx)(n.code,{children:'java -jar -Dspring.application.json={"name":"duxiaotou"} app.jar'}),"\u542f\u52a8 Spring Boot \u5e94\u7528\u7684\u65f6\u5019\uff0c\u8be5\u5c5e\u6027\u4f1a\u88ab\u81ea\u52a8\u6dfb\u52a0\u5230 JVM \u7cfb\u7edf\u5c5e\u6027\u4e2d (\u5176\u5b9e ",(0,o.jsx)(n.em,{children:"-Dkey=value"})," \u8fd9\u79cd\u5f62\u5f0f\u7684\u5c5e\u6027\u5747\u662f\u5982\u6b64)\uff0c\u5176\u7b49\u6548\u4e8e",(0,o.jsx)(n.code,{children:"System.setProperty(key, value)"}),"\uff1b\u800c\u5f53\u5b58\u5728",(0,o.jsx)(n.code,{children:"SPRING_APPLICATION_JSON"}),"\u8fd9\u4e00\u7cfb\u7edf\u53d8\u91cf\u65f6\uff0c\u81ea\u7136\u4e5f\u4f1a\u5728",(0,o.jsx)(n.code,{children:"System.getenv()"}),"\u4e2d\u51fa\u73b0\u3002\u524d\u9762\u66fe\u7ecf\u63d0\u5230\u8fc7",(0,o.jsx)(n.code,{children:"System.getProperties()"}),"\u4ee3\u8868\u7684\u662f",(0,o.jsx)(n.code,{children:"systemProperties"}),"\u8fd9\u4e00 ",(0,o.jsx)(n.em,{children:"PropertySource"}),"\uff0c\u800c",(0,o.jsx)(n.code,{children:"System.getenv()"}),"\u5219\u4ee3\u8868\u7684\u662f",(0,o.jsx)(n.code,{children:"systemEnvironment"}),"\u8fd9\u4e00 ",(0,o.jsx)(n.em,{children:"PropertySource"}),"\u3002",(0,o.jsx)(n.code,{children:"SpringApplicationJsonEnvironmentPostProcessor"}),"\u5c31\u662f\u7528\u4e8e\u4ece\u8fd9\u4e24\u4e2a ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u4e2d\u62bd\u53d6\u51fa ",(0,o.jsx)(n.em,{children:"spring.application.json"})," \u6216 ",(0,o.jsx)(n.em,{children:"SPRING_APPLICATION_JSON"})," \u7684 ",(0,o.jsx)(n.em,{children:"JSON"})," \u4e32\uff0c\u8fdb\u800c\u5355\u72ec\u5411 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u8ffd\u52a0\u4e00\u4e2a\u540d\u79f0\u4e3a",(0,o.jsx)(n.code,{children:"spring.application.json"}),"\u7684 ",(0,o.jsx)(n.em,{children:"PropertySource"}),"\uff0c\u5373",(0,o.jsx)(n.code,{children:"JsonPropertySource"}),"\u3002"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"ConfigDataEnvironmentPostProcessor"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"ConfigDataEnvironmentPostProcessor"}),"\u8d1f\u8d23\u5c06",(0,o.jsx)(n.code,{children:"optional:classpath:/"}),"\u3001",(0,o.jsx)(n.code,{children:"optional:classpath:/config/"}),"\u3001",(0,o.jsx)(n.code,{children:"optional:file:./"}),"\u3001",(0,o.jsx)(n.code,{children:"optional:file:./config/"}),"\u548c",(0,o.jsx)(n.code,{children:"optional:file:./config/*/"}),"\u8fd9\u4e9b\u76ee\u5f55\u4e0b\u7684 ",(0,o.jsx)(n.em,{children:"application.properties"})," \u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u51fa\u6765\uff1b\u5982\u679c\u8fd8\u6307\u5b9a\u4e86 _spring.profiles.active_\u7684\u8bdd\uff0c\u540c\u65f6\u4e5f\u4f1a\u5c06\u8fd9\u4e9b\u76ee\u5f55\u4e0b\u7684 ",(0,o.jsx)(n.code,{children:"_application-{profile}.properties_ "}),"\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u51fa\u6765\u3002\u6700\u7ec8\uff0c",(0,o.jsx)(n.em,{children:"ConfigDataEnvironmentPostProcessor"})," \u5c06\u4f1a\u5411 ",(0,o.jsx)(n.em,{children:"Environment"})," \u4e2d\u8ffd\u52a0\u4e24\u4e2a",(0,o.jsx)(n.code,{children:"OriginTrackedMapPropertySource"}),"\uff0c\u8fd9\u4fe9 ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u4f4d\u4e8e ",(0,o.jsx)(n.em,{children:"Environment"})," \u7684\u5c3e\u90e8\uff1b\u5176\u4e2d ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.code,{children:"application-{profile}.properties"})})," \u6240\u4ee3\u8868\u7684 ",(0,o.jsx)(n.em,{children:"OriginTrackedMapPropertySource"})," \u662f\u6392\u5728 ",(0,o.jsx)(n.em,{children:"application.properties"})," \u6240\u4ee3\u8868\u7684 ",(0,o.jsx)(n.em,{children:"OriginTrackedMapPropertySource"})," \u524d\u9762\u7684\uff0c\u8fd9\u4e00\u70b9\u633a\u91cd\u8981\u3002"]}),"\n",(0,o.jsx)(n.h2,{id:"3-jasypt-\u6838\u5fc3\u539f\u7406\u89e3\u8bfb",children:"3 jasypt \u6838\u5fc3\u539f\u7406\u89e3\u8bfb"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"jasypt"}),"\u57fa\u7840\u7ec4\u4ef6\u5e93\u4e0e",(0,o.jsx)(n.code,{children:"jasypt-spring-boot-starter"}),"\u662f\u4e0d\u540c\u4f5c\u8005\u5199\u7684\uff0c\u540e\u8005\u53ea\u662f\u4e3a jasypt \u7ec4\u4ef6\u5f00\u53d1\u4e86 Spring Boot \u7684\u8d77\u6b65\u4f9d\u8d56\u7ec4\u4ef6\u800c\u5df2\u3002\u672c\u6587\u6240\u5206\u6790\u7684\u5176\u5b9e\u5c31\u662f\u8fd9\u4e2a\u8d77\u6b65\u4f9d\u8d56\u7ec4\u4ef6\u3002"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.em,{children:"application.properties"})," \u914d\u7f6e\u6587\u4ef6\u4e2d\u5173\u4e8e\u6570\u636e\u6e90\u7684\u5bc6\u7801\u662f\u4e00\u4e2a\u52a0\u5bc6\u540e\u7684\u5bc6\u6587\uff0c\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"spring.datasource.hikari.password=ENC(4+t9a5QG8NkNdWVS6UjIX3dj18UtYRMqU6eb3wUKjivOiDHFLZC/RTK7HuWWkUtV)\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5f53",(0,o.jsx)(n.code,{children:"HikariDataSource"}),"\u5b8c\u6210\u5c5e\u6027\u586b\u5145\u64cd\u4f5c\u540e\uff0c\u8be5 Bean \u4e2d ",(0,o.jsx)(n.em,{children:"password"})," \u5b57\u6bb5\u7684\u503c\u548b\u5c31\u53d8\u4e3a\u89e3\u5bc6\u540e\u7684 ",(0,o.jsx)(n.em,{children:"qwe@1234"})," \u8fd9\u4e00\u660e\u6587\u4e86\u5462\uff1f\u663e\u7136\uff0cSpring Boot \u4e3a ",(0,o.jsx)(n.em,{children:"Environment"})," \u63d0\u4f9b\u7684",(0,o.jsx)(n.code,{children:"EnvironmentPostProcessor"}),"\u8fd9\u4e00\u62d3\u5c55\u70b9\u53ef\u4ee5\u5b9e\u73b0\u5077\u5929\u6362\u65e5\uff01\u4f46\u4f5c\u8005\u6ca1\u6709\u7528\u5b83\uff0c\u800c\u662f\u4f7f\u7528\u4e86 Spring \u4e2d\u7684\u4e00\u4e2a ",(0,o.jsx)(n.em,{children:"IoC \u62d3\u5c55\u70b9"}),"\uff0c\u5373",(0,o.jsx)(n.code,{children:"BeanFactoryPostProcessor"}),"\uff0c\u8fd9\u4e5f\u662f\u5b8c\u5168\u53ef\u4ee5\u7684\uff0c\u56e0\u4e3a\u5f53\u6267\u884c\u5230 ",(0,o.jsx)(n.em,{children:"BeanFactoryPostProcessor"})," \u4e2d\u7684",(0,o.jsx)(n.code,{children:"postProcessBeanFactory()"}),"\u903b\u8f91\u65f6\uff0c\u53ea\u662f\u5b8c\u6210\u4e86\u6240\u6709",(0,o.jsx)(n.code,{children:"BeanDefinition"}),"\u7684\u52a0\u8f7d\uff0c\u4f46\u8fd8\u6ca1\u6709\u5b9e\u4f8b\u5316 ",(0,o.jsx)(n.em,{children:"BeanDefinition"})," \u5404\u81ea\u6240\u5bf9\u5e94\u7684 Bean\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u4e0b\u9762\u770b\u4e00\u4e0b",(0,o.jsx)(n.code,{children:"EnableEncryptablePropertiesBeanFactoryPostProcessor"}),"\u4e2d\u7684\u5185\u5bb9\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class EnableEncryptablePropertiesBeanFactoryPostProcessor implements BeanFactoryPostProcessor, Ordered {\n\n    private final ConfigurableEnvironment environment;\n    private final EncryptablePropertySourceConverter converter;\n\n    public EnableEncryptablePropertiesBeanFactoryPostProcessor(ConfigurableEnvironment environment, EncryptablePropertySourceConverter converter) {\n        this.environment = environment;\n        this.converter = converter;\n    }\n\n    @Override\n    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {\n        MutablePropertySources propSources = environment.getPropertySources();\n        converter.convertPropertySources(propSources);\n    }\n\n    @Override\n    public int getOrder() {\n        return Ordered.LOWEST_PRECEDENCE - 100;\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u4e0a\u8ff0\u6e90\u7801\u8868\u660e\u8be5 ",(0,o.jsx)(n.em,{children:"BeanFactoryPostProcessor"})," \u501f\u52a9",(0,o.jsx)(n.code,{children:"EncryptablePropertySourceConverter"}),"\u5bf9 ",(0,o.jsx)(n.em,{children:"MutablePropertySources"})," \u505a\u4e86\u4e00\u5c42\u8f6c\u6362\uff0c\u90a3\u4e48\u8f6c\u6362\u6210\u5565\u4e86\u5462\uff1f"]}),"\n",(0,o.jsxs)(n.p,{children:["\u63a5\u7740\uff0c\u8ddf\u8fdb ",(0,o.jsx)(n.em,{children:"EncryptablePropertySourceConverter"}),"\uff0c\u6838\u5fc3\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class EncryptablePropertySourceConverter {\n\n    public void convertPropertySources(MutablePropertySources propSources) {\n        propSources.stream()\n                .filter(ps -> !(ps instanceof EncryptablePropertySource))\n                .map(this::makeEncryptable)\n                .collect(toList())\n                .forEach(ps -> propSources.replace(ps.getName(), ps));\n    }\n\n    public <T> PropertySource<T> makeEncryptable(PropertySource<T> propertySource) {\n        if (propertySource instanceof EncryptablePropertySource \n                || skipPropertySourceClasses.stream().anyMatch(skipClass -> skipClass.equals(propertySource.getClass()))) {\n            return propertySource;\n        }\n        PropertySource<T> encryptablePropertySource = convertPropertySource(propertySource);\n        return encryptablePropertySource;\n    }\n\n    private <T> PropertySource<T> convertPropertySource(PropertySource<T> propertySource) {\n        PropertySource<T> encryptablePropertySource;\n        if (propertySource instanceof SystemEnvironmentPropertySource) {\n            encryptablePropertySource = (PropertySource<T>) new EncryptableSystemEnvironmentPropertySourceWrapper((SystemEnvironmentPropertySource) propertySource, propertyResolver, propertyFilter);\n        } else if (propertySource instanceof MapPropertySource) {\n            encryptablePropertySource = (PropertySource<T>) new EncryptableMapPropertySourceWrapper((MapPropertySource) propertySource, propertyResolver, propertyFilter);\n        } else if (propertySource instanceof EnumerablePropertySource) {\n            encryptablePropertySource = new EncryptableEnumerablePropertySourceWrapper<>((EnumerablePropertySource) propertySource, propertyResolver, propertyFilter);\n        } else {\n            encryptablePropertySource = new EncryptablePropertySourceWrapper<>(propertySource, propertyResolver, propertyFilter);\n        }\n        return encryptablePropertySource;\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u663e\u7136\uff0c\u5b83\u5c06\u76f8\u5173\u539f\u751f ",(0,o.jsx)(n.em,{children:"PropertySource"})," \u8f6c\u6362\u4e3a\u4e86\u4e00\u4e2a",(0,o.jsx)(n.code,{children:"EncryptablePropertySourceWrapper"}),"\uff0c\u90a3\u8fd9\u4e2a\u80af\u5b9a\u53ef\u4ee5\u5b9e\u73b0\u5bc6\u6587\u89e3\u5bc6\uff0c\u5fc5\u987b\u7684\uff01"]}),"\n",(0,o.jsxs)(n.p,{children:["\u7ee7\u7eed\uff0c\u8ddf\u8fdb",(0,o.jsx)(n.code,{children:"EncryptablePropertySourceWrapper"}),"\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class EncryptablePropertySourceWrapper<T> extends PropertySource<T> implements EncryptablePropertySource<T> {\n    private final CachingDelegateEncryptablePropertySource<T> encryptableDelegate;\n\n    public EncryptablePropertySourceWrapper(PropertySource<T> delegate, EncryptablePropertyResolver resolver, EncryptablePropertyFilter filter) {\n        super(delegate.getName(), delegate.getSource());\n        encryptableDelegate = new CachingDelegateEncryptablePropertySource<>(delegate, resolver, filter);\n    }\n\n    @Override\n    public Object getProperty(String name) {\n        return encryptableDelegate.getProperty(name);\n    }\n\n    @Override\n    public PropertySource<T> getDelegate() {\n        return encryptableDelegate;\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5931\u671b\uff01\u6ca1\u770b\u51fa\u5565\u89e3\u5bc6\u903b\u8f91\uff0c\u4f46\u4ece\u5176 ",(0,o.jsx)(n.em,{children:"getProperty"})," \u65b9\u6cd5\u6765\u770b\uff0c\u5c06\u5177\u4f53\u89e3\u6790\u903b\u8f91\u59d4\u6d3e\u7ed9\u4e86",(0,o.jsx)(n.code,{children:"CachingDelegateEncryptablePropertySource"}),"\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u6ca1\u529e\u6cd5\uff0c\u53ea\u80fd\u5230 ",(0,o.jsx)(n.em,{children:"CachingDelegateEncryptablePropertySource"})," \u4e2d\u4e00\u63a2\u7a76\u7adf\u4e86\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"public class CachingDelegateEncryptablePropertySource<T> extends PropertySource<T> implements EncryptablePropertySource<T> {\n    private final PropertySource<T> delegate;\n    private final EncryptablePropertyResolver resolver;\n    private final EncryptablePropertyFilter filter;\n    private final Map<String, Object> cache;\n\n    public CachingDelegateEncryptablePropertySource(PropertySource<T> delegate, EncryptablePropertyResolver resolver, EncryptablePropertyFilter filter) {\n        super(delegate.getName(), delegate.getSource());\n        this.delegate = delegate;\n        this.resolver = resolver;\n        this.filter = filter;\n        this.cache = new HashMap<>();\n    }\n\n    @Override\n    public PropertySource<T> getDelegate() {\n        return delegate;\n    }\n\n    @Override\n    public Object getProperty(String name) {\n        if (cache.containsKey(name)) {\n            return cache.get(name);\n        }\n        synchronized (name.intern()) {\n            if (!cache.containsKey(name)) {\n                Object resolved = getProperty(resolver, filter, delegate, name);\n                if (resolved != null) {\n                    cache.put(name, resolved);\n                }\n            }\n            return cache.get(name);\n        }\n    }\n}\n\u590d\u5236\u4ee3\u7801\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u7ec8\u4e8e\uff0c\u8ddf\u8fdb\u5230",(0,o.jsx)(n.code,{children:"EncryptablePropertySource"}),"\u4e2d\u770b\u5230\u4e86\u89e3\u5bc6\u7684\u6700\u7ec8\u903b\u8f91\u3002\u5176\u4e2d\uff0c",(0,o.jsx)(n.code,{children:"EncryptablePropertyDetector"}),"\u8d1f\u8d23\u63a2\u6d4b\u76f8\u5173\u5c5e\u6027\u662f\u5426\u9700\u8981\u5bf9\u5176\u89e3\u5bc6\uff0c\u4e3b\u8981\u901a\u8fc7\u5224\u65ad\u8be5\u5c5e\u6027\u503c\u662f\u5426\u7531",(0,o.jsx)(n.code,{children:"ENC()"}),"\u5305\u88f9\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'public interface EncryptablePropertySource<T> extends OriginLookup<String> {\n    default Object getProperty(EncryptablePropertyResolver resolver, EncryptablePropertyFilter filter, PropertySource<T> source, String name) {\n        Object value = source.getProperty(name);\n        if (value != null && filter.shouldInclude(source, name) && value instanceof String) {\n            String stringValue = String.valueOf(value);\n            return resolver.resolvePropertyValue(stringValue);\n        }\n        return value;\n    }\n}\n\npublic class DefaultPropertyResolver implements EncryptablePropertyResolver {\n\n    private final Environment environment;\n    private StringEncryptor encryptor;\n    private EncryptablePropertyDetector detector;\n\n    @Override\n    public String resolvePropertyValue(String value) {\n        return Optional.ofNullable(value)\n                .map(environment::resolvePlaceholders)\n                .filter(detector::isEncrypted)\n                .map(resolvedValue -> {\n                    try {\n                        String unwrappedProperty = detector.unwrapEncryptedValue(resolvedValue.trim());\n                        String resolvedProperty = environment.resolvePlaceholders(unwrappedProperty);\n                        return encryptor.decrypt(resolvedProperty);\n                    } catch (EncryptionOperationNotPossibleException e) {\n                        throw new DecryptionException("Unable to decrypt property: " + value + " resolved to: " + resolvedValue + ". Decryption of Properties failed,  make sure encryption/decryption " +\n                                "passwords match", e);\n                    }\n                })\n                .orElse(value);\n    }\n}\n\u590d\u5236\u4ee3\u7801\n'})}),"\n",(0,o.jsx)(n.h2,{id:"4-\u603b\u7ed3",children:"4 \u603b\u7ed3"}),"\n",(0,o.jsxs)(n.p,{children:["\u603b\u7ed3\u6027\u7684\u6587\u5b57\u5c31\u4e0d\u518d\u8bf4\u4e86\uff0c\u7b14\u8005\u73b0\u5728\u6587\u601d\u6cc9\u6d8c\uff0c\u5426\u5219\u53c8\u80fd\u6c34300\u5b57\u3002\u6700\u540e\uff0c\u5e0c\u671b\u5927\u5bb6\u8bb0\u4f4f\u5728\u5f53\u524d Spring Boot \u7248\u672c\u4e2d\uff0c\u7531",(0,o.jsx)(n.code,{children:"ApplicationServletEnvironment"}),"\u626e\u6f14 ",(0,o.jsx)(n.em,{children:"Environment"}),"\uff0c\u5176\u6700\u7ec8\u5c06\u59d4\u6d3e",(0,o.jsx)(n.code,{children:"ConfigurationPropertySourcesPropertyResolver"}),"\u53bb\u83b7\u53d6\u5c5e\u6027\u503c\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u4f5c\u8005\uff1a\u7a0b\u5e8f\u733f\u675c\u5c0f\u5934\n\u94fe\u63a5\uff1a",(0,o.jsx)(n.a,{href:"https://juejin.cn/post/7098299623759937543",children:"https://juejin.cn/post/7098299623759937543"}),"\n\u6765\u6e90\uff1a\u7a00\u571f\u6398\u91d1\n\u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002"]}),"\n",(0,o.jsx)(n.h1,{id:"\u53c2\u8003\u6587\u7ae0",children:"\u53c2\u8003\u6587\u7ae0"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://www.w3cschool.cn/wkspring",children:"https://www.w3cschool.cn/wkspring"}),"\n",(0,o.jsx)(n.a,{href:"https://www.runoob.com/w3cnote/basic-knowledge-summary-of-spring.html",children:"https://www.runoob.com/w3cnote/basic-knowledge-summary-of-spring.html"}),"\n",(0,o.jsx)(n.a,{href:"http://codepub.cn/2015/06/21/Basic-knowledge-summary-of-Spring",children:"http://codepub.cn/2015/06/21/Basic-knowledge-summary-of-Spring"}),"\n",(0,o.jsx)(n.a,{href:"https://dunwu.github.io/spring-tutorial",children:"https://dunwu.github.io/spring-tutorial"}),"\n",(0,o.jsx)(n.a,{href:"https://mszlu.com/java/spring",children:"https://mszlu.com/java/spring"}),"\n",(0,o.jsx)(n.a,{href:"http://c.biancheng.net/spring/aop-module.html",children:"http://c.biancheng.net/spring/aop-module.html"})]})]})}function d(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},88672:(e,n,r)=>{r.d(n,{Z:()=>c,a:()=>s});var o=r(50959);const t={},i=o.createContext(t);function s(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);