"use strict";(self.webpackChunkcode_note_blog=self.webpackChunkcode_note_blog||[]).push([[7893],{63777:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});var i=s(11527),o=s(88672);const t={},c=void 0,r={id:"Spring\u5168\u5bb6\u6876/SpringBoot\u6e90\u7801\u89e3\u6790/SpringBoot\u81ea\u52a8\u88c5\u914d\uff08\u4e8c\uff09\uff1a\u6761\u4ef6\u6ce8\u89e3",title:"SpringBoot\u81ea\u52a8\u88c5\u914d\uff08\u4e8c\uff09\uff1a\u6761\u4ef6\u6ce8\u89e3",description:"1\\. \u6761\u4ef6\u6ce8\u89e3\u53ca\u5176\u5224\u65ad\u7c7b",source:"@site/docs/Spring\u5168\u5bb6\u6876/SpringBoot\u6e90\u7801\u89e3\u6790/SpringBoot\u81ea\u52a8\u88c5\u914d\uff08\u4e8c\uff09\uff1a\u6761\u4ef6\u6ce8\u89e3.md",sourceDirName:"Spring\u5168\u5bb6\u6876/SpringBoot\u6e90\u7801\u89e3\u6790",slug:"/Spring\u5168\u5bb6\u6876/SpringBoot\u6e90\u7801\u89e3\u6790/SpringBoot\u81ea\u52a8\u88c5\u914d\uff08\u4e8c\uff09\uff1a\u6761\u4ef6\u6ce8\u89e3",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/SpringBoot\u6e90\u7801\u89e3\u6790/SpringBoot\u81ea\u52a8\u88c5\u914d\uff08\u4e8c\uff09\uff1a\u6761\u4ef6\u6ce8\u89e3",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring\u5168\u5bb6\u6876/SpringBoot\u6e90\u7801\u89e3\u6790/SpringBoot\u81ea\u52a8\u88c5\u914d\uff08\u4e8c\uff09\uff1a\u6761\u4ef6\u6ce8\u89e3.md",tags:[],version:"current",frontMatter:{},sidebar:"spring",previous:{title:"SpringBoot\u542f\u52a8\u6d41\u7a0b\uff08\u4e00\uff09\uff1a\u51c6\u5907SpringApplication",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/SpringBoot\u6e90\u7801\u89e3\u6790/SpringBoot\u542f\u52a8\u6d41\u7a0b\uff08\u4e00\uff09\uff1a\u51c6\u5907SpringApplication"},next:{title:"SpringBoot\u81ea\u52a8\u88c5\u914d\uff08\u4e09\uff09\uff1a\u81ea\u52a8\u88c5\u914d\u987a\u5e8f",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/SpringBoot\u6e90\u7801\u89e3\u6790/SpringBoot\u81ea\u52a8\u88c5\u914d\uff08\u4e09\uff09\uff1a\u81ea\u52a8\u88c5\u914d\u987a\u5e8f"}},d={},a=[{value:"1. \u6761\u4ef6\u6ce8\u89e3\u53ca\u5176\u5224\u65ad\u7c7b",id:"1-\u6761\u4ef6\u6ce8\u89e3\u53ca\u5176\u5224\u65ad\u7c7b",level:3},{value:"2. <code>SpringBootCondition#matches</code>",id:"2-springbootconditionmatches",level:3},{value:"3. <code>@ConditionalOnClass</code>: <code>OnClassCondition#getMatchOutcome</code>",id:"3-conditionalonclass-onclassconditiongetmatchoutcome",level:3},{value:"4. <code>@ConditionalOnBean</code>: <code>OnBeanCondition#getMatchOutcome</code>",id:"4-conditionalonbean-onbeanconditiongetmatchoutcome",level:3},{value:"<code>OnBeanCondition#getMatchingBeans</code>",id:"onbeanconditiongetmatchingbeans",level:4},{value:"5. <code>@ConditionalOnProperty</code>\uff1a<code>OnPropertyCondition#getMatchOutcome</code>",id:"5-conditionalonpropertyonpropertyconditiongetmatchoutcome",level:3},{value:"6. <code>@ConditionalOnResource</code>\uff1a<code>OnResourceCondition#getMatchOutcome</code>",id:"6-conditionalonresourceonresourceconditiongetmatchoutcome",level:3},{value:"7. <code>@ConditionalOnWebApplication</code>\uff1a<code>OnWebApplicationCondition#getMatchOutcome</code>",id:"7-conditionalonwebapplicationonwebapplicationconditiongetmatchoutcome",level:3},{value:"8. <code>@ConditionalOnExpression</code>\uff1a<code>OnExpressionCondition#getMatchOutcome</code>",id:"8-conditionalonexpressiononexpressionconditiongetmatchoutcome",level:3}];function l(n){const e={a:"a",code:"code",em:"em",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h3,{id:"1-\u6761\u4ef6\u6ce8\u89e3\u53ca\u5176\u5224\u65ad\u7c7b",children:"1. \u6761\u4ef6\u6ce8\u89e3\u53ca\u5176\u5224\u65ad\u7c7b"}),"\n",(0,i.jsxs)(e.p,{children:["\u5728 ",(0,i.jsx)(e.a,{href:"https://my.oschina.net/funcy/blog/4870868",children:"springboot \u81ea\u52a8\u88c5\u914d\u4e4b\u52a0\u8f7d\u81ea\u52a8\u88c5\u914d\u7c7b"}),"\u4e00\u6587\u4e2d\uff0c\u6211\u4eec\u5206\u6790\u5230 springboot \u4f1a\u52a0\u8f7d ",(0,i.jsx)(e.code,{children:"META-INF/spring.factories"})," \u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u81ea\u52a8\u88c5\u914d\u7c7b\uff0c\u52a0\u8f7d\u5230\u8fd9\u4e9b\u81ea\u52a8\u88c5\u914d\u7c7b\u540e\uff0c\u8fd9\u4e9b\u7c7b\u4e2d\u7684 bean \u5c31\u4e00\u5b9a\u4f1a\u521d\u59cb\u5316\u5417\uff1f\u5e76\u4e0d\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5bf9\u5e94\u7684 Bean \u751f\u6210\u65b9\u6cd5\u4e0a\u4f7f\u7528",(0,i.jsx)(e.strong,{children:"\u6761\u4ef6\u6ce8\u89e3"}),"\u6765\u63a7\u5236\u7c7b\u662f\u5426\u8fdb\u884c\u521d\u59cb\u5316\uff01"]}),"\n",(0,i.jsx)(e.p,{children:"springboot \u63d0\u4f9b\u7684\u6761\u4ef6\u6ce8\u89e3\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-0e8d27c887fb6ca142672cad1c60e9de207.png",alt:""})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u91cc\u5217\u4e3e\u90e8\u5206\u5982\u4e0b\uff1a"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u6ce8\u89e3\u7c7b\u578b"}),(0,i.jsx)(e.th,{children:"\u6ce8\u89e3\u7c7b\u578b"}),(0,i.jsx)(e.th,{children:"\u529f\u80fd\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"class \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnClass"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingClass"})]}),(0,i.jsxs)(e.td,{children:["\u5f53\u6307\u5b9a\u7684\u7c7b",(0,i.jsx)(e.strong,{children:"\u5b58\u5728 / \u7f3a\u5931"}),"\u65f6\u521d\u59cb\u5316\u8be5 bean"]})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"bean \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})]}),(0,i.jsxs)(e.td,{children:["\u5f53\u6307\u5b9a\u7684 bean ",(0,i.jsx)(e.strong,{children:"\u5b58\u5728 / \u7f3a\u5931"}),"\u65f6\u521d\u59cb\u5316\u8be5 bean"]})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5c5e\u6027\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnProperty"})}),(0,i.jsx)(e.td,{children:"\u5f53\u6307\u5b9a\u7684\u5c5e\u6027\u5b58\u5728\u521d\u59cb\u5316\u8be5 bean"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Resource \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnResource"})}),(0,i.jsx)(e.td,{children:"\u5f53\u6307\u5b9a\u7684\u8d44\u6e90\u5b58\u5728\u521d\u59cb\u5316\u8be5 bean"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Web \u5e94\u7528\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnWebApplication"})," / ",(0,i.jsx)(e.code,{children:"@ConditionalOnNotWebApplication"})]}),(0,i.jsxs)(e.td,{children:["\u5f53\u524d\u5e94\u7528",(0,i.jsx)(e.strong,{children:"\u4e3a / \u4e0d\u4e3a"})," web \u5e94\u7528\u65f6\u521d\u59cb\u5316\u8be5 bean"]})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"spring \u8868\u8fbe\u5f0f\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnExpression"})}),(0,i.jsx)(e.td,{children:"\u5f53\u8868\u8fbe\u5f0f\u7ed3\u679c\u4e3a true \u65f6\u521d\u59cb\u5316\u8be5 bean"})]})]})]}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"@ConditionalOnClass"})," \u770b\u770b\u8be5\u6ce8\u89e3\u7684\u5185\u5bb9\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"...\n@Conditional(OnClassCondition.class)\npublic @interface ConditionalOnClass {\n    ...\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c",(0,i.jsx)(e.code,{children:"ConditionalOnClass"})," \u7ec4\u5408\u4e86 ",(0,i.jsx)(e.code,{children:"@Conditional"})," \u6ce8\u89e3\u7684\u529f\u80fd\uff0c\u5904\u7406\u7c7b\u662f ",(0,i.jsx)(e.code,{children:"OnClassCondition.class"}),"\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5173\u4e8e ",(0,i.jsx)(e.code,{children:"@Conditional"})," \u6ce8\u89e3\u53ef\u4ee5\u53c2\u8003 ",(0,i.jsx)(e.a,{href:"https://my.oschina.net/funcy/blog/4873444",children:"ConfigurationClassPostProcessor \u4e4b\u5904\u7406 @Conditional \u6ce8\u89e3"}),"\uff0c\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u8bf4 ",(0,i.jsx)(e.code,{children:"@Conditional"})," \u7684\u4f7f\u7528\u65b9\u5f0f\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"@Conditional"})," \u662f spring \u5904\u7406\u7684\u6761\u4ef6\u6ce8\u89e3\uff1b"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"@Conditional"})," \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5c5e\u6027 ",(0,i.jsx)(e.code,{children:"value"}),"\uff0c\u7c7b\u578b\u4e3a ",(0,i.jsx)(e.code,{children:"Class"}),"\uff0c\u5176\u5fc5\u987b\u662f ",(0,i.jsx)(e.code,{children:"Condition"})," \u7684\u5b50\u7c7b\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"Class<? extends Condition>[] value();\n\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"Condition"})," \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a ",(0,i.jsx)(e.code,{children:"matches(...)"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"public interface Condition {\n\n    boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata);\n\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u53ea\u6709\u5728 ",(0,i.jsx)(e.code,{children:"matches(...)"})," \u65b9\u6cd5\u8fd4\u56de ",(0,i.jsx)(e.code,{children:"true"})," \u65f6\uff0c",(0,i.jsx)(e.code,{children:"ConfigurationClassPostProcessor"})," \u624d\u4f1a\u5c06\u5176\u5bf9\u5e94\u7684 bean \u6ce8\u518c\u5230 ",(0,i.jsx)(e.code,{children:"beanFactory"})," \u7684 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u603b\u7ed3\u5b8c ",(0,i.jsx)(e.code,{children:"@Conditional"})," \u7684\u4f7f\u7528\u65b9\u5f0f\u540e\uff0c\u6211\u4eec\u5c31\u660e\u767d\u4e86\uff1a",(0,i.jsx)(e.code,{children:"OnClassCondition.class"})," \u662f ",(0,i.jsx)(e.code,{children:"Condition"})," \u7684\u5b50\u7c7b\uff0c\u5176 ",(0,i.jsx)(e.code,{children:"matches(...)"})," \u65b9\u6cd5\u7528\u6765\u5904\u7406\u4e3b\u8981\u6761\u4ef6\u89c4\u5219\u3002\u540c\u7406\uff0c\u5176\u4ed6\u6761\u4ef6\u6ce8\u89e3\u7684\u5904\u7406\u65b9\u5f0f\u4e5f\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u603b\u7ed3\u4e0b\u6761\u4ef6\u6ce8\u89e3\u7684\u5224\u65ad\u7c7b\uff1a"]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u6ce8\u89e3\u7c7b\u578b"}),(0,i.jsx)(e.th,{children:"\u6ce8\u89e3\u7c7b\u578b"}),(0,i.jsx)(e.th,{children:"\u6761\u4ef6\u5224\u65ad\u7c7b"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"class \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnClass"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingClass"})]}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnClassCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"bean \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})]}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnBeanCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5c5e\u6027\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnProperty"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnPropertyCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Resource \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnResource"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnResourceCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Web \u5e94\u7528\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnWebApplication"})," / ",(0,i.jsx)(e.code,{children:"@ConditionalOnNotWebApplication"})]}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnWebApplicationCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"spring \u8868\u8fbe\u5f0f\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnExpression"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnExpressionCondition"})})]})]})]}),"\n",(0,i.jsxs)(e.p,{children:["\u63a5\u4e0b\u6765\uff0c\u5206\u6790\u76ee\u7684\u5c31\u5f88\u660e\u786e\u4e86\uff1a\u8981\u5206\u6790\u8fd9\u4e9b\u6761\u4ef6\u6ce8\u89e3\u7684\u5224\u65ad\u903b\u8f91\uff0c\u53ea\u9700\u8981\u5206\u6790\u5bf9\u5e94\u6761\u4ef6\u5224\u65ad\u7c7b\u7684 ",(0,i.jsx)(e.code,{children:"matches(...)"})," \u65b9\u6cd5\u5c31\u53ef\u4ee5\u4e86\u3002"]}),"\n",(0,i.jsxs)(e.h3,{id:"2-springbootconditionmatches",children:["2. ",(0,i.jsx)(e.code,{children:"SpringBootCondition#matches"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"OnClassCondition#matches"})," \u65b9\u6cd5\uff0c\u53d1\u73b0\u6765\u5230\u7684\u662f ",(0,i.jsx)(e.code,{children:"SpringBootCondition"}),"\uff0c\u76f8\u5173\u65b9\u6cd5\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"public abstract class SpringBootCondition implements Condition {\n\n    private final Log logger = LogFactory.getLog(getClass());\n\n    @Override\n    public final boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {\n        String classOrMethodName = getClassOrMethodName(metadata);\n        try {\n            // \u83b7\u53d6\u6761\u4ef6\u5339\u914d\u7ed3\u679c\n            ConditionOutcome outcome = getMatchOutcome(context, metadata);\n            // \u6253\u5370\u4e00\u6761\u65e5\u5fd7\n            logOutcome(classOrMethodName, outcome);\n            // \u8bb0\u5f55\u6761\u4ef6\u8bc4\u4f30\u7684\u53d1\u751f\uff0c\u7b80\u5355\u7406\u89e3\u4e3a\u8bb0\u5f55\u4e00\u6761\u6761\u4ef6\u5224\u65ad\u8bb0\u5f55\u5427\n            recordEvaluation(context, classOrMethodName, outcome);\n            // \u8fd9\u91cc\u8fd4\u56de\u6700\u7ec8\u7ed3\u679c\uff1atrue \u6216 false\n            return outcome.isMatch();\n        }\n        catch (NoClassDefFoundError ex) {\n            throw new IllegalStateException(...);\n        }\n        catch (RuntimeException ex) {\n            throw new IllegalStateException(...);\n        }\n    }\n\n    /**\n     * \u8fd9\u662f\u4e2a\u62bd\u8c61\u65b9\u5f0f\uff0c\u5177\u4f53\u5185\u5bb9\u7531\u5b50\u7c7b\u5b9e\u73b0\n     */\n    public abstract ConditionOutcome getMatchOutcome(\n        ConditionContext context, AnnotatedTypeMetadata metadata);\n\n    ...\n\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"SpringBootCondition"})," \u7684 ",(0,i.jsx)(e.code,{children:"matches(...)"})," \u5173\u952e\u5c31\u4e24\u884c\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"...\nConditionOutcome outcome = getMatchOutcome(context, metadata);\n...\nreturn outcome.isMatch();\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u800c ",(0,i.jsx)(e.code,{children:"SpringBootCondition"})," \u7684 ",(0,i.jsx)(e.code,{children:"getMatchOutcome(...)"})," \u53c8\u662f\u4e2a\u62bd\u8c61\u65b9\u6cd5\uff0c\u5177\u4f53\u7684\u903b\u8f91\u7531\u5b50\u7c7b\u63d0\u4f9b\uff0c",(0,i.jsx)(e.code,{children:"OnClassCondition"})," \u5b83\u7684\u5b9e\u73b0\u4e4b\u4e00\u3002\u5b9e\u9645\u4e0a\uff0c\u4e0a\u8ff0\u6761\u4ef6\u5224\u65ad\u7c7b\u90fd\u662f ",(0,i.jsx)(e.code,{children:"SpringBootCondition"})," \u7684\u5b50\u7c7b\uff0c\u540e\u9762\u6211\u4eec\u5c31\u76f4\u63a5\u8fdb\u5165\u5177\u4f53\u7c7b\u7684 ",(0,i.jsx)(e.code,{children:"getMatchOutcome(...)"})," \u65b9\u6cd5\u5206\u6790\u4e86\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"getMatchOutcome(...)"})," \u65b9\u6cd5\u8fd4\u56de\u7684\u7ed3\u679c\u662f ",(0,i.jsx)(e.code,{children:"ConditionOutcome"}),"\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"ConditionOutcome"})," \u662f\u4e2a\u5565\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'public class ConditionOutcome {\n\n    private final boolean match;\n\n    private final ConditionMessage message;\n\n    /**\n     * \u6784\u9020\u65b9\u6cd5\n     */\n    public ConditionOutcome(boolean match, String message) {\n        this(match, ConditionMessage.of(message));\n    }\n\n    /**\n     * \u6784\u9020\u65b9\u6cd5\n     */\n    public ConditionOutcome(boolean match, ConditionMessage message) {\n        Assert.notNull(message, "ConditionMessage must not be null");\n        this.match = match;\n        this.message = message;\n    }\n\n    /**\n     * \u8fd4\u56de\u5339\u914d\u7684\u7ed3\u679c\n     */\n    public boolean isMatch() {\n        return this.match;\n    }\n\n    ...\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u4ece\u4ee3\u7801\u6765\u770b\uff0c\u8fd9\u4e2a\u7c7b\u5c31\u662f\u7528\u6765\u5c01\u88c5\u6bd4\u8f83\u7ed3\u679c\u7684\uff0c\u5185\u90e8\u6709\u4e24\u4e2a\u5c5e\u6027\uff1a",(0,i.jsx)(e.code,{children:"match"})," \u4e0e ",(0,i.jsx)(e.code,{children:"message"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"match"})," \u7684\u7c7b\u578b\u662f ",(0,i.jsx)(e.code,{children:"boolean"}),"\uff0c\u8fd9\u4e2a\u5c31\u662f\u6700\u7ec8\u5339\u914d\u6210\u529f\u8fd8\u662f\u5931\u8d25\u7684\u6807\u8bc6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"message"})," \u7684\u7c7b\u578b\u662f ",(0,i.jsx)(e.code,{children:"ConditionMessage"}),"\uff0c\u5b83\u8868\u793a\u5339\u914d\u7ed3\u679c\u7684\u8bf4\u660e"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u518d\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"ConditionMessage"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"public final class ConditionMessage {\n\n    private String message;\n\n    private ConditionMessage() {\n        this(null);\n    }\n\n    private ConditionMessage(String message) {\n        this.message = message;\n    }\n\n    ...\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5b83\u4ec5\u6709\u4e00\u4e2a\u5c5e\u6027\uff1a",(0,i.jsx)(e.code,{children:"message"}),"\uff0c\u8fd9\u8868\u660e\u5b83\u5c31\u662f\u5bf9\u8bf4\u660e\u4fe1\u606f\u7684\u5305\u88c5\u3002"]}),"\n",(0,i.jsxs)(e.h3,{id:"3-conditionalonclass-onclassconditiongetmatchoutcome",children:["3. ",(0,i.jsx)(e.code,{children:"@ConditionalOnClass"}),": ",(0,i.jsx)(e.code,{children:"OnClassCondition#getMatchOutcome"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u5206\u6790 ",(0,i.jsx)(e.code,{children:"OnClassCondition"})," \u7684\u5339\u914d\u903b\u8f91\uff0c\u76f4\u63a5\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"getMatchOutcome"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'public ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) {\n    ClassLoader classLoader = context.getClassLoader();\n    ConditionMessage matchMessage = ConditionMessage.empty();\n    // 1\\. \u5904\u7406 @ConditionalOnClass \u6ce8\u89e3\n    List<String> onClasses = getCandidates(metadata, ConditionalOnClass.class);\n    if (onClasses != null) {\n        // 1.1 \u5904\u7406\u6761\u4ef6\u5224\u65ad\n        List<String> missing = filter(onClasses, ClassNameFilter.MISSING, classLoader);\n        if (!missing.isEmpty()) {\n            // 1.2 \u6784\u5efa\u8fd4\u56de\u7ed3\u679c\uff1a\u4e0d\u5339\u914d\u7684\u60c5\u51b5\n            return ConditionOutcome.noMatch(ConditionMessage.forCondition(ConditionalOnClass.class)\n                    .didNotFind("required class", "required classes").items(Style.QUOTE, missing));\n        }\n        matchMessage = matchMessage.andCondition(ConditionalOnClass.class)\n                .found("required class", "required classes")\n                .items(Style.QUOTE, filter(onClasses, ClassNameFilter.PRESENT, classLoader));\n    }\n\n    // 2\\. \u5904\u7406 @ConditionalOnMissingClass \u6ce8\u89e3\n    List<String> onMissingClasses = getCandidates(metadata, ConditionalOnMissingClass.class);\n    if (onMissingClasses != null) {\n        // 2.1 \u5904\u7406\u6761\u4ef6\u5224\u65ad\n        List<String> present = filter(onMissingClasses, ClassNameFilter.PRESENT, classLoader);\n        if (!present.isEmpty()) {\n            // 2.2 \u6784\u5efa\u8fd4\u56de\u7ed3\u679c\uff1a\u4e0d\u5339\u914d\u7684\u60c5\u51b5\n            return ConditionOutcome.noMatch(ConditionMessage\n                    .forCondition(ConditionalOnMissingClass.class)\n                    .found("unwanted class", "unwanted classes").items(Style.QUOTE, present));\n        }\n        matchMessage = matchMessage.andCondition(ConditionalOnMissingClass.class)\n                .didNotFind("unwanted class", "unwanted classes")\n                .items(Style.QUOTE, filter(onMissingClasses, ClassNameFilter.MISSING, classLoader));\n    }\n    // \u6700\u540e\u8fd4\u56de\u5339\u914d\u7684\u7ed3\u679c\n    return ConditionOutcome.match(matchMessage);\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u4e2a\u65b9\u6cd5\u540c\u65f6\u5904\u7406\u4e86 ",(0,i.jsx)(e.code,{children:"@ConditionalOnClass"})," \u4e0e ",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingClass"})," \u4e24\u4e2a\u6ce8\u89e3\uff0c\u5904\u7406\u6d41\u7a0b\u6781\u5176\u76f8\u4f3c\uff0c\u4e24\u4e2a\u6ce8\u89e3\u7684\u6761\u4ef6\u5224\u65ad\u90fd\u662f\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"FilteringSpringBootCondition#filter"})," \u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"protected final List<String> filter(Collection<String> classNames, ClassNameFilter classNameFilter,\n        ClassLoader classLoader) {\n    if (CollectionUtils.isEmpty(classNames)) {\n        return Collections.emptyList();\n    }\n    List<String> matches = new ArrayList<>(classNames.size());\n    for (String candidate : classNames) {\n        // \u8fdb\u884c\u6761\u4ef6\u5339\u914d\n        if (classNameFilter.matches(candidate, classLoader)) {\n            matches.add(candidate);\n        }\n    }\n    return matches;\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u7531\u6b64\u53ef\u89c1\uff0c\u4f20\u5165\u7684 ",(0,i.jsx)(e.code,{children:"classNameFilter"})," \u6210\u4e86\u5173\u952e\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5904\u7406 ",(0,i.jsx)(e.code,{children:"@ConditionalOnClass"})," \u65f6\uff0c",(0,i.jsx)(e.code,{children:"classNameFilter"})," \u4e3a ",(0,i.jsx)(e.code,{children:"ClassNameFilter.MISSING"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5904\u7406 ",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingClass"})," \u65f6\uff0c",(0,i.jsx)(e.code,{children:"classNameFilter"})," \u4e3a ",(0,i.jsx)(e.code,{children:"ClassNameFilter.PRESENT"})]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u8ba9\u6211\u4eec\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"ClassNameFilter"})," \u4e00\u63a2\u7a76\u7adf\uff0c\u5b83\u662f ",(0,i.jsx)(e.code,{children:"FilteringSpringBootCondition"})," \u7684\u5b50\u7c7b\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"abstract class FilteringSpringBootCondition extends SpringBootCondition\n        implements AutoConfigurationImportFilter, BeanFactoryAware, BeanClassLoaderAware {\n    ...\n    /**\n     * \u5982\u679c classLoader \u5b58\u5728\uff0c\u5219\u8c03\u7528 ClassLoader#loadClass \u65b9\u6cd5\n     * \u5426\u5219\u8c03\u7528 Class#forName \u65b9\u6cd5\n     */\n    protected static Class<?> resolve(String className, ClassLoader classLoader) \n            throws ClassNotFoundException {\n        if (classLoader != null) {\n            return classLoader.loadClass(className);\n        }\n        return Class.forName(className);\n    }\n\n    /**\n     * \u5904\u7406\u6761\u4ef6\u5339\u914d\n     */\n    protected enum ClassNameFilter {\n\n        PRESENT {\n\n            @Override\n            public boolean matches(String className, ClassLoader classLoader) {\n                return isPresent(className, classLoader);\n            }\n\n        },\n\n        MISSING {\n\n            @Override\n            public boolean matches(String className, ClassLoader classLoader) {\n                return !isPresent(className, classLoader);\n            }\n\n        };\n\n        abstract boolean matches(String className, ClassLoader classLoader);\n\n        /**\n         * Class \u662f\u5426\u5b58\u5728\n         * \u901a\u8fc7\u6355\u83b7\u7c7b\u52a0\u8f7d\u65f6\u7684\u5f02\u5e38\u6765\u5224\u65ad\u7c7b\u662f\u5426\u5b58\u5728\uff0c\u672a\u629b\u51fa\u5f02\u5e38\u5219\u8868\u793a\u7c7b\u5b58\u5728\n         */\n        static boolean isPresent(String className, ClassLoader classLoader) {\n            if (classLoader == null) {\n                classLoader = ClassUtils.getDefaultClassLoader();\n            }\n            try {\n                // \u901a\u8fc7\u5f02\u5e38\u6355\u83b7\u6765\u5224\u65ad\u662f\u5426\u5b58\u5728\u8be5class\n                resolve(className, classLoader);\n                return true;\n            }\n            catch (Throwable ex) {\n                return false;\n            }\n        }\n    }\n    ...\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u770b\u5230\u8fd9\u91cc\u6211\u4eec\u5c31\u660e\u767d\u4e86\uff1a\u5224\u65ad ",(0,i.jsx)(e.code,{children:"Class"})," \u662f\u5426\u5b58\u5728\uff0cspring \u662f\u901a\u8fc7\u6355\u83b7 ",(0,i.jsx)(e.code,{children:"ClassLoader.load(String)"})," \u6216 ",(0,i.jsx)(e.code,{children:"Class.forName(String)"})," \u65b9\u6cd5\u7684\u5f02\u5e38\u6765\u5904\u7406\u7684\uff0c\u5982\u679c\u629b\u51fa\u4e86\u5f02\u5e38\u5c31\u8868\u660e ",(0,i.jsx)(e.code,{children:"Class"})," \u4e0d\u5b58\u5728\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u91cc\u603b\u7ed3\u4e0b ",(0,i.jsx)(e.code,{children:"@ConditionalOnClass"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingClass"})," \u7684\u5904\u7406\u65b9\u5f0f\uff1a",(0,i.jsxs)(e.strong,{children:["\u4e24\u8005\u7684\u5904\u7406\u7c7b\u90fd\u4e3a ",(0,i.jsx)(e.code,{children:"OnClassCondition"}),"\uff0c\u901a\u8fc7\u6355\u83b7 ",(0,i.jsx)(e.code,{children:"ClassLoader.load(String)"})," \u6216 ",(0,i.jsx)(e.code,{children:"Class.forName(String)"})," \u65b9\u6cd5\u7684\u5f02\u5e38\u6765\u5224\u65ad ",(0,i.jsx)(e.code,{children:"Class"})," \u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u629b\u51fa\u4e86\u5f02\u5e38\u5c31\u8868\u660e ",(0,i.jsx)(e.code,{children:"Class"})," \u4e0d\u5b58\u5728"]}),"\u3002"]}),"\n",(0,i.jsxs)(e.h3,{id:"4-conditionalonbean-onbeanconditiongetmatchoutcome",children:["4. ",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),": ",(0,i.jsx)(e.code,{children:"OnBeanCondition#getMatchOutcome"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u7ee7\u7eed\u770b\u770b ",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"})," \u7684 \u5904\u7406\uff0c\u76f4\u63a5\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"OnBeanCondition#getMatchOutcome"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'public ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) {\n    ConditionMessage matchMessage = ConditionMessage.empty();\n    MergedAnnotations annotations = metadata.getAnnotations();\n    // \u5904\u7406 @ConditionalOnBean\n    if (annotations.isPresent(ConditionalOnBean.class)) {\n        Spec<ConditionalOnBean> spec = new Spec<>(context, metadata, \n                annotations, ConditionalOnBean.class);\n        // \u5904\u7406\u5339\u914d\n        MatchResult matchResult = getMatchingBeans(context, spec);\n        // \u6ce8\u610f\u5224\u65ad\u6761\u4ef6\n        if (!matchResult.isAllMatched()) {\n            String reason = createOnBeanNoMatchReason(matchResult);\n            return ConditionOutcome.noMatch(spec.message().because(reason));\n        }\n        matchMessage = spec.message(matchMessage).found("bean", "beans").items(Style.QUOTE,\n                matchResult.getNamesOfAllMatches());\n    }\n\n    // \u5904\u7406 @ConditionalOnSingleCandidate\n    if (metadata.isAnnotated(ConditionalOnSingleCandidate.class.getName())) {\n        Spec<ConditionalOnSingleCandidate> spec \n                = new SingleCandidateSpec(context, metadata, annotations);\n        // \u5904\u7406\u5339\u914d\n        MatchResult matchResult = getMatchingBeans(context, spec);\n        // \u6ce8\u610f\u5224\u65ad\u6761\u4ef6\n        if (!matchResult.isAllMatched()) {\n            return ConditionOutcome.noMatch(spec.message().didNotFind("any beans").atAll());\n        }\n        else if (!hasSingleAutowireCandidate(context.getBeanFactory(), \n                matchResult.getNamesOfAllMatches(), spec.getStrategy() == SearchStrategy.ALL)) {\n            return ConditionOutcome.noMatch(spec.message().didNotFind("a primary bean from beans")\n                    .items(Style.QUOTE, matchResult.getNamesOfAllMatches()));\n        }\n        matchMessage = spec.message(matchMessage).found("a primary bean from beans")\n                .items(Style.QUOTE, matchResult.getNamesOfAllMatches());\n    }\n\n    // \u5904\u7406 @ConditionalOnMissingBean\n    if (metadata.isAnnotated(ConditionalOnMissingBean.class.getName())) {\n        Spec<ConditionalOnMissingBean> spec = new Spec<>(context, metadata, annotations,\n                ConditionalOnMissingBean.class);\n        // \u5904\u7406\u5339\u914d\n        MatchResult matchResult = getMatchingBeans(context, spec);\n        // \u6ce8\u610f\u5224\u65ad\u6761\u4ef6\n        if (matchResult.isAnyMatched()) {\n            String reason = createOnMissingBeanNoMatchReason(matchResult);\n            return ConditionOutcome.noMatch(spec.message().because(reason));\n        }\n        matchMessage = spec.message(matchMessage).didNotFind("any beans").atAll();\n    }\n    return ConditionOutcome.match(matchMessage);\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e00\u5171\u5904\u7406\u4e86\u4e24\u4e2a\u6ce8\u89e3\u7684\u6761\u4ef6\u5339\u914d\uff1a",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"\u3001",(0,i.jsx)(e.code,{children:"@ConditionalOnSingleCandidate"})," \u4e0e ",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"}),"\uff0c\u4e09\u8005\u90fd\u8c03\u7528\u4e86\u540c\u4e00\u4e2a\u65b9\u6cd5 ",(0,i.jsx)(e.code,{children:"getMatchingBeans(...)"})," \u6765\u83b7\u53d6\u5339\u914d\u7ed3\u679c\uff0c\u7136\u540e\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"matchResult.isAllMatched()"})," \u6216 ",(0,i.jsx)(e.code,{children:"matchResult.isAnyMatched()"})," \u6765\u505a\u6700\u7ec8\u7684\u7ed3\u679c\u5224\u65ad\u3002"]}),"\n",(0,i.jsx)(e.h4,{id:"onbeanconditiongetmatchingbeans",children:(0,i.jsx)(e.code,{children:"OnBeanCondition#getMatchingBeans"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"getMatchingBeans(...)"})," \u7684\u4ee3\u7801\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'protected final MatchResult getMatchingBeans(ConditionContext context, Spec<?> spec) {\n    ClassLoader classLoader = context.getClassLoader();\n    ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();\n    boolean considerHierarchy = spec.getStrategy() != SearchStrategy.CURRENT;\n    Set<Class<?>> parameterizedContainers = spec.getParameterizedContainers();\n    if (spec.getStrategy() == SearchStrategy.ANCESTORS) {\n        BeanFactory parent = beanFactory.getParentBeanFactory();\n        Assert.isInstanceOf(ConfigurableListableBeanFactory.class, parent,\n                "Unable to use SearchStrategy.ANCESTORS");\n        beanFactory = (ConfigurableListableBeanFactory) parent;\n    }\n    MatchResult result = new MatchResult();\n    // 1\\. \u83b7\u53d6 ignoreType\uff0c\u53ea\u6709 @ConditionalOnMissingBean \u6709\u8fd9\u4e2a\u5c5e\u6027\n    Set<String> beansIgnoredByType = getNamesOfBeansIgnoredByType(classLoader, beanFactory, \n            considerHierarchy, spec.getIgnoredTypes(), parameterizedContainers);\n\n    // 2\\. \u5904\u7406 types\n    for (String type : spec.getTypes()) {\n        Collection<String> typeMatches = getBeanNamesForType(classLoader, considerHierarchy, \n                beanFactory, type, parameterizedContainers);\n        typeMatches.removeAll(beansIgnoredByType);\n        if (typeMatches.isEmpty()) {\n            result.recordUnmatchedType(type);\n        }\n        else {\n            result.recordMatchedType(type, typeMatches);\n        }\n    }\n\n    // 3\\. \u5904\u7406\u7c7b\u4e0a\u7684\u6ce8\u89e3 @ConditionalOnMissingBean \u6709\u8fd9\u4e2a\u5c5e\u6027\n    for (String annotation : spec.getAnnotations()) {\n        Set<String> annotationMatches = getBeanNamesForAnnotation(classLoader, beanFactory, \n                annotation, considerHierarchy);\n        annotationMatches.removeAll(beansIgnoredByType);\n        if (annotationMatches.isEmpty()) {\n            result.recordUnmatchedAnnotation(annotation);\n        }\n        else {\n            result.recordMatchedAnnotation(annotation, annotationMatches);\n        }\n    }\n\n    // 4\\. \u5904\u7406 beanName\n    for (String beanName : spec.getNames()) {\n        if (!beansIgnoredByType.contains(beanName) && containsBean(beanFactory, beanName, \n                considerHierarchy)) {\n            result.recordMatchedName(beanName);\n        }\n        else {\n            result.recordUnmatchedName(beanName);\n        }\n    }\n    return result;\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5904\u7406 3 \u4e2a\u6ce8\u89e3\u7684\u5339\u914d\u89c4\u5219\uff1a",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"\u3001",(0,i.jsx)(e.code,{children:"@ConditionalOnSingleCandidate"})," \u4e0e ",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"}),"\uff0c\u5904\u7406\u6b65\u9aa4\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u83b7\u53d6 ",(0,i.jsx)(e.code,{children:"ignoreType"}),"\uff0c\u53ea\u6709 ",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})," \u6709\u8fd9\u4e2a\u5c5e\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5904\u7406 ",(0,i.jsx)(e.code,{children:"types"})," \u7684\u5339\u914d\u89c4\u5219"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5904\u7406\u6ce8\u89e3\uff08\u7c7b\u4e0a\u7684\u6ce8\u89e3\uff09\u7684\u5339\u914d\u89c4\u5219\uff0c \u53ea\u6709 ",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})," \u6709\u8fd9\u4e2a\u5c5e\u6027"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5904\u7406 ",(0,i.jsx)(e.code,{children:"beanName"})," \u7684\u5339\u914d\u89c4\u5219"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u5173\u4e8e\u4ee5\u4e0a\u6b65\u9aa4\u7684\u5177\u4f53\u7ec6\u8282\uff0c\u672c\u6587\u5c31\u4e0d\u5177\u4f53\u5c55\u5f00\u4e86\uff0c\u8fd9\u91cc\u4ec5\u63d0\u4f9b\u6d41\u7a0b\uff1a"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u83b7\u53d6 ",(0,i.jsx)(e.code,{children:"ignoreType"}),"\uff1a","\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"ListableBeanFactory#getBeanNamesForType(Class, boolean, boolean)"})," \u65b9\u6cd5\u83b7\u53d6\u5bb9\u5668\u4e2d\u6240\u6709\u7684 ",(0,i.jsx)(e.code,{children:"ignoreType"})," \u7684 ",(0,i.jsx)(e.code,{children:"beanName"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u7ed3\u679c\u4e3a ",(0,i.jsx)(e.code,{children:"beansIgnoredByType"}),"(\u7c7b\u578b\u662f ",(0,i.jsx)(e.code,{children:"Set<String>"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5904\u7406 ",(0,i.jsx)(e.code,{children:"types"})," \u7684\u5339\u914d\u89c4\u5219","\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"ListableBeanFactory#getBeanNamesForType(Class, boolean, boolean)"})," \u65b9\u6cd5\u83b7\u53d6\u5bb9\u5668\u4e2d\u6240\u6709\u7684 ",(0,i.jsx)(e.code,{children:"type"})," \u5bf9\u5e94\u7684 ",(0,i.jsx)(e.code,{children:"beanName"}),"\uff0c\u7ed3\u679c\u4e3a ",(0,i.jsx)(e.code,{children:"typeMatches"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5c06 ",(0,i.jsx)(e.code,{children:"typeMatches"})," \u4e2d\u7684\u503c\u53bb\u9664 ",(0,i.jsx)(e.code,{children:"ignoreType"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5224\u65ad\u7b2c\u4e8c\u6b65\u5f97\u5230\u7684 ",(0,i.jsx)(e.code,{children:"typeMatches"}),"\uff0c\u5982\u679c\u5185\u5bb9\u4e3a\u7a7a\uff0c\u5c06\u5f53\u524d ",(0,i.jsx)(e.code,{children:"Type"})," \u4fdd\u5b58\u5230 ",(0,i.jsx)(e.code,{children:"unmatchedTypes"})," \u4e2d\uff0c\u5426\u5219\u4fdd\u5b58\u5230 ",(0,i.jsx)(e.code,{children:"matchedTypes"})," \u4e0e ",(0,i.jsx)(e.code,{children:"namesOfAllMatches"})," \u4e2d"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5904\u7406\u6ce8\u89e3\u7684\u5339\u914d\u89c4\u5219","\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"ListableBeanFactory#getBeanNamesForAnnotation"})," \u65b9\u6cd5\u83b7\u53d6\u5bb9\u5668\u4e2d\u6240\u6709\u7684 ",(0,i.jsx)(e.code,{children:"annotation"})," \u5bf9\u5e94\u7684 ",(0,i.jsx)(e.code,{children:"beanName"}),"\uff0c\u7ed3\u679c\u4e3a ",(0,i.jsx)(e.code,{children:"annotationMatches"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5c06 ",(0,i.jsx)(e.code,{children:"annotationMatches"})," \u4e2d\u7684\u503c\u53bb\u9664 ",(0,i.jsx)(e.code,{children:"ignoreType"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5224\u65ad\u7b2c\u4e8c\u6b65\u5f97\u5230\u7684 ",(0,i.jsx)(e.code,{children:"annotationMatches"}),"\uff0c\u5982\u679c\u5185\u5bb9\u4e3a\u7a7a\uff0c\u5c06\u5f53\u524d ",(0,i.jsx)(e.code,{children:"Annotation"})," \u4fdd\u5b58\u5230 ",(0,i.jsx)(e.code,{children:"unmatchedAnnotations"})," \u4e2d\uff0c\u5426\u5219\u4fdd\u5b58\u5230 ",(0,i.jsx)(e.code,{children:"matchedAnnotations"})," \u4e0e ",(0,i.jsx)(e.code,{children:"namesOfAllMatches"})," \u4e2d"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5904\u7406 ",(0,i.jsx)(e.code,{children:"beanName"})," \u7684\u5339\u914d\u89c4\u5219","\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5224\u65ad ",(0,i.jsx)(e.code,{children:"beansIgnoredByType"})," \u662f\u5426\u5305\u542b ",(0,i.jsx)(e.code,{children:"beanName"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"BeanFactory#containsBean"})," \u65b9\u6cd5\u5224\u65ad\u5bb9\u5668\u4e2d\u6709\u8be5 ",(0,i.jsx)(e.code,{children:"beanName"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u7b2c 2 \u6b65\u7ed3\u679c\u4e3a ",(0,i.jsx)(e.code,{children:"false"}),"\uff0c\u7b2c\u4e8c\u6b65\u7ed3\u679c\u4e3a ",(0,i.jsx)(e.code,{children:"true"}),"\uff0c\u5219\u5c06\u5f53\u524d ",(0,i.jsx)(e.code,{children:"beanName"})," \u52a0\u5165\u5230 ",(0,i.jsx)(e.code,{children:"matchedNames"})," \u4e0e ",(0,i.jsx)(e.code,{children:"namesOfAllMatches"}),"\uff0c\u5426\u5219\u4fdd\u5b58\u5230 ",(0,i.jsx)(e.code,{children:"unmatchedNames"})," \u4e2d"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5f97\u5230 ",(0,i.jsx)(e.code,{children:"matchedTypes"}),"\u3001",(0,i.jsx)(e.code,{children:"unmatchedNames"})," \u7b49\u5185\u5bb9\u540e\uff0c",(0,i.jsx)(e.code,{children:"matchResult.isAllMatched()"})," \u6216 ",(0,i.jsx)(e.code,{children:"matchResult.isAnyMatched()"})," \u6700\u7ec8\u7684\u5224\u65ad\u7ed3\u679c\u5c31\u662f\u5224\u65ad\u8fd9\u4e9b\u7ed3\u6784\u662f\u5426\u7a7a\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"boolean isAllMatched() {\n    return this.unmatchedAnnotations.isEmpty() && this.unmatchedNames.isEmpty()\n            && this.unmatchedTypes.isEmpty();\n}\n\nboolean isAnyMatched() {\n    return (!this.matchedAnnotations.isEmpty()) || (!this.matchedNames.isEmpty())\n            || (!this.matchedTypes.isEmpty());\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u770b\u6765\uff0c",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})," \u7684\u5173\u952e\uff0c\u5c31\u662f\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"ListableBeanFactory#getBeanNamesForType"})," \u6216 ",(0,i.jsx)(e.code,{children:"BeanFactory#containsBean"})," \u6765\u5224\u65ad ",(0,i.jsx)(e.code,{children:"beanName"}),"\u3001",(0,i.jsx)(e.code,{children:"beanType"})," \u662f\u5426\u5b58\u5728\u4e86\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5728\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})," \u65f6\uff0c\u6709\u4e00\u4e2a\u5751\u9700\u8981\u7279\u522b\u6ce8\u610f\uff1a\u6761\u4ef6\u6ce8\u89e3\u7684\u6267\u884c\u65f6\u673a\u662f\u5728 spring \u7684 ",(0,i.jsx)(e.code,{children:"ConfigurationClassPostProcessor"})," \u4e2d\u7684\uff0c\u786e\u5207\u5730\u8bf4\uff0c\u662f\u5728\u5c06 ",(0,i.jsx)(e.code,{children:"bean"})," \u52a0\u5165\u5230 ",(0,i.jsx)(e.code,{children:"beanFactory"})," \u7684 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e4b\u524d\u5224\u65ad\u7684\uff0c\u5982\u679c\u6ee1\u8db3\u6761\u4ef6\u5219\u6dfb\u52a0\u5230 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d\uff0c\u5426\u5219\u5c31\u4e0d\u6dfb\u52a0\u3002\u8fd9\u6837\u5c31\u5bfc\u81f4\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u679c\u5728 ",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})," \u7684 ",(0,i.jsx)(e.code,{children:"bean"})," \u5728\u8be5 ",(0,i.jsx)(e.code,{children:"bean"})," \u4e4b\u540e\u52a0\u5165\u5230 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d\uff0c\u5c31\u6709\u53ef\u80fd\u51fa\u73b0\u8bef\u5224\uff0c\u4e3e\u4f8b\u8bf4\u660e\uff1a"]}),"\n",(0,i.jsx)(e.p,{children:"\u73b0\u5728\u6709\u4e24\u4e2a\u7c7b\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'@Component\n@ConditionalOnMissingBean("b")\npublic class A {\n\n}\n\n@Component\npublic class B {\n\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u5176\u4e2d ",(0,i.jsx)(e.code,{children:"A"})," \u4e0e ",(0,i.jsx)(e.code,{children:"B"})," \u90fd\u6dfb\u52a0\u4e86 ",(0,i.jsx)(e.code,{children:"@Component"}),"\uff0c\u8868\u660e\u8fd9\u662f spring bean\uff0c\u7136\u540e\u5728 ",(0,i.jsx)(e.code,{children:"A"})," \u4e0a\u6dfb\u52a0\u4e86\u6ce8\u89e3 ",(0,i.jsx)(e.code,{children:'@ConditionalOnMissingBean("b")'}),"\uff0c\u8868\u660e\u5728 ",(0,i.jsx)(e.code,{children:"b"})," \u4e0d\u5b58\u5728\u65f6\uff0c",(0,i.jsx)(e.code,{children:"A"})," \u624d\u8fdb\u884c\u521d\u59cb\u5316\u3002\u6709\u4e86\u8fd9\u4e9b\u524d\u63d0\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u4e24\u79cd\u60c5\u51b5\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c ",(0,i.jsx)(e.code,{children:"b"})," \u5148\u6dfb\u52a0\u5230 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d\uff0c\u5728\u5c06 ",(0,i.jsx)(e.code,{children:"a"})," \u6dfb\u52a0\u5230 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u65f6\uff0c\u53d1\u73b0 ",(0,i.jsx)(e.code,{children:"b"})," \u5df2\u7ecf\u5b58\u5728\u4e86\uff0c\u4e8e\u662f\u5c31\u4e0d\u6dfb\u52a0\u4e86\uff0c\u7b26\u5408\u6211\u4eec\u7684\u9884\u671f\uff1b"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c ",(0,i.jsx)(e.code,{children:"a"})," \u5148\u88ab\u5904\u7406\uff0c\u5728\u6dfb\u52a0\u65f6\uff0c\u53d1\u73b0 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d\u5e76\u6ca1\u6709 ",(0,i.jsx)(e.code,{children:"b"}),"\uff0c\u4e8e\u662f ",(0,i.jsx)(e.code,{children:"a"})," \u88ab\u6dfb\u52a0\u5230 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d\uff0c\u518d\u5904\u7406 ",(0,i.jsx)(e.code,{children:"b"}),"\uff0c",(0,i.jsx)(e.code,{children:"b"})," \u4e5f\u4f1a\u88ab\u6dfb\u52a0\u5230 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"}),"\uff0c\u8fd9\u6837\u4e00\u6765\uff0c",(0,i.jsx)(e.code,{children:"a"})," \u4e0e ",(0,i.jsx)(e.code,{children:"b"})," \u540c\u65f6\u5b58\u5728\u4e8e ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d\uff0c\u6700\u7ec8\u90fd\u4f1a\u88ab\u521d\u59cb\u5316\u6210 spring bean\uff0c\u8fd9\u4e0e\u6211\u4eec\u7684\u9884\u671f\u4e0d\u7b26\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u90a3\u4e48 springboot \u5982\u4f55\u89e3\u51b3\u4ee5\u4e0a\u95ee\u9898\u5462\uff1f\u6211\u4eec\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})," \u7684\u8bf4\u660e\uff1a"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-30df67cb01c73a6b201695298aad14fd0a5.png",alt:""})}),"\n",(0,i.jsx)(e.p,{children:"\u7a0d\u5fae\u7ffb\u8bd1\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(e.p,{children:"\u8be5\u6761\u4ef6\u53ea\u80fd\u5339\u914d\u5230\u76ee\u524d\u4e3a\u6b62\u7684\u5e94\u7528\u7a0b\u5e8f\u4e0a\u4e0b\u6587\u4e2d\u7684 bean \u5b58\u5728\u60c5\u51b5\uff0c\u56e0\u6b64\uff0c\u5f3a\u70c8\u5efa\u8bae\u4ec5\u4e8e\u81ea\u52a8\u914d\u7f6e\u7c7b\u4e2d\u4f7f\u7528\u3002\u5982\u679c\u5019\u9009 bean \u8981\u5728\u53e6\u4e00\u79cd\u81ea\u52a8\u914d\u7f6e\u4e0b\u521b\u5efa\uff0c\u8bf7\u786e\u4fdd\u4f7f\u7528\u6b64\u6761\u4ef6\u7684\u914d\u7f6e\u5728\u6b64\u4e4b\u540e\u8fd0\u884c\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u5bf9\u4ee5\u4e0a\u5185\u5bb9\uff0c\u6211\u7684\u89e3\u8bfb\u5982\u4e0b\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\u88ab ",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})," \u6807\u8bb0 ",(0,i.jsx)(e.code,{children:"bean"})," \u52a0\u5165\u5230 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u90a3\u4e00\u523b\uff0c\u4ec5\u5339\u914d\u76ee\u524d\u4e3a\u6b62 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d\u5df2\u5b58\u5728\u7684 bean\uff0c\u5bf9\u4e4b\u540e\u52a0\u5165\u7684 bean \u4e0d\u8003\u8651\uff0c\u8fd9\u5c31\u6709\u53ef\u80fd\u9020\u6210\u8bef\u5224\uff0c\u53ef\u4ee5\u53c2\u8003\u4e0a\u9762\u4e3e\u7684 ",(0,i.jsx)(e.code,{children:"a"})," \u4e0e ",(0,i.jsx)(e.code,{children:"b"})," \u7684\u4f8b\u5b50"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5f3a\u70c8\u5efa\u8bae\u4ec5\u5728\u81ea\u52a8\u914d\u7f6e\u7c7b\u4e2d\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})," \u8fd9\u4e24\u4e2a\u6ce8\u89e3\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u81ea\u52a8\u914d\u7f6e\u7c7b\u4e2d\u4f7f\u7528\u7684\u8bdd\uff0c\u80fd\u6b63\u786e\u5904\u7406\u5339\u914d"]}),"\n",(0,i.jsxs)(e.li,{children:["\u8fd8\u662f\u62ff\u4e0a\u9762\u7684 ",(0,i.jsx)(e.code,{children:"a"})," \u4e0e ",(0,i.jsx)(e.code,{children:"b"})," \u4e3e\u4f8b\uff0c\u5982\u679c ",(0,i.jsx)(e.code,{children:"a"})," \u4e0e ",(0,i.jsx)(e.code,{children:"b"})," \u5206\u522b\u4f4d\u4e8e\u4e0d\u540c\u7684\u81ea\u52a8\u914d\u7f6e\u7c7b\u4e2d\uff0c\u90a3\u4e48 ",(0,i.jsx)(e.code,{children:"a"})," \u9700\u8981\u5728 ",(0,i.jsx)(e.code,{children:"b"})," \u4e4b\u540e\u52a0\u8f7d\u5230 ",(0,i.jsx)(e.code,{children:"beanDefinitionMap"})," \u4e2d\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"@AutoConfigureAfter"}),"\u3001",(0,i.jsx)(e.code,{children:"@AutoConfigureBefore"}),"\u3001",(0,i.jsx)(e.code,{children:"@AutoConfigureOrder"})," \u7b49\u6ce8\u89e3\u6765\u6307\u5b9a"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u5173\u4e8e\u81ea\u52a8\u914d\u7f6e\u7c7b\u7684\u52a0\u8f7d\u987a\u5e8f\uff0c\u540e\u9762\u518d\u505a\u5206\u6790\u5427\u3002"}),"\n",(0,i.jsx)(e.p,{children:"\u9650\u4e8e\u7bc7\u5e45\uff0c\u672c\u6587\u5c31\u5148\u5230\u8fd9\u91cc\u4e86\uff0c\u4e0b\u7bc7\u7ee7\u7eed\u5206\u6790\u5269\u4e0b\u7684\u6761\u4ef6\u6ce8\u89e3\u3002"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u6587\u662f springboot \u6761\u4ef6\u6ce8\u89e3\u5206\u6790\u7684\u7b2c\u4e8c\u7bc7\uff0c\u4e0a\u6587\u6211\u4eec\u603b\u7ed3\u4e86 springboot \u7684\u51e0\u4e2a\u6761\u4ef6\u603b\u7ed3\uff1a"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u6ce8\u89e3\u7c7b\u578b"}),(0,i.jsx)(e.th,{children:"\u6ce8\u89e3\u7c7b\u578b"}),(0,i.jsx)(e.th,{children:"\u6761\u4ef6\u5224\u65ad\u7c7b"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"class \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnClass"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingClass"})]}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnClassCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"bean \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnBean"}),"/",(0,i.jsx)(e.code,{children:"@ConditionalOnMissingBean"})]}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnBeanCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"\u5c5e\u6027\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnProperty"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnPropertyCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Resource \u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnResource"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnResourceCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Web \u5e94\u7528\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsxs)(e.td,{children:[(0,i.jsx)(e.code,{children:"@ConditionalOnWebApplication"})," / ",(0,i.jsx)(e.code,{children:"@ConditionalOnNotWebApplication"})]}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnWebApplicationCondition"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"spring \u8868\u8fbe\u5f0f\u6761\u4ef6\u6ce8\u89e3"}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"@ConditionalOnExpression"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"OnExpressionCondition"})})]})]})]}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u6587\u7ee7\u7eed\u5206\u6790\u6761\u4ef6\u5224\u65ad\u3002"}),"\n",(0,i.jsxs)(e.h3,{id:"5-conditionalonpropertyonpropertyconditiongetmatchoutcome",children:["5. ",(0,i.jsx)(e.code,{children:"@ConditionalOnProperty"}),"\uff1a",(0,i.jsx)(e.code,{children:"OnPropertyCondition#getMatchOutcome"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u518d\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"@ConditionalOnProperty"})," \u7684\u5904\u7406\uff0c\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"OnPropertyCondition#getMatchOutcome"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"class OnPropertyCondition extends SpringBootCondition {\n\n    @Override\n    public ConditionOutcome getMatchOutcome(ConditionContext context, \n            AnnotatedTypeMetadata metadata) {\n        // \u83b7\u53d6 @ConditionalOnProperty \u7684\u5c5e\u6027\u503c\n        List<AnnotationAttributes> allAnnotationAttributes = annotationAttributesFromMultiValueMap(\n                metadata.getAllAnnotationAttributes(ConditionalOnProperty.class.getName()));\n        List<ConditionMessage> noMatch = new ArrayList<>();\n        List<ConditionMessage> match = new ArrayList<>();\n        for (AnnotationAttributes annotationAttributes : allAnnotationAttributes) {\n            // \u5728 determineOutcome(...) \u65b9\u6cd5\u4e2d\u8fdb\u884c\u5224\u65ad\uff0c\u6ce8\u610f\u53c2\u6570\uff1acontext.getEnvironment()\n            ConditionOutcome outcome = determineOutcome(annotationAttributes, \n                    context.getEnvironment());\n            (outcome.isMatch() ? match : noMatch).add(outcome.getConditionMessage());\n        }\n        if (!noMatch.isEmpty()) {\n            return ConditionOutcome.noMatch(ConditionMessage.of(noMatch));\n        }\n        return ConditionOutcome.match(ConditionMessage.of(match));\n    }\n\n    ...\n\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u4e2a\u65b9\u6cd5\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u5148\u662f\u83b7\u53d6 ",(0,i.jsx)(e.code,{children:"@ConditionalOnProperty"})," \u7684\u5c5e\u6027\u503c\uff0c\u518d\u8c03\u7528 ",(0,i.jsx)(e.code,{children:"determineOutcome(...)"})," \u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u8ba9\u6211\u4eec\u518d\u8fdb\u884c ",(0,i.jsx)(e.code,{children:"OnPropertyCondition#determineOutcome"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'/**\n * \u5904\u7406\u7ed3\u679c\n * \u6ce8\u610f\uff1aresolver \u4f20\u5165\u7684\u7684\u662f Environment\uff0c\u8fd9\u5c31\u662f applicationContext \u4e2d\u7684 Environment\n */\nprivate ConditionOutcome determineOutcome(AnnotationAttributes annotationAttributes, \n        PropertyResolver resolver) {\n    Spec spec = new Spec(annotationAttributes);\n    List<String> missingProperties = new ArrayList<>();\n    List<String> nonMatchingProperties = new ArrayList<>();\n    // \u5904\u7406\u64cd\u4f5c\n    spec.collectProperties(resolver, missingProperties, nonMatchingProperties);\n    // \u5224\u65ad\u7ed3\u679c\n    if (!missingProperties.isEmpty()) {\n        return ConditionOutcome.noMatch(ConditionMessage\n            .forCondition(ConditionalOnProperty.class, spec)\n            .didNotFind("property", "properties").items(Style.QUOTE, missingProperties));\n    }\n    // \u5224\u65ad\u7ed3\u679c\n    if (!nonMatchingProperties.isEmpty()) {\n        return ConditionOutcome.noMatch(ConditionMessage\n            .forCondition(ConditionalOnProperty.class, spec)\n            .found("different value in property", "different value in properties")\n            .items(Style.QUOTE, nonMatchingProperties));\n    }\n    // \u5224\u65ad\u7ed3\u679c\n    return ConditionOutcome.match(ConditionMessage\n        .forCondition(ConditionalOnProperty.class, spec).because("matched"));\n}\n\n/**\n * \u5904\u7406\u5c5e\u6027\n */\nprivate void collectProperties(PropertyResolver resolver, List<String> missing, \n        List<String> nonMatching) {\n    for (String name : this.names) {\n        String key = this.prefix + name;\n        // resolver \u4f20\u5165\u7684 environment\n        // properties \u6761\u4ef6\u5224\u65ad\u5c31\u662f\u5224\u65ad environment \u91cc\u6709\u6ca1\u6709\u76f8\u5e94\u5c5e\u6027\n        if (resolver.containsProperty(key)) {\n            if (!isMatch(resolver.getProperty(key), this.havingValue)) {\n                nonMatching.add(name);\n            }\n        }\n        else {\n            if (!this.matchIfMissing) {\n                missing.add(name);\n            }\n        }\n    }\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c",(0,i.jsx)(e.code,{children:"@ConditionalOnProperty"})," \u6700\u7ec8\u662f\u901a\u8fc7\u5224\u65ad ",(0,i.jsx)(e.code,{children:"environment"})," \u4e2d\u662f\u5426\u6709\u8be5\u5c5e\u6027\u6765\u5904\u7406\u6761\u4ef6\u5224\u65ad\u7684\u3002"]}),"\n",(0,i.jsxs)(e.h3,{id:"6-conditionalonresourceonresourceconditiongetmatchoutcome",children:["6. ",(0,i.jsx)(e.code,{children:"@ConditionalOnResource"}),"\uff1a",(0,i.jsx)(e.code,{children:"OnResourceCondition#getMatchOutcome"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u518d\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"@ConditionalOnResource"})," \u7684\u5904\u7406\uff0c\u4e00\u822c\u6211\u4eec\u8fd9\u6837\u4f7f\u7528\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'@Bean\n@ConditionalOnResource(resources = "classpath:config.properties")\npublic Config config() {\n    return config;\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u8868\u793a\u5f53 ",(0,i.jsx)(e.code,{children:"classpath"})," \u4e2d\u5b58\u5728 ",(0,i.jsx)(e.code,{children:"config.properties"})," \u65f6\uff0c",(0,i.jsx)(e.code,{children:"config"})," \u624d\u4f1a\u88ab\u521d\u59cb\u5316 springbean\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u518d\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"OnResourceCondition#getOutcomes"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'@Override\npublic ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) {\n    MultiValueMap<String, Object> attributes = metadata\n            .getAllAnnotationAttributes(ConditionalOnResource.class.getName(), true);\n    // \u83b7\u53d6 ResourceLoader\n    ResourceLoader loader = context.getResourceLoader();\n    List<String> locations = new ArrayList<>();\n    collectValues(locations, attributes.get("resources"));\n    Assert.isTrue(!locations.isEmpty(),\n            "@ConditionalOnResource annotations must specify at least one resource location");\n    List<String> missing = new ArrayList<>();\n    // \u904d\u5386\u5224\u65ad\u8d44\u6e90\u662f\u5426\u5b58\u5728\n    for (String location : locations) {\n        // location \u4e2d\u53ef\u80fd\u6709\u5360\u4f4d\u7b26\uff0c\u5728\u8fd9\u91cc\u5904\u7406\n        String resource = context.getEnvironment().resolvePlaceholders(location);\n        // \u5224\u65ad resource \u662f\u5426\u5b58\u5728\n        if (!loader.getResource(resource).exists()) {\n            missing.add(location);\n        }\n    }\n    // \u5904\u7406\u7ed3\u679c\n    if (!missing.isEmpty()) {\n        return ConditionOutcome.noMatch(ConditionMessage.forCondition(ConditionalOnResource.class)\n                .didNotFind("resource", "resources").items(Style.QUOTE, missing));\n    }\n    return ConditionOutcome.match(ConditionMessage.forCondition(ConditionalOnResource.class)\n            .found("location", "locations").items(locations));\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u5148\u662f\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"OnResourceCondition#getOutcomes"})," \u65b9\u6cd5\u6765\u83b7\u53d6 ",(0,i.jsx)(e.code,{children:"ResourceLoader"}),"\uff0c\u901a\u8fc7\u8c03\u8bd5\u65b9\u5f0f\u53d1\u73b0\u5f53\u524d\u7684 ",(0,i.jsx)(e.code,{children:"ResourceLoader"})," \u4e3a ",(0,i.jsx)(e.code,{children:"AnnotationConfigServletWebServerApplicationContext"}),"\uff1a"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-8f1de99f757eca7aeb0307b06b28d1020d2.png",alt:""})}),"\n",(0,i.jsxs)(e.p,{children:["\u83b7\u53d6\u5230 ",(0,i.jsx)(e.code,{children:"ResourceLoader"})," \u540e\uff0c\u8c03\u7528 ",(0,i.jsx)(e.code,{children:"ResourceLoader#getResource(String)"})," \u6765\u83b7\u53d6\u8d44\u6e90\uff0c\u7136\u540e\u8c03\u7528 ",(0,i.jsx)(e.code,{children:"Resource#exists"})," \u6765\u5224\u65ad\u8d44\u6e90\u662f\u5426\u5b58\u5728\uff0c\u6700\u540e\u5904\u7406\u5339\u914d\u7ed3\u679c\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u6574\u4e2a\u6d41\u7a0b\u7684\u5173\u952e\u662f\u5728 ",(0,i.jsx)(e.code,{children:"ResourceLoader#getResource(String)"}),"\uff0c\u6211\u4eec\u6765\u770b\u770b\u8be5\u65b9\u6cd5\u7684\u5904\u7406\uff0c\u8fdb\u5165\u5230 ",(0,i.jsx)(e.code,{children:"GenericApplicationContext#getResource"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"@Override\npublic Resource getResource(String location) {\n    if (this.resourceLoader != null) {\n        return this.resourceLoader.getResource(location);\n    }\n    return super.getResource(location);\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u91cc\u7684 ",(0,i.jsx)(e.code,{children:"this.resourceLoader"})," \u4e3a ",(0,i.jsx)(e.code,{children:"null"}),"\uff0c\u8fdb\u5165\u7236\u7c7b\u7684\u65b9\u6cd5 ",(0,i.jsx)(e.code,{children:"DefaultResourceLoader#getResource"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'public Resource getResource(String location) {\n    Assert.notNull(location, "Location must not be null");\n    for (ProtocolResolver protocolResolver : getProtocolResolvers()) {\n        Resource resource = protocolResolver.resolve(location, this);\n        if (resource != null) {\n            return resource;\n        }\n    }\n    // \u5904\u7406/\u5f00\u5934\u7684\u8d44\u6e90\n    if (location.startsWith("/")) {\n        return getResourceByPath(location);\n    }\n    else if (location.startsWith(CLASSPATH_URL_PREFIX)) {\n        // \u5904\u7406classpath\u5f00\u5934\u7684\u8d44\u6e90\n        return new ClassPathResource(\n            location.substring(CLASSPATH_URL_PREFIX.length()), getClassLoader());\n    }\n    else {\n        try {\n            // \u4ee5\u4e0a\u90fd\u4e0d\u6ee1\u8db3\uff0c\u4f7f\u7528 url \u6765\u89e3\u6790\n            URL url = new URL(location);\n            return (ResourceUtils.isFileURL(url) \n                ? new FileUrlResource(url) : new UrlResource(url));\n        }\n        catch (MalformedURLException ex) {\n            // url\u89e3\u6790\u51fa\u4e86\u95ee\u9898\uff0c\u6700\u7ec8\u8fd8\u662f\u7528 getResourceByPath(...) \u6765\u89e3\u6790\n            return getResourceByPath(location);\n        }\n    }\n}\n\n/**\n * \u901a\u8fc7\u8def\u5f84\u5f97\u5230 Resource\n */\nprotected Resource getResourceByPath(String path) {\n    return new ClassPathContextResource(path, getClassLoader());\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c",(0,i.jsx)(e.code,{children:"DefaultResourceLoader#getResource"})," \u901a\u8fc7\u5224\u65ad ",(0,i.jsx)(e.code,{children:"location"})," \u7684\u524d\u7f00\uff0c\u5f97\u5230\u4e86 4 \u79cd ",(0,i.jsx)(e.code,{children:"Resource"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"ClassPathContextResource"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"FileUrlResource"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"UrlResource"})}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5f97\u5230 ",(0,i.jsx)(e.code,{children:"Resource"})," \u540e\uff0c\u63a5\u7740\u5c31\u662f\u5224\u65ad\u8be5 ",(0,i.jsx)(e.code,{children:"Resource"})," \u662f\u5426\u5b58\u5728\u4e86\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"ClassPathContextResource#exist"})," \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u5728 ",(0,i.jsx)(e.code,{children:"ClassPathResource#exists"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"/**\n * \u5224\u65ad Resource \u662f\u5426\u5b58\u5728\n */\n@Override\npublic boolean exists() {\n    return (resolveURL() != null);\n}\n\n/**\n * \u8d44\u6e90\u80fd\u83b7\u53d6\u5230\uff0c\u5219\u8fd4\u56de\u8d44\u6e90\u5bf9\u5e94\u7684url\uff0c\u5426\u5219\u8fd4\u56denull\n */\n@Nullable\nprotected URL resolveURL() {\n    if (this.clazz != null) {\n        // \u4f7f\u7528\u5f53\u524d\u7684 class \u5bf9\u5e94\u7684 classLoader \u6765\u83b7\u53d6\n        return this.clazz.getResource(this.path);\n    }\n    else if (this.classLoader != null) {\n        // \u4f7f\u7528\u6307\u5b9a\u7684 classLoader \u6765\u83b7\u53d6\n        return this.classLoader.getResource(this.path);\n    }\n    else {\n        // \u83b7\u53d6\u7cfb\u7edf\u7c7b\u52a0\u8f7d\u5668\u83b7\u53d6\n        return ClassLoader.getSystemResource(this.path);\n    }\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4ece\u4ee3\u7801\u53ef\u4ee5\u770b\u5230\uff0c\u6700\u7ec8\u662f\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"classLoader"})," \u83b7\u53d6\u6587\u4ef6\u7684 ",(0,i.jsx)(e.code,{children:"url"}),"\uff0c\u901a\u8fc7\u5224\u65ad\u6587\u4ef6 ",(0,i.jsx)(e.code,{children:"url"})," \u662f\u5426\u4e3a ",(0,i.jsx)(e.code,{children:"null"})," \u6765\u5224\u65ad ",(0,i.jsx)(e.code,{children:"resource"})," \u662f\u5426\u5b58\u5728\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u518d\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"FileUrlResource"})," \u7684\u5224\u65ad\uff0c\u5b9e\u9645\u4e0a ",(0,i.jsx)(e.code,{children:"FileUrlResource"})," \u4e0e ",(0,i.jsx)(e.code,{children:"UrlResource"})," \u7684 ",(0,i.jsx)(e.code,{children:"exist()"})," \u65b9\u6cd5\u90fd\u662f ",(0,i.jsx)(e.code,{children:"AbstractFileResolvingResource#exists"}),"\uff0c\u8fd9\u91cc\u7edf\u4e00\u5206\u6790\u5c31\u53ef\u4ee5\u4e86\uff0c\u8be5\u65b9\u6cd5\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"public boolean exists() {\n    try {\n        URL url = getURL();\n        if (ResourceUtils.isFileURL(url)) {\n            // \u5982\u679c\u662f\u6587\u4ef6\uff0c\u76f4\u63a5\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\n            return getFile().exists();\n        }\n        else {\n            // \u5426\u5219\u4f7f\u7528\u7f51\u7edc\u6587\u4ef6\u6765\u5904\u7406\n            URLConnection con = url.openConnection();\n            customizeConnection(con);\n            HttpURLConnection httpCon =\n                    (con instanceof HttpURLConnection ? (HttpURLConnection) con : null);\n            // \u5982\u679c\u662fhttp\uff0c\u5219\u5224\u65ad\u770b\u770b\u94fe\u63a5\u8fd4\u56de\u7684\u72b6\u6001\u7801\n            if (httpCon != null) {\n                int code = httpCon.getResponseCode();\n                if (code == HttpURLConnection.HTTP_OK) {\n                    return true;\n                }\n                else if (code == HttpURLConnection.HTTP_NOT_FOUND) {\n                    return false;\n                }\n            }\n            // \u8fde\u63a5 contentLengthLong \u5927\u4e8e0\uff0c\u4e5f\u5f53\u6210\u662ftrue\n            if (con.getContentLengthLong() > 0) {\n                return true;\n            }\n            if (httpCon != null) {\n                httpCon.disconnect();\n                return false;\n            }\n            else {\n                getInputStream().close();\n                return true;\n            }\n        }\n    }\n    catch (IOException ex) {\n        return false;\n    }\n}\n\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u662f\u672c\u5730\u6587\u4ef6\uff0c\u76f4\u63a5\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"File#exists()"})," \u65b9\u6cd5\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5426\u5219\u5c31\u5224\u65ad\u7f51\u7edc\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5224\u65ad\u65b9\u5f0f\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bf4\u4e86\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u603b\u7684\u6765\u8bf4\uff0cspringboot \u5bf9 ",(0,i.jsx)(e.code,{children:"@ConditionalOnResource"})," \u7684\u5224\u65ad\u8fd8\u662f\u6709\u4e9b\u590d\u6742\u7684\uff0c\u8fd9\u91cc\u603b\u7ed3\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u662f ",(0,i.jsx)(e.code,{children:"classpath"})," \u6587\u4ef6\uff0c\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"classloader"})," \u83b7\u53d6\u6587\u4ef6\u5bf9\u5e94\u7684 ",(0,i.jsx)(e.code,{children:"url"})," \u662f\u5426\u4e3a ",(0,i.jsx)(e.code,{children:"null"})," \u6765\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff1b"]}),"\n",(0,i.jsxs)(e.li,{children:["\u5982\u679c\u662f\u666e\u901a\u6587\u4ef6\uff0c\u5219\u76f4\u63a5 ",(0,i.jsx)(e.code,{children:"File#exists()"})," \u65b9\u6cd5\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff1b"]}),"\n",(0,i.jsx)(e.li,{children:"\u5982\u679c\u662f\u7f51\u7edc\u6587\u4ef6\uff0c\u5148\u6253\u5f00\u4e00\u4e2a\u7f51\u7edc\u8fde\u63a5\uff0c\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728\u3002"}),"\n"]}),"\n",(0,i.jsxs)(e.h3,{id:"7-conditionalonwebapplicationonwebapplicationconditiongetmatchoutcome",children:["7. ",(0,i.jsx)(e.code,{children:"@ConditionalOnWebApplication"}),"\uff1a",(0,i.jsx)(e.code,{children:"OnWebApplicationCondition#getMatchOutcome"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u518d\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"@ConditionalOnWebApplication"})," \u7684\u5904\u7406\uff0c\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"OnWebApplicationCondition#getOutcomes"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'@Override\nprotected ConditionOutcome[] getOutcomes(String[] autoConfigurationClasses,\n        AutoConfigurationMetadata autoConfigurationMetadata) {\n    ConditionOutcome[] outcomes = new ConditionOutcome[autoConfigurationClasses.length];\n    for (int i = 0; i < outcomes.length; i++) {\n        String autoConfigurationClass = autoConfigurationClasses[i];\n        if (autoConfigurationClass != null) {\n            // \u5904\u7406\u7ed3\u679c\n            outcomes[i] = getOutcome(autoConfigurationMetadata.get(autoConfigurationClass, \n                "ConditionalOnWebApplication"));\n        }\n    }\n    return outcomes;\n}\n\n/**\n * \u5904\u7406\u7ed3\u679c\n * springboot\u652f\u6301\u7684web\u7c7b\u578b\u6709\u4e24\u79cd\uff1aSERVLET\uff0cREACTIVE\n */\nprivate ConditionOutcome getOutcome(String type) {\n    if (type == null) {\n        return null;\n    }\n    ConditionMessage.Builder message = ConditionMessage\n            .forCondition(ConditionalOnWebApplication.class);\n    // \u5982\u679c\u6307\u5b9a\u7684\u7c7b\u578b\u662f SERVLET\n    if (ConditionalOnWebApplication.Type.SERVLET.name().equals(type)) {\n        if (!ClassNameFilter.isPresent(SERVLET_WEB_APPLICATION_CLASS, getBeanClassLoader())) {\n            return ConditionOutcome.noMatch(\n                message.didNotFind("servlet web application classes").atAll());\n        }\n    }\n    // \u5982\u679c\u6307\u5b9a\u7684\u7c7b\u578b\u662f REACTIVE\n    if (ConditionalOnWebApplication.Type.REACTIVE.name().equals(type)) {\n        if (!ClassNameFilter.isPresent(REACTIVE_WEB_APPLICATION_CLASS, getBeanClassLoader())) {\n            return ConditionOutcome.noMatch(\n                message.didNotFind("reactive web application classes").atAll());\n        }\n    }\n    // \u5982\u679c\u6ca1\u6709\u6307\u5b9aweb\u7c7b\u578b\n    if (!ClassNameFilter.isPresent(SERVLET_WEB_APPLICATION_CLASS, getBeanClassLoader())\n            && !ClassUtils.isPresent(REACTIVE_WEB_APPLICATION_CLASS, getBeanClassLoader())) {\n        return ConditionOutcome.noMatch(\n            message.didNotFind("reactive or servlet web application classes").atAll());\n    }\n    return null;\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u4e2a\u65b9\u6cd5\u5f88\u7b80\u5355\uff0c\u5904\u7406\u903b\u8f91\u4e3a\uff1a\u6839\u636e ",(0,i.jsx)(e.code,{children:"@ConditionalOnWebApplication"})," \u4e2d\u6307\u5b9a\u7684\u7c7b\u578b\uff0c\u5224\u65ad\u5bf9\u5e94\u7684\u7c7b\u662f\u5426\u5b58\u5728\uff0c\u5224\u65ad\u65b9\u5f0f\u4e0e ",(0,i.jsx)(e.code,{children:"@ConditionalOnClass"})," \u5224\u65ad\u7c7b\u662f\u5426\u5b58\u5728\u4e00\u81f4\uff0c\u800c\u4e24\u79cd\u7c7b\u578b\u5bf9\u5e94\u7684\u7c7b\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Servlet\uff1a",(0,i.jsx)(e.code,{children:"org.springframework.web.context.support.GenericWebApplicationContext"})]}),"\n",(0,i.jsxs)(e.li,{children:["Reactive\uff1a",(0,i.jsx)(e.code,{children:"org.springframework.web.reactive.HandlerResult"})]}),"\n"]}),"\n",(0,i.jsxs)(e.h3,{id:"8-conditionalonexpressiononexpressionconditiongetmatchoutcome",children:["8. ",(0,i.jsx)(e.code,{children:"@ConditionalOnExpression"}),"\uff1a",(0,i.jsx)(e.code,{children:"OnExpressionCondition#getMatchOutcome"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u6211\u4eec\u518d\u6765\u770b\u770b ",(0,i.jsx)(e.code,{children:"@ConditionalOnExpression"})," \u7684\u5904\u7406\uff0c\u8fdb\u5165 ",(0,i.jsx)(e.code,{children:"OnExpressionCondition#getOutcomes"})," \u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'/**\n * \u5904\u7406\u5339\u914d\u7ed3\u679c\n */\n@Override\npublic ConditionOutcome getMatchOutcome(ConditionContext context, \n        AnnotatedTypeMetadata metadata) {\n    // \u83b7\u53d6\u8868\u8fbe\u5f0f\n    String expression = (String) metadata.getAnnotationAttributes(\n            ConditionalOnExpression.class.getName()).get("value");\n    expression = wrapIfNecessary(expression);\n    ConditionMessage.Builder messageBuilder = ConditionMessage\n            .forCondition(ConditionalOnExpression.class, "(" + expression + ")");\n    // \u5904\u7406\u5360\u4f4d\u7b26\n    expression = context.getEnvironment().resolvePlaceholders(expression);\n    ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();\n    if (beanFactory != null) {\n        // \u8ba1\u7b97\u8868\u8fbe\u5f0f\u7684\u503c\n        boolean result = evaluateExpression(beanFactory, expression);\n        return new ConditionOutcome(result, messageBuilder.resultedIn(result));\n    }\n    return ConditionOutcome.noMatch(messageBuilder.because("no BeanFactory available."));\n}\n\n/**\n * \u8ba1\u7b97\u8868\u8fbe\u5f0f\u7684\u503c\n */\nprivate Boolean evaluateExpression(ConfigurableListableBeanFactory beanFactory, \n        String expression) {\n    BeanExpressionResolver resolver = beanFactory.getBeanExpressionResolver();\n    if (resolver == null) {\n        resolver = new StandardBeanExpressionResolver();\n    }\n    // \u5728\u8fd9\u91cc\u89e3\u6790\u8868\u8fbe\u5f0f\u7684\u503c\n    BeanExpressionContext expressionContext = new BeanExpressionContext(beanFactory, null);\n    Object result = resolver.evaluate(expression, expressionContext);\n    return (result != null && (boolean) result);\n}\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0cspringboot \u6700\u7ec8\u662f\u901a\u8fc7 ",(0,i.jsx)(e.code,{children:"BeanExpressionResolver#evaluate"})," \u65b9\u6cd5\u6765\u8ba1\u7b97\u8868\u8fbe\u5f0f\u7ed3\u679c\uff0c\u5173\u4e8e spring \u8868\u8fbe\u5f0f\uff0c\u672c\u6587\u5c31\u4e0d\u5c55\u5f00\u5206\u6790\u4e86\u3002"]}),"\n",(0,i.jsx)(e.p,{children:"\u597d\u4e86\uff0cspring \u6761\u4ef6\u6ce8\u89e3\u7684\u5206\u6790\u5c31\u5230\u8fd9\u91cc\u4e86\uff0c\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0cspringboot \u8fd8 \u6709\u5176\u4ed6\u6761\u4ef6\u6ce8\u89e3\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-0e8d27c887fb6ca142672cad1c60e9de207.png",alt:""})}),"\n",(0,i.jsx)(e.p,{children:"\u8fd9\u4e9b\u6ce8\u89e3\u7684\u5224\u65ad\u65b9\u5f0f\u4e0e\u672c\u6587\u7684\u65b9\u5f0f\u76f8\u7c7b\u4f3c\uff0c\u5c31\u4e0d\u4e00\u4e00\u8fdb\u884c\u5206\u6790\u4e86\u3002"}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsxs)(e.em,{children:["\u672c\u6587\u539f\u6587\u94fe\u63a5\uff1a",(0,i.jsx)(e.a,{href:"https://my.oschina.net/funcy/blog/4921590",children:"https://my.oschina.net/funcy/blog/4921590"})," \uff0c\u9650\u4e8e\u4f5c\u8005\u4e2a\u4eba\u6c34\u5e73\uff0c\u6587\u4e2d\u96be\u514d\u6709\u9519\u8bef\u4e4b\u5904\uff0c\u6b22\u8fce\u6307\u6b63\uff01\u539f\u521b\u4e0d\u6613\uff0c\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002"]})})]})}function h(n={}){const{wrapper:e}={...(0,o.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}},88672:(n,e,s)=>{s.d(e,{Z:()=>r,a:()=>c});var i=s(50959);const o={},t=i.createContext(o);function c(n){const e=i.useContext(t);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:c(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);