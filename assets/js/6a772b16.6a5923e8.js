"use strict";(self.webpackChunkcode_note_blog=self.webpackChunkcode_note_blog||[]).push([[9709],{85341:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var i=t(11527),r=t(88672);const a={},o=void 0,s={id:"Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u6e90\u7801\u5256\u6790\uff1aAOP\u5b9e\u73b0\u539f\u7406\u8be6\u89e3",title:"Spring\u6e90\u7801\u5256\u6790\uff1aAOP\u5b9e\u73b0\u539f\u7406\u8be6\u89e3",description:"\u672c\u6587\u8f6c\u81ea\u4e94\u6708\u7684\u4ed3\u9889 https://www.cnblogs.com/xrq730",source:"@site/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u6e90\u7801\u5256\u6790\uff1aAOP\u5b9e\u73b0\u539f\u7406\u8be6\u89e3.md",sourceDirName:"Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790",slug:"/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u6e90\u7801\u5256\u6790\uff1aAOP\u5b9e\u73b0\u539f\u7406\u8be6\u89e3",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u6e90\u7801\u5256\u6790\uff1aAOP\u5b9e\u73b0\u539f\u7406\u8be6\u89e3",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u6e90\u7801\u5256\u6790\uff1aAOP\u5b9e\u73b0\u539f\u7406\u8be6\u89e3.md",tags:[],version:"current",frontMatter:{},sidebar:"spring",previous:{title:"Spring\u6e90\u7801\u5256\u6790\uff1a\u61d2\u52a0\u8f7d\u7684\u5355\u4f8bBean\u83b7\u53d6\u8fc7\u7a0b\u5206\u6790",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u6e90\u7801\u5256\u6790\uff1a\u61d2\u52a0\u8f7d\u7684\u5355\u4f8bBean\u83b7\u53d6\u8fc7\u7a0b\u5206\u6790"},next:{title:"Spring\u6e90\u7801\u5256\u6790\uff1aJDK\u548ccglib\u52a8\u6001\u4ee3\u7406\u539f\u7406\u8be6\u89e3",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u6e90\u7801\u5256\u6790\uff1aJDK\u548ccglib\u52a8\u6001\u4ee3\u7406\u539f\u7406\u8be6\u89e3"}},c={},d=[{value:"AOP\u5b9e\u73b0\u539f\u7406\u2014\u2014\u627e\u5230Spring\u5904\u7406AOP\u7684\u6e90\u5934",id:"aop\u5b9e\u73b0\u539f\u7406\u627e\u5230spring\u5904\u7406aop\u7684\u6e90\u5934",level:2},{value:"\u89e3\u6790\u589e\u5f3a\u5668advisor",id:"\u89e3\u6790\u589e\u5f3a\u5668advisor",level:2},{value:"\u89e3\u6790\u5207\u9762\u7684\u8fc7\u7a0b",id:"\u89e3\u6790\u5207\u9762\u7684\u8fc7\u7a0b",level:2},{value:"AOP\u4e3aBean\u751f\u6210\u4ee3\u7406\u7684\u65f6\u673a\u5206\u6790",id:"aop\u4e3abean\u751f\u6210\u4ee3\u7406\u7684\u65f6\u673a\u5206\u6790",level:2},{value:"\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u5316\u8fc7\u7a0b",id:"\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u5316\u8fc7\u7a0b",level:2},{value:"\u5e73\u65f6\u6211\u4eec\u8bf4AOP\u539f\u7406\u4e09\u53e5\u8bdd\u5c31\u80fd\u6982\u62ec\uff1a",id:"\u5e73\u65f6\u6211\u4eec\u8bf4aop\u539f\u7406\u4e09\u53e5\u8bdd\u5c31\u80fd\u6982\u62ec",level:2},{value:"\u4ee3\u7406\u65b9\u6cd5\u8c03\u7528\u539f\u7406",id:"\u4ee3\u7406\u65b9\u6cd5\u8c03\u7528\u539f\u7406",level:2},{value:"CGLIB\u4ee3\u7406\u5b9e\u73b0",id:"cglib\u4ee3\u7406\u5b9e\u73b0",level:2},{value:"\u5fae\u4fe1\u516c\u4f17\u53f7",id:"\u5fae\u4fe1\u516c\u4f17\u53f7",level:2},{value:"\u4e2a\u4eba\u516c\u4f17\u53f7\uff1a\u9ec4\u5c0f\u659c",id:"\u4e2a\u4eba\u516c\u4f17\u53f7\u9ec4\u5c0f\u659c",level:3},{value:"\u6280\u672f\u516c\u4f17\u53f7\uff1aJava\u6280\u672f\u6c5f\u6e56",id:"\u6280\u672f\u516c\u4f17\u53f7java\u6280\u672f\u6c5f\u6e56",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",del:"del",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["\u672c\u6587\u8f6c\u81ea\u4e94\u6708\u7684\u4ed3\u9889 ",(0,i.jsx)(n.a,{href:"https://www.cnblogs.com/xrq730",children:"https://www.cnblogs.com/xrq730"})]}),"\n",(0,i.jsx)(n.p,{children:"\u672c\u7cfb\u5217\u6587\u7ae0\u5c06\u6574\u7406\u5230\u6211\u5728GitHub\u4e0a\u7684\u300aJava\u9762\u8bd5\u6307\u5357\u300b\u4ed3\u5e93\uff0c\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9\u8bf7\u5230\u6211\u7684\u4ed3\u5e93\u91cc\u67e5\u770b"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://github.com/h2pl/Java-Tutorial",children:"https://github.com/h2pl/Java-Tutorial"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u559c\u6b22\u7684\u8bdd\u9ebb\u70e6\u70b9\u4e0bStar\u54c8"}),"\n",(0,i.jsx)(n.p,{children:"\u6587\u7ae0\u5c06\u540c\u6b65\u5230\u6211\u7684\u4e2a\u4eba\u535a\u5ba2\uff1a"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"http://www.how2playlife.com",children:"www.how2playlife.com"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u672c\u6587\u662f\u5fae\u4fe1\u516c\u4f17\u53f7\u3010Java\u6280\u672f\u6c5f\u6e56\u3011\u7684\u300aSpring\u548cSpringMVC\u6e90\u7801\u5206\u6790\u300b\u5176\u4e2d\u4e00\u7bc7\uff0c\u672c\u6587\u90e8\u5206\u5185\u5bb9\u6765\u6e90\u4e8e\u7f51\u7edc\uff0c\u4e3a\u4e86\u628a\u672c\u6587\u4e3b\u9898\u8bb2\u5f97\u6e05\u6670\u900f\u5f7b\uff0c\u4e5f\u6574\u5408\u4e86\u5f88\u591a\u6211\u8ba4\u4e3a\u4e0d\u9519\u7684\u6280\u672f\u535a\u5ba2\u5185\u5bb9\uff0c\u5f15\u7528\u5176\u4e2d\u4e86\u4e00\u4e9b\u6bd4\u8f83\u597d\u7684\u535a\u5ba2\u6587\u7ae0\uff0c\u5982\u6709\u4fb5\u6743\uff0c\u8bf7\u8054\u7cfb\u4f5c\u8005\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8be5\u7cfb\u5217\u535a\u6587\u4f1a\u544a\u8bc9\u4f60\u5982\u4f55\u4ecespring\u57fa\u7840\u5165\u624b\uff0c\u4e00\u6b65\u6b65\u5730\u5b66\u4e60spring\u57fa\u7840\u548cspringmvc\u7684\u6846\u67b6\u77e5\u8bc6\uff0c\u5e76\u4e0a\u624b\u8fdb\u884c\u9879\u76ee\u5b9e\u6218\uff0cspring\u6846\u67b6\u662f\u6bcf\u4e00\u4e2aJava\u5de5\u7a0b\u5e08\u5fc5\u987b\u8981\u5b66\u4e60\u548c\u7406\u89e3\u7684\u77e5\u8bc6\u70b9\uff0c\u8fdb\u4e00\u6b65\u6765\u8bf4\uff0c\u4f60\u8fd8\u9700\u8981\u638c\u63e1spring\u751a\u81f3\u662fspringmvc\u7684\u6e90\u7801\u4ee5\u53ca\u5b9e\u73b0\u539f\u7406\uff0c\u624d\u80fd\u66f4\u5b8c\u6574\u5730\u4e86\u89e3\u6574\u4e2aspring\u6280\u672f\u4f53\u7cfb\uff0c\u5f62\u6210\u81ea\u5df1\u7684\u77e5\u8bc6\u6846\u67b6\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u540e\u7eed\u8fd8\u4f1a\u6709springboot\u548cspringcloud\u7684\u6280\u672f\u4e13\u9898\uff0c\u9646\u7eed\u4e3a\u5927\u5bb6\u5e26\u6765\uff0c\u656c\u8bf7\u671f\u5f85\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4e3a\u4e86\u66f4\u597d\u5730\u603b\u7ed3\u548c\u68c0\u9a8c\u4f60\u7684\u5b66\u4e60\u6210\u679c\uff0c\u672c\u7cfb\u5217\u6587\u7ae0\u4e5f\u4f1a\u63d0\u4f9b\u90e8\u5206\u77e5\u8bc6\u70b9\u5bf9\u5e94\u7684\u9762\u8bd5\u9898\u4ee5\u53ca\u53c2\u8003\u7b54\u6848\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u5bf9\u672c\u7cfb\u5217\u6587\u7ae0\u6709\u4ec0\u4e48\u5efa\u8bae\uff0c\u6216\u8005\u662f\u6709\u4ec0\u4e48\u7591\u95ee\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u5173\u6ce8\u516c\u4f17\u53f7\u3010Java\u6280\u672f\u6c5f\u6e56\u3011\u8054\u7cfb\u4f5c\u8005\uff0c\u6b22\u8fce\u4f60\u53c2\u4e0e\u672c\u7cfb\u5217\u535a\u6587\u7684\u521b\u4f5c\u548c\u4fee\u8ba2\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u524d\u8a00"}),"\n",(0,i.jsx)(n.p,{children:"\u524d\u9762\u5199\u4e86\u516d\u7bc7\u6587\u7ae0\u8be6\u7ec6\u5730\u5206\u6790\u4e86Spring Bean\u52a0\u8f7d\u6d41\u7a0b\uff0c\u8fd9\u90e8\u5206\u5b8c\u4e86\u4e4b\u540e\u5c31\u8981\u8fdb\u5165\u4e00\u4e2a\u6bd4\u8f83\u56f0\u96be\u7684\u90e8\u5206\u4e86\uff0c\u5c31\u662fAOP\u7684\u5b9e\u73b0\u539f\u7406\u5206\u6790\u3002\u4e3a\u4e86\u63a2\u7a76AOP\u5b9e\u73b0\u539f\u7406\uff0c\u9996\u5148\u5b9a\u4e49\u51e0\u4e2a\u7c7b\uff0c\u4e00\u4e2aDao\u63a5\u53e3\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'public interface Dao {\npublic void select();\npublic void insert();\n}\nDao\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7bDaoImpl\uff1a\n\n\npublic class DaoImpl implements Dao {\n\n    @Override\n    public void select() {\n        System.out.println("Enter DaoImpl.select()");\n    }\n\n    @Override\n    public void insert() {\n        System.out.println("Enter DaoImpl.insert()");\n    }\n\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5b9a\u4e49\u4e00\u4e2aTimeHandler\uff0c\u7528\u4e8e\u65b9\u6cd5\u8c03\u7528\u524d\u540e\u6253\u5370\u65f6\u95f4\uff0c\u5728AOP\u4e2d\uff0c\u8fd9\u626e\u6f14\u7684\u662f\u6a2a\u5207\u5173\u6ce8\u70b9\u7684\u89d2\u8272\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'public class TimeHandler {\n\n    public void printTime() {\n        System.out.println("CurrentTime:" + System.currentTimeMillis());\n    }\n\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5b9a\u4e49\u4e00\u4e2aXML\u6587\u4ef6aop.xml\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n    xmlns:aop="http://www.springframework.org/schema/aop"\n    xmlns:tx="http://www.springframework.org/schema/tx"\n    xsi:schemaLocation="http://www.springframework.org/schema/beans\n\nhttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd\n\nhttp://www.springframework.org/schema/aop\n\nhttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd">\n\n    <bean id="daoImpl" class="org.xrq.action.aop.DaoImpl" />\n    <bean id="timeHandler" class="org.xrq.action.aop.TimeHandler" />\n\n \n</beans>\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5199\u4e00\u6bb5\u6d4b\u8bd5\u4ee3\u7801TestAop.java\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'public class TestAop {\n\n    @Test\n    public void testAop() {\n        ApplicationContext ac = new ClassPathXmlApplicationContext("spring/aop.xml");\n\n        Dao dao = (Dao)ac.getBean("daoImpl");\n        dao.select();\n    }\n\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u4ee3\u7801\u8fd0\u884c\u7ed3\u679c\u5c31\u4e0d\u770b\u4e86\uff0c\u6709\u4e86\u4ee5\u4e0a\u7684\u5185\u5bb9\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6839\u636e\u8fd9\u4e9b\u8ddf\u4e00\u4e0b\u4ee3\u7801\uff0c\u770b\u770bSpring\u5230\u5e95\u662f\u5982\u4f55\u5b9e\u73b0AOP\u7684\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"aop\u5b9e\u73b0\u539f\u7406\u627e\u5230spring\u5904\u7406aop\u7684\u6e90\u5934",children:"AOP\u5b9e\u73b0\u539f\u7406\u2014\u2014\u627e\u5230Spring\u5904\u7406AOP\u7684\u6e90\u5934"}),"\n",(0,i.jsx)(n.p,{children:"\u6709\u5f88\u591a\u670b\u53cb\u4e0d\u613f\u610f\u53bb\u770bAOP\u6e90\u7801\u7684\u4e00\u4e2a\u5f88\u5927\u539f\u56e0\u662f\u56e0\u4e3a\u627e\u4e0d\u5230AOP\u6e90\u7801\u5b9e\u73b0\u7684\u5165\u53e3\u5728\u54ea\u91cc\uff0c\u8fd9\u4e2a\u786e\u5b9e\u662f\u3002\u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u770b\u4e00\u4e0b\u4e0a\u9762\u7684\u6d4b\u8bd5\u4ee3\u7801\uff0c\u5c31\u666e\u901aBean\u4e5f\u597d\u3001AOP\u4e5f\u597d\uff0c\u6700\u7ec8\u90fd\u662f\u901a\u8fc7getBean\u65b9\u6cd5\u83b7\u53d6\u5230Bean\u5e76\u8c03\u7528\u65b9\u6cd5\u7684\uff0cgetBean\u4e4b\u540e\u7684\u5bf9\u8c61\u5df2\u7ecf\u524d\u540e\u90fd\u6253\u5370\u4e86TimeHandler\u7c7bprintTime()\u65b9\u6cd5\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u60f3\u89c1\u5b83\u4eec\u5df2\u7ecf\u662f\u88abSpring\u5bb9\u5668\u5904\u7406\u8fc7\u4e86\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u65e2\u7136\u5982\u6b64\uff0c\u90a3\u65e0\u975e\u5c31\u4e24\u4e2a\u5730\u65b9\u5904\u7406\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u52a0\u8f7dBean\u5b9a\u4e49\u7684\u65f6\u5019\u5e94\u8be5\u6709\u8fc7\u7279\u6b8a\u7684\u5904\u7406\ngetBean\u7684\u65f6\u5019\u5e94\u8be5\u6709\u8fc7\u7279\u6b8a\u7684\u5904\u7406\n\u56e0\u6b64\uff0c\u672c\u6587\u56f4\u7ed5\u30101.\u52a0\u8f7dBean\u5b9a\u4e49\u7684\u65f6\u5019\u5e94\u8be5\u6709\u8fc7\u7279\u6b8a\u7684\u5904\u7406\u3011\u5c55\u5f00\uff0c\u5148\u627e\u4e00\u4e0b\u5230\u5e95\u662f\u54ea\u91ccSpring\u5bf9AOP\u505a\u4e86\u7279\u6b8a\u7684\u5904\u7406\u3002\u4ee3\u7801\u76f4\u63a5\u5b9a\u4f4d\u5230DefaultBeanDefinitionDocumentReader\u7684parseBeanDefinitions\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {\n    if (delegate.isDefaultNamespace(root)) {\n        NodeList nl = root.getChildNodes();\n        for (int i = 0; i < nl.getLength(); i++) {\n            Node node = nl.item(i);\n            if (node instanceof Element) {\n                Element ele = (Element) node;\n                if (delegate.isDefaultNamespace(ele)) {\n                    parseDefaultElement(ele, delegate);\n                }\n                else {\n                    delegate.parseCustomElement(ele);\n                }\n            }\n        }\n    }\n    else {\n        delegate.parseCustomElement(root);\n    }\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6b63\u5e38\u6765\u8bf4\uff0c\u9047\u5230",(0,i.jsx)(n.code,{children:"<bean id=\u201ddaoImpl\u201d\u2026>\u3001<bean id=\u201dtimeHandler\u201d\u2026>"}),"\u8fd9\u4e24\u4e2a\u6807\u7b7e\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u6267\u884c\u7b2c9\u884c\u7684\u4ee3\u7801\uff0c\u56e0\u4e3a",(0,i.jsx)(n.code,{children:"<bean>"}),"\u6807\u7b7e\u662f\u9ed8\u8ba4\u7684Namespace\u3002\u4f46\u662f\u5728\u9047\u5230\u540e\u9762\u7684\u6807\u7b7e\u7684\u65f6\u5019\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u5e76\u4e0d\u662f\u9ed8\u8ba4\u7684Namespace\uff0c\u56e0\u6b64\u4f1a\u6267\u884c\u7b2c12\u884c\u7684\u4ee3\u7801\uff0c\u770b\u4e00\u4e0b\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'public BeanDefinition parseCustomElement(Element ele, BeanDefinition containingBd) {\n    String namespaceUri = getNamespaceURI(ele);\n    NamespaceHandler handler = this.readerContext.getNamespaceHandlerResolver().resolve(namespaceUri);\n    if (handler == null) {\n        error("Unable to locate Spring NamespaceHandler for XML schema namespace [" + namespaceUri + "]", ele);\n        return null;\n    }\n    return handler.parse(ele, new ParserContext(this.readerContext, this, containingBd));\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u56e0\u4e3a\u4e4b\u524d\u628a\u6574\u4e2aXML\u89e3\u6790\u4e3a\u4e86org.w3c.dom.Document\uff0corg.w3c.dom.Document\u4ee5\u6811\u7684\u5f62\u5f0f\u8868\u793a\u6574\u4e2aXML\uff0c\u5177\u4f53\u5230\u6bcf\u4e00\u4e2a\u8282\u70b9\u5c31\u662f\u4e00\u4e2aNode\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u9996\u5148\u7b2c2\u884c\u4ece\u8fd9\u4e2aNode\uff08\u53c2\u6570Element\u662fNode\u63a5\u53e3\u7684\u5b50\u63a5\u53e3\uff09\u4e2d\u62ff\u5230Namespace=\u201d",(0,i.jsx)(n.a,{href:"https://links.jianshu.com/go?to=http%3A%2F%2Fwww.springframework.org%2Fschema%2Faop",children:"http://www.springframework.org/schema/aop"}),"\u201c\uff0c\u7b2c3\u884c\u7684\u4ee3\u7801\u6839\u636e\u8fd9\u4e2aNamespace\u83b7\u53d6\u5bf9\u5e94\u7684NamespaceHandler\u5373Namespace\u5904\u7406\u5668\uff0c\u5177\u4f53\u5230aop\u8fd9\u4e2aNamespace\u7684NamespaceHandler\u662forg.springframework.aop.config.AopNamespaceHandler\u7c7b\uff0c\u4e5f\u5c31\u662f\u7b2c3\u884c\u4ee3\u7801\u83b7\u53d6\u5230\u7684\u7ed3\u679c\u3002\u5177\u4f53\u5230AopNamespaceHandler\u91cc\u9762\uff0c\u6709\u51e0\u4e2aParser\uff0c\u662f\u7528\u4e8e\u5177\u4f53\u6807\u7b7e\u8f6c\u6362\u7684\uff0c\u5206\u522b\u4e3a\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:"config\u2013>ConfigBeanDefinitionParser\naspectj-autoproxy\u2013>AspectJAutoProxyBeanDefinitionParser\nscoped-proxy\u2013>ScopedProxyBeanDefinitionDecorator\nspring-configured\u2013>SpringConfiguredBeanDefinitionParser\n\u63a5\u7740\uff0c\u5c31\u662f\u7b2c8\u884c\u7684\u4ee3\u7801\uff0c\u5229\u7528AopNamespaceHandler\u7684parse\u65b9\u6cd5\uff0c\u89e3\u6790\u4e0b\u7684\u5185\u5bb9\u4e86\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u89e3\u6790\u589e\u5f3a\u5668advisor",children:"\u89e3\u6790\u589e\u5f3a\u5668advisor"}),"\n",(0,i.jsx)(n.p,{children:"AOP Bean\u5b9a\u4e49\u52a0\u8f7d\u2014\u2014\u6839\u636e\u7ec7\u5165\u65b9\u5f0f\u5c06\u3001\u8f6c\u6362\u6210\u540d\u4e3aadviceDef\u7684RootBeanDefinition\n\u4e0a\u9762\u7ecf\u8fc7\u5206\u6790\uff0c\u5df2\u7ecf\u627e\u5230\u4e86Spring\u662f\u901a\u8fc7AopNamespaceHandler\u5904\u7406\u7684AOP\uff0c\u90a3\u4e48\u63a5\u7740\u8fdb\u5165AopNamespaceHandler\u7684parse\u65b9\u6cd5\u6e90\u4ee3\u7801\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public BeanDefinition parse(Element element, ParserContext parserContext) {\n    return findParserForElement(element, parserContext).parse(element, parserContext);\n}   \n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u9996\u5148\u83b7\u53d6\u5177\u4f53\u7684Parser\uff0c\u56e0\u4e3a\u5f53\u524d\u8282\u70b9\u662f\uff0c\u4e0a\u4e00\u90e8\u5206\u6700\u540e\u6709\u5217\uff0cconfig\u662f\u901a\u8fc7ConfigBeanDefinitionParser\u6765\u5904\u7406\u7684\uff0c\u56e0\u6b64findParserForElement(element, parserContext)\u8fd9\u4e00\u90e8\u5206\u4ee3\u7801\u83b7\u53d6\u5230\u7684\u662fConfigBeanDefinitionParser\uff0c\u63a5\u7740\u770bConfigBeanDefinitionParser\u7684parse\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public BeanDefinition parse(Element element, ParserContext parserContext) {\n    CompositeComponentDefinition compositeDef =\n            new CompositeComponentDefinition(element.getTagName(), parserContext.extractSource(element));\n    parserContext.pushContainingComponent(compositeDef);\n\n    configureAutoProxyCreator(parserContext, element);\n\n    List<Element> childElts = DomUtils.getChildElements(element);\n    for (Element elt: childElts) {\n        String localName = parserContext.getDelegate().getLocalName(elt);\n        if (POINTCUT.equals(localName)) {\n            parsePointcut(elt, parserContext);\n        }\n        else if (ADVISOR.equals(localName)) {\n            parseAdvisor(elt, parserContext);\n        }\n        else if (ASPECT.equals(localName)) {\n            parseAspect(elt, parserContext);\n        }\n    }\n\n    parserContext.popAndRegisterContainingComponent();\n    return null;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u91cd\u70b9\u5148\u63d0\u4e00\u4e0b\u7b2c6\u884c\u7684\u4ee3\u7801\uff0c\u8be5\u884c\u4ee3\u7801\u7684\u5177\u4f53\u5b9e\u73b0\u4e0d\u8ddf\u4e86\u4f46\u5b83\u975e\u5e38\u91cd\u8981\uff0cconfigureAutoProxyCreator\u65b9\u6cd5\u7684\u4f5c\u7528\u6211\u7528\u51e0\u53e5\u8bdd\u8bf4\u4e00\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u5411Spring\u5bb9\u5668\u6ce8\u518c\u4e86\u4e00\u4e2aBeanName\u4e3aorg.springframework.aop.config.internalAutoProxyCreator\u7684Bean\u5b9a\u4e49\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e5f\u53ef\u4ee5\u4f7f\u7528Spring\u63d0\u4f9b\u7684\uff08\u6839\u636e\u4f18\u5148\u7ea7\u6765\uff09\nSpring\u9ed8\u8ba4\u63d0\u4f9b\u7684\u662forg.springframework.aop.aspectj.autoproxy.AspectJAwareAdvisorAutoProxyCreator\uff0c\u8fd9\u4e2a\u7c7b\u662fAOP\u7684\u6838\u5fc3\u7c7b\uff0c\u7559\u5728\u4e0b\u7bc7\u8bb2\u89e3\n\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u4e5f\u4f1a\u6839\u636e\u914d\u7f6eproxy-target-class\u548cexpose-proxy\uff0c\u8bbe\u7f6e\u662f\u5426\u4f7f\u7528CGLIB\u8fdb\u884c\u4ee3\u7406\u4ee5\u53ca\u662f\u5426\u66b4\u9732\u6700\u7ec8\u7684\u4ee3\u7406\u3002\n\u4e0b\u7684\u8282\u70b9\u4e3a\uff0c\u60f3\u89c1\u5fc5\u7136\u662f\u6267\u884c\u7b2c18\u884c\u7684\u4ee3\u7801parseAspect\uff0c\u8ddf\u8fdb\u53bb\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'private void parseAspect(Element aspectElement, ParserContext parserContext) {\n    String aspectId = aspectElement.getAttribute(ID);\n    String aspectName = aspectElement.getAttribute(REF);\n\n    try {\n        this.parseState.push(new AspectEntry(aspectId, aspectName));\n        List<BeanDefinition> beanDefinitions = new ArrayList<BeanDefinition>();\n        List<BeanReference> beanReferences = new ArrayList<BeanReference>();\n\n        List<Element> declareParents = DomUtils.getChildElementsByTagName(aspectElement, DECLARE_PARENTS);\n        for (int i = METHOD_INDEX; i < declareParents.size(); i++) {\n            Element declareParentsElement = declareParents.get(i);\n            beanDefinitions.add(parseDeclareParents(declareParentsElement, parserContext));\n        }\n\n        // We have to parse "advice" and all the advice kinds in one loop, to get the\n        // ordering semantics right.\n        NodeList nodeList = aspectElement.getChildNodes();\n        boolean adviceFoundAlready = false;\n        for (int i = 0; i < nodeList.getLength(); i++) {\n            Node node = nodeList.item(i);\n            if (isAdviceNode(node, parserContext)) {\n                if (!adviceFoundAlready) {\n                    adviceFoundAlready = true;\n                    if (!StringUtils.hasText(aspectName)) {\n                        parserContext.getReaderContext().error(\n                                " tag needs aspect bean reference via \'ref\' attribute when declaring advices.",\n                                aspectElement, this.parseState.snapshot());\n                        return;\n                    }\n                    beanReferences.add(new RuntimeBeanReference(aspectName));\n                }\n                AbstractBeanDefinition advisorDefinition = parseAdvice(\n                        aspectName, i, aspectElement, (Element) node, parserContext, beanDefinitions, beanReferences);\n                beanDefinitions.add(advisorDefinition);\n            }\n        }\n\n        AspectComponentDefinition aspectComponentDefinition = createAspectComponentDefinition(\n                aspectElement, aspectId, beanDefinitions, beanReferences, parserContext);\n        parserContext.pushContainingComponent(aspectComponentDefinition);\n\n        List<Element> pointcuts = DomUtils.getChildElementsByTagName(aspectElement, POINTCUT);\n        for (Element pointcutElement : pointcuts) {\n            parsePointcut(pointcutElement, parserContext);\n        }\n\n        parserContext.popAndRegisterContainingComponent();\n    }\n    finally {\n        this.parseState.pop();\n    }\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u4ece\u7b2c20\u884c~\u7b2c37\u884c\u7684\u5faa\u73af\u5f00\u59cb\u5173\u6ce8\u8fd9\u4e2a\u65b9\u6cd5\u3002\u8fd9\u4e2afor\u5faa\u73af\u6709\u4e00\u4e2a\u5173\u952e\u7684\u5224\u65ad\u5c31\u662f\u7b2c22\u884c\u7684ifAdviceNode\u5224\u65ad\uff0c\u770b\u4e0bifAdviceNode\u65b9\u6cd5\u505a\u4e86\u4ec0\u4e48\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"private boolean isAdviceNode(Node aNode, ParserContext parserContext) {\n    if (!(aNode instanceof Element)) {\n        return false;\n    }\n    else {\n        String name = parserContext.getDelegate().getLocalName(aNode);\n        return (BEFORE.equals(name) || AFTER.equals(name) || AFTER_RETURNING_ELEMENT.equals(name) ||\n                AFTER_THROWING_ELEMENT.equals(name) || AROUND.equals(name));\n    }\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5373\u8fd9\u4e2afor\u5faa\u73af\u53ea\u7528\u6765\u5904\u7406\u6807\u7b7e\u4e0b\u7684\u3001\u3001\u3001\u3001\u8fd9\u4e94\u4e2a\u6807\u7b7e\u7684\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u63a5\u7740\uff0c\u5982\u679c\u662f\u4e0a\u8ff0\u4e94\u79cd\u6807\u7b7e\u4e4b\u4e00\uff0c\u90a3\u4e48\u8fdb\u5165\u7b2c33\u884c~\u7b2c34\u884c\u7684parseAdvice\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'private AbstractBeanDefinition parseAdvice(\n    String aspectName, int order, Element aspectElement, Element adviceElement, ParserContext parserContext,\n    List<BeanDefinition> beanDefinitions, List<BeanReference> beanReferences) {\n    try {\n        this.parseState.push(new AdviceEntry(parserContext.getDelegate().getLocalName(adviceElement)));\n        // create the method factory bean\n        RootBeanDefinition methodDefinition = new RootBeanDefinition(MethodLocatingFactoryBean.class);\n        methodDefinition.getPropertyValues().add("targetBeanName", aspectName);\n        methodDefinition.getPropertyValues().add("methodName", adviceElement.getAttribute("method"));\n        methodDefinition.setSynthetic(true);\n        // create instance factory definition\n        RootBeanDefinition aspectFactoryDef =\n        new RootBeanDefinition(SimpleBeanFactoryAwareAspectInstanceFactory.class);\n        aspectFactoryDef.getPropertyValues().add("aspectBeanName", aspectName);\n        aspectFactoryDef.setSynthetic(true);\n\n        // register the pointcut\n        AbstractBeanDefinition adviceDef = createAdviceDefinition(\n            adviceElement, parserContext, aspectName, order, methodDefinition, aspectFactoryDef,\n            beanDefinitions, beanReferences);\n\n        // configure the advisor\n        RootBeanDefinition advisorDefinition = new RootBeanDefinition(AspectJPointcutAdvisor.class);\n        advisorDefinition.setSource(parserContext.extractSource(adviceElement));\n        advisorDefinition.getConstructorArgumentValues().addGenericArgumentValue(adviceDef);\n        if (aspectElement.hasAttribute(ORDER_PROPERTY)) {\n            advisorDefinition.getPropertyValues().add(\n                ORDER_PROPERTY, aspectElement.getAttribute(ORDER_PROPERTY));\n        }\n\n        // register the final advisor\n        parserContext.getReaderContext().registerWithGeneratedName(advisorDefinition);\n\n        return advisorDefinition;\n    }\n    finally {\n        this.parseState.pop();\n    }\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u65b9\u6cd5\u4e3b\u8981\u505a\u4e86\u4e09\u4ef6\u4e8b\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u6839\u636e\u7ec7\u5165\u65b9\u5f0f\uff08before\u3001after\u8fd9\u4e9b\uff09\u521b\u5efaRootBeanDefinition\uff0c\u540d\u4e3aadviceDef\u5373advice\u5b9a\u4e49"}),"\n",(0,i.jsx)(n.p,{children:"\u5c06\u4e0a\u4e00\u6b65\u521b\u5efa\u7684RootBeanDefinition\u5199\u5165\u4e00\u4e2a\u65b0\u7684RootBeanDefinition\uff0c\u6784\u9020\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff0c\u540d\u4e3aadvisorDefinition\uff0c\u5373advisor\u5b9a\u4e49\n\u5c06advisorDefinition\u6ce8\u518c\u5230DefaultListableBeanFactory\u4e2d\n\u4e0b\u9762\u6765\u770b\u505a\u7684\u7b2c\u4e00\u4ef6\u4e8bcreateAdviceDefinition\u65b9\u6cd5\u5b9a\u4e49\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"private AbstractBeanDefinition createAdviceDefinition(\n        Element adviceElement, ParserContext parserContext, String aspectName, int order,\n        RootBeanDefinition methodDef, RootBeanDefinition aspectFactoryDef,\n        List<BeanDefinition> beanDefinitions, List<BeanReference> beanReferences) {\n\n    RootBeanDefinition adviceDefinition = new RootBeanDefinition(getAdviceClass(adviceElement, parserContext));\n    adviceDefinition.setSource(parserContext.extractSource(adviceElement));\n        adviceDefinition.getPropertyValues().add(ASPECT_NAME_PROPERTY, aspectName);\n    adviceDefinition.getPropertyValues().add(DECLARATION_ORDER_PROPERTY, order);\n\n    if (adviceElement.hasAttribute(RETURNING)) {\n        adviceDefinition.getPropertyValues().add(\n                RETURNING_PROPERTY, adviceElement.getAttribute(RETURNING));\n    }\n    if (adviceElement.hasAttribute(THROWING)) {\n        adviceDefinition.getPropertyValues().add(\n                THROWING_PROPERTY, adviceElement.getAttribute(THROWING));\n    }\n    if (adviceElement.hasAttribute(ARG_NAMES)) {\n        adviceDefinition.getPropertyValues().add(\n                ARG_NAMES_PROPERTY, adviceElement.getAttribute(ARG_NAMES));\n    }\n\n    ConstructorArgumentValues cav = adviceDefinition.getConstructorArgumentValues();\n    cav.addIndexedArgumentValue(METHOD_INDEX, methodDef);\n\n    Object pointcut = parsePointcutProperty(adviceElement, parserContext);\n    if (pointcut instanceof BeanDefinition) {\n        cav.addIndexedArgumentValue(POINTCUT_INDEX, pointcut);\n        beanDefinitions.add((BeanDefinition) pointcut);\n    }\n    else if (pointcut instanceof String) {\n        RuntimeBeanReference pointcutRef = new RuntimeBeanReference((String) pointcut);\n        cav.addIndexedArgumentValue(POINTCUT_INDEX, pointcutRef);\n        beanReferences.add(pointcutRef);\n    }\n\n    cav.addIndexedArgumentValue(ASPECT_INSTANCE_FACTORY_INDEX, aspectFactoryDef);\n\n    return adviceDefinition;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u9996\u5148\u53ef\u4ee5\u770b\u5230\uff0c\u521b\u5efa\u7684AbstractBeanDefinition\u5b9e\u4f8b\u662fRootBeanDefinition\uff0c\u8fd9\u548c\u666e\u901aBean\u521b\u5efa\u7684\u5b9e\u4f8b\u4e3aGenericBeanDefinition\u4e0d\u540c\u3002\u7136\u540e\u8fdb\u5165\u7b2c6\u884c\u7684getAdviceClass\u65b9\u6cd5\u770b\u4e00\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'private Class getAdviceClass(Element adviceElement, ParserContext parserContext) {\n    String elementName = parserContext.getDelegate().getLocalName(adviceElement);\n    if (BEFORE.equals(elementName)) {\n        return AspectJMethodBeforeAdvice.class;\n    }\n    else if (AFTER.equals(elementName)) {\n        return AspectJAfterAdvice.class;\n    }\n    else if (AFTER_RETURNING_ELEMENT.equals(elementName)) {\n        return AspectJAfterReturningAdvice.class;\n    }\n    else if (AFTER_THROWING_ELEMENT.equals(elementName)) {\n        return AspectJAfterThrowingAdvice.class;\n    }\n    else if (AROUND.equals(elementName)) {\n        return AspectJAroundAdvice.class;\n    }\n    else {\n        throw new IllegalArgumentException("Unknown advice kind [" + elementName + "].");\n    }\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u65e2\u7136\u521b\u5efaBean\u5b9a\u4e49\uff0c\u5fc5\u7136\u8be5Bean\u5b9a\u4e49\u4e2d\u8981\u5bf9\u5e94\u4e00\u4e2a\u5177\u4f53\u7684Class\uff0c\u4e0d\u540c\u7684\u5207\u5165\u65b9\u5f0f\u5bf9\u5e94\u4e0d\u540c\u7684Class\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"before\u5bf9\u5e94AspectJMethodBeforeAdvice\nAfter\u5bf9\u5e94AspectJAfterAdvice\nafter-returning\u5bf9\u5e94AspectJAfterReturningAdvice\nafter-throwing\u5bf9\u5e94AspectJAfterThrowingAdvice\naround\u5bf9\u5e94AspectJAroundAdvice\n"})}),"\n",(0,i.jsx)(n.p,{children:"createAdviceDefinition\u65b9\u6cd5\u5269\u4f59\u903b\u8f91\u6ca1\u4ec0\u4e48\uff0c\u5c31\u662f\u5224\u65ad\u4e00\u4e0b\u6807\u7b7e\u91cc\u9762\u7684\u5c5e\u6027\u5e76\u8bbe\u7f6e\u4e00\u4e0b\u76f8\u5e94\u7684\u503c\u800c\u5df2\uff0c\u81f3\u6b64\u3001\u4e24\u4e2a\u6807\u7b7e\u5bf9\u5e94\u7684AbstractBeanDefinition\u5c31\u521b\u5efa\u51fa\u6765\u4e86\u3002"}),"\n",(0,i.jsx)(n.p,{children:"AOP Bean\u5b9a\u4e49\u52a0\u8f7d\u2014\u2014\u5c06\u540d\u4e3aadviceDef\u7684RootBeanDefinition\u8f6c\u6362\u6210\u540d\u4e3aadvisorDefinition\u7684RootBeanDefinition\n\u4e0b\u9762\u6211\u4eec\u770b\u4e00\u4e0b\u7b2c\u4e8c\u6b65\u7684\u64cd\u4f5c\uff0c\u5c06\u540d\u4e3aadviceDef\u7684RootBeanD\u8f6c\u6362\u6210\u540d\u4e3aadvisorDefinition\u7684RootBeanDefinition\uff0c\u8ddf\u4e00\u4e0b\u4e0a\u9762\u4e00\u90e8\u5206ConfigBeanDefinitionParser\u7c7bparseAdvice\u65b9\u6cd5\u7684\u7b2c26\u884c~32\u884c\u7684\u4ee3\u7801\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"RootBeanDefinition advisorDefinition = new RootBeanDefinition(AspectJPointcutAdvisor.class);\nadvisorDefinition.setSource(parserContext.extractSource(adviceElement));\nadvisorDefinition.getConstructorArgumentValues().addGenericArgumentValue(adviceDef);\nif (aspectElement.hasAttribute(ORDER_PROPERTY)) {\n    advisorDefinition.getPropertyValues().add(\n            ORDER_PROPERTY, aspectElement.getAttribute(ORDER_PROPERTY));\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u91cc\u76f8\u5f53\u4e8e\u5c06\u4e0a\u4e00\u6b65\u751f\u6210\u7684RootBeanDefinition\u5305\u88c5\u4e86\u4e00\u4e0b\uff0cnew\u4e00\u4e2a\u65b0\u7684RootBeanDefinition\u51fa\u6765\uff0cClass\u7c7b\u578b\u662forg.springframework.aop.aspectj.AspectJPointcutAdvisor\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c4\u884c~\u7b2c7\u884c\u7684\u4ee3\u7801\u662f\u7528\u4e8e\u5224\u65ad\u6807\u7b7e\u4e2d\u6709\u6ca1\u6709\u201dorder\u201d\u5c5e\u6027\u7684\uff0c\u6709\u5c31\u8bbe\u7f6e\u4e00\u4e0b\uff0c\u201dorder\u201d\u5c5e\u6027\u662f\u7528\u6765\u63a7\u5236\u5207\u5165\u65b9\u6cd5\u4f18\u5148\u7ea7\u7684\u3002"}),"\n",(0,i.jsx)(n.p,{children:"AOP Bean\u5b9a\u4e49\u52a0\u8f7d\u2014\u2014\u5c06BeanDefinition\u6ce8\u518c\u5230DefaultListableBeanFactory\u4e2d"}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u540e\u4e00\u6b65\u5c31\u662f\u5c06BeanDefinition\u6ce8\u518c\u5230DefaultListableBeanFactory\u4e2d\u4e86\uff0c\u4ee3\u7801\u5c31\u662f\u524d\u9762ConfigBeanDefinitionParser\u7684parseAdvice\u65b9\u6cd5\u7684\u6700\u540e\u4e00\u90e8\u5206\u4e86\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"// register the final advisor\nparserContext.getReaderContext().registerWithGeneratedName(advisorDefinition);\n...\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8ddf\u4e00\u4e0bregisterWithGeneratedName\u65b9\u6cd5\u7684\u5b9e\u73b0\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public String registerWithGeneratedName(BeanDefinition beanDefinition) {\n    String generatedName = generateBeanName(beanDefinition);\n    getRegistry().registerBeanDefinition(generatedName, beanDefinition);\n    return generatedName;\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c2\u884c\u83b7\u53d6\u6ce8\u518c\u7684\u540d\u5b57BeanName\uff0c\u548c",(0,i.jsx)(n.code,{children:"<bean>"}),"\u7684\u6ce8\u518c\u5dee\u4e0d\u591a\uff0c\u4f7f\u7528\u7684\u662fClass\u5168\u8def\u5f84+\u201d#\u201d+\u5168\u5c40\u8ba1\u6570\u5668\u7684\u65b9\u5f0f\uff0c\u5176\u4e2d\u7684Class\u5168\u8def\u5f84\u4e3aorg.springframework.aop.aspectj.AspectJPointcutAdvisor\uff0c\u4f9d\u6b21\u7c7b\u63a8\uff0c\u6bcf\u4e00\u4e2aBeanName\u5e94\u5f53\u4e3aorg.springframework.aop.aspectj.AspectJPointcutAdvisor#0\u3001org.springframework.aop.aspectj.AspectJPointcutAdvisor#1\u3001org.springframework.aop.aspectj.AspectJPointcutAdvisor#2\u8fd9\u6837\u4e0b\u53bb\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c3\u884c\u5411DefaultListableBeanFactory\u4e2d\u6ce8\u518c\uff0cBeanName\u5df2\u7ecf\u6709\u4e86\uff0c\u5269\u4e0b\u7684\u5c31\u662fBean\u5b9a\u4e49\uff0cBean\u5b9a\u4e49\u7684\u89e3\u6790\u6d41\u7a0b\u4e4b\u524d\u5df2\u7ecf\u770b\u8fc7\u4e86\uff0c\u5c31\u4e0d\u8bf4\u4e86\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u89e3\u6790\u5207\u9762\u7684\u8fc7\u7a0b",children:"\u89e3\u6790\u5207\u9762\u7684\u8fc7\u7a0b"}),"\n",(0,i.jsx)(n.p,{children:"AOP Bean\u5b9a\u4e49\u52a0\u8f7d\u2014\u2014AopNamespaceHandler\u5904\u7406\u6d41\u7a0b\n\u56de\u5230ConfigBeanDefinitionParser\u7684parseAspect\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"    private void parseAspect(Element aspectElement, ParserContext parserContext) {\n    \n            ...  \n    \n            AspectComponentDefinition aspectComponentDefinition = createAspectComponentDefinition(\n                    aspectElement, aspectId, beanDefinitions, beanReferences, parserContext);\n            parserContext.pushContainingComponent(aspectComponentDefinition);\n    \n            List<Element> pointcuts = DomUtils.getChildElementsByTagName(aspectElement, POINTCUT);\n            for (Element pointcutElement : pointcuts) {\n                parsePointcut(pointcutElement, parserContext);\n            }\n    \n            parserContext.popAndRegisterContainingComponent();\n        }\n        finally {\n            this.parseState.pop();\n        }\n    }\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7701\u7565\u53f7\u90e8\u5206\u8868\u793a\u662f\u89e3\u6790\u7684\u662f\u3001\u8fd9\u79cd\u6807\u7b7e\uff0c\u4e0a\u90e8\u5206\u5df2\u7ecf\u8bf4\u8fc7\u4e86\uff0c\u5c31\u4e0d\u8bf4\u4e86\uff0c\u4e0b\u9762\u770b\u4e00\u4e0b\u89e3\u6790\u90e8\u5206\u7684\u6e90\u7801\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c5\u884c~\u7b2c7\u884c\u7684\u4ee3\u7801\u6784\u5efa\u4e86\u4e00\u4e2aAspect\u6807\u7b7e\u7ec4\u4ef6\u5b9a\u4e49\uff0c\u5e76\u5c06Apsect\u6807\u7b7e\u7ec4\u4ef6\u5b9a\u4e49\u63a8\u5230ParseContext\u5373\u89e3\u6790\u5de5\u5177\u4e0a\u4e0b\u6587\u4e2d\uff0c\u8fd9\u90e8\u5206\u4ee3\u7801\u4e0d\u662f\u5173\u952e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c9\u884c\u7684\u4ee3\u7801\u62ff\u5230\u6240\u6709\u4e0b\u7684pointcut\u6807\u7b7e\uff0c\u8fdb\u884c\u904d\u5386\uff0c\u7531parsePointcut\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"private AbstractBeanDefinition parsePointcut(Element pointcutElement, ParserContext parserContext) {\n    String id = pointcutElement.getAttribute(ID);\n    String expression = pointcutElement.getAttribute(EXPRESSION);\n\n    AbstractBeanDefinition pointcutDefinition = null;\n\n    try {\n        this.parseState.push(new PointcutEntry(id));\n        pointcutDefinition = createPointcutDefinition(expression);\n        pointcutDefinition.setSource(parserContext.extractSource(pointcutElement));\n\n        String pointcutBeanName = id;\n        if (StringUtils.hasText(pointcutBeanName)) {\n            parserContext.getRegistry().registerBeanDefinition(pointcutBeanName, pointcutDefinition);\n        }\n        else {\n            pointcutBeanName = parserContext.getReaderContext().registerWithGeneratedName(pointcutDefinition);\n        }\n\n        parserContext.registerComponent(\n                new PointcutComponentDefinition(pointcutBeanName, pointcutDefinition, expression));\n    }\n    finally {\n        this.parseState.pop();\n    }\n\n    return pointcutDefinition;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c2\u884c~\u7b2c3\u884c\u7684\u4ee3\u7801\u83b7\u53d6\u6807\u7b7e\u4e0b\u7684\u201did\u201d\u5c5e\u6027\u4e0e\u201dexpression\u201d\u5c5e\u6027\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c8\u884c\u7684\u4ee3\u7801\u63a8\u9001\u4e00\u4e2aPointcutEntry\uff0c\u8868\u793a\u5f53\u524dSpring\u4e0a\u4e0b\u6587\u6b63\u5728\u89e3\u6790Pointcut\u6807\u7b7e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c9\u884c\u7684\u4ee3\u7801\u521b\u5efaPointcut\u7684Bean\u5b9a\u4e49\uff0c\u4e4b\u540e\u518d\u770b\uff0c\u5148\u628a\u5176\u4ed6\u65b9\u6cd5\u90fd\u770b\u4e00\u4e0b\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c10\u884c\u7684\u4ee3\u7801\u4e0d\u7ba1\u5b83\uff0c\u6700\u7ec8\u4eceNullSourceExtractor\u7684extractSource\u65b9\u6cd5\u83b7\u53d6Source\uff0c\u5c31\u662f\u4e2anull\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c12\u884c~\u7b2c18\u884c\u7684\u4ee3\u7801\u7528\u4e8e\u6ce8\u518c\u83b7\u53d6\u5230\u7684Bean\u5b9a\u4e49\uff0c\u9ed8\u8ba4pointcutBeanName\u4e3a\u6807\u7b7e\u4e2d\u5b9a\u4e49\u7684id\u5c5e\u6027\uff1a"}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u679c\u6807\u7b7e\u4e2d\u914d\u7f6e\u4e86id\u5c5e\u6027\u5c31\u6267\u884c\u7684\u662f\u7b2c13\u884c",(0,i.jsx)(n.del,{children:"\u7b2c15\u884c\u7684\u4ee3\u7801\uff0cpointcutBeanName=id\n\u5982\u679c\u6807\u7b7e\u4e2d\u6ca1\u6709\u914d\u7f6eid\u5c5e\u6027\u5c31\u6267\u884c\u7684\u662f\u7b2c16\u884c"}),"\u7b2c18\u884c\u7684\u4ee3\u7801\uff0c\u548cBean\u4e0d\u914d\u7f6eid\u5c5e\u6027\u4e00\u6837\u7684\u89c4\u5219\uff0cpointcutBeanName=org.springframework.aop.aspectj.AspectJExpressionPointcut#\u5e8f\u53f7\uff08\u4ece0\u5f00\u59cb\u7d2f\u52a0\uff09\n\u7b2c20\u884c~\u7b2c21\u884c\u7684\u4ee3\u7801\u5411\u89e3\u6790\u5de5\u5177\u4e0a\u4e0b\u6587\u4e2d\u6ce8\u518c\u4e00\u4e2aPointcut\u7ec4\u4ef6\u5b9a\u4e49"]}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c23\u884c~\u7b2c25\u884c\u7684\u4ee3\u7801\uff0cfinally\u5757\u5728\u6807\u7b7e\u89e3\u6790\u5b8c\u6bd5\u540e\uff0c\u8ba9\u4e4b\u524d\u63a8\u9001\u81f3\u6808\u9876\u7684PointcutEntry\u51fa\u6808\uff0c\u8868\u793a\u6b64\u6b21\u6807\u7b7e\u89e3\u6790\u5b8c\u6bd5\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u540e\u56de\u5934\u6765\u4e00\u4e0b\u7b2c9\u884c\u4ee3\u7801createPointcutDefinition\u7684\u5b9e\u73b0\uff0c\u6bd4\u8f83\u7b80\u5355\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"protected AbstractBeanDefinition createPointcutDefinition(String expression) {\n    RootBeanDefinition beanDefinition = new RootBeanDefinition(AspectJExpressionPointcut.class);\n    beanDefinition.setScope(BeanDefinition.SCOPE_PROTOTYPE);\n    beanDefinition.setSynthetic(true);\n    beanDefinition.getPropertyValues().add(EXPRESSION, expression);\n    return beanDefinition;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5173\u952e\u5c31\u662f\u6ce8\u610f\u4e00\u4e0b\u4e24\u70b9\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u6807\u7b7e\u5bf9\u5e94\u89e3\u6790\u51fa\u6765\u7684BeanDefinition\u662fRootBeanDefinition\uff0c\u4e14RootBenaDefinitoin\u4e2d\u7684Class\u662forg.springframework.aop.aspectj.AspectJExpressionPointcut\n\u6807\u7b7e\u5bf9\u5e94\u7684Bean\u662fprototype\u5373\u539f\u578b\u7684\n\u8fd9\u6837\u4e00\u4e2a\u6d41\u7a0b\u4e0b\u6765\uff0c\u5c31\u89e3\u6790\u4e86\u6807\u7b7e\u4e2d\u7684\u5185\u5bb9\u5e76\u5c06\u4e4b\u8f6c\u6362\u4e3aRootBeanDefintion\u5b58\u50a8\u5728Spring\u5bb9\u5668\u4e2d\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"aop\u4e3abean\u751f\u6210\u4ee3\u7406\u7684\u65f6\u673a\u5206\u6790",children:"AOP\u4e3aBean\u751f\u6210\u4ee3\u7406\u7684\u65f6\u673a\u5206\u6790"}),"\n",(0,i.jsx)(n.p,{children:"\u4e0a\u7bc7\u6587\u7ae0\u8bf4\u4e86\uff0corg.springframework.aop.aspectj.autoproxy.AspectJAwareAdvisorAutoProxyCreator\u8fd9\u4e2a\u7c7b\u662fSpring\u63d0\u4f9b\u7ed9\u5f00\u53d1\u8005\u7684AOP\u7684\u6838\u5fc3\u7c7b\uff0c\u5c31\u662fAspectJAwareAdvisorAutoProxyCreator\u5b8c\u6210\u4e86\u3010\u7c7b/\u63a5\u53e3\u2013>\u4ee3\u7406\u3011\u7684\u8f6c\u6362\u8fc7\u7a0b\uff0c\u9996\u5148\u6211\u4eec\u770b\u4e00\u4e0bAspectJAwareAdvisorAutoProxyCreator\u7684\u5c42\u6b21\u7ed3\u6784\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u91cc\u6700\u503c\u5f97\u6ce8\u610f\u7684\u4e00\u70b9\u662f\u6700\u5de6\u4e0b\u89d2\u7684\u90a3\u4e2a\u65b9\u6846\uff0c\u6211\u7528\u51e0\u53e5\u8bdd\u603b\u7ed3\u4e00\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"AspectJAwareAdvisorAutoProxyCreator\u662fBeanPostProcessor\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\npostProcessBeforeInitialization\u65b9\u6cd5\u4e0epostProcessAfterInitialization\u65b9\u6cd5\u5b9e\u73b0\u5728\u7236\u7c7bAbstractAutoProxyCreator\u4e2d\npostProcessBeforeInitialization\u65b9\u6cd5\u662f\u4e00\u4e2a\u7a7a\u5b9e\u73b0\n\u903b\u8f91\u4ee3\u7801\u5728postProcessAfterInitialization\u65b9\u6cd5\u4e2d\n\u57fa\u4e8e\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u5c06Bean\u751f\u6210\u4ee3\u7406\u7684\u65f6\u673a\u5df2\u7ecf\u4e00\u76ee\u4e86\u7136\u4e86\uff1a\u5728\u6bcf\u4e2aBean\u521d\u59cb\u5316\u4e4b\u540e\uff0c\u5982\u679c\u9700\u8981\uff0c\u8c03\u7528AspectJAwareAdvisorAutoProxyCreator\u4e2d\u7684postProcessBeforeInitialization\u4e3aBean\u751f\u6210\u4ee3\u7406\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u5316\u2014-\u5224\u65ad\u662f\u5426\u4e3a",(0,i.jsx)(n.code,{children:"<bean>"}),"\u751f\u6210\u4ee3\u7406\n\u4e0a\u6587\u5206\u6790\u4e86Bean\u751f\u6210\u4ee3\u7406\u7684\u65f6\u673a\u662f\u5728\u6bcf\u4e2aBean\u521d\u59cb\u5316\u4e4b\u540e\uff0c\u4e0b\u9762\u628a\u4ee3\u7801\u5b9a\u4f4d\u5230Bean\u521d\u59cb\u5316\u4e4b\u540e\uff0c\u5148\u662fAbstractAutowireCapableBeanFactory\u7684initializeBean\u65b9\u6cd5\u8fdb\u884c\u521d\u59cb\u5316\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'protected Object initializeBean(final String beanName, final Object bean, RootBeanDefinition mbd) {\n    if (System.getSecurityManager() != null) {\n        AccessController.doPrivileged(new PrivilegedAction<Object>() {\n            public Object run() {\n                invokeAwareMethods(beanName, bean);\n                return null;\n            }\n        }, getAccessControlContext());\n    }\n    else {\n        invokeAwareMethods(beanName, bean);\n    }\n\n    Object wrappedBean = bean;\n    if (mbd == null || !mbd.isSynthetic()) {\n        wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);\n    }\n\n    try {\n    invokeInitMethods(beanName, wrappedBean, mbd);\n    }\n    catch (Throwable ex) {\n        throw new BeanCreationException(\n                (mbd != null ? mbd.getResourceDescription() : null),\n                beanName, "Invocation of init method failed", ex);\n    }\n\n    if (mbd == null || !mbd.isSynthetic()) {\n        wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);\n    }\n    return wrappedBean;\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u521d\u59cb\u5316\u4e4b\u524d\u662f\u7b2c16\u884c\u7684applyBeanPostProcessorsBeforeInitialization\u65b9\u6cd5\uff0c\u521d\u59cb\u5316\u4e4b\u540e\u537329\u884c\u7684applyBeanPostProcessorsAfterInitialization\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public Object applyBeanPostProcessorsAfterInitialization(Object existingBean, String beanName)\n        throws BeansException {\n\n    Object result = existingBean;\n    for (BeanPostProcessor beanProcessor : getBeanPostProcessors()) {\n        result = beanProcessor.postProcessAfterInitialization(result, beanName);\n        if (result == null) {\n            return result;\n        }\n    }\n    return result;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u91cc\u8c03\u7528\u6bcf\u4e2aBeanPostProcessor\u7684postProcessBeforeInitialization\u65b9\u6cd5\u3002\u6309\u7167\u4e4b\u524d\u7684\u5206\u6790\uff0c\u770b\u4e00\u4e0bAbstractAutoProxyCreator\u7684postProcessAfterInitialization\u65b9\u6cd5\u5b9e\u73b0\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n    if (bean != null) {\n        Object cacheKey = getCacheKey(bean.getClass(), beanName);\n        if (!this.earlyProxyReferences.contains(cacheKey)) {\n            return wrapIfNecessary(bean, beanName, cacheKey);\n        }\n    }\n    return bean;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8ddf\u4e00\u4e0b\u7b2c5\u884c\u7684\u65b9\u6cd5wrapIfNecessary\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) {\n    if (this.targetSourcedBeans.contains(beanName)) {\n        return bean;\n    }\n    if (this.nonAdvisedBeans.contains(cacheKey)) {\n        return bean;\n    }\n    if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) {\n        this.nonAdvisedBeans.add(cacheKey);\n        return bean;\n    }\n\n    // Create proxy if we have advice.\n    Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null);\n    if (specificInterceptors != DO_NOT_PROXY) {\n        this.advisedBeans.add(cacheKey);\n        Object proxy = createProxy(bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean));\n        this.proxyTypes.put(cacheKey, proxy.getClass());\n        return proxy;\n    }\n\n    this.nonAdvisedBeans.add(cacheKey);\n    return bean;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c2\u884c~\u7b2c11\u884c\u662f\u4e00\u4e9b\u4e0d\u9700\u8981\u751f\u6210\u4ee3\u7406\u7684\u573a\u666f\u5224\u65ad\uff0c\u8fd9\u91cc\u7565\u8fc7\u3002\u9996\u5148\u6211\u4eec\u8981\u601d\u8003\u7684\u7b2c\u4e00\u4e2a\u95ee\u9898\u662f\uff1a\u54ea\u4e9b\u76ee\u6807\u5bf9\u8c61\u9700\u8981\u751f\u6210\u4ee3\u7406\uff1f\u56e0\u4e3a\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6709\u5f88\u591aBean\uff0c\u80af\u5b9a\u4e0d\u80fd\u5bf9\u6bcf\u4e2aBean\u90fd\u751f\u6210\u4ee3\u7406\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u5957\u89c4\u5219\u5224\u65adBean\u662f\u4e0d\u662f\u9700\u8981\u751f\u6210\u4ee3\u7406\uff0c\u8fd9\u5957\u89c4\u5219\u5c31\u662f\u7b2c14\u884c\u7684\u4ee3\u7801getAdvicesAndAdvisorsForBean\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"    protected List<Advisor> findEligibleAdvisors(Class beanClass, String beanName) {\n        List<Advisor> candidateAdvisors = findCandidateAdvisors();\n        List<Advisor> eligibleAdvisors = findAdvisorsThatCanApply(candidateAdvisors, beanClass, beanName);\n        extendAdvisors(eligibleAdvisors);\n        if (!eligibleAdvisors.isEmpty()) {\n            eligibleAdvisors = sortAdvisors(eligibleAdvisors);\n        }\n        return eligibleAdvisors;\n    }\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u987e\u540d\u601d\u4e49\uff0c\u65b9\u6cd5\u7684\u610f\u601d\u662f\u4e3a\u6307\u5b9aclass\u5bfb\u627e\u5408\u9002\u7684Advisor\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c2\u884c\u4ee3\u7801\uff0c\u5bfb\u627e\u5019\u9009Advisors\uff0c\u6839\u636e\u4e0a\u6587\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6709\u4e24\u4e2a\u5019\u9009Advisor\uff0c\u5206\u522b\u662f\u8282\u70b9\u4e0b\u7684\u548c\u8fd9\u4e24\u4e2a\uff0c\u8fd9\u4e24\u4e2a\u5728XML\u89e3\u6790\u7684\u65f6\u5019\u5df2\u7ecf\u88ab\u8f6c\u6362\u751f\u6210\u4e86RootBeanDefinition\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8df3\u8fc7\u7b2c3\u884c\u7684\u4ee3\u7801\uff0c\u5148\u770b\u4e0b\u7b2c4\u884c\u7684\u4ee3\u7801extendAdvisors\u65b9\u6cd5\uff0c\u4e4b\u540e\u518d\u91cd\u70b9\u770b\u4e00\u4e0b\u7b2c3\u884c\u7684\u4ee3\u7801\u3002\u7b2c4\u884c\u7684\u4ee3\u7801extendAdvisors\u65b9\u6cd5\u4f5c\u7528\u662f\u5411\u5019\u9009Advisor\u94fe\u7684\u5f00\u5934\uff08\u4e5f\u5c31\u662fList.get(0)\u7684\u4f4d\u7f6e\uff09\u6dfb\u52a0\u4e00\u4e2aorg.springframework.aop.support.DefaultPointcutAdvisor\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c3\u884c\u4ee3\u7801\uff0c\u6839\u636e\u5019\u9009Advisors\uff0c\u5bfb\u627e\u53ef\u4ee5\u4f7f\u7528\u7684Advisor\uff0c\u8ddf\u4e00\u4e0b\u65b9\u6cd5\u5b9e\u73b0\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public static List<Advisor> findAdvisorsThatCanApply(List<Advisor> candidateAdvisors, Class<?> clazz) {\n    if (candidateAdvisors.isEmpty()) {\n        return candidateAdvisors;\n    }\n    List<Advisor> eligibleAdvisors = new LinkedList<Advisor>();\n    for (Advisor candidate : candidateAdvisors) {\n        if (candidate instanceof IntroductionAdvisor && canApply(candidate, clazz)) {\n            eligibleAdvisors.add(candidate);\n        }\n    }\n    boolean hasIntroductions = !eligibleAdvisors.isEmpty();\n    for (Advisor candidate : candidateAdvisors) {\n        if (candidate instanceof IntroductionAdvisor) {\n            // already processed\n            continue;\n        }\n        if (canApply(candidate, clazz, hasIntroductions)) {\n            eligibleAdvisors.add(candidate);\n        }\n    }\n    return eligibleAdvisors;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6574\u4e2a\u65b9\u6cd5\u7684\u4e3b\u8981\u5224\u65ad\u90fd\u56f4\u7ed5canApply\u5c55\u5f00\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public static boolean canApply(Advisor advisor, Class<?> targetClass, boolean hasIntroductions) {\n    if (advisor instanceof IntroductionAdvisor) {\n        return ((IntroductionAdvisor) advisor).getClassFilter().matches(targetClass);\n    }\n    else if (advisor instanceof PointcutAdvisor) {\n        PointcutAdvisor pca = (PointcutAdvisor) advisor;\n        return canApply(pca.getPointcut(), targetClass, hasIntroductions);\n    }\n    else {\n        // It doesn't have a pointcut so we assume it applies.\n        return true;\n    }\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e00\u4e2a\u53c2\u6570advisor\u7684\u5b9e\u9645\u7c7b\u578b\u662fAspectJPointcutAdvisor\uff0c\u5b83\u662fPointcutAdvisor\u7684\u5b50\u7c7b\uff0c\u56e0\u6b64\u6267\u884c\u7b2c7\u884c\u7684\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public static boolean canApply(Pointcut pc, Class<?> targetClass, boolean hasIntroductions) {\n    if (!pc.getClassFilter().matches(targetClass)) {\n        return false;\n    }\n\n    MethodMatcher methodMatcher = pc.getMethodMatcher();\n    IntroductionAwareMethodMatcher introductionAwareMethodMatcher = null;\n    if (methodMatcher instanceof IntroductionAwareMethodMatcher) {\n        introductionAwareMethodMatcher = (IntroductionAwareMethodMatcher) methodMatcher;\n    }\n\n    Set<Class> classes = new HashSet<Class>(ClassUtils.getAllInterfacesForClassAsSet(targetClass));\n    classes.add(targetClass);\n    for (Class<?> clazz : classes) {\n        Method[] methods = clazz.getMethods();\n        for (Method method : methods) {\n            if ((introductionAwareMethodMatcher != null &&\n                introductionAwareMethodMatcher.matches(method, targetClass, hasIntroductions)) ||\n                    methodMatcher.matches(method, targetClass)) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e2a\u65b9\u6cd5\u5176\u5b9e\u5c31\u662f\u62ff\u5f53\u524dAdvisor\u5bf9\u5e94\u7684expression\u505a\u4e86\u4e24\u5c42\u5224\u65ad\uff1a"}),"\n",(0,i.jsxs)(n.p,{children:["\u76ee\u6807\u7c7b\u5fc5\u987b\u6ee1\u8db3expression\u7684\u5339\u914d\u89c4\u5219\n\u76ee\u6807\u7c7b\u4e2d\u7684\u65b9\u6cd5\u5fc5\u987b\u6ee1\u8db3expression\u7684\u5339\u914d\u89c4\u5219\uff0c\u5f53\u7136\u8fd9\u91cc\u65b9\u6cd5\u4e0d\u662f\u5168\u90e8\u9700\u8981\u6ee1\u8db3expression\u7684\u5339\u914d\u89c4\u5219\uff0c\u6709\u4e00\u4e2a\u65b9\u6cd5\u6ee1\u8db3\u5373\u53ef\n\u5982\u679c\u4ee5\u4e0a\u4e24\u6761\u90fd\u6ee1\u8db3\uff0c\u90a3\u4e48\u5bb9\u5668\u5219\u4f1a\u5224\u65ad\u8be5",(0,i.jsx)(n.code,{children:"<bean>"}),"\u6ee1\u8db3\u6761\u4ef6\uff0c\u9700\u8981\u88ab\u751f\u6210\u4ee3\u7406\u5bf9\u8c61\uff0c\u5177\u4f53\u65b9\u5f0f\u4e3a\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u5bf9\u8c61\uff0c\u8be5\u6570\u7ec4\u5bf9\u8c61\u4e2d\u5b58\u50a8\u7684\u662f",(0,i.jsx)(n.code,{children:"<bean>"}),"\u5bf9\u5e94\u7684Advisor\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u5316\u8fc7\u7a0b",children:"\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u5316\u8fc7\u7a0b"}),"\n",(0,i.jsxs)(n.p,{children:["\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u5316\u2014-\u4e3a",(0,i.jsx)(n.code,{children:"<bean>"}),"\u751f\u6210\u4ee3\u7406\u4ee3\u7801\u4e0a\u4e0b\u6587\u68b3\u7406\n\u4e0a\u6587\u5206\u6790\u4e86\u4e3a",(0,i.jsx)(n.code,{children:"<bean>"}),"\u751f\u6210\u4ee3\u7406\u7684\u6761\u4ef6\uff0c\u73b0\u5728\u5c31\u6b63\u5f0f\u770b\u4e00\u4e0bSpring\u4e0a\u4e0b\u6587\u662f\u5982\u4f55\u4e3a",(0,i.jsx)(n.code,{children:"<bean>"}),"\u751f\u6210\u4ee3\u7406\u7684\u3002\u56de\u5230AbstractAutoProxyCreator\u7684wrapIfNecessary\u65b9\u6cd5\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey) {\n    if (this.targetSourcedBeans.contains(beanName)) {\n        return bean;\n    }\n    if (this.nonAdvisedBeans.contains(cacheKey)) {\n        return bean;\n    }\n    if (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) {\n        this.nonAdvisedBeans.add(cacheKey);\n        return bean;\n    }\n\n    // Create proxy if we have advice.\n    Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, null);\n    if (specificInterceptors != DO_NOT_PROXY) {\n        this.advisedBeans.add(cacheKey);\n        Object proxy = createProxy(bean.getClass(), beanName, specificInterceptors, new SingletonTargetSource(bean));\n        this.proxyTypes.put(cacheKey, proxy.getClass());\n        return proxy;\n    }\n\n    this.nonAdvisedBeans.add(cacheKey);\n    return bean;\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c14\u884c\u62ff\u5230",(0,i.jsx)(n.code,{children:"<bean>"}),"\u5bf9\u5e94\u7684Advisor\u6570\u7ec4\uff0c\u7b2c15\u884c\u5224\u65ad\u53ea\u8981Advisor\u6570\u7ec4\u4e0d\u4e3a\u7a7a\uff0c\u90a3\u4e48\u5c31\u4f1a\u901a\u8fc7\u7b2c17\u884c\u7684\u4ee3\u7801\u4e3a",(0,i.jsx)(n.code,{children:"<bean>"}),"\u521b\u5efa\u4ee3\u7406\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"protected Object createProxy(\n        Class<?> beanClass, String beanName, Object[] specificInterceptors, TargetSource targetSource) {\n\n    ProxyFactory proxyFactory = new ProxyFactory();\n    // Copy our properties (proxyTargetClass etc) inherited from ProxyConfig.\n    proxyFactory.copyFrom(this);\n\n    if (!shouldProxyTargetClass(beanClass, beanName)) {\n        // Must allow for introductions; can't just set interfaces to\n        // the target's interfaces only.\n        Class<?>[] targetInterfaces = ClassUtils.getAllInterfacesForClass(beanClass, this.proxyClassLoader);\n        for (Class<?> targetInterface : targetInterfaces) {\n            proxyFactory.addInterface(targetInterface);\n        }\n    }\n\n    Advisor[] advisors = buildAdvisors(beanName, specificInterceptors);\n    for (Advisor advisor : advisors) {\n        proxyFactory.addAdvisor(advisor);\n    }\n\n    proxyFactory.setTargetSource(targetSource);\n    customizeProxyFactory(proxyFactory);\n\n    proxyFactory.setFrozen(this.freezeProxy);\n    if (advisorsPreFiltered()) {\n        proxyFactory.setPreFiltered(true);\n    }\n\n    return proxyFactory.getProxy(this.proxyClassLoader);\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c4\u884c~\u7b2c6\u884cnew\u51fa\u4e86\u4e00\u4e2aProxyFactory\uff0cProxy\uff0c\u987e\u540d\u601d\u4e49\uff0c\u4ee3\u7406\u5de5\u5382\u7684\u610f\u601d\uff0c\u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u65b9\u5f0f\u4f7f\u7528\u4ee3\u7801\u83b7\u53d6\u548c\u914d\u7f6eAOP\u4ee3\u7406\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c8\u884c\u7684\u4ee3\u7801\u505a\u4e86\u4e00\u4e2a\u5224\u65ad\uff0c\u5224\u65ad\u7684\u5185\u5bb9\u662f\u8fd9\u4e2a\u8282\u70b9\u4e2dproxy-target-class=\u201dfalse\u201d\u6216\u8005proxy-target-class\u4e0d\u914d\u7f6e\uff0c\u5373\u4e0d\u4f7f\u7528CGLIB\u751f\u6210\u4ee3\u7406\u3002\u5982\u679c\u6ee1\u8db3\u6761\u4ef6\uff0c\u8fdb\u5224\u65ad\uff0c\u83b7\u53d6\u5f53\u524dBean\u5b9e\u73b0\u7684\u6240\u6709\u63a5\u53e3\uff0c\u8bb2\u8fd9\u4e9b\u63a5\u53e3Class\u5bf9\u8c61\u90fd\u6dfb\u52a0\u5230ProxyFactory\u4e2d\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c17\u884c~\u7b2c28\u884c\u7684\u4ee3\u7801\u6ca1\u4ec0\u4e48\u770b\u7684\u5fc5\u8981\uff0c\u5411ProxyFactory\u4e2d\u6dfb\u52a0\u4e00\u4e9b\u53c2\u6570\u800c\u5df2\u3002\u91cd\u70b9\u770b\u7b2c30\u884cproxyFactory.getProxy(this.proxyClassLoader)\u8fd9\u53e5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public Object getProxy(ClassLoader classLoader) {\nreturn createAopProxy().getProxy(classLoader);\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5b9e\u73b0\u4ee3\u7801\u5c31\u4e00\u884c\uff0c\u4f46\u662f\u5374\u660e\u786e\u544a\u8bc9\u6211\u4eec\u505a\u4e86\u4e24\u4ef6\u4e8b\u60c5\uff1a"}),"\n",(0,i.jsxs)(n.p,{children:["\u521b\u5efaAopProxy\u63a5\u53e3\u5b9e\u73b0\u7c7b\n\u901a\u8fc7AopProxy\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u7684getProxy\u65b9\u6cd5\u83b7\u53d6",(0,i.jsx)(n.code,{children:"<bean>"}),"\u5bf9\u5e94\u7684\u4ee3\u7406\n\u5c31\u4ece\u8fd9\u4e24\u4e2a\u70b9\u51fa\u53d1\uff0c\u5206\u4e24\u90e8\u5206\u5206\u6790\u4e00\u4e0b\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u5316\u2014-\u521b\u5efaAopProxy\u63a5\u53e3\u5b9e\u73b0\u7c7b\n\u770b\u4e00\u4e0bcreateAopProxy()\u65b9\u6cd5\u7684\u5b9e\u73b0\uff0c\u5b83\u4f4d\u4e8eDefaultAopProxyFactory\u7c7b\u4e2d\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"protected final synchronized AopProxy createAopProxy() {\nif (!this.active) {\nactivate();\n}\nreturn getAopProxyFactory().createAopProxy(this);\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u524d\u9762\u7684\u90e8\u5206\u6ca1\u4ec0\u4e48\u5fc5\u8981\u770b\uff0c\u76f4\u63a5\u8fdb\u5165\u91cd\u70b9\u5373createAopProxy\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'public AopProxy createAopProxy(AdvisedSupport config) throws AopConfigException {\n    if (config.isOptimize() || config.isProxyTargetClass() || hasNoUserSuppliedProxyInterfaces(config)) {\n        Class targetClass = config.getTargetClass();\n        if (targetClass == null) {\n            throw new AopConfigException("TargetSource cannot determine target class: " +\n                    "Either an interface or a target is required for proxy creation.");\n        }\n        if (targetClass.isInterface()) {\n            return new JdkDynamicAopProxy(config);\n        }\n        if (!cglibAvailable) {\n            throw new AopConfigException(\n                    "Cannot proxy target class because CGLIB2 is not available. " +\n                    "Add CGLIB to the class path or specify proxy interfaces.");\n        }\n        return CglibProxyFactory.createCglibProxy(config);\n    }\n    else {\n        return new JdkDynamicAopProxy(config);\n    }\n}\n\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e73\u65f6\u6211\u4eec\u8bf4aop\u539f\u7406\u4e09\u53e5\u8bdd\u5c31\u80fd\u6982\u62ec",children:"\u5e73\u65f6\u6211\u4eec\u8bf4AOP\u539f\u7406\u4e09\u53e5\u8bdd\u5c31\u80fd\u6982\u62ec\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u7c7b\u751f\u6210\u4ee3\u7406\u4f7f\u7528CGLIB\n\u5bf9\u63a5\u53e3\u751f\u6210\u4ee3\u7406\u4f7f\u7528JDK\u539f\u751f\u7684Proxy\n\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u5bf9\u63a5\u53e3\u4f7f\u7528CGLIB\u751f\u6210\u4ee3\u7406\n\u8fd9\u4e09\u53e5\u8bdd\u7684\u51fa\u5904\u5c31\u662fcreateAopProxy\u65b9\u6cd5\u3002\u770b\u5230\u9ed8\u8ba4\u662f\u7b2c19\u884c\u7684\u4ee3\u7801\u4f7f\u7528JDK\u81ea\u5e26\u7684Proxy\u751f\u6210\u4ee3\u7406\uff0c\u78b0\u5230\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5\u4f8b\u5916\uff1a"}),"\n",(0,i.jsxs)(n.p,{children:["ProxyConfig\u7684isOptimize\u65b9\u6cd5\u4e3atrue\uff0c\u8fd9\u8868\u793a\u8ba9Spring\u81ea\u5df1\u53bb\u4f18\u5316\u800c\u4e0d\u662f\u7528\u6237\u6307\u5b9a\nProxyConfig\u7684isProxyTargetClass\u65b9\u6cd5\u4e3atrue\uff0c\u8fd9\u8868\u793a\u914d\u7f6e\u4e86proxy-target-class=\u201dtrue\u201d\nProxyConfig\u6ee1\u8db3hasNoUserSuppliedProxyInterfaces\u65b9\u6cd5\u6267\u884c\u7ed3\u679c\u4e3atrue\uff0c\u8fd9\u8868\u793a",(0,i.jsx)(n.code,{children:"<bean>"}),"\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0\u4efb\u4f55\u63a5\u53e3\u6216\u8005\u5b9e\u73b0\u7684\u63a5\u53e3\u662fSpringProxy\u63a5\u53e3\n\u5728\u8fdb\u5165\u7b2c2\u884c\u7684if\u5224\u65ad\u4e4b\u540e\u518d\u6839\u636e\u76ee\u6807",(0,i.jsx)(n.code,{children:"<bean>"}),"\u7684\u7c7b\u578b\u51b3\u5b9a\u8fd4\u56de\u54ea\u79cdAopProxy\u3002\u7b80\u5355\u603b\u7ed3\u8d77\u6765\u5c31\u662f\uff1a"]}),"\n",(0,i.jsxs)(n.p,{children:["proxy-target-class\u6ca1\u6709\u914d\u7f6e\u6216\u8005proxy-target-class=\u201dfalse\u201d\uff0c\u8fd4\u56deJdkDynamicAopProxy\nproxy-target-class=\u201dtrue\u201d\u6216\u8005",(0,i.jsx)(n.code,{children:"<bean>"}),"\u5bf9\u8c61\u6ca1\u6709\u5b9e\u73b0\u4efb\u4f55\u63a5\u53e3\u6216\u8005\u53ea\u5b9e\u73b0\u4e86SpringProxy\u63a5\u53e3\uff0c\u8fd4\u56deCglib2AopProxy\n\u5f53\u7136\uff0c\u4e0d\u7ba1\u662fJdkDynamicAopProxy\u8fd8\u662fCglib2AopProxy\uff0cAdvisedSupport\u90fd\u662f\u4f5c\u4e3a\u6784\u9020\u51fd\u6570\u53c2\u6570\u4f20\u5165\u7684\uff0c\u91cc\u9762\u5b58\u50a8\u4e86\u5177\u4f53\u7684Advisor\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4ee3\u7406\u5bf9\u8c61\u5b9e\u4f8b\u5316\u2014-\u901a\u8fc7getProxy\u65b9\u6cd5\u83b7\u53d6",(0,i.jsx)(n.code,{children:"<bean>"}),"\u5bf9\u5e94\u7684\u4ee3\u7406\n\u5176\u5b9e\u4ee3\u7801\u5df2\u7ecf\u5206\u6790\u5230\u4e86JdkDynamicAopProxy\u548cCglib2AopProxy\uff0c\u5269\u4e0b\u7684\u5c31\u6ca1\u4ec0\u4e48\u597d\u8bb2\u7684\u4e86\uff0c\u65e0\u975e\u5c31\u662f\u770b\u5bf9\u8fd9\u4e24\u79cd\u65b9\u5f0f\u751f\u6210\u4ee3\u7406\u7684\u719f\u6089\u7a0b\u5ea6\u800c\u5df2\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"Cglib2AopProxy\u751f\u6210\u4ee3\u7406\u7684\u4ee3\u7801\u5c31\u4e0d\u770b\u4e86\uff0c\u5bf9Cglib\u4e0d\u719f\u6089\u7684\u670b\u53cb\u53ef\u4ee5\u770bCglib\u53ca\u5176\u57fa\u672c\u4f7f\u7528\u4e00\u6587\u3002"}),"\n",(0,i.jsx)(n.p,{children:"JdkDynamicAopProxy\u751f\u6210\u4ee3\u7406\u7684\u65b9\u5f0f\u7a0d\u5fae\u770b\u4e00\u4e0b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'    public Object getProxy(ClassLoader classLoader) {\n    if (logger.isDebugEnabled()) {\n    logger.debug("Creating JDK dynamic proxy: target source is " + this.advised.getTargetSource());\n    }\n    Class[] proxiedInterfaces = AopProxyUtils.completeProxiedInterfaces(this.advised);\n    findDefinedEqualsAndHashCodeMethods(proxiedInterfaces);\n    return Proxy.newProxyInstance(classLoader, proxiedInterfaces, this);\n    }\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u8fb9\u89e3\u91ca\u4e00\u4e0b\u7b2c5\u884c\u548c\u7b2c6\u884c\u7684\u4ee3\u7801\uff0c\u7b2c5\u884c\u4ee3\u7801\u7684\u4f5c\u7528\u662f\u62ff\u5230\u6240\u6709\u8981\u4ee3\u7406\u7684\u63a5\u53e3\uff0c\u7b2c6\u884c\u4ee3\u7801\u7684\u4f5c\u7528\u662f\u5c1d\u8bd5\u5bfb\u627e\u8fd9\u4e9b\u63a5\u53e3\u65b9\u6cd5\u91cc\u9762\u6709\u6ca1\u6709equals\u65b9\u6cd5\u548chashCode\u65b9\u6cd5\uff0c\u540c\u65f6\u90fd\u6709\u7684\u8bdd\u6253\u4e2a\u6807\u8bb0\uff0c\u5bfb\u627e\u7ed3\u675f\uff0cequals\u65b9\u6cd5\u548chashCode\u65b9\u6cd5\u6709\u7279\u6b8a\u5904\u7406\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u7ec8\u901a\u8fc7\u7b2c7\u884c\u7684Proxy.newProxyInstance\u65b9\u6cd5\u83b7\u53d6\u63a5\u53e3/\u7c7b\u5bf9\u5e94\u7684\u4ee3\u7406\u5bf9\u8c61\uff0cProxy\u662fJDK\u539f\u751f\u652f\u6301\u7684\u751f\u6210\u4ee3\u7406\u7684\u65b9\u5f0f\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u4ee3\u7406\u65b9\u6cd5\u8c03\u7528\u539f\u7406",children:"\u4ee3\u7406\u65b9\u6cd5\u8c03\u7528\u539f\u7406"}),"\n",(0,i.jsx)(n.p,{children:"\u524d\u9762\u5df2\u7ecf\u8be6\u7ec6\u5206\u6790\u4e86\u4e3a\u63a5\u53e3/\u7c7b\u751f\u6210\u4ee3\u7406\u7684\u539f\u7406\uff0c\u751f\u6210\u4ee3\u7406\u4e4b\u540e\u5c31\u8981\u8c03\u7528\u65b9\u6cd5\u4e86\uff0c\u8fd9\u91cc\u770b\u4e00\u4e0b\u4f7f\u7528JdkDynamicAopProxy\u8c03\u7528\u65b9\u6cd5\u7684\u539f\u7406\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7531\u4e8eJdkDynamicAopProxy\u672c\u8eab\u5b9e\u73b0\u4e86InvocationHandler\u63a5\u53e3\uff0c\u56e0\u6b64\u5177\u4f53\u4ee3\u7406\u524d\u540e\u5904\u7406\u7684\u903b\u8f91\u5728invoke\u65b9\u6cd5\u4e2d\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n    MethodInvocation invocation;\n    Object oldProxy = null;\n    boolean setProxyContext = false;\n\n    TargetSource targetSource = this.advised.targetSource;\n    Class targetClass = null;\n    Object target = null;\n\n    try {\n        if (!this.equalsDefined && AopUtils.isEqualsMethod(method)) {\n            // The target does not implement the equals(Object) method itself.\n            return equals(args[0]);\n        }\n        if (!this.hashCodeDefined && AopUtils.isHashCodeMethod(method)) {\n            // The target does not implement the hashCode() method itself.\n            return hashCode();\n        }\n        if (!this.advised.opaque && method.getDeclaringClass().isInterface() &&\n                method.getDeclaringClass().isAssignableFrom(Advised.class)) {\n            // Service invocations on ProxyConfig with the proxy config...\n            return AopUtils.invokeJoinpointUsingReflection(this.advised, method, args);\n        }\n\n        Object retVal;\n\n        if (this.advised.exposeProxy) {\n            // Make invocation available if necessary.\n            oldProxy = AopContext.setCurrentProxy(proxy);\n            setProxyContext = true;\n        }\n\n        // May be null. Get as late as possible to minimize the time we "own" the target,\n        // in case it comes from a pool.\n        target = targetSource.getTarget();\n        if (target != null) {\n            targetClass = target.getClass();\n        }\n\n        // Get the interception chain for this method.\n        List<Object> chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);\n\n        // Check whether we have any advice. If we don\'t, we can fallback on direct\n        // reflective invocation of the target, and avoid creating a MethodInvocation.\n        if (chain.isEmpty()) {\n            // We can skip creating a MethodInvocation: just invoke the target directly\n            // Note that the final invoker must be an InvokerInterceptor so we know it does\n            // nothing but a reflective operation on the target, and no hot swapping or fancy proxying.\n            retVal = AopUtils.invokeJoinpointUsingReflection(target, method, args);\n        }\n        else {\n            // We need to create a method invocation...\n            invocation = new ReflectiveMethodInvocation(proxy, target, method, args, targetClass, chain);\n            // Proceed to the joinpoint through the interceptor chain.\n            retVal = invocation.proceed();\n        }\n\n        // Massage return value if necessary.\n        if (retVal != null && retVal == target && method.getReturnType().isInstance(proxy) &&\n                !RawTargetAccess.class.isAssignableFrom(method.getDeclaringClass())) {\n            // Special case: it returned "this" and the return type of the method\n            // is type-compatible. Note that we can\'t help if the target sets\n            // a reference to itself in another returned object.\n            retVal = proxy;\n        }\n        return retVal;\n    }\n    finally {\n        if (target != null && !targetSource.isStatic()) {\n            // Must have come from TargetSource.\n            targetSource.releaseTarget(target);\n        }\n        if (setProxyContext) {\n            // Restore old proxy.\n            AopContext.setCurrentProxy(oldProxy);\n        }\n    }\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c11\u884c~\u7b2c18\u884c\u7684\u4ee3\u7801\uff0c\u8868\u793aequals\u65b9\u6cd5\u4e0ehashCode\u65b9\u6cd5\u5373\u4f7f\u6ee1\u8db3expression\u89c4\u5219\uff0c\u4e5f\u4e0d\u4f1a\u4e3a\u4e4b\u4ea7\u751f\u4ee3\u7406\u5185\u5bb9\uff0c\u8c03\u7528\u7684\u662fJdkDynamicAopProxy\u7684equals\u65b9\u6cd5\u4e0ehashCode\u65b9\u6cd5\u3002\u81f3\u4e8e\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u662f\u4ec0\u4e48\u4f5c\u7528\uff0c\u53ef\u4ee5\u81ea\u5df1\u67e5\u770b\u4e00\u4e0b\u6e90\u4ee3\u7801\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c19\u884c~\u7b2c23\u884c\u7684\u4ee3\u7801\uff0c\u8868\u793a\u65b9\u6cd5\u6240\u5c5e\u7684Class\u662f\u4e00\u4e2a\u63a5\u53e3\u5e76\u4e14\u65b9\u6cd5\u6240\u5c5e\u7684Class\u662fAdvisedSupport\u7684\u7236\u7c7b\u6216\u8005\u7236\u63a5\u53e3\uff0c\u76f4\u63a5\u901a\u8fc7\u53cd\u5c04\u8c03\u7528\u8be5\u65b9\u6cd5\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c27\u884c~\u7b2c30\u884c\u7684\u4ee3\u7801\uff0c\u662f\u7528\u4e8e\u5224\u65ad\u662f\u5426\u5c06\u4ee3\u7406\u66b4\u9732\u51fa\u53bb\u7684\uff0c\u7531\u6807\u7b7e\u4e2d\u7684expose-proxy=\u201dtrue/false\u201d\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c41\u884c\u7684\u4ee3\u7801\uff0c\u83b7\u53d6AdvisedSupport\u4e2d\u7684\u6240\u6709\u62e6\u622a\u5668\u548c\u52a8\u6001\u62e6\u622a\u5668\u5217\u8868\uff0c\u7528\u4e8e\u62e6\u622a\u65b9\u6cd5\uff0c\u5177\u4f53\u5230\u6211\u4eec\u7684\u5b9e\u9645\u4ee3\u7801\uff0c\u5217\u8868\u4e2d\u6709\u4e09\u4e2aObject\uff0c\u5206\u522b\u662f\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"chain.get(0)\uff1aExposeInvocationInterceptor\uff0c\u8fd9\u662f\u4e00\u4e2a\u9ed8\u8ba4\u7684\u62e6\u622a\u5668\uff0c\u5bf9\u5e94\u7684\u539fAdvisor\u4e3aDefaultPointcutAdvisor\nchain.get(1)\uff1aMethodBeforeAdviceInterceptor\uff0c\u7528\u4e8e\u5728\u5b9e\u9645\u65b9\u6cd5\u8c03\u7528\u4e4b\u524d\u7684\u62e6\u622a\uff0c\u5bf9\u5e94\u7684\u539fAdvisor\u4e3aAspectJMethodBeforeAdvice\nchain.get(2)\uff1aAspectJAfterAdvice\uff0c\u7528\u4e8e\u5728\u5b9e\u9645\u65b9\u6cd5\u8c03\u7528\u4e4b\u540e\u7684\u5904\u7406\n\u7b2c45\u884c~\u7b2c50\u884c\u7684\u4ee3\u7801\uff0c\u5982\u679c\u62e6\u622a\u5668\u5217\u8868\u4e3a\u7a7a\uff0c\u5f88\u6b63\u5e38\uff0c\u56e0\u4e3a\u67d0\u4e2a\u7c7b/\u63a5\u53e3\u4e0b\u7684\u67d0\u4e2a\u65b9\u6cd5\u53ef\u80fd\u4e0d\u6ee1\u8db3expression\u7684\u5339\u914d\u89c4\u5219\uff0c\u56e0\u6b64\u6b64\u65f6\u901a\u8fc7\u53cd\u5c04\u76f4\u63a5\u8c03\u7528\u8be5\u65b9\u6cd5\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c51\u884c~\u7b2c56\u884c\u7684\u4ee3\u7801\uff0c\u5982\u679c\u62e6\u622a\u5668\u5217\u8868\u4e0d\u4e3a\u7a7a\uff0c\u6309\u7167\u6ce8\u91ca\u7684\u610f\u601d\uff0c\u9700\u8981\u4e00\u4e2aReflectiveMethodInvocation\uff0c\u5e76\u901a\u8fc7proceed\u65b9\u6cd5\u5bf9\u539f\u65b9\u6cd5\u8fdb\u884c\u62e6\u622a\uff0cproceed\u65b9\u6cd5\u611f\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u53bb\u770b\u4e00\u4e0b\uff0c\u91cc\u9762\u4f7f\u7528\u5230\u4e86\u9012\u5f52\u7684\u601d\u60f3\u5bf9chain\u4e2d\u7684Object\u8fdb\u884c\u4e86\u5c42\u5c42\u7684\u8c03\u7528\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"cglib\u4ee3\u7406\u5b9e\u73b0",children:"CGLIB\u4ee3\u7406\u5b9e\u73b0"}),"\n",(0,i.jsx)(n.p,{children:"\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0bCGLIB\u4ee3\u7406\u7684\u65b9\u5f0f\uff0c\u8fd9\u91cc\u9700\u8981\u8bfb\u8005\u53bb\u4e86\u89e3\u4e00\u4e0bCGLIB\u4ee5\u53ca\u5176\u521b\u5efa\u4ee3\u7406\u7684\u65b9\u5f0f\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://upload-images.jianshu.io/upload_images/5447660-9ab9ff5a18b6a429.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/915/format/webp",alt:""})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://upload-images.jianshu.io/upload_images/5447660-f3812e8cf27245fa.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/711/format/webp",alt:""})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://upload-images.jianshu.io/upload_images/5447660-2b8fafa06c78cacf.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/910/format/webp",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u91cc\u5c06\u62e6\u622a\u5668\u94fe\u5c01\u88c5\u5230\u4e86DynamicAdvisedInterceptor\u4e2d\uff0c\u5e76\u52a0\u5165\u4e86Callback\uff0cDynamicAdvisedInterceptor\u5b9e\u73b0\u4e86CGLIB\u7684MethodInterceptor\uff0c\u6240\u4ee5\u5176\u6838\u5fc3\u903b\u8f91\u5728intercept\u65b9\u6cd5\u4e2d\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://upload-images.jianshu.io/upload_images/5447660-c9dde35cfeb0faee.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/933/format/webp",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u91cc\u6211\u4eec\u770b\u5230\u4e86\u4e0eJDK\u52a8\u6001\u4ee3\u7406\u540c\u6837\u7684\u83b7\u53d6\u62e6\u622a\u5668\u94fe\u7684\u8fc7\u7a0b\uff0c\u5e76\u4e14CglibMethodInvokcation\u7ee7\u627f\u4e86\u6211\u4eec\u5728JDK\u52a8\u6001\u4ee3\u7406\u770b\u5230\u7684ReflectiveMethodInvocation\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u91cd\u5199\u5176proceed\u65b9\u6cd5\uff0c\u53ea\u662f\u91cd\u5199\u4e86\u6267\u884c\u76ee\u6807\u65b9\u6cd5\u7684\u903b\u8f91\uff0c\u6240\u4ee5\u6574\u4f53\u4e0a\u662f\u5927\u540c\u5c0f\u5f02\u7684\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5230\u8fd9\u91cc\uff0c\u6574\u4e2aSpring \u52a8\u6001AOP\u7684\u6e90\u7801\u5c31\u5206\u6790\u5b8c\u4e86\uff0cSpring\u8fd8\u652f\u6301\u9759\u6001AOP\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8fc7\u591a\u8d58\u8ff0\u4e86\uff0c\u6709\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u67e5\u9605\u76f8\u5173\u8d44\u6599\u6765\u5b66\u4e60\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5fae\u4fe1\u516c\u4f17\u53f7",children:"\u5fae\u4fe1\u516c\u4f17\u53f7"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e2a\u4eba\u516c\u4f17\u53f7\u9ec4\u5c0f\u659c",children:"\u4e2a\u4eba\u516c\u4f17\u53f7\uff1a\u9ec4\u5c0f\u659c"}),"\n",(0,i.jsx)(n.p,{children:"\u9ec4\u5c0f\u659c\u662f\u8de8\u8003\u8f6f\u4ef6\u5de5\u7a0b\u7684 985 \u7855\u58eb\uff0c\u81ea\u5b66 Java \u4e24\u5e74\uff0c\u62ff\u5230\u4e86 BAT \u7b49\u8fd1\u5341\u5bb6\u5927\u5382 offer\uff0c\u4ece\u6280\u672f\u5c0f\u767d\u6210\u957f\u4e3a\u963f\u91cc\u5de5\u7a0b\u5e08\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4f5c\u8005\u4e13\u6ce8\u4e8e JAVA \u540e\u7aef\u6280\u672f\u6808\uff0c\u70ed\u8877\u4e8e\u5206\u4eab\u7a0b\u5e8f\u5458\u5e72\u8d27\u3001\u5b66\u4e60\u7ecf\u9a8c\u3001\u6c42\u804c\u5fc3\u5f97\u548c\u7a0b\u5e8f\u4eba\u751f\uff0c\u76ee\u524d\u9ec4\u5c0f\u659c\u7684CSDN\u535a\u5ba2\u6709\u767e\u4e07+\u8bbf\u95ee\u91cf\uff0c\u77e5\u4e4e\u7c89\u4e1d2W+\uff0c\u5168\u7f51\u5df2\u670910W+\u8bfb\u8005\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u9ec4\u5c0f\u659c\u662f\u4e00\u4e2a\u659c\u6760\u9752\u5e74\uff0c\u575a\u6301\u5b66\u4e60\u548c\u5199\u4f5c\uff0c\u76f8\u4fe1\u7ec8\u8eab\u5b66\u4e60\u7684\u529b\u91cf\uff0c\u5e0c\u671b\u548c\u66f4\u591a\u7684\u7a0b\u5e8f\u5458\u4ea4\u670b\u53cb\uff0c\u4e00\u8d77\u8fdb\u6b65\u548c\u6210\u957f\uff01"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u539f\u521b\u7535\u5b50\u4e66:"}),"\n\u5173\u6ce8\u516c\u4f17\u53f7\u3010\u9ec4\u5c0f\u659c\u3011\u540e\u56de\u590d\u3010\u539f\u521b\u7535\u5b50\u4e66\u3011\u5373\u53ef\u9886\u53d6\u6211\u539f\u521b\u7684\u7535\u5b50\u4e66\u300a\u83dc\u9e1f\u7a0b\u5e8f\u5458\u4fee\u70bc\u624b\u518c\uff1a\u4ece\u6280\u672f\u5c0f\u767d\u5230\u963f\u91cc\u5df4\u5df4Java\u5de5\u7a0b\u5e08\u300b"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u7a0b\u5e8f\u54583T\u6280\u672f\u5b66\u4e60\u8d44\u6e90\uff1a"})," \u4e00\u4e9b\u7a0b\u5e8f\u5458\u5b66\u4e60\u6280\u672f\u7684\u8d44\u6e90\u5927\u793c\u5305\uff0c\u5173\u6ce8\u516c\u4f17\u53f7\u540e\uff0c\u540e\u53f0\u56de\u590d\u5173\u952e\u5b57 ",(0,i.jsx)(n.strong,{children:"\u201c\u8d44\u6599\u201d"})," \u5373\u53ef\u514d\u8d39\u65e0\u5957\u8def\u83b7\u53d6\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u8003\u7814\u590d\u4e60\u8d44\u6599\uff1a"}),"\n\u8ba1\u7b97\u673a\u8003\u7814\u5927\u793c\u5305\uff0c\u90fd\u662f\u6211\u81ea\u5df1\u8003\u7814\u590d\u4e60\u65f6\u7528\u7684\u4e00\u4e9b\u590d\u4e60\u8d44\u6599,\u5305\u62ec\u516c\u5171\u8bfe\u548c\u4e13\u4e1a\u7684\u590d\u4e60\u89c6\u9891\uff0c\u8fd9\u91cc\u4e5f\u63a8\u8350\u7ed9\u5927\u5bb6\uff0c\u5173\u6ce8\u516c\u4f17\u53f7\u540e\uff0c\u540e\u53f0\u56de\u590d\u5173\u952e\u5b57 ",(0,i.jsx)(n.strong,{children:"\u201c\u8003\u7814\u201d"})," \u5373\u53ef\u514d\u8d39\u83b7\u53d6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://img-blog.csdnimg.cn/20190829222750556.jpg",alt:""})}),"\n",(0,i.jsx)(n.h3,{id:"\u6280\u672f\u516c\u4f17\u53f7java\u6280\u672f\u6c5f\u6e56",children:"\u6280\u672f\u516c\u4f17\u53f7\uff1aJava\u6280\u672f\u6c5f\u6e56"}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u5927\u5bb6\u60f3\u8981\u5b9e\u65f6\u5173\u6ce8\u6211\u66f4\u65b0\u7684\u6587\u7ae0\u4ee5\u53ca\u5206\u4eab\u7684\u5e72\u8d27\u7684\u8bdd\uff0c\u53ef\u4ee5\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7\u3010Java\u6280\u672f\u6c5f\u6e56\u3011\u4e00\u4f4d\u963f\u91cc Java \u5de5\u7a0b\u5e08\u7684\u6280\u672f\u5c0f\u7ad9\uff0c\u4f5c\u8005\u9ec4\u5c0f\u659c\uff0c\u4e13\u6ce8 Java \u76f8\u5173\u6280\u672f\uff1aSSM\u3001SpringBoot\u3001MySQL\u3001\u5206\u5e03\u5f0f\u3001\u4e2d\u95f4\u4ef6\u3001\u96c6\u7fa4\u3001Linux\u3001\u7f51\u7edc\u3001\u591a\u7ebf\u7a0b\uff0c\u5076\u5c14\u8bb2\u70b9Docker\u3001ELK\uff0c\u540c\u65f6\u4e5f\u5206\u4eab\u6280\u672f\u5e72\u8d27\u548c\u5b66\u4e60\u7ecf\u9a8c\uff0c\u81f4\u529b\u4e8eJava\u5168\u6808\u5f00\u53d1\uff01"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Java\u5de5\u7a0b\u5e08\u5fc5\u5907\u5b66\u4e60\u8d44\u6e90:"})," \u4e00\u4e9bJava\u5de5\u7a0b\u5e08\u5e38\u7528\u5b66\u4e60\u8d44\u6e90\uff0c\u5173\u6ce8\u516c\u4f17\u53f7\u540e\uff0c\u540e\u53f0\u56de\u590d\u5173\u952e\u5b57 ",(0,i.jsx)(n.strong,{children:"\u201cJava\u201d"})," \u5373\u53ef\u514d\u8d39\u65e0\u5957\u8def\u83b7\u53d6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://img-blog.csdnimg.cn/20190805090108984.jpg",alt:"\u6211\u7684\u516c\u4f17\u53f7"})})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},88672:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>o});var i=t(50959);const r={},a=i.createContext(r);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);