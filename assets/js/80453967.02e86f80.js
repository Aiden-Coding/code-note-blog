"use strict";(self.webpackChunkcode_note_blog=self.webpackChunkcode_note_blog||[]).push([[407],{4168:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>l});var s=r(11527),i=r(88672);const c={},d=void 0,a={id:"Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u8bbf\u95ee",title:"Spring\u4e2d\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u8bbf\u95ee",description:"\u914d\u7f6e\u6570\u636e\u6e90",source:"@site/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u8bbf\u95ee.md",sourceDirName:"Spring\u5168\u5bb6\u6876/Spring",slug:"/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u8bbf\u95ee",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u8bbf\u95ee",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u8bbf\u95ee.md",tags:[],version:"current",frontMatter:{},sidebar:"spring",previous:{title:"Spring\u4e2d\u7684Environment\u73af\u5883\u53d8\u91cf",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u7684Environment\u73af\u5883\u53d8\u91cf"},next:{title:"Spring \u6821\u9a8c",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring/Spring\u4e2d\u5bf9\u4e8e\u6821\u9a8c\u529f\u80fd\u7684\u652f\u6301"}},t={},l=[{value:"\u914d\u7f6e\u6570\u636e\u6e90",id:"\u914d\u7f6e\u6570\u636e\u6e90",level:2},{value:"Spring \u914d\u7f6e\u6570\u636e\u6e90",id:"spring-\u914d\u7f6e\u6570\u636e\u6e90",level:3},{value:"#\u4f7f\u7528 JNDI \u6570\u636e\u6e90",id:"\u4f7f\u7528-jndi-\u6570\u636e\u6e90",level:4},{value:"#\u4f7f\u7528\u6570\u636e\u5e93\u8fde\u63a5\u6c60",id:"\u4f7f\u7528\u6570\u636e\u5e93\u8fde\u63a5\u6c60",level:4},{value:"#\u57fa\u4e8e JDBC \u9a71\u52a8\u7684\u6570\u636e\u6e90",id:"\u57fa\u4e8e-jdbc-\u9a71\u52a8\u7684\u6570\u636e\u6e90",level:4},{value:"\u4f7f\u7528JDBC",id:"\u4f7f\u7528jdbc",level:4},{value:"JdbcTemplate\u7528\u6cd5",id:"jdbctemplate\u7528\u6cd5",level:3},{value:"Insert\u64cd\u4f5c",id:"insert\u64cd\u4f5c",level:3},{value:"Delete\u64cd\u4f5c",id:"delete\u64cd\u4f5c",level:3},{value:"Update\u64cd\u4f5c",id:"update\u64cd\u4f5c",level:3},{value:"\u4f7f\u7528HQL\u67e5\u8be2",id:"\u4f7f\u7528hql\u67e5\u8be2",level:3},{value:"\u96c6\u6210MyBatis",id:"\u96c6\u6210mybatis",level:4},{value:"XML\u914d\u7f6e",id:"xml\u914d\u7f6e",level:3}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"\u914d\u7f6e\u6570\u636e\u6e90",children:"\u914d\u7f6e\u6570\u636e\u6e90"}),"\n",(0,s.jsx)(n.h3,{id:"spring-\u914d\u7f6e\u6570\u636e\u6e90",children:"Spring \u914d\u7f6e\u6570\u636e\u6e90"}),"\n",(0,s.jsx)(n.p,{children:"Spring \u914d\u7f6e\u6570\u636e\u6e90\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u4e0b\u9762\u4e00\u4e00\u5217\u4e3e\uff1a"}),"\n",(0,s.jsxs)(n.h4,{id:"\u4f7f\u7528-jndi-\u6570\u636e\u6e90",children:[(0,s.jsx)(n.a,{href:"https://dunwu.github.io/spring-tutorial/pages/1b774c/#%E4%BD%BF%E7%94%A8-jndi-%E6%95%B0%E6%8D%AE%E6%BA%90",children:"#"}),"\u4f7f\u7528 JNDI \u6570\u636e\u6e90"]}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c Spring \u5e94\u7528\u90e8\u7f72\u5728\u652f\u6301 JNDI \u7684 WEB \u670d\u52a1\u5668\u4e0a\uff08\u5982 WebSphere\u3001JBoss\u3001Tomcat \u7b49\uff09\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 JNDI \u83b7\u53d6\u6570\u636e\u6e90\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xmlns:jee="http://www.springframework.org/schema/jee"\n  xsi:schemaLocation="http://www.springframework.org/schema/beans\n            http://www.springframework.org/schema/beans/spring-beans-3.2.xsd\nhttp://www.springframework.org/schema/jee\nhttp://www.springframework.org/schema/jee/spring-jee-3.2.xsd">\n\n  \x3c!-- 1.\u4f7f\u7528bean\u914d\u7f6ejndi\u6570\u636e\u6e90 --\x3e\n  <bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">\n    <property name="jndiName" value="java:comp/env/jdbc/orclight" />\n  </bean>\n\n  \x3c!-- 2.\u4f7f\u7528jee\u6807\u7b7e\u914d\u7f6ejndi\u6570\u636e\u6e90\uff0c\u4e0e1\u7b49\u4ef7\uff0c\u4f46\u662f\u9700\u8981\u5f15\u5165\u547d\u540d\u7a7a\u95f4 --\x3e\n  <jee:jndi-lookup id="dataSource" jndi-name=" java:comp/env/jdbc/orclight" />\n</beans>\n\n'})}),"\n",(0,s.jsxs)(n.h4,{id:"\u4f7f\u7528\u6570\u636e\u5e93\u8fde\u63a5\u6c60",children:[(0,s.jsx)(n.a,{href:"https://dunwu.github.io/spring-tutorial/pages/1b774c/#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0",children:"#"}),"\u4f7f\u7528\u6570\u636e\u5e93\u8fde\u63a5\u6c60"]}),"\n",(0,s.jsxs)(n.p,{children:["Spring \u672c\u8eab\u5e76\u6ca1\u6709\u63d0\u4f9b\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u7684\u5b9e\u73b0\uff0c\u9700\u8981\u81ea\u884c\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 ",(0,s.jsx)(n.a,{href:"https://github.com/alibaba/druid",children:"Druid (opens new window)"}),"\u4f5c\u4e3a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u7684\u793a\u4f8b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'<bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"\n        init-method="init" destroy-method="close">\n    <property name="driverClassName" value="${jdbc.driver}"/>\n    <property name="url" value="${jdbc.url}"/>\n    <property name="username" value="${jdbc.username}"/>\n    <property name="password" value="${jdbc.password}"/>\n\n    \x3c!-- \u914d\u7f6e\u521d\u59cb\u5316\u5927\u5c0f\u3001\u6700\u5c0f\u3001\u6700\u5927 --\x3e\n    <property name="initialSize" value="1"/>\n    <property name="minIdle" value="1"/>\n    <property name="maxActive" value="10"/>\n\n    \x3c!-- \u914d\u7f6e\u83b7\u53d6\u8fde\u63a5\u7b49\u5f85\u8d85\u65f6\u7684\u65f6\u95f4 --\x3e\n    <property name="maxWait" value="10000"/>\n\n    \x3c!-- \u914d\u7f6e\u95f4\u9694\u591a\u4e45\u624d\u8fdb\u884c\u4e00\u6b21\u68c0\u6d4b\uff0c\u68c0\u6d4b\u9700\u8981\u5173\u95ed\u7684\u7a7a\u95f2\u8fde\u63a5\uff0c\u5355\u4f4d\u662f\u6beb\u79d2 --\x3e\n    <property name="timeBetweenEvictionRunsMillis" value="60000"/>\n\n    \x3c!-- \u914d\u7f6e\u4e00\u4e2a\u8fde\u63a5\u5728\u6c60\u4e2d\u6700\u5c0f\u751f\u5b58\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u6beb\u79d2 --\x3e\n    <property name="minEvictableIdleTimeMillis" value="300000"/>\n\n    <property name="testWhileIdle" value="true"/>\n\n    \x3c!-- \u8fd9\u91cc\u5efa\u8bae\u914d\u7f6e\u4e3aTRUE\uff0c\u9632\u6b62\u53d6\u5230\u7684\u8fde\u63a5\u4e0d\u53ef\u7528 --\x3e\n    <property name="testOnBorrow" value="true"/>\n    <property name="testOnReturn" value="false"/>\n\n    \x3c!-- \u6253\u5f00PSCache\uff0c\u5e76\u4e14\u6307\u5b9a\u6bcf\u4e2a\u8fde\u63a5\u4e0aPSCache\u7684\u5927\u5c0f --\x3e\n    <property name="poolPreparedStatements" value="true"/>\n    <property name="maxPoolPreparedStatementPerConnectionSize"\n              value="20"/>\n\n    \x3c!-- \u8fd9\u91cc\u914d\u7f6e\u63d0\u4ea4\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u5c31\u662fTRUE\uff0c\u53ef\u4ee5\u4e0d\u7528\u914d\u7f6e --\x3e\n\n    <property name="defaultAutoCommit" value="true"/>\n\n    \x3c!-- \u9a8c\u8bc1\u8fde\u63a5\u6709\u6548\u4e0e\u5426\u7684SQL\uff0c\u4e0d\u540c\u7684\u6570\u636e\u914d\u7f6e\u4e0d\u540c --\x3e\n    <property name="validationQuery" value="select 1 "/>\n    <property name="filters" value="stat"/>\n  </bean>\n\n'})}),"\n",(0,s.jsxs)(n.h4,{id:"\u57fa\u4e8e-jdbc-\u9a71\u52a8\u7684\u6570\u636e\u6e90",children:[(0,s.jsx)(n.a,{href:"https://dunwu.github.io/spring-tutorial/pages/1b774c/#%E5%9F%BA%E4%BA%8E-jdbc-%E9%A9%B1%E5%8A%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E6%BA%90",children:"#"}),"\u57fa\u4e8e JDBC \u9a71\u52a8\u7684\u6570\u636e\u6e90"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">\n  <property name="driverClassName" value="${jdbc.driver}"/>\n  <property name="url" value="${jdbc.url}"/>\n  <property name="username" value="${jdbc.username}"/>\n  <property name="password" value="${jdbc.password}"/>\n</bean>\n'})}),"\n",(0,s.jsx)(n.h4,{id:"\u4f7f\u7528jdbc",children:"\u4f7f\u7528JDBC"}),"\n",(0,s.jsx)(n.p,{children:"\u6700\u540e\u66f4\u65b0: 2022/11/16 20:10 / \u9605\u8bfb: 946668"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u5728\u524d\u9762\u4ecb\u7ecd",(0,s.jsx)(n.a,{href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1255943820274272",children:"JDBC\u7f16\u7a0b"}),"\u65f6\u5df2\u7ecf\u8bb2\u8fc7\uff0cJava\u7a0b\u5e8f\u4f7f\u7528JDBC\u63a5\u53e3\u8bbf\u95ee\u5173\u7cfb\u6570\u636e\u5e93\u7684\u65f6\u5019\uff0c\u9700\u8981\u4ee5\u4e0b\u51e0\u6b65\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u521b\u5efa\u5168\u5c40",(0,s.jsx)(n.code,{children:"DataSource"}),"\u5b9e\u4f8b\uff0c\u8868\u793a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5728\u9700\u8981\u8bfb\u5199\u6570\u636e\u5e93\u7684\u65b9\u6cd5\u5185\u90e8\uff0c\u6309\u5982\u4e0b\u6b65\u9aa4\u8bbf\u95ee\u6570\u636e\u5e93\uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4ece\u5168\u5c40",(0,s.jsx)(n.code,{children:"DataSource"}),"\u5b9e\u4f8b\u83b7\u53d6",(0,s.jsx)(n.code,{children:"Connection"}),"\u5b9e\u4f8b\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u901a\u8fc7",(0,s.jsx)(n.code,{children:"Connection"}),"\u5b9e\u4f8b\u521b\u5efa",(0,s.jsx)(n.code,{children:"PreparedStatement"}),"\u5b9e\u4f8b\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u6267\u884cSQL\u8bed\u53e5\uff0c\u5982\u679c\u662f\u67e5\u8be2\uff0c\u5219\u901a\u8fc7",(0,s.jsx)(n.code,{children:"ResultSet"}),"\u8bfb\u53d6\u7ed3\u679c\u96c6\uff0c\u5982\u679c\u662f\u4fee\u6539\uff0c\u5219\u83b7\u5f97",(0,s.jsx)(n.code,{children:"int"}),"\u7ed3\u679c\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6b63\u786e\u7f16\u5199JDBC\u4ee3\u7801\u7684\u5173\u952e\u662f\u4f7f\u7528",(0,s.jsx)(n.code,{children:"try ... finally"}),"\u91ca\u653e\u8d44\u6e90\uff0c\u6d89\u53ca\u5230\u4e8b\u52a1\u7684\u4ee3\u7801\u9700\u8981\u6b63\u786e\u63d0\u4ea4\u6216\u56de\u6eda\u4e8b\u52a1\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728Spring\u4f7f\u7528JDBC\uff0c\u9996\u5148\u6211\u4eec\u901a\u8fc7IoC\u5bb9\u5668\u521b\u5efa\u5e76\u7ba1\u7406\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"DataSource"}),"\u5b9e\u4f8b\uff0c\u7136\u540e\uff0cSpring\u63d0\u4f9b\u4e86\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5730\u8ba9\u6211\u4eec\u64cd\u4f5cJDBC\uff0c\u56e0\u6b64\uff0c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u5b9e\u4f8b\u5316\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u3002\u987e\u540d\u601d\u4e49\uff0c\u8fd9\u4e2a\u7c7b\u4e3b\u8981\u4f7f\u7528\u4e86",(0,s.jsx)(n.a,{href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1281319636041762",children:"Template\u6a21\u5f0f"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7f16\u5199\u793a\u4f8b\u4ee3\u7801\u6216\u8005\u6d4b\u8bd5\u4ee3\u7801\u65f6\uff0c\u6211\u4eec\u5f3a\u70c8\u63a8\u8350\u4f7f\u7528",(0,s.jsx)(n.a,{href:"http://hsqldb.org/",children:"HSQLDB"}),"\u8fd9\u4e2a\u6570\u636e\u5e93\uff0c\u5b83\u662f\u4e00\u4e2a\u7528Java\u7f16\u5199\u7684\u5173\u7cfb\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u4ee5\u5185\u5b58\u6a21\u5f0f\u6216\u8005\u6587\u4ef6\u6a21\u5f0f\u8fd0\u884c\uff0c\u672c\u8eab\u53ea\u6709\u4e00\u4e2ajar\u5305\uff0c\u975e\u5e38\u9002\u5408\u6f14\u793a\u4ee3\u7801\u6216\u8005\u6d4b\u8bd5\u4ee3\u7801\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u4ee5\u5b9e\u9645\u5de5\u7a0b\u4e3a\u4f8b\uff0c\u5148\u521b\u5efaMaven\u5de5\u7a0b",(0,s.jsx)(n.code,{children:"spring-data-jdbc"}),"\uff0c\u7136\u540e\u5f15\u5165\u4ee5\u4e0b\u4f9d\u8d56\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"org.springframework:spring-context:6.0.0"}),"\n",(0,s.jsx)(n.li,{children:"org.springframework:spring-jdbc:6.0.0"}),"\n",(0,s.jsxs)(n.li,{children:["jakarta.annotation",":jakarta",".annotation-api:2.1.1"]}),"\n",(0,s.jsx)(n.li,{children:"com.zaxxer:HikariCP:5.0.1"}),"\n",(0,s.jsx)(n.li,{children:"org.hsqldb:hsqldb:2.7.1"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728",(0,s.jsx)(n.code,{children:"AppConfig"}),"\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4ee5\u4e0b\u51e0\u4e2a\u5fc5\u987b\u7684Bean\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Configuration\n@ComponentScan\n@PropertySource("jdbc.properties")\npublic class AppConfig {\n\n    @Value("${jdbc.url}")\n    String jdbcUrl;\n\n    @Value("${jdbc.username}")\n    String jdbcUsername;\n\n    @Value("${jdbc.password}")\n    String jdbcPassword;\n\n    @Bean\n    DataSource createDataSource() {\n        HikariConfig config = new HikariConfig();\n        config.setJdbcUrl(jdbcUrl);\n        config.setUsername(jdbcUsername);\n        config.setPassword(jdbcPassword);\n        config.addDataSourceProperty("autoCommit", "true");\n        config.addDataSourceProperty("connectionTimeout", "5");\n        config.addDataSourceProperty("idleTimeout", "60");\n        return new HikariDataSource(config);\n    }\n\n    @Bean\n    JdbcTemplate createJdbcTemplate(@Autowired DataSource dataSource) {\n        return new JdbcTemplate(dataSource);\n    }\n}\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u4e0a\u8ff0\u914d\u7f6e\u4e2d\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u901a\u8fc7",(0,s.jsx)(n.code,{children:'@PropertySource("jdbc.properties")'}),"\u8bfb\u53d6\u6570\u636e\u5e93\u914d\u7f6e\u6587\u4ef6\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u901a\u8fc7",(0,s.jsx)(n.code,{children:'@Value("${jdbc.url}")'}),"\u6ce8\u5165\u914d\u7f6e\u6587\u4ef6\u7684\u76f8\u5173\u914d\u7f6e\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u521b\u5efa\u4e00\u4e2aDataSource\u5b9e\u4f8b\uff0c\u5b83\u7684\u5b9e\u9645\u7c7b\u578b\u662f",(0,s.jsx)(n.code,{children:"HikariDataSource"}),"\uff0c\u521b\u5efa\u65f6\u9700\u8981\u7528\u5230\u6ce8\u5165\u7684\u914d\u7f6e\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u521b\u5efa\u4e00\u4e2aJdbcTemplate\u5b9e\u4f8b\uff0c\u5b83\u9700\u8981\u6ce8\u5165",(0,s.jsx)(n.code,{children:"DataSource"}),"\uff0c\u8fd9\u662f\u901a\u8fc7\u65b9\u6cd5\u53c2\u6570\u5b8c\u6210\u6ce8\u5165\u7684\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u9488\u5bf9HSQLDB\u5199\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6",(0,s.jsx)(n.code,{children:"jdbc.properties"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"# \u6570\u636e\u5e93\u6587\u4ef6\u540d\u4e3atestdb:\njdbc.url=jdbc:hsqldb:file:testdb\n\n# Hsqldb\u9ed8\u8ba4\u7684\u7528\u6237\u540d\u662fsa\uff0c\u53e3\u4ee4\u662f\u7a7a\u5b57\u7b26\u4e32:\njdbc.username=sa\njdbc.password=\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u4ee5\u901a\u8fc7HSQLDB\u81ea\u5e26\u7684\u5de5\u5177\u6765\u521d\u59cb\u5316\u6570\u636e\u5e93\u8868\uff0c\u8fd9\u91cc\u6211\u4eec\u5199\u4e00\u4e2aBean\uff0c\u5728Spring\u5bb9\u5668\u542f\u52a8\u65f6\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"users"}),"\u8868\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Component\npublic class DatabaseInitializer {\n    @Autowired\n    JdbcTemplate jdbcTemplate;\n\n    @PostConstruct\n    public void init() {\n        jdbcTemplate.update("CREATE TABLE IF NOT EXISTS users (" //\n                + "id BIGINT IDENTITY NOT NULL PRIMARY KEY, " //\n                + "email VARCHAR(100) NOT NULL, " //\n                + "password VARCHAR(100) NOT NULL, " //\n                + "name VARCHAR(100) NOT NULL, " //\n                + "UNIQUE (email))");\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u73b0\u5728\uff0c\u6240\u6709\u51c6\u5907\u5de5\u4f5c\u90fd\u5df2\u5b8c\u6bd5\u3002\u6211\u4eec\u53ea\u9700\u8981\u5728\u9700\u8981\u8bbf\u95ee\u6570\u636e\u5e93\u7684Bean\u4e2d\uff0c\u6ce8\u5165",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u5373\u53ef\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Component\npublic class UserService {\n    @Autowired\n    JdbcTemplate jdbcTemplate;\n    ...\n}\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"jdbctemplate\u7528\u6cd5",children:"JdbcTemplate\u7528\u6cd5"}),"\n",(0,s.jsxs)(n.p,{children:["Spring\u63d0\u4f9b\u7684",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u91c7\u7528Template\u6a21\u5f0f\uff0c\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u4ee5\u56de\u8c03\u4e3a\u7279\u70b9\u7684\u5de5\u5177\u65b9\u6cd5\uff0c\u76ee\u7684\u662f\u907f\u514d\u7e41\u7410\u7684",(0,s.jsx)(n.code,{children:"try...catch"}),"\u8bed\u53e5\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u4ee5\u5177\u4f53\u7684\u793a\u4f8b\u6765\u8bf4\u660eJdbcTemplate\u7684\u7528\u6cd5\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u9996\u5148\u6211\u4eec\u770b",(0,s.jsx)(n.code,{children:"T execute(ConnectionCallback<T> action)"}),"\u65b9\u6cd5\uff0c\u5b83\u63d0\u4f9b\u4e86Jdbc\u7684",(0,s.jsx)(n.code,{children:"Connection"}),"\u4f9b\u6211\u4eec\u4f7f\u7528\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public User getUserById(long id) {\n    // \u6ce8\u610f\u4f20\u5165\u7684\u662fConnectionCallback:\n    return jdbcTemplate.execute((Connection conn) -> {\n        // \u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528conn\u5b9e\u4f8b\uff0c\u4e0d\u8981\u91ca\u653e\u5b83\uff0c\u56de\u8c03\u7ed3\u675f\u540eJdbcTemplate\u81ea\u52a8\u91ca\u653e:\n        // \u5728\u5185\u90e8\u624b\u52a8\u521b\u5efa\u7684PreparedStatement\u3001ResultSet\u5fc5\u987b\u7528try(...)\u91ca\u653e:\n        try (var ps = conn.prepareStatement("SELECT * FROM users WHERE id = ?")) {\n            ps.setObject(1, id);\n            try (var rs = ps.executeQuery()) {\n                if (rs.next()) {\n                    return new User( // new User object:\n                            rs.getLong("id"), // id\n                            rs.getString("email"), // email\n                            rs.getString("password"), // password\n                            rs.getString("name")); // name\n                }\n                throw new RuntimeException("user not found by id.");\n            }\n        }\n    });\n}\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e0a\u8ff0\u56de\u8c03\u65b9\u6cd5\u5141\u8bb8\u83b7\u53d6Connection\uff0c\u7136\u540e\u505a\u4efb\u4f55\u57fa\u4e8eConnection\u7684\u64cd\u4f5c\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u518d\u770b",(0,s.jsx)(n.code,{children:"T execute(String sql, PreparedStatementCallback<T> action)"}),"\u7684\u7528\u6cd5\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public User getUserByName(String name) {\n    // \u9700\u8981\u4f20\u5165SQL\u8bed\u53e5\uff0c\u4ee5\u53caPreparedStatementCallback:\n    return jdbcTemplate.execute("SELECT * FROM users WHERE name = ?", (PreparedStatement ps) -> {\n        // PreparedStatement\u5b9e\u4f8b\u5df2\u7ecf\u7531JdbcTemplate\u521b\u5efa\uff0c\u5e76\u5728\u56de\u8c03\u540e\u81ea\u52a8\u91ca\u653e:\n        ps.setObject(1, name);\n        try (var rs = ps.executeQuery()) {\n            if (rs.next()) {\n                return new User( // new User object:\n                        rs.getLong("id"), // id\n                        rs.getString("email"), // email\n                        rs.getString("password"), // password\n                        rs.getString("name")); // name\n            }\n            throw new RuntimeException("user not found by id.");\n        }\n    });\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u770b",(0,s.jsx)(n.code,{children:"T queryForObject(String sql, RowMapper<T> rowMapper, Object... args)"}),"\u65b9\u6cd5\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public User getUserByEmail(String email) {\n    // \u4f20\u5165SQL\uff0c\u53c2\u6570\u548cRowMapper\u5b9e\u4f8b:\n    return jdbcTemplate.queryForObject("SELECT * FROM users WHERE email = ?",\n            (ResultSet rs, int rowNum) -> {\n                // \u5c06ResultSet\u7684\u5f53\u524d\u884c\u6620\u5c04\u4e3a\u4e00\u4e2aJavaBean:\n                return new User( // new User object:\n                        rs.getLong("id"), // id\n                        rs.getString("email"), // email\n                        rs.getString("password"), // password\n                        rs.getString("name")); // name\n            },\n            email);\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728",(0,s.jsx)(n.code,{children:"queryForObject()"}),"\u65b9\u6cd5\u4e2d\uff0c\u4f20\u5165SQL\u4ee5\u53caSQL\u53c2\u6570\u540e\uff0c",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u4f1a\u81ea\u52a8\u521b\u5efa",(0,s.jsx)(n.code,{children:"PreparedStatement"}),"\uff0c\u81ea\u52a8\u6267\u884c\u67e5\u8be2\u5e76\u8fd4\u56de",(0,s.jsx)(n.code,{children:"ResultSet"}),"\uff0c\u6211\u4eec\u63d0\u4f9b\u7684",(0,s.jsx)(n.code,{children:"RowMapper"}),"\u9700\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u628a",(0,s.jsx)(n.code,{children:"ResultSet"}),"\u7684\u5f53\u524d\u884c\u6620\u5c04\u6210\u4e00\u4e2aJavaBean\u5e76\u8fd4\u56de\u3002\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4f7f\u7528",(0,s.jsx)(n.code,{children:"Connection"}),"\u3001",(0,s.jsx)(n.code,{children:"PreparedStatement"}),"\u548c",(0,s.jsx)(n.code,{children:"ResultSet"}),"\u90fd\u4e0d\u9700\u8981\u6211\u4eec\u624b\u52a8\u7ba1\u7406\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"RowMapper"}),"\u4e0d\u4e00\u5b9a\u8fd4\u56deJavaBean\uff0c\u5b9e\u9645\u4e0a\u5b83\u53ef\u4ee5\u8fd4\u56de\u4efb\u4f55Java\u5bf9\u8c61\u3002\u4f8b\u5982\uff0c\u4f7f\u7528",(0,s.jsx)(n.code,{children:"SELECT COUNT(*)"}),"\u67e5\u8be2\u65f6\uff0c\u53ef\u4ee5\u8fd4\u56de",(0,s.jsx)(n.code,{children:"Long"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public long getUsers() {\n    return jdbcTemplate.queryForObject("SELECT COUNT(*) FROM users", (ResultSet rs, int rowNum) -> {\n        // SELECT COUNT(*)\u67e5\u8be2\u53ea\u6709\u4e00\u5217\uff0c\u53d6\u7b2c\u4e00\u5217\u6570\u636e:\n        return rs.getLong(1);\n    });\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u6211\u4eec\u671f\u671b\u8fd4\u56de\u591a\u884c\u8bb0\u5f55\uff0c\u800c\u4e0d\u662f\u4e00\u884c\uff0c\u53ef\u4ee5\u7528",(0,s.jsx)(n.code,{children:"query()"}),"\u65b9\u6cd5\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public List<User> getUsers(int pageIndex) {\n    int limit = 100;\n    int offset = limit * (pageIndex - 1);\n    return jdbcTemplate.query("SELECT * FROM users LIMIT ? OFFSET ?",\n            new BeanPropertyRowMapper<>(User.class),\n            limit, offset);\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0a\u8ff0",(0,s.jsx)(n.code,{children:"query()"}),"\u65b9\u6cd5\u4f20\u5165\u7684\u53c2\u6570\u4ecd\u7136\u662fSQL\u3001SQL\u53c2\u6570\u4ee5\u53ca",(0,s.jsx)(n.code,{children:"RowMapper"}),"\u5b9e\u4f8b\u3002\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u4f7f\u7528Spring\u63d0\u4f9b\u7684",(0,s.jsx)(n.code,{children:"BeanPropertyRowMapper"}),"\u3002\u5982\u679c\u6570\u636e\u5e93\u8868\u7684\u7ed3\u6784\u6070\u597d\u548cJavaBean\u7684\u5c5e\u6027\u540d\u79f0\u4e00\u81f4\uff0c\u90a3\u4e48",(0,s.jsx)(n.code,{children:"BeanPropertyRowMapper"}),"\u5c31\u53ef\u4ee5\u76f4\u63a5\u628a\u4e00\u884c\u8bb0\u5f55\u6309\u5217\u540d\u8f6c\u6362\u4e3aJavaBean\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u6211\u4eec\u6267\u884c\u7684\u4e0d\u662f\u67e5\u8be2\uff0c\u800c\u662f\u63d2\u5165\u3001\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\uff0c\u90a3\u4e48\u9700\u8981\u4f7f\u7528",(0,s.jsx)(n.code,{children:"update()"}),"\u65b9\u6cd5\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public void updateUser(User user) {\n    // \u4f20\u5165SQL\uff0cSQL\u53c2\u6570\uff0c\u8fd4\u56de\u66f4\u65b0\u7684\u884c\u6570:\n    if (1 != jdbcTemplate.update("UPDATE users SET name = ? WHERE id = ?", user.getName(), user.getId())) {\n        throw new RuntimeException("User not found by id");\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u53ea\u6709\u4e00\u79cd",(0,s.jsx)(n.code,{children:"INSERT"}),"\u64cd\u4f5c\u6bd4\u8f83\u7279\u6b8a\uff0c\u90a3\u5c31\u662f\u5982\u679c\u67d0\u4e00\u5217\u662f\u81ea\u589e\u5217\uff08\u4f8b\u5982\u81ea\u589e\u4e3b\u952e\uff09\uff0c\u901a\u5e38\uff0c\u6211\u4eec\u9700\u8981\u83b7\u53d6\u63d2\u5165\u540e\u7684\u81ea\u589e\u503c\u3002",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u63d0\u4f9b\u4e86\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"KeyHolder"}),"\u6765\u7b80\u5316\u8fd9\u4e00\u64cd\u4f5c\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public User register(String email, String password, String name) {\n    // \u521b\u5efa\u4e00\u4e2aKeyHolder:\n    KeyHolder holder = new GeneratedKeyHolder();\n    if (1 != jdbcTemplate.update(\n        // \u53c2\u65701:PreparedStatementCreator\n        (conn) -> {\n            // \u521b\u5efaPreparedStatement\u65f6\uff0c\u5fc5\u987b\u6307\u5b9aRETURN_GENERATED_KEYS:\n            var ps = conn.prepareStatement("INSERT INTO users(email, password, name) VALUES(?, ?, ?)",\n                    Statement.RETURN_GENERATED_KEYS);\n            ps.setObject(1, email);\n            ps.setObject(2, password);\n            ps.setObject(3, name);\n            return ps;\n        },\n        // \u53c2\u65702:KeyHolder\n        holder)\n    ) {\n        throw new RuntimeException("Insert failed.");\n    }\n    // \u4eceKeyHolder\u4e2d\u83b7\u53d6\u8fd4\u56de\u7684\u81ea\u589e\u503c:\n    return new User(holder.getKey().longValue(), email, password, name);\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u8fd8\u6709\u8bb8\u591a\u91cd\u8f7d\u65b9\u6cd5\uff0c\u8fd9\u91cc\u6211\u4eec\u4e0d\u4e00\u4e00\u4ecb\u7ecd\u3002\u9700\u8981\u5f3a\u8c03\u7684\u662f\uff0c",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u53ea\u662f\u5bf9JDBC\u64cd\u4f5c\u7684\u4e00\u4e2a\u7b80\u5355\u5c01\u88c5\uff0c\u5b83\u7684\u76ee\u7684\u662f\u5c3d\u91cf\u51cf\u5c11\u624b\u52a8\u7f16\u5199",(0,s.jsx)(n.code,{children:"try(resource) {...}"}),"\u7684\u4ee3\u7801\uff0c\u5bf9\u4e8e\u67e5\u8be2\uff0c\u4e3b\u8981\u901a\u8fc7",(0,s.jsx)(n.code,{children:"RowMapper"}),"\u5b9e\u73b0\u4e86JDBC\u7ed3\u679c\u96c6\u5230Java\u5bf9\u8c61\u7684\u8f6c\u6362\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u603b\u7ed3\u4e00\u4e0b",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u7684\u7528\u6cd5\uff0c\u90a3\u5c31\u662f\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u9488\u5bf9\u7b80\u5355\u67e5\u8be2\uff0c\u4f18\u9009",(0,s.jsx)(n.code,{children:"query()"}),"\u548c",(0,s.jsx)(n.code,{children:"queryForObject()"}),"\uff0c\u56e0\u4e3a\u53ea\u9700\u63d0\u4f9bSQL\u8bed\u53e5\u3001\u53c2\u6570\u548c",(0,s.jsx)(n.code,{children:"RowMapper"}),"\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u9488\u5bf9\u66f4\u65b0\u64cd\u4f5c\uff0c\u4f18\u9009",(0,s.jsx)(n.code,{children:"update()"}),"\uff0c\u56e0\u4e3a\u53ea\u9700\u63d0\u4f9bSQL\u8bed\u53e5\u548c\u53c2\u6570\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4efb\u4f55\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u6700\u7ec8\u4e5f\u53ef\u4ee5\u901a\u8fc7",(0,s.jsx)(n.code,{children:"execute(ConnectionCallback)"}),"\u5b9e\u73b0\uff0c\u56e0\u4e3a\u62ff\u5230",(0,s.jsx)(n.code,{children:"Connection"}),"\u5c31\u53ef\u4ee5\u505a\u4efb\u4f55JDBC\u64cd\u4f5c\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5b9e\u9645\u4e0a\u6211\u4eec\u4f7f\u7528\u6700\u591a\u7684\u4ecd\u7136\u662f\u5404\u79cd\u67e5\u8be2\u3002\u5982\u679c\u5728\u8bbe\u8ba1\u8868\u7ed3\u6784\u7684\u65f6\u5019\uff0c\u80fd\u591f\u548cJavaBean\u7684\u5c5e\u6027\u4e00\u4e00\u5bf9\u5e94\uff0c\u90a3\u4e48\u76f4\u63a5\u4f7f\u7528",(0,s.jsx)(n.code,{children:"BeanPropertyRowMapper"}),"\u5c31\u5f88\u65b9\u4fbf\u3002\u5982\u679c\u8868\u7ed3\u6784\u548cJavaBean\u4e0d\u4e00\u81f4\u600e\u4e48\u529e\uff1f\u90a3\u5c31\u9700\u8981\u7a0d\u5fae\u6539\u5199\u4e00\u4e0b\u67e5\u8be2\uff0c\u4f7f\u7ed3\u679c\u96c6\u7684\u7ed3\u6784\u548cJavaBean\u4fdd\u6301\u4e00\u81f4\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4f8b\u5982\uff0c\u8868\u7684\u5217\u540d\u662f",(0,s.jsx)(n.code,{children:"office_address"}),"\uff0c\u800cJavaBean\u5c5e\u6027\u662f",(0,s.jsx)(n.code,{children:"workAddress"}),"\uff0c\u5c31\u9700\u8981\u6307\u5b9a\u522b\u540d\uff0c\u6539\u5199\u67e5\u8be2\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"SELECT id, email, office_address AS workAddress, name FROM users WHERE email = ?\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u7684\u65f6\u5019\uff0c\u6211\u4eec\u7528\u5f97\u6700\u591a\u7684\u65b9\u6cd5\u5c31\u662f",(0,s.jsx)(n.code,{children:"List<T> query(String, RowMapper, Object...)"}),"\u3002\u8fd9\u4e2a",(0,s.jsx)(n.code,{children:"RowMapper"}),"\u7684\u4f5c\u7528\u5c31\u662f\u628a",(0,s.jsx)(n.code,{children:"ResultSet"}),"\u7684\u4e00\u884c\u8bb0\u5f55\u6620\u5c04\u4e3aJava Bean\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u79cd\u628a\u5173\u7cfb\u6570\u636e\u5e93\u7684\u8868\u8bb0\u5f55\u6620\u5c04\u4e3aJava\u5bf9\u8c61\u7684\u8fc7\u7a0b\u5c31\u662fORM\uff1aObject-Relational Mapping\u3002ORM\u65e2\u53ef\u4ee5\u628a\u8bb0\u5f55\u8f6c\u6362\u6210Java\u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u628aJava\u5bf9\u8c61\u8f6c\u6362\u4e3a\u884c\u8bb0\u5f55\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u914d\u5408",(0,s.jsx)(n.code,{children:"RowMapper"}),"\u53ef\u4ee5\u770b\u4f5c\u662f\u6700\u539f\u59cb\u7684ORM\u3002\u5982\u679c\u8981\u5b9e\u73b0\u66f4\u81ea\u52a8\u5316\u7684ORM\uff0c\u53ef\u4ee5\u9009\u62e9\u6210\u719f\u7684ORM\u6846\u67b6\uff0c\u4f8b\u5982",(0,s.jsx)(n.a,{href:"https://hibernate.org/",children:"Hibernate"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u5728Spring\u4e2d\u96c6\u6210Hibernate\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["Hibernate\u4f5c\u4e3aORM\u6846\u67b6\uff0c\u5b83\u53ef\u4ee5\u66ff\u4ee3",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\uff0c\u4f46Hibernate\u4ecd\u7136\u9700\u8981JDBC\u9a71\u52a8\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u5f15\u5165JDBC\u9a71\u52a8\u3001\u8fde\u63a5\u6c60\uff0c\u4ee5\u53caHibernate\u672c\u8eab\u3002\u5728Maven\u4e2d\uff0c\u6211\u4eec\u52a0\u5165\u4ee5\u4e0b\u4f9d\u8d56\u9879\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"org.springframework:spring-context:6.0.0"}),"\n",(0,s.jsx)(n.li,{children:"org.springframework:spring-orm:6.0.0"}),"\n",(0,s.jsxs)(n.li,{children:["jakarta.annotation",":jakarta",".annotation-api:2.1.1"]}),"\n",(0,s.jsxs)(n.li,{children:["jakarta.persistence",":jakarta",".persistence-api:3.1.0"]}),"\n",(0,s.jsx)(n.li,{children:"org.hibernate:hibernate-core:6.1.4.Final"}),"\n",(0,s.jsx)(n.li,{children:"com.zaxxer:HikariCP:5.0.1"}),"\n",(0,s.jsx)(n.li,{children:"org.hsqldb:hsqldb:2.7.1"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5728",(0,s.jsx)(n.code,{children:"AppConfig"}),"\u4e2d\uff0c\u6211\u4eec\u4ecd\u7136\u9700\u8981\u521b\u5efa",(0,s.jsx)(n.code,{children:"DataSource"}),"\u3001\u5f15\u5165JDBC\u914d\u7f6e\u6587\u4ef6\uff0c\u4ee5\u53ca\u542f\u7528\u58f0\u660e\u5f0f\u4e8b\u52a1\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Configuration\n@ComponentScan\n@EnableTransactionManagement\n@PropertySource("jdbc.properties")\npublic class AppConfig {\n    @Bean\n    DataSource createDataSource() {\n        ...\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a\u4e86\u542f\u7528Hibernate\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"LocalSessionFactoryBean"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public class AppConfig {\n    @Bean\n    LocalSessionFactoryBean createSessionFactory(@Autowired DataSource dataSource) {\n        var props = new Properties();\n        props.setProperty("hibernate.hbm2ddl.auto", "update"); // \u751f\u4ea7\u73af\u5883\u4e0d\u8981\u4f7f\u7528\n        props.setProperty("hibernate.dialect", "org.hibernate.dialect.HSQLDialect");\n        props.setProperty("hibernate.show_sql", "true");\n        var sessionFactoryBean = new LocalSessionFactoryBean();\n        sessionFactoryBean.setDataSource(dataSource);\n        // \u626b\u63cf\u6307\u5b9a\u7684package\u83b7\u53d6\u6240\u6709entity class:\n        sessionFactoryBean.setPackagesToScan("com.itranswarp.learnjava.entity");\n        sessionFactoryBean.setHibernateProperties(props);\n        return sessionFactoryBean;\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6ce8\u610f\u6211\u4eec\u5728",(0,s.jsx)(n.a,{href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1308043627200545",children:"\u5b9a\u5236Bean"}),"\u4e2d\u8bb2\u5230\u8fc7",(0,s.jsx)(n.code,{children:"FactoryBean"}),"\uff0c",(0,s.jsx)(n.code,{children:"LocalSessionFactoryBean"}),"\u662f\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"FactoryBean"}),"\uff0c\u5b83\u4f1a\u518d\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\uff0c\u5728Hibernate\u4e2d\uff0c",(0,s.jsx)(n.code,{children:"Session"}),"\u662f\u5c01\u88c5\u4e86\u4e00\u4e2aJDBC ",(0,s.jsx)(n.code,{children:"Connection"}),"\u7684\u5b9e\u4f8b\uff0c\u800c",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u662f\u5c01\u88c5\u4e86JDBC ",(0,s.jsx)(n.code,{children:"DataSource"}),"\u7684\u5b9e\u4f8b\uff0c\u5373",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u6301\u6709\u8fde\u63a5\u6c60\uff0c\u6bcf\u6b21\u9700\u8981\u64cd\u4f5c\u6570\u636e\u5e93\u7684\u65f6\u5019\uff0c",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684",(0,s.jsx)(n.code,{children:"Session"}),"\uff0c\u76f8\u5f53\u4e8e\u4ece\u8fde\u63a5\u6c60\u83b7\u53d6\u5230\u4e00\u4e2a\u65b0\u7684",(0,s.jsx)(n.code,{children:"Connection"}),"\u3002",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u5c31\u662fHibernate\u63d0\u4f9b\u7684\u6700\u6838\u5fc3\u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4f46",(0,s.jsx)(n.code,{children:"LocalSessionFactoryBean"}),"\u662fSpring\u63d0\u4f9b\u7684\u4e3a\u4e86\u8ba9\u6211\u4eec\u65b9\u4fbf\u521b\u5efa",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u7684\u7c7b\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6ce8\u610f\u5230\u4e0a\u9762\u521b\u5efa",(0,s.jsx)(n.code,{children:"LocalSessionFactoryBean"}),"\u7684\u4ee3\u7801\uff0c\u9996\u5148\u7528",(0,s.jsx)(n.code,{children:"Properties"}),"\u6301\u6709Hibernate\u521d\u59cb\u5316",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u65f6\u7528\u5230\u7684\u6240\u6709\u8bbe\u7f6e\uff0c\u5e38\u7528\u7684\u8bbe\u7f6e\u8bf7\u53c2\u8003",(0,s.jsx)(n.a,{href:"https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#configurations",children:"Hibernate\u6587\u6863"}),"\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u5b9a\u4e49\u4e863\u4e2a\u8bbe\u7f6e\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"hibernate.hbm2ddl.auto=update"}),"\uff1a\u8868\u793a\u81ea\u52a8\u521b\u5efa\u6570\u636e\u5e93\u7684\u8868\u7ed3\u6784\uff0c\u6ce8\u610f\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u542f\u7528\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"hibernate.dialect=org.hibernate.dialect.HSQLDialect"}),"\uff1a\u6307\u793aHibernate\u4f7f\u7528\u7684\u6570\u636e\u5e93\u662fHSQLDB\u3002Hibernate\u4f7f\u7528\u4e00\u79cdHQL\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u5b83\u548cSQL\u7c7b\u4f3c\uff0c\u4f46\u771f\u6b63\u5728\u201c\u7ffb\u8bd1\u201d\u6210SQL\u65f6\uff0c\u4f1a\u6839\u636e\u8bbe\u5b9a\u7684\u6570\u636e\u5e93\u201c\u65b9\u8a00\u201d\u6765\u751f\u6210\u9488\u5bf9\u6570\u636e\u5e93\u4f18\u5316\u7684SQL\uff1b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"hibernate.show_sql=true"}),"\uff1a\u8ba9Hibernate\u6253\u5370\u6267\u884c\u7684SQL\uff0c\u8fd9\u5bf9\u4e8e\u8c03\u8bd5\u975e\u5e38\u6709\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u65b9\u4fbf\u5730\u770b\u5230Hibernate\u751f\u6210\u7684SQL\u8bed\u53e5\u662f\u5426\u7b26\u5408\u6211\u4eec\u7684\u9884\u671f\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u9664\u4e86\u8bbe\u7f6e",(0,s.jsx)(n.code,{children:"DataSource"}),"\u548c",(0,s.jsx)(n.code,{children:"Properties"}),"\u4e4b\u5916\uff0c\u6ce8\u610f\u5230",(0,s.jsx)(n.code,{children:"setPackagesToScan()"}),"\u6211\u4eec\u4f20\u5165\u4e86\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"package"}),"\u540d\u79f0\uff0c\u5b83\u6307\u793aHibernate\u626b\u63cf\u8fd9\u4e2a\u5305\u4e0b\u9762\u7684\u6240\u6709Java\u7c7b\uff0c\u81ea\u52a8\u627e\u51fa\u80fd\u6620\u5c04\u4e3a\u6570\u636e\u5e93\u8868\u8bb0\u5f55\u7684JavaBean\u3002\u540e\u9762\u6211\u4eec\u4f1a\u4ed4\u7ec6\u8ba8\u8bba\u5982\u4f55\u7f16\u5199\u7b26\u5408Hibernate\u8981\u6c42\u7684JavaBean\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7d27\u63a5\u7740\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u521b\u5efa",(0,s.jsx)(n.code,{children:"HibernateTransactionManager"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public class AppConfig {\n    @Bean\n    PlatformTransactionManager createTxManager(@Autowired SessionFactory sessionFactory) {\n        return new HibernateTransactionManager(sessionFactory);\n    }\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HibernateTransactionManager"}),"\u662f\u914d\u5408Hibernate\u4f7f\u7528\u58f0\u660e\u5f0f\u4e8b\u52a1\u6240\u5fc5\u987b\u7684\u3002\u5230\u6b64\u4e3a\u6b62\uff0c\u6240\u6709\u7684\u914d\u7f6e\u90fd\u5b9a\u4e49\u5b8c\u6bd5\uff0c\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u5c06\u6570\u636e\u5e93\u8868\u7ed3\u6784\u6620\u5c04\u4e3aJava\u5bf9\u8c61\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u8003\u5bdf\u5982\u4e0b\u7684\u6570\u636e\u5e93\u8868\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"CREATE TABLE user\n    id BIGINT NOT NULL AUTO_INCREMENT,\n    email VARCHAR(100) NOT NULL,\n    password VARCHAR(100) NOT NULL,\n    name VARCHAR(100) NOT NULL,\n    createdAt BIGINT NOT NULL,\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `email` (`email`)\n);\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5176\u4e2d\uff0c",(0,s.jsx)(n.code,{children:"id"}),"\u662f\u81ea\u589e\u4e3b\u952e\uff0c",(0,s.jsx)(n.code,{children:"email"}),"\u3001",(0,s.jsx)(n.code,{children:"password"}),"\u3001",(0,s.jsx)(n.code,{children:"name"}),"\u662f",(0,s.jsx)(n.code,{children:"VARCHAR"}),"\u7c7b\u578b\uff0c",(0,s.jsx)(n.code,{children:"email"}),"\u5e26\u552f\u4e00\u7d22\u5f15\u4ee5\u786e\u4fdd\u552f\u4e00\u6027\uff0c",(0,s.jsx)(n.code,{children:"createdAt"}),"\u5b58\u50a8\u6574\u578b\u7c7b\u578b\u7684\u65f6\u95f4\u6233\u3002\u7528JavaBean\u8868\u793a\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public class User {\n    private Long id;\n    private String email;\n    private String password;\n    private String name;\n    private Long createdAt;\n\n    // getters and setters\n    ...\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd9\u79cd\u6620\u5c04\u5173\u7cfb\u5341\u5206\u6613\u61c2\uff0c\u4f46\u6211\u4eec\u9700\u8981\u6dfb\u52a0\u4e00\u4e9b\u6ce8\u89e3\u6765\u544a\u8bc9Hibernate\u5982\u4f55\u628a",(0,s.jsx)(n.code,{children:"User"}),"\u7c7b\u6620\u5c04\u5230\u8868\u8bb0\u5f55\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Entity\npublic class User {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(nullable = false, updatable = false)\n    public Long getId() { ... }\n\n    @Column(nullable = false, unique = true, length = 100)\n    public String getEmail() { ... }\n\n    @Column(nullable = false, length = 100)\n    public String getPassword() { ... }\n\n    @Column(nullable = false, length = 100)\n    public String getName() { ... }\n\n    @Column(nullable = false, updatable = false)\n    public Long getCreatedAt() { ... }\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u4e00\u4e2aJavaBean\u88ab\u7528\u4e8e\u6620\u5c04\uff0c\u6211\u4eec\u5c31\u6807\u8bb0\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"@Entity"}),"\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6620\u5c04\u7684\u8868\u540d\u662f",(0,s.jsx)(n.code,{children:"user"}),"\uff0c\u5982\u679c\u5b9e\u9645\u7684\u8868\u540d\u4e0d\u540c\uff0c\u4f8b\u5982\u5b9e\u9645\u8868\u540d\u662f",(0,s.jsx)(n.code,{children:"users"}),"\uff0c\u53ef\u4ee5\u8ffd\u52a0\u4e00\u4e2a",(0,s.jsx)(n.code,{children:'@Table(name="users")'}),"\u8868\u793a\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Entity\n@Table(name="users)\npublic class User {\n    ...\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6bcf\u4e2a\u5c5e\u6027\u5230\u6570\u636e\u5e93\u5217\u7684\u6620\u5c04\u7528",(0,s.jsx)(n.code,{children:"@Column()"}),"\u6807\u8bc6\uff0c",(0,s.jsx)(n.code,{children:"nullable"}),"\u6307\u793a\u5217\u662f\u5426\u5141\u8bb8\u4e3a",(0,s.jsx)(n.code,{children:"NULL"}),"\uff0c",(0,s.jsx)(n.code,{children:"updatable"}),"\u6307\u793a\u8be5\u5217\u662f\u5426\u5141\u8bb8\u88ab\u7528\u5728",(0,s.jsx)(n.code,{children:"UPDATE"}),"\u8bed\u53e5\uff0c",(0,s.jsx)(n.code,{children:"length"}),"\u6307\u793a",(0,s.jsx)(n.code,{children:"String"}),"\u7c7b\u578b\u7684\u5217\u7684\u957f\u5ea6\uff08\u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff0c\u9ed8\u8ba4\u662f",(0,s.jsx)(n.code,{children:"255"}),"\uff09\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5bf9\u4e8e\u4e3b\u952e\uff0c\u8fd8\u9700\u8981\u7528",(0,s.jsx)(n.code,{children:"@Id"}),"\u6807\u8bc6\uff0c\u81ea\u589e\u4e3b\u952e\u518d\u8ffd\u52a0\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"@GeneratedValue"}),"\uff0c\u4ee5\u4fbfHibernate\u80fd\u8bfb\u53d6\u5230\u81ea\u589e\u4e3b\u952e\u7684\u503c\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7ec6\u5fc3\u7684\u7ae5\u978b\u53ef\u80fd\u8fd8\u6ce8\u610f\u5230\uff0c\u4e3b\u952e",(0,s.jsx)(n.code,{children:"id"}),"\u5b9a\u4e49\u7684\u7c7b\u578b\u4e0d\u662f",(0,s.jsx)(n.code,{children:"long"}),"\uff0c\u800c\u662f",(0,s.jsx)(n.code,{children:"Long"}),"\u3002\u8fd9\u662f\u56e0\u4e3aHibernate\u5982\u679c\u68c0\u6d4b\u5230\u4e3b\u952e\u4e3a",(0,s.jsx)(n.code,{children:"null"}),"\uff0c\u5c31\u4e0d\u4f1a\u5728",(0,s.jsx)(n.code,{children:"INSERT"}),"\u8bed\u53e5\u4e2d\u6307\u5b9a\u4e3b\u952e\u7684\u503c\uff0c\u800c\u662f\u8fd4\u56de\u7531\u6570\u636e\u5e93\u751f\u6210\u7684\u81ea\u589e\u503c\uff0c\u5426\u5219\uff0cHibernate\u8ba4\u4e3a\u6211\u4eec\u7684\u7a0b\u5e8f\u6307\u5b9a\u4e86\u4e3b\u952e\u7684\u503c\uff0c\u4f1a\u5728",(0,s.jsx)(n.code,{children:"INSERT"}),"\u8bed\u53e5\u4e2d\u76f4\u63a5\u5217\u51fa\u3002",(0,s.jsx)(n.code,{children:"long"}),"\u578b\u5b57\u6bb5\u603b\u662f\u5177\u6709\u9ed8\u8ba4\u503c",(0,s.jsx)(n.code,{children:"0"}),"\uff0c\u56e0\u6b64\uff0c\u6bcf\u6b21\u63d2\u5165\u7684\u4e3b\u952e\u503c\u603b\u662f0\uff0c\u5bfc\u81f4\u9664\u7b2c\u4e00\u6b21\u5916\u540e\u7eed\u63d2\u5165\u90fd\u5c06\u5931\u8d25\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"createdAt"}),"\u867d\u7136\u662f\u6574\u578b\uff0c\u4f46\u6211\u4eec\u5e76\u6ca1\u6709\u4f7f\u7528",(0,s.jsx)(n.code,{children:"long"}),"\uff0c\u800c\u662f",(0,s.jsx)(n.code,{children:"Long"}),"\uff0c\u8fd9\u662f\u56e0\u4e3a\u4f7f\u7528\u57fa\u672c\u7c7b\u578b\u4f1a\u5bfc\u81f4findByExample\u67e5\u8be2\u4f1a\u6dfb\u52a0\u610f\u5916\u7684\u6761\u4ef6\uff0c\u8fd9\u91cc\u53ea\u9700\u7262\u8bb0\uff0c\u4f5c\u4e3a\u6620\u5c04\u4f7f\u7528\u7684JavaBean\uff0c\u6240\u6709\u5c5e\u6027\u90fd\u4f7f\u7528\u5305\u88c5\u7c7b\u578b\u800c\u4e0d\u662f\u57fa\u672c\u7c7b\u578b\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528Hibernate\u65f6\uff0c\u4e0d\u8981\u4f7f\u7528\u57fa\u672c\u7c7b\u578b\u7684\u5c5e\u6027\uff0c\u603b\u662f\u4f7f\u7528\u5305\u88c5\u7c7b\u578b\uff0c\u5982Long\u6216Integer\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u7c7b\u4f3c\u7684\uff0c\u6211\u4eec\u518d\u5b9a\u4e49\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"Book"}),"\u7c7b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Entity\npublic class Book {\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(nullable = false, updatable = false)\n    public Long getId() { ... }\n\n    @Column(nullable = false, length = 100)\n    public String getTitle() { ... }\n\n    @Column(nullable = false, updatable = false)\n    public Long getCreatedAt() { ... }\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u4ed4\u7ec6\u89c2\u5bdf",(0,s.jsx)(n.code,{children:"User"}),"\u548c",(0,s.jsx)(n.code,{children:"Book"}),"\uff0c\u4f1a\u53d1\u73b0\u5b83\u4eec\u5b9a\u4e49\u7684",(0,s.jsx)(n.code,{children:"id"}),"\u3001",(0,s.jsx)(n.code,{children:"createdAt"}),"\u5c5e\u6027\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u5728\u6570\u636e\u5e93\u8868\u7ed3\u6784\u7684\u8bbe\u8ba1\u4e2d\u5f88\u5e38\u89c1\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u8868\uff0c\u901a\u5e38\u6211\u4eec\u4f1a\u7edf\u4e00\u4f7f\u7528\u4e00\u79cd\u4e3b\u952e\u751f\u6210\u673a\u5236\uff0c\u5e76\u6dfb\u52a0",(0,s.jsx)(n.code,{children:"createdAt"}),"\u8868\u793a\u521b\u5efa\u65f6\u95f4\uff0c",(0,s.jsx)(n.code,{children:"updatedAt"}),"\u8868\u793a\u4fee\u6539\u65f6\u95f4\u7b49\u901a\u7528\u5b57\u6bb5\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0d\u5fc5\u5728",(0,s.jsx)(n.code,{children:"User"}),"\u548c",(0,s.jsx)(n.code,{children:"Book"}),"\u4e2d\u91cd\u590d\u5b9a\u4e49\u8fd9\u4e9b\u901a\u7528\u5b57\u6bb5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec\u63d0\u5230\u4e00\u4e2a\u62bd\u8c61\u7c7b\u4e2d\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@MappedSuperclass\npublic abstract class AbstractEntity {\n\n    private Long id;\n    private Long createdAt;\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    @Column(nullable = false, updatable = false)\n    public Long getId() { ... }\n\n    @Column(nullable = false, updatable = false)\n    public Long getCreatedAt() { ... }\n\n    @Transient\n    public ZonedDateTime getCreatedDateTime() {\n        return Instant.ofEpochMilli(this.createdAt).atZone(ZoneId.systemDefault());\n    }\n\n    @PrePersist\n    public void preInsert() {\n        setCreatedAt(System.currentTimeMillis());\n    }\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5bf9\u4e8e",(0,s.jsx)(n.code,{children:"AbstractEntity"}),"\u6765\u8bf4\uff0c\u6211\u4eec\u8981\u6807\u6ce8\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"@MappedSuperclass"}),"\u8868\u793a\u5b83\u7528\u4e8e\u7ee7\u627f\u3002\u6b64\u5916\uff0c\u6ce8\u610f\u5230\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"@Transient"}),"\u65b9\u6cd5\uff0c\u5b83\u8fd4\u56de\u4e00\u4e2a\u201c\u865a\u62df\u201d\u7684\u5c5e\u6027\u3002\u56e0\u4e3a",(0,s.jsx)(n.code,{children:"getCreatedDateTime()"}),"\u662f\u8ba1\u7b97\u5f97\u51fa\u7684\u5c5e\u6027\uff0c\u800c\u4e0d\u662f\u4ece\u6570\u636e\u5e93\u8868\u8bfb\u51fa\u7684\u503c\uff0c\u56e0\u6b64\u5fc5\u987b\u8981\u6807\u6ce8",(0,s.jsx)(n.code,{children:"@Transient"}),"\uff0c\u5426\u5219Hibernate\u4f1a\u5c1d\u8bd5\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u540d\u4e3a",(0,s.jsx)(n.code,{children:"createdDateTime"}),"\u8fd9\u4e2a\u4e0d\u5b58\u5728\u7684\u5b57\u6bb5\u4ece\u800c\u51fa\u9519\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u518d\u6ce8\u610f\u5230",(0,s.jsx)(n.code,{children:"@PrePersist"}),"\u6807\u8bc6\u7684\u65b9\u6cd5\uff0c\u5b83\u8868\u793a\u5728\u6211\u4eec\u5c06\u4e00\u4e2aJavaBean\u6301\u4e45\u5316\u5230\u6570\u636e\u5e93\u4e4b\u524d\uff08\u5373\u6267\u884cINSERT\u8bed\u53e5\uff09\uff0cHibernate\u4f1a\u5148\u6267\u884c\u8be5\u65b9\u6cd5\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u81ea\u52a8\u8bbe\u7f6e\u597d",(0,s.jsx)(n.code,{children:"createdAt"}),"\u5c5e\u6027\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6709\u4e86",(0,s.jsx)(n.code,{children:"AbstractEntity"}),"\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5927\u5e45\u7b80\u5316",(0,s.jsx)(n.code,{children:"User"}),"\u548c",(0,s.jsx)(n.code,{children:"Book"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Entity\npublic class User extends AbstractEntity {\n\n    @Column(nullable = false, unique = true, length = 100)\n    public String getEmail() { ... }\n\n    @Column(nullable = false, length = 100)\n    public String getPassword() { ... }\n\n    @Column(nullable = false, length = 100)\n    public String getName() { ... }\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6ce8\u610f\u5230\u4f7f\u7528\u7684\u6240\u6709\u6ce8\u89e3\u5747\u6765\u81ea",(0,s.jsx)(n.code,{children:"jakarta.persistence"}),"\uff0c\u5b83\u662fJPA\u89c4\u8303\u7684\u4e00\u90e8\u5206\u3002\u8fd9\u91cc\u6211\u4eec\u53ea\u4ecb\u7ecd\u4f7f\u7528\u6ce8\u89e3\u7684\u65b9\u5f0f\u914d\u7f6eHibernate\u6620\u5c04\u5173\u7cfb\uff0c\u4e0d\u518d\u4ecb\u7ecd\u4f20\u7edf\u7684\u6bd4\u8f83\u7e41\u7410\u7684XML\u914d\u7f6e\u3002\u901a\u8fc7Spring\u96c6\u6210Hibernate\u65f6\uff0c\u4e5f\u4e0d\u518d\u9700\u8981",(0,s.jsx)(n.code,{children:"hibernate.cfg.xml"}),"\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u4e00\u53e5\u8bdd\u603b\u7ed3\uff1a"]}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528Spring\u96c6\u6210Hibernate\uff0c\u914d\u5408JPA\u6ce8\u89e3\uff0c\u65e0\u9700\u4efb\u4f55\u989d\u5916\u7684XML\u914d\u7f6e\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u7c7b\u4f3c",(0,s.jsx)(n.code,{children:"User"}),"\u3001",(0,s.jsx)(n.code,{children:"Book"}),"\u8fd9\u6837\u7684\u7528\u4e8eORM\u7684Java Bean\uff0c\u6211\u4eec\u901a\u5e38\u79f0\u4e4b\u4e3aEntity Bean\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u6765\u770b\u770b\u5982\u679c\u5bf9",(0,s.jsx)(n.code,{children:"user"}),"\u8868\u8fdb\u884c\u589e\u5220\u6539\u67e5\u3002\u56e0\u4e3a\u4f7f\u7528\u4e86Hibernate\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u505a\u7684\uff0c\u5b9e\u9645\u4e0a\u662f\u5bf9",(0,s.jsx)(n.code,{children:"User"}),"\u8fd9\u4e2aJavaBean\u8fdb\u884c\u201c\u589e\u5220\u6539\u67e5\u201d\u3002\u6211\u4eec\u7f16\u5199\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"UserService"}),"\uff0c\u6ce8\u5165",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Component\n@Transactional\npublic class UserService {\n    @Autowired\n    SessionFactory sessionFactory;\n}\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"insert\u64cd\u4f5c",children:"Insert\u64cd\u4f5c"}),"\n",(0,s.jsxs)(n.p,{children:["\u8981\u6301\u4e45\u5316\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"User"}),"\u5b9e\u4f8b\uff0c\u6211\u4eec\u53ea\u9700\u8c03\u7528",(0,s.jsx)(n.code,{children:"persist()"}),"\u65b9\u6cd5\u3002\u4ee5",(0,s.jsx)(n.code,{children:"register()"}),"\u65b9\u6cd5\u4e3a\u4f8b\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public User register(String email, String password, String name) {\n    // \u521b\u5efa\u4e00\u4e2aUser\u5bf9\u8c61:\n    User user = new User();\n    // \u8bbe\u7f6e\u597d\u5404\u4e2a\u5c5e\u6027:\n    user.setEmail(email);\n    user.setPassword(password);\n    user.setName(name);\n    // \u4e0d\u8981\u8bbe\u7f6eid\uff0c\u56e0\u4e3a\u4f7f\u7528\u4e86\u81ea\u589e\u4e3b\u952e\n    // \u4fdd\u5b58\u5230\u6570\u636e\u5e93:\n    sessionFactory.getCurrentSession().persist(user);\n    // \u73b0\u5728\u5df2\u7ecf\u81ea\u52a8\u83b7\u5f97\u4e86id:\n    System.out.println(user.getId());\n    return user;\n}\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"delete\u64cd\u4f5c",children:"Delete\u64cd\u4f5c"}),"\n",(0,s.jsxs)(n.p,{children:["\u5220\u9664\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"User"}),"\u76f8\u5f53\u4e8e\u4ece\u8868\u4e2d\u5220\u9664\u5bf9\u5e94\u7684\u8bb0\u5f55\u3002\u6ce8\u610fHibernate\u603b\u662f\u7528",(0,s.jsx)(n.code,{children:"id"}),"\u6765\u5220\u9664\u8bb0\u5f55\uff0c\u56e0\u6b64\uff0c\u8981\u6b63\u786e\u8bbe\u7f6e",(0,s.jsx)(n.code,{children:"User"}),"\u7684",(0,s.jsx)(n.code,{children:"id"}),"\u5c5e\u6027\u624d\u80fd\u6b63\u5e38\u5220\u9664\u8bb0\u5f55\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public boolean deleteUser(Long id) {\n    User user = sessionFactory.getCurrentSession().byId(User.class).load(id);\n    if (user != null) {\n        sessionFactory.getCurrentSession().remove(user);\n        return true;\n    }\n    return false;\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u8fc7\u4e3b\u952e\u5220\u9664\u8bb0\u5f55\u65f6\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u7528\u6cd5\u662f\u5148\u6839\u636e\u4e3b\u952e\u52a0\u8f7d\u8be5\u8bb0\u5f55\uff0c\u518d\u5220\u9664\u3002\u6ce8\u610f\u5230\u5f53\u8bb0\u5f55\u4e0d\u5b58\u5728\u65f6\uff0c",(0,s.jsx)(n.code,{children:"load()"}),"\u8fd4\u56de",(0,s.jsx)(n.code,{children:"null"}),"\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"update\u64cd\u4f5c",children:"Update\u64cd\u4f5c"}),"\n",(0,s.jsxs)(n.p,{children:["\u66f4\u65b0\u8bb0\u5f55\u76f8\u5f53\u4e8e\u5148\u66f4\u65b0",(0,s.jsx)(n.code,{children:"User"}),"\u7684\u6307\u5b9a\u5c5e\u6027\uff0c\u7136\u540e\u8c03\u7528",(0,s.jsx)(n.code,{children:"merge()"}),"\u65b9\u6cd5\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public void updateUser(Long id, String name) {\n    User user = sessionFactory.getCurrentSession().byId(User.class).load(id);\n    user.setName(name);\n    sessionFactory.getCurrentSession().merge(user);\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u524d\u9762\u6211\u4eec\u5728\u5b9a\u4e49",(0,s.jsx)(n.code,{children:"User"}),"\u65f6\uff0c\u5bf9\u6709\u7684\u5c5e\u6027\u6807\u6ce8\u4e86",(0,s.jsx)(n.code,{children:"@Column(updatable=false)"}),"\u3002Hibernate\u5728\u66f4\u65b0\u8bb0\u5f55\u65f6\uff0c\u5b83\u53ea\u4f1a\u628a",(0,s.jsx)(n.code,{children:"@Column(updatable=true)"}),"\u7684\u5c5e\u6027\u52a0\u5165\u5230",(0,s.jsx)(n.code,{children:"UPDATE"}),"\u8bed\u53e5\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u4f9b\u4e00\u5c42\u989d\u5916\u7684\u5b89\u5168\u6027\uff0c\u5373\u5982\u679c\u4e0d\u5c0f\u5fc3\u4fee\u6539\u4e86",(0,s.jsx)(n.code,{children:"User"}),"\u7684",(0,s.jsx)(n.code,{children:"email"}),"\u3001",(0,s.jsx)(n.code,{children:"createdAt"}),"\u7b49\u5c5e\u6027\uff0c\u6267\u884c",(0,s.jsx)(n.code,{children:"update()"}),"\u65f6\u5e76\u4e0d\u4f1a\u66f4\u65b0\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u5217\u3002\u4f46\u4e5f\u5fc5\u987b\u7262\u8bb0\uff1a\u8fd9\u4e2a\u529f\u80fd\u662fHibernate\u63d0\u4f9b\u7684\uff0c\u5982\u679c\u7ed5\u8fc7Hibernate\u76f4\u63a5\u901a\u8fc7JDBC\u6267\u884c",(0,s.jsx)(n.code,{children:"UPDATE"}),"\u8bed\u53e5\u4ecd\u7136\u53ef\u4ee5\u66f4\u65b0\u6570\u636e\u5e93\u7684\u4efb\u610f\u5217\u7684\u503c\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u7f16\u5199\u7684\u5927\u90e8\u5206\u65b9\u6cd5\u90fd\u662f\u5404\u79cd\u5404\u6837\u7684\u67e5\u8be2\u3002\u6839\u636e",(0,s.jsx)(n.code,{children:"id"}),"\u67e5\u8be2\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528",(0,s.jsx)(n.code,{children:"load()"}),"\uff0c\u5982\u679c\u8981\u4f7f\u7528\u6761\u4ef6\u67e5\u8be2\uff0c\u4f8b\u5982\uff0c\u5047\u8bbe\u6211\u4eec\u60f3\u6267\u884c\u4ee5\u4e0b\u67e5\u8be2\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"SELECT * FROM user WHERE email = ? AND password = ?\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u6765\u770b\u770b\u53ef\u4ee5\u4f7f\u7528\u4ec0\u4e48\u67e5\u8be2\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528hql\u67e5\u8be2",children:"\u4f7f\u7528HQL\u67e5\u8be2"}),"\n",(0,s.jsx)(n.p,{children:"\u4e00\u79cd\u5e38\u7528\u7684\u67e5\u8be2\u662f\u76f4\u63a5\u7f16\u5199Hibernate\u5185\u7f6e\u7684HQL\u67e5\u8be2\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'List<User> list = sessionFactory.getCurrentSession()\n        .createQuery("from User u where u.email = ?1 and u.password = ?2", User.class)\n        .setParameter(1, email).setParameter(2, password)\n        .list();\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u548cSQL\u76f8\u6bd4\uff0cHQL\u4f7f\u7528\u7c7b\u540d\u548c\u5c5e\u6027\u540d\uff0c\u7531Hibernate\u81ea\u52a8\u8f6c\u6362\u4e3a\u5b9e\u9645\u7684\u8868\u540d\u548c\u5217\u540d\u3002\u8be6\u7ec6\u7684HQL\u8bed\u6cd5\u53ef\u4ee5\u53c2\u8003",(0,s.jsx)(n.a,{href:"https://docs.jboss.org/hibernate/orm/6.1/userguide/html_single/Hibernate_User_Guide.html#query-language",children:"Hibernate\u6587\u6863"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u9664\u4e86\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165HQL\u5b57\u7b26\u4e32\u5916\uff0cHibernate\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e00\u79cd",(0,s.jsx)(n.code,{children:"NamedQuery"}),"\uff0c\u5b83\u7ed9\u67e5\u8be2\u8d77\u4e2a\u540d\u5b57\uff0c\u7136\u540e\u4fdd\u5b58\u5728\u6ce8\u89e3\u4e2d\u3002\u4f7f\u7528",(0,s.jsx)(n.code,{children:"NamedQuery"}),"\u65f6\uff0c\u6211\u4eec\u8981\u5148\u5728",(0,s.jsx)(n.code,{children:"User"}),"\u7c7b\u6807\u6ce8\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@NamedQueries(\n    @NamedQuery(\n        // \u67e5\u8be2\u540d\u79f0:\n        name = "login",\n        // \u67e5\u8be2\u8bed\u53e5:\n        query = "SELECT u FROM User u WHERE u.email = :e AND u.password = :pwd"\n    )\n)\n@Entity\npublic class User extends AbstractEntity {\n    ...\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6ce8\u610f\u5230\u5f15\u5165\u7684",(0,s.jsx)(n.code,{children:"NamedQuery"}),"\u662f",(0,s.jsx)(n.code,{children:"jakarta.persistence.NamedQuery"}),"\uff0c\u5b83\u548c\u76f4\u63a5\u4f20\u5165HQL\u6709\u70b9\u4e0d\u540c\u7684\u662f\uff0c\u5360\u4f4d\u7b26\u4f7f\u7528",(0,s.jsx)(n.code,{children:":e"}),"\u548c",(0,s.jsx)(n.code,{children:":pwd"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528",(0,s.jsx)(n.code,{children:"NamedQuery"}),"\u53ea\u9700\u8981\u5f15\u5165\u67e5\u8be2\u540d\u548c\u53c2\u6570\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public User login(String email, String password) {\n    List<User> list = sessionFactory.getCurrentSession()\n        .createNamedQuery("login", User.class) // \u521b\u5efaNamedQuery\n        .setParameter("e", email) // \u7ed1\u5b9ae\u53c2\u6570\n        .setParameter("pwd", password) // \u7ed1\u5b9apwd\u53c2\u6570\n        .list();\n    return list.isEmpty() ? null : list.get(0);\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u76f4\u63a5\u5199HQL\u548c\u4f7f\u7528",(0,s.jsx)(n.code,{children:"NamedQuery"}),"\u5404\u6709\u4f18\u52a3\u3002\u524d\u8005\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u76f4\u89c2\u5730\u770b\u5230\u67e5\u8be2\u8bed\u53e5\uff0c\u540e\u8005\u53ef\u4ee5\u5728",(0,s.jsx)(n.code,{children:"User"}),"\u7c7b\u7edf\u4e00\u7ba1\u7406\u6240\u6709\u76f8\u5173\u67e5\u8be2\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u4e00\u8282\u6211\u4eec\u8bb2\u4e86\u5728Spring\u4e2d\u96c6\u6210Hibernate\u3002Hibernate\u662f\u7b2c\u4e00\u4e2a\u88ab\u5e7f\u6cdb\u4f7f\u7528\u7684ORM\u6846\u67b6\uff0c\u4f46\u662f\u5f88\u591a\u5c0f\u4f19\u4f34\u8fd8\u542c\u8bf4\u8fc7JPA\uff1aJava Persistence API\uff0c\u8fd9\u53c8\u662f\u5565\uff1f"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u8ba8\u8bbaJPA\u4e4b\u524d\uff0c\u6211\u4eec\u8981\u6ce8\u610f\u5230JavaEE\u65e9\u57281999\u5e74\u5c31\u53d1\u5e03\u4e86\uff0c\u5e76\u4e14\u6709Servlet\u3001JMS\u7b49\u8bf8\u591a\u6807\u51c6\u3002\u548c\u5176\u4ed6\u5e73\u53f0\u4e0d\u540c\uff0cJava\u4e16\u754c\u65e9\u671f\u975e\u5e38\u70ed\u8877\u4e8e\u6807\u51c6\u5148\u884c\uff0c\u5404\u5bb6\u8ddf\u8fdb\uff1a\u5927\u5bb6\u5148\u5750\u4e0b\u6765\u628a\u63a5\u53e3\u5b9a\u4e86\uff0c\u7136\u540e\uff0c\u5404\u81ea\u56de\u5bb6\u5e72\u6d3b\u53bb\u5b9e\u73b0\u63a5\u53e3\uff0c\u8fd9\u6837\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u5382\u5bb6\u63d0\u4f9b\u7684\u4ea7\u54c1\u8fdb\u884c\u9009\u62e9\uff0c\u8fd8\u53ef\u4ee5\u968f\u610f\u5207\u6362\uff0c\u56e0\u4e3a\u7528\u6237\u7f16\u5199\u4ee3\u7801\u7684\u65f6\u5019\u53ea\u9700\u8981\u5f15\u7528\u63a5\u53e3\uff0c\u5e76\u4e0d\u9700\u8981\u5f15\u7528\u5177\u4f53\u7684\u5e95\u5c42\u5b9e\u73b0\uff08\u60f3\u60f3JDBC\uff09\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["JPA\u5c31\u662fJavaEE\u7684\u4e00\u4e2aORM\u6807\u51c6\uff0c\u5b83\u7684\u5b9e\u73b0\u5176\u5b9e\u548cHibernate\u6ca1\u5565\u672c\u8d28\u533a\u522b\uff0c\u4f46\u662f\u7528\u6237\u5982\u679c\u4f7f\u7528JPA\uff0c\u90a3\u4e48\u5f15\u7528\u7684\u5c31\u662f",(0,s.jsx)(n.code,{children:"jakarta.persistence"}),"\u8fd9\u4e2a\u201c\u6807\u51c6\u201d\u5305\uff0c\u800c\u4e0d\u662f",(0,s.jsx)(n.code,{children:"org.hibernate"}),"\u8fd9\u6837\u7684\u7b2c\u4e09\u65b9\u5305\u3002\u56e0\u4e3aJPA\u53ea\u662f\u63a5\u53e3\uff0c\u6240\u4ee5\uff0c\u8fd8\u9700\u8981\u9009\u62e9\u4e00\u4e2a\u5b9e\u73b0\u4ea7\u54c1\uff0c\u8ddfJDBC\u63a5\u53e3\u548cMySQL\u9a71\u52a8\u4e00\u4e2a\u9053\u7406\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u4eec\u4f7f\u7528JPA\u65f6\u4e5f\u5b8c\u5168\u53ef\u4ee5\u9009\u62e9Hibernate\u4f5c\u4e3a\u5e95\u5c42\u5b9e\u73b0\uff0c\u4f46\u4e5f\u53ef\u4ee5\u9009\u62e9\u5176\u5b83\u7684JPA\u63d0\u4f9b\u65b9\uff0c\u6bd4\u5982",(0,s.jsx)(n.a,{href:"https://www.eclipse.org/eclipselink/",children:"EclipseLink"}),"\u3002Spring\u5185\u7f6e\u4e86JPA\u7684\u96c6\u6210\uff0c\u5e76\u652f\u6301\u9009\u62e9Hibernate\u6216EclipseLink\u4f5c\u4e3a\u5b9e\u73b0\u3002\u8fd9\u91cc\u6211\u4eec\u4ecd\u7136\u4ee5\u4e3b\u6d41\u7684Hibernate\u4f5c\u4e3aJPA\u5b9e\u73b0\u4e3a\u4f8b\u5b50\uff0c\u6f14\u793aJPA\u7684\u57fa\u672c\u7528\u6cd5\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u548c\u4f7f\u7528Hibernate\u4e00\u6837\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5f15\u5165\u5982\u4e0b\u4f9d\u8d56\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"org.springframework:spring-context:6.0.0"}),"\n",(0,s.jsx)(n.li,{children:"org.springframework:spring-orm:6.0.0"}),"\n",(0,s.jsxs)(n.li,{children:["jakarta.annotation",":jakarta",".annotation-api:2.1.1"]}),"\n",(0,s.jsxs)(n.li,{children:["jakarta.persistence",":jakarta",".persistence-api:3.1.0"]}),"\n",(0,s.jsx)(n.li,{children:"org.hibernate:hibernate-core:6.1.4.Final"}),"\n",(0,s.jsx)(n.li,{children:"com.zaxxer:HikariCP:5.0.1"}),"\n",(0,s.jsx)(n.li,{children:"org.hsqldb:hsqldb:2.7.1"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5b9e\u9645\u4e0a\u6211\u4eec\u8fd9\u91cc\u5f15\u5165\u7684\u4f9d\u8d56\u548c\u4e0a\u4e00\u8282\u96c6\u6210Hibernate\u5f15\u5165\u7684\u4f9d\u8d56\u5b8c\u5168\u4e00\u6837\uff0c\u56e0\u4e3aHibernate\u65e2\u63d0\u4f9b\u4e86\u5b83\u81ea\u5df1\u7684\u63a5\u53e3\uff0c\u4e5f\u63d0\u4f9b\u4e86JPA\u63a5\u53e3\uff0c\u6211\u4eec\u7528JPA\u63a5\u53e3\u5c31\u76f8\u5f53\u4e8e\u901a\u8fc7JPA\u64cd\u4f5cHibernate\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u7136\u540e\uff0c\u5728",(0,s.jsx)(n.code,{children:"AppConfig"}),"\u4e2d\u542f\u7528\u58f0\u660e\u5f0f\u4e8b\u52a1\u7ba1\u7406\uff0c\u521b\u5efa",(0,s.jsx)(n.code,{children:"DataSource"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Configuration\n@ComponentScan\n@EnableTransactionManagement\n@PropertySource("jdbc.properties")\npublic class AppConfig {\n    @Bean\n    DataSource createDataSource() { ... }\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4f7f\u7528Hibernate\u65f6\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"LocalSessionFactoryBean"}),"\uff0c\u5e76\u8ba9\u5b83\u518d\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u3002\u4f7f\u7528JPA\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u6211\u4eec\u4e5f\u521b\u5efa\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"LocalContainerEntityManagerFactoryBean"}),"\uff0c\u5e76\u8ba9\u5b83\u518d\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"EntityManagerFactory"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Bean\npublic LocalContainerEntityManagerFactoryBean createEntityManagerFactory(@Autowired DataSource dataSource) {\n    var emFactory = new LocalContainerEntityManagerFactoryBean();\n    // \u6ce8\u5165DataSource:\n    emFactory.setDataSource(dataSource);\n    // \u626b\u63cf\u6307\u5b9a\u7684package\u83b7\u53d6\u6240\u6709entity class:\n    emFactory.setPackagesToScan(AbstractEntity.class.getPackageName());\n    // \u4f7f\u7528Hibernate\u4f5c\u4e3aJPA\u5b9e\u73b0:\n    emFactory.setJpaVendorAdapter(new HibernateJpaVendorAdapter());\n    // \u5176\u4ed6\u914d\u7f6e\u9879:\n    var props = new Properties();\n    props.setProperty("hibernate.hbm2ddl.auto", "update"); // \u751f\u4ea7\u73af\u5883\u4e0d\u8981\u4f7f\u7528\n    props.setProperty("hibernate.dialect", "org.hibernate.dialect.HSQLDialect");\n    props.setProperty("hibernate.show_sql", "true");\n    emFactory.setJpaProperties(props);\n    return emFactory;\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u89c2\u5bdf\u4e0a\u8ff0\u4ee3\u7801\uff0c\u9664\u4e86\u9700\u8981\u6ce8\u5165",(0,s.jsx)(n.code,{children:"DataSource"}),"\u548c\u8bbe\u5b9a\u81ea\u52a8\u626b\u63cf\u7684",(0,s.jsx)(n.code,{children:"package"}),"\u5916\uff0c\u8fd8\u9700\u8981\u6307\u5b9aJPA\u7684\u63d0\u4f9b\u5546\uff0c\u8fd9\u91cc\u4f7f\u7528Spring\u63d0\u4f9b\u7684\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"HibernateJpaVendorAdapter"}),"\uff0c\u6700\u540e\uff0c\u9488\u5bf9Hibernate\u81ea\u5df1\u9700\u8981\u7684\u914d\u7f6e\uff0c\u4ee5",(0,s.jsx)(n.code,{children:"Properties"}),"\u7684\u5f62\u5f0f\u6ce8\u5165\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u540e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5b9e\u4f8b\u5316\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"JpaTransactionManager"}),"\uff0c\u4ee5\u5b9e\u73b0\u58f0\u660e\u5f0f\u4e8b\u52a1\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Bean\nPlatformTransactionManager createTxManager(@Autowired EntityManagerFactory entityManagerFactory) {\n    return new JpaTransactionManager(entityManagerFactory);\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e86JPA\u7684\u5168\u90e8\u521d\u59cb\u5316\u5de5\u4f5c\u3002\u6709\u4e9b\u7ae5\u978b\u53ef\u80fd\u4ece\u7f51\u4e0a\u641c\u7d22\u5f97\u77e5JPA\u9700\u8981",(0,s.jsx)(n.code,{children:"persistence.xml"}),"\u914d\u7f6e\u6587\u4ef6\uff0c\u4ee5\u53ca\u590d\u6742\u7684",(0,s.jsx)(n.code,{children:"orm.xml"}),"\u6587\u4ef6\u3002\u8fd9\u91cc\u6211\u4eec\u8d1f\u8d23\u5730\u544a\u8bc9\u5927\u5bb6\uff0c\u4f7f\u7528Spring+Hibernate\u4f5c\u4e3aJPA\u5b9e\u73b0\uff0c\u65e0\u9700\u4efb\u4f55\u914d\u7f6e\u6587\u4ef6\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6240\u6709Entity Bean\u7684\u914d\u7f6e\u548c\u4e0a\u4e00\u8282\u5b8c\u5168\u76f8\u540c\uff0c\u5168\u90e8\u91c7\u7528Annotation\u6807\u6ce8\u3002\u6211\u4eec\u73b0\u5728\u53ea\u9700\u5173\u5fc3\u5177\u4f53\u7684\u4e1a\u52a1\u7c7b\u5982\u4f55\u901a\u8fc7JPA\u63a5\u53e3\u64cd\u4f5c\u6570\u636e\u5e93\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd8\u662f\u4ee5",(0,s.jsx)(n.code,{children:"UserService"}),"\u4e3a\u4f8b\uff0c\u9664\u4e86\u6807\u6ce8",(0,s.jsx)(n.code,{children:"@Component"}),"\u548c",(0,s.jsx)(n.code,{children:"@Transactional"}),"\u5916\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u5165\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"EntityManager"}),"\uff0c\u4f46\u662f\u4e0d\u8981\u4f7f\u7528",(0,s.jsx)(n.code,{children:"Autowired"}),"\uff0c\u800c\u662f",(0,s.jsx)(n.code,{children:"@PersistenceContext"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Component\n@Transactional\npublic class UserService {\n    @PersistenceContext\n    EntityManager em;\n}\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u56de\u987e\u4e00\u4e0bJDBC\u3001Hibernate\u548cJPA\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u5b9e\u9645\u4e0a\uff0c\u5b83\u4eec\u7684\u5173\u7cfb\u5982\u4e0b\uff1a"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"JDBC"}),(0,s.jsx)(n.th,{children:"Hibernate"}),(0,s.jsx)(n.th,{children:"JPA"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DataSource"}),(0,s.jsx)(n.td,{children:"SessionFactory"}),(0,s.jsx)(n.td,{children:"EntityManagerFactory"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Connection"}),(0,s.jsx)(n.td,{children:"Session"}),(0,s.jsx)(n.td,{children:"EntityManager"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u548c",(0,s.jsx)(n.code,{children:"EntityManagerFactory"}),"\u76f8\u5f53\u4e8e",(0,s.jsx)(n.code,{children:"DataSource"}),"\uff0c",(0,s.jsx)(n.code,{children:"Session"}),"\u548c",(0,s.jsx)(n.code,{children:"EntityManager"}),"\u76f8\u5f53\u4e8e",(0,s.jsx)(n.code,{children:"Connection"}),"\u3002\u6bcf\u6b21\u9700\u8981\u8bbf\u95ee\u6570\u636e\u5e93\u7684\u65f6\u5019\uff0c\u9700\u8981\u83b7\u53d6\u65b0\u7684",(0,s.jsx)(n.code,{children:"Session"}),"\u548c",(0,s.jsx)(n.code,{children:"EntityManager"}),"\uff0c\u7528\u5b8c\u540e\u518d\u5173\u95ed\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4f46\u662f\uff0c\u6ce8\u610f\u5230",(0,s.jsx)(n.code,{children:"UserService"}),"\u6ce8\u5165\u7684\u4e0d\u662f",(0,s.jsx)(n.code,{children:"EntityManagerFactory"}),"\uff0c\u800c\u662f",(0,s.jsx)(n.code,{children:"EntityManager"}),"\uff0c\u5e76\u4e14\u6807\u6ce8\u4e86",(0,s.jsx)(n.code,{children:"@PersistenceContext"}),"\u3002\u96be\u9053\u4f7f\u7528JPA\u53ef\u4ee5\u5141\u8bb8\u591a\u7ebf\u7a0b\u64cd\u4f5c\u540c\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"EntityManager"}),"\uff1f"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5b9e\u9645\u4e0a\u8fd9\u91cc\u6ce8\u5165\u7684\u5e76\u4e0d\u662f\u771f\u6b63\u7684",(0,s.jsx)(n.code,{children:"EntityManager"}),"\uff0c\u800c\u662f\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"EntityManager"}),"\u7684\u4ee3\u7406\u7c7b\uff0c\u76f8\u5f53\u4e8e\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public class EntityManagerProxy implements EntityManager {\n    private EntityManagerFactory emf;\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Spring\u9047\u5230\u6807\u6ce8\u4e86",(0,s.jsx)(n.code,{children:"@PersistenceContext"}),"\u7684",(0,s.jsx)(n.code,{children:"EntityManager"}),"\u4f1a\u81ea\u52a8\u6ce8\u5165\u4ee3\u7406\uff0c\u8be5\u4ee3\u7406\u4f1a\u5728\u5fc5\u8981\u7684\u65f6\u5019\u81ea\u52a8\u6253\u5f00",(0,s.jsx)(n.code,{children:"EntityManager"}),"\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u591a\u7ebf\u7a0b\u5f15\u7528\u7684",(0,s.jsx)(n.code,{children:"EntityManager"}),"\u867d\u7136\u662f\u540c\u4e00\u4e2a\u4ee3\u7406\u7c7b\uff0c\u4f46\u8be5\u4ee3\u7406\u7c7b\u5185\u90e8\u9488\u5bf9\u4e0d\u540c\u7ebf\u7a0b\u4f1a\u521b\u5efa\u4e0d\u540c\u7684",(0,s.jsx)(n.code,{children:"EntityManager"}),"\u5b9e\u4f8b\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff0c\u6807\u6ce8\u4e86",(0,s.jsx)(n.code,{children:"@PersistenceContext"}),"\u7684",(0,s.jsx)(n.code,{children:"EntityManager"}),"\u53ef\u4ee5\u88ab\u591a\u7ebf\u7a0b\u5b89\u5168\u5730\u5171\u4eab\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u56e0\u6b64\uff0c\u5728",(0,s.jsx)(n.code,{children:"UserService"}),"\u7684\u6bcf\u4e2a\u4e1a\u52a1\u65b9\u6cd5\u91cc\uff0c\u76f4\u63a5\u4f7f\u7528",(0,s.jsx)(n.code,{children:"EntityManager"}),"\u5c31\u5f88\u65b9\u4fbf\u3002\u4ee5\u4e3b\u952e\u67e5\u8be2\u4e3a\u4f8b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public User getUserById(long id) {\n    User user = this.em.find(User.class, id);\n    if (user == null) {\n        throw new RuntimeException("User not found by id: " + id);\n    }\n    return user;\n}\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0eHQL\u67e5\u8be2\u7c7b\u4f3c\uff0cJPA\u4f7f\u7528JPQL\u67e5\u8be2\uff0c\u5b83\u7684\u8bed\u6cd5\u548cHQL\u57fa\u672c\u5dee\u4e0d\u591a\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public User fetchUserByEmail(String email) {\n    // JPQL\u67e5\u8be2:\n    TypedQuery<User> query = em.createQuery("SELECT u FROM User u WHERE u.email = :e", User.class);\n    query.setParameter("e", email);\n    List<User> list = query.getResultList();\n    if (list.isEmpty()) {\n        return null;\n    }\n    return list.get(0);\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u540c\u6837\u7684\uff0cJPA\u4e5f\u652f\u6301",(0,s.jsx)(n.code,{children:"NamedQuery"}),"\uff0c\u5373\u5148\u7ed9\u67e5\u8be2\u8d77\u4e2a\u540d\u5b57\uff0c\u518d\u6309\u540d\u5b57\u521b\u5efa\u67e5\u8be2\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public User login(String email, String password) {\n    TypedQuery<User> query = em.createNamedQuery("login", User.class);\n    query.setParameter("e", email);\n    query.setParameter("pwd", password);\n    List<User> list = query.getResultList();\n    return list.isEmpty() ? null : list.get(0);\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"NamedQuery"}),"\u901a\u8fc7\u6ce8\u89e3\u6807\u6ce8\u5728",(0,s.jsx)(n.code,{children:"User"}),"\u7c7b\u4e0a\uff0c\u5b83\u7684\u5b9a\u4e49\u548c\u4e0a\u4e00\u8282\u7684",(0,s.jsx)(n.code,{children:"User"}),"\u7c7b\u4e00\u6837\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@NamedQueries(\n    @NamedQuery(\n        name = "login",\n        query = "SELECT u FROM User u WHERE u.email=:e AND u.password=:pwd"\n    )\n)\n@Entity\npublic class User {\n    ...\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u589e\u5220\u6539\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5206\u522b\u4f7f\u7528",(0,s.jsx)(n.code,{children:"persist()"}),"\u3001",(0,s.jsx)(n.code,{children:"remove()"}),"\u548c",(0,s.jsx)(n.code,{children:"merge()"}),"\u65b9\u6cd5\uff0c\u53c2\u6570\u5747\u4e3aEntity Bean\u672c\u8eab\uff0c\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u91cc\u4e0d\u518d\u591a\u8ff0\u3002"]}),"\n",(0,s.jsx)(n.h4,{id:"\u96c6\u6210mybatis",children:"\u96c6\u6210MyBatis"}),"\n",(0,s.jsx)(n.p,{children:"\u6700\u540e\u66f4\u65b0: 2022/11/16 21:07 / \u9605\u8bfb: 601258"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528Hibernate\u6216JPA\u64cd\u4f5c\u6570\u636e\u5e93\u65f6\uff0c\u8fd9\u7c7bORM\u5e72\u7684\u4e3b\u8981\u5de5\u4f5c\u5c31\u662f\u628aResultSet\u7684\u6bcf\u4e00\u884c\u53d8\u6210Java Bean\uff0c\u6216\u8005\u628aJava Bean\u81ea\u52a8\u8f6c\u6362\u5230INSERT\u6216UPDATE\u8bed\u53e5\u7684\u53c2\u6570\u4e2d\uff0c\u4ece\u800c\u5b9e\u73b0ORM\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u800cORM\u6846\u67b6\u4e4b\u6240\u4ee5\u77e5\u9053\u5982\u4f55\u628a\u884c\u6570\u636e\u6620\u5c04\u5230Java Bean\uff0c\u662f\u56e0\u4e3a\u6211\u4eec\u5728Java Bean\u7684\u5c5e\u6027\u4e0a\u7ed9\u4e86\u8db3\u591f\u7684\u6ce8\u89e3\u4f5c\u4e3a\u5143\u6570\u636e\uff0cORM\u6846\u67b6\u83b7\u53d6Java Bean\u7684\u6ce8\u89e3\u540e\uff0c\u5c31\u77e5\u9053\u5982\u4f55\u8fdb\u884c\u53cc\u5411\u6620\u5c04\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u90a3\u4e48\uff0cORM\u6846\u67b6\u662f\u5982\u4f55\u8ddf\u8e2aJava Bean\u7684\u4fee\u6539\uff0c\u4ee5\u4fbf\u5728",(0,s.jsx)(n.code,{children:"update()"}),"\u64cd\u4f5c\u4e2d\u66f4\u65b0\u5fc5\u8981\u7684\u5c5e\u6027\uff1f"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7b54\u6848\u662f\u4f7f\u7528",(0,s.jsx)(n.a,{href:"https://www.liaoxuefeng.com/wiki/1252599548343744/1281319432618017",children:"Proxy\u6a21\u5f0f"}),"\uff0c\u4eceORM\u6846\u67b6\u8bfb\u53d6\u7684User\u5b9e\u4f8b\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662fUser\u7c7b\uff0c\u800c\u662f\u4ee3\u7406\u7c7b\uff0c\u4ee3\u7406\u7c7b\u7ee7\u627f\u81eaUser\u7c7b\uff0c\u4f46\u9488\u5bf9\u6bcf\u4e2asetter\u65b9\u6cd5\u505a\u4e86\u8986\u5199\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public class UserProxy extends User {\n    boolean _isNameChanged;\n\n    public void setName(String name) {\n        super.setName(name);\n        _isNameChanged = true;\n    }\n}\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u6837\uff0c\u4ee3\u7406\u7c7b\u53ef\u4ee5\u8ddf\u8e2a\u5230\u6bcf\u4e2a\u5c5e\u6027\u7684\u53d8\u5316\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9488\u5bf9\u4e00\u5bf9\u591a\u6216\u591a\u5bf9\u4e00\u5173\u7cfb\u65f6\uff0c\u4ee3\u7406\u7c7b\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7getter\u65b9\u6cd5\u67e5\u8be2\u6570\u636e\u5e93\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public class UserProxy extends User {\n    Session _session;\n    boolean _isNameChanged;\n\n    public void setName(String name) {\n        super.setName(name);\n        _isNameChanged = true;\n    }\n\n    /**\n     * \u83b7\u53d6User\u5bf9\u8c61\u5173\u8054\u7684Address\u5bf9\u8c61:\n     */\n    public Address getAddress() {\n        Query q = _session.createQuery("from Address where userId = :userId");\n        q.setParameter("userId", this.getId());\n        List<Address> list = query.list();\n        return list.isEmpty() ? null : list(0);\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u6837\u7684\u67e5\u8be2\uff0cUserProxy\u5fc5\u987b\u4fdd\u5b58Hibernate\u7684\u5f53\u524dSession\u3002\u4f46\u662f\uff0c\u5f53\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0cSession\u81ea\u52a8\u5173\u95ed\uff0c\u6b64\u65f6\u518d\u83b7\u53d6",(0,s.jsx)(n.code,{children:"getAddress()"}),"\u5c06\u65e0\u6cd5\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u6216\u8005\u83b7\u53d6\u7684\u4e0d\u662f\u4e8b\u52a1\u4e00\u81f4\u7684\u6570\u636e\u3002\u56e0\u6b64\uff0cORM\u6846\u67b6\u603b\u662f\u5f15\u5165\u4e86Attached/Detached\u72b6\u6001\uff0c\u8868\u793a\u5f53\u524d\u6b64Java Bean\u5230\u5e95\u662f\u5728Session\u7684\u8303\u56f4\u5185\uff0c\u8fd8\u662f\u8131\u79bb\u4e86Session\u53d8\u6210\u4e86\u4e00\u4e2a\u201c\u6e38\u79bb\u201d\u5bf9\u8c61\u3002\u5f88\u591a\u521d\u5b66\u8005\u65e0\u6cd5\u6b63\u786e\u7406\u89e3\u72b6\u6001\u53d8\u5316\u548c\u4e8b\u52a1\u8fb9\u754c\uff0c\u5c31\u4f1a\u9020\u6210\u5927\u91cf\u7684",(0,s.jsx)(n.code,{children:"PersistentObjectException"}),"\u5f02\u5e38\u3002\u8fd9\u79cd\u9690\u5f0f\u72b6\u6001\u4f7f\u5f97\u666e\u901aJava Bean\u7684\u751f\u547d\u5468\u671f\u53d8\u5f97\u590d\u6742\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u5916\uff0cHibernate\u548cJPA\u4e3a\u4e86\u5b9e\u73b0\u517c\u5bb9\u591a\u79cd\u6570\u636e\u5e93\uff0c\u5b83\u4f7f\u7528HQL\u6216JPQL\u67e5\u8be2\uff0c\u7ecf\u8fc7\u4e00\u9053\u8f6c\u6362\uff0c\u53d8\u6210\u7279\u5b9a\u6570\u636e\u5e93\u7684SQL\uff0c\u7406\u8bba\u4e0a\u8fd9\u6837\u53ef\u4ee5\u505a\u5230\u65e0\u7f1d\u5207\u6362\u6570\u636e\u5e93\uff0c\u4f46\u8fd9\u4e00\u5c42\u81ea\u52a8\u8f6c\u6362\u9664\u4e86\u5c11\u8bb8\u7684\u6027\u80fd\u5f00\u9500\u5916\uff0c\u7ed9SQL\u7ea7\u522b\u7684\u4f18\u5316\u5e26\u6765\u4e86\u9ebb\u70e6\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6700\u540e\uff0cORM\u6846\u67b6\u901a\u5e38\u63d0\u4f9b\u4e86\u7f13\u5b58\uff0c\u5e76\u4e14\u8fd8\u5206\u4e3a\u4e00\u7ea7\u7f13\u5b58\u548c\u4e8c\u7ea7\u7f13\u5b58\u3002\u4e00\u7ea7\u7f13\u5b58\u662f\u6307\u5728\u4e00\u4e2aSession\u8303\u56f4\u5185\u7684\u7f13\u5b58\uff0c\u5e38\u89c1\u7684\u60c5\u666f\u662f\u6839\u636e\u4e3b\u952e\u67e5\u8be2\u65f6\uff0c\u4e24\u6b21\u67e5\u8be2\u53ef\u4ee5\u8fd4\u56de\u540c\u4e00\u5b9e\u4f8b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"User user1 = session.load(User.class, 123);\nUser user2 = session.load(User.class, 123);\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e8c\u7ea7\u7f13\u5b58\u662f\u6307\u8de8Session\u7684\u7f13\u5b58\uff0c\u4e00\u822c\u9ed8\u8ba4\u5173\u95ed\uff0c\u9700\u8981\u624b\u52a8\u914d\u7f6e\u3002\u4e8c\u7ea7\u7f13\u5b58\u6781\u5927\u7684\u589e\u52a0\u4e86\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u6027\uff0c\u539f\u56e0\u5728\u4e8eSQL\u975e\u5e38\u7075\u6d3b\uff0c\u5e38\u5e38\u4f1a\u5bfc\u81f4\u610f\u5916\u7684\u66f4\u65b0\u3002\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"// \u7ebf\u7a0b1\u8bfb\u53d6:\nUser user1 = session1.load(User.class, 123);\n...\n// \u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u7ebf\u7a0b2\u8bfb\u53d6:\nUser user2 = session2.load(User.class, 123);\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u4e8c\u7ea7\u7f13\u5b58\u751f\u6548\u7684\u65f6\u5019\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u8bfb\u53d6\u7684User\u5b9e\u4f8b\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\uff0c\u6570\u636e\u5e93\u5bf9\u5e94\u7684\u884c\u8bb0\u5f55\u5b8c\u5168\u53ef\u80fd\u88ab\u4fee\u6539\uff0c\u4f8b\u5982\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"-- \u7ed9\u8001\u7528\u6237\u589e\u52a0100\u79ef\u5206:\nUPDATE users SET bonus = bonus + 100 WHERE createdAt <= ?\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["ORM\u65e0\u6cd5\u5224\u65ad",(0,s.jsx)(n.code,{children:"id=123"}),"\u7684\u7528\u6237\u662f\u5426\u53d7\u8be5",(0,s.jsx)(n.code,{children:"UPDATE"}),"\u8bed\u53e5\u5f71\u54cd\u3002\u8003\u8651\u5230\u6570\u636e\u5e93\u901a\u5e38\u4f1a\u652f\u6301\u591a\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u6b64UPDATE\u8bed\u53e5\u53ef\u80fd\u7531\u5176\u4ed6\u8fdb\u7a0b\u6267\u884c\uff0cORM\u6846\u67b6\u5c31\u66f4\u4e0d\u77e5\u9053\u4e86\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u628a\u8fd9\u79cdORM\u6846\u67b6\u79f0\u4e4b\u4e3a\u5168\u81ea\u52a8ORM\u6846\u67b6\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5bf9\u6bd4Spring\u63d0\u4f9b\u7684JdbcTemplate\uff0c\u5b83\u548cORM\u6846\u67b6\u76f8\u6bd4\uff0c\u4e3b\u8981\u6709\u51e0\u70b9\u5dee\u522b\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u67e5\u8be2\u540e\u9700\u8981\u624b\u52a8\u63d0\u4f9bMapper\u5b9e\u4f8b\u4ee5\u4fbf\u628aResultSet\u7684\u6bcf\u4e00\u884c\u53d8\u4e3aJava\u5bf9\u8c61\uff1b"}),"\n",(0,s.jsx)(n.li,{children:"\u589e\u5220\u6539\u64cd\u4f5c\u6240\u9700\u7684\u53c2\u6570\u5217\u8868\uff0c\u9700\u8981\u624b\u52a8\u4f20\u5165\uff0c\u5373\u628aUser\u5b9e\u4f8b\u53d8\u4e3a[user.id, user.name, user.email]\u8fd9\u6837\u7684\u5217\u8868\uff0c\u6bd4\u8f83\u9ebb\u70e6\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4f46\u662fJdbcTemplate\u7684\u4f18\u52bf\u5728\u4e8e\u5b83\u7684\u786e\u5b9a\u6027\uff1a\u5373\u6bcf\u6b21\u8bfb\u53d6\u64cd\u4f5c\u4e00\u5b9a\u662f\u6570\u636e\u5e93\u64cd\u4f5c\u800c\u4e0d\u662f\u7f13\u5b58\uff0c\u6240\u6267\u884c\u7684SQL\u662f\u5b8c\u5168\u786e\u5b9a\u7684\uff0c\u7f3a\u70b9\u5c31\u662f\u4ee3\u7801\u6bd4\u8f83\u7e41\u7410\uff0c\u6784\u9020",(0,s.jsx)(n.code,{children:"INSERT INTO users VALUES (?,?,?)"}),"\u66f4\u662f\u590d\u6742\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u4ee5\uff0c\u4ecb\u4e8e\u5168\u81ea\u52a8ORM\u5982Hibernate\u548c\u624b\u5199\u5168\u90e8\u5982JdbcTemplate\u4e4b\u95f4\uff0c\u8fd8\u6709\u4e00\u79cd\u534a\u81ea\u52a8\u7684ORM\uff0c\u5b83\u53ea\u8d1f\u8d23\u628aResultSet\u81ea\u52a8\u6620\u5c04\u5230Java Bean\uff0c\u6216\u8005\u81ea\u52a8\u586b\u5145Java Bean\u53c2\u6570\uff0c\u4f46\u4ecd\u9700\u81ea\u5df1\u5199\u51faSQL\u3002",(0,s.jsx)(n.a,{href:"https://mybatis.org/",children:"MyBatis"}),"\u5c31\u662f\u8fd9\u6837\u4e00\u79cd\u534a\u81ea\u52a8\u5316ORM\u6846\u67b6\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u5728Spring\u4e2d\u96c6\u6210MyBatis\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9996\u5148\uff0c\u6211\u4eec\u8981\u5f15\u5165MyBatis\u672c\u8eab\uff0c\u5176\u6b21\uff0c\u7531\u4e8eSpring\u5e76\u6ca1\u6709\u50cfHibernate\u90a3\u6837\u5185\u7f6e\u5bf9MyBatis\u7684\u96c6\u6210\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u518d\u5f15\u5165MyBatis\u5b98\u65b9\u81ea\u5df1\u5f00\u53d1\u7684\u4e00\u4e2a\u4e0eSpring\u96c6\u6210\u7684\u5e93\uff1a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"org.mybatis:mybatis:3.5.11"}),"\n",(0,s.jsx)(n.li,{children:"org.mybatis:mybatis-spring:3.0.0"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u548c\u524d\u9762\u4e00\u6837\uff0c\u5148\u521b\u5efa",(0,s.jsx)(n.code,{children:"DataSource"}),"\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Configuration\n@ComponentScan\n@EnableTransactionManagement\n@PropertySource("jdbc.properties")\npublic class AppConfig {\n    @Bean\n    DataSource createDataSource() { ... }\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u518d\u56de\u987e\u4e00\u4e0bHibernate\u548cJPA\u7684",(0,s.jsx)(n.code,{children:"SessionFactory"}),"\u4e0e",(0,s.jsx)(n.code,{children:"EntityManagerFactory"}),"\uff0cMyBatis\u4e0e\u4e4b\u5bf9\u5e94\u7684\u662f",(0,s.jsx)(n.code,{children:"SqlSessionFactory"}),"\u548c",(0,s.jsx)(n.code,{children:"SqlSession"}),"\uff1a"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"JDBC"}),(0,s.jsx)(n.th,{children:"Hibernate"}),(0,s.jsx)(n.th,{children:"JPA"}),(0,s.jsx)(n.th,{children:"MyBatis"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DataSource"}),(0,s.jsx)(n.td,{children:"SessionFactory"}),(0,s.jsx)(n.td,{children:"EntityManagerFactory"}),(0,s.jsx)(n.td,{children:"SqlSessionFactory"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Connection"}),(0,s.jsx)(n.td,{children:"Session"}),(0,s.jsx)(n.td,{children:"EntityManager"}),(0,s.jsx)(n.td,{children:"SqlSession"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u89c1\uff0cORM\u7684\u8bbe\u8ba1\u5957\u8def\u90fd\u662f\u7c7b\u4f3c\u7684\u3002\u4f7f\u7528MyBatis\u7684\u6838\u5fc3\u5c31\u662f\u521b\u5efa",(0,s.jsx)(n.code,{children:"SqlSessionFactory"}),"\uff0c\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u521b\u5efa\u7684\u662f",(0,s.jsx)(n.code,{children:"SqlSessionFactoryBean"}),"\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Bean\nSqlSessionFactoryBean createSqlSessionFactoryBean(@Autowired DataSource dataSource) {\n    var sqlSessionFactoryBean = new SqlSessionFactoryBean();\n    sqlSessionFactoryBean.setDataSource(dataSource);\n    return sqlSessionFactoryBean;\n}\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u56e0\u4e3aMyBatis\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528Spring\u7ba1\u7406\u7684\u58f0\u660e\u5f0f\u4e8b\u52a1\uff0c\u56e0\u6b64\uff0c\u521b\u5efa\u4e8b\u52a1\u7ba1\u7406\u5668\u548c\u4f7f\u7528JDBC\u662f\u4e00\u6837\u7684\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@Bean\nPlatformTransactionManager createTxManager(@Autowired DataSource dataSource) {\n    return new DataSourceTransactionManager(dataSource);\n}\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u548cHibernate\u4e0d\u540c\u7684\u662f\uff0cMyBatis\u4f7f\u7528Mapper\u6765\u5b9e\u73b0\u6620\u5c04\uff0c\u800c\u4e14Mapper\u5fc5\u987b\u662f\u63a5\u53e3\u3002\u6211\u4eec\u4ee5",(0,s.jsx)(n.code,{children:"User"}),"\u7c7b\u4e3a\u4f8b\uff0c\u5728",(0,s.jsx)(n.code,{children:"User"}),"\u7c7b\u548c",(0,s.jsx)(n.code,{children:"users"}),"\u8868\u4e4b\u95f4\u6620\u5c04\u7684",(0,s.jsx)(n.code,{children:"UserMapper"}),"\u7f16\u5199\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'public interface UserMapper {\n\t@Select("SELECT * FROM users WHERE id = #{id}")\n\tUser getById(@Param("id") long id);\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6ce8\u610f\uff1a\u8fd9\u91cc\u7684Mapper\u4e0d\u662f",(0,s.jsx)(n.code,{children:"JdbcTemplate"}),"\u7684",(0,s.jsx)(n.code,{children:"RowMapper"}),"\u7684\u6982\u5ff5\uff0c\u5b83\u662f\u5b9a\u4e49\u8bbf\u95ee",(0,s.jsx)(n.code,{children:"users"}),"\u8868\u7684\u63a5\u53e3\u65b9\u6cd5\u3002\u6bd4\u5982\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"User getById(long)"}),"\u7684\u4e3b\u952e\u67e5\u8be2\u65b9\u6cd5\uff0c\u4e0d\u4ec5\u8981\u5b9a\u4e49\u63a5\u53e3\u65b9\u6cd5\u672c\u8eab\uff0c\u8fd8\u8981\u660e\u786e\u5199\u51fa\u67e5\u8be2\u7684SQL\uff0c\u8fd9\u91cc\u7528\u6ce8\u89e3",(0,s.jsx)(n.code,{children:"@Select"}),"\u6807\u8bb0\u3002SQL\u8bed\u53e5\u7684\u4efb\u4f55\u53c2\u6570\uff0c\u90fd\u4e0e\u65b9\u6cd5\u53c2\u6570\u6309\u540d\u79f0\u5bf9\u5e94\u3002\u4f8b\u5982\uff0c\u65b9\u6cd5\u53c2\u6570id\u7684\u540d\u5b57\u901a\u8fc7\u6ce8\u89e3",(0,s.jsx)(n.code,{children:"@Param()"}),"\u6807\u8bb0\u4e3a",(0,s.jsx)(n.code,{children:"id"}),"\uff0c\u5219SQL\u8bed\u53e5\u91cc\u5c06\u6765\u66ff\u6362\u7684\u5360\u4f4d\u7b26\u5c31\u662f",(0,s.jsx)(n.code,{children:"#{id}"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u6709\u591a\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48\u6bcf\u4e2a\u53c2\u6570\u547d\u540d\u540e\u76f4\u63a5\u5728SQL\u4e2d\u5199\u51fa\u5bf9\u5e94\u7684\u5360\u4f4d\u7b26\u5373\u53ef\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Select("SELECT * FROM users LIMIT #{offset}, #{maxResults}")\nList<User> getAll(@Param("offset") int offset, @Param("maxResults") int maxResults);\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u6ce8\u610f\uff1aMyBatis\u6267\u884c\u67e5\u8be2\u540e\uff0c\u5c06\u6839\u636e\u65b9\u6cd5\u7684\u8fd4\u56de\u7c7b\u578b\u81ea\u52a8\u628aResultSet\u7684\u6bcf\u4e00\u884c\u8f6c\u6362\u4e3aUser\u5b9e\u4f8b\uff0c\u8f6c\u6362\u89c4\u5219\u5f53\u7136\u662f\u6309\u5217\u540d\u548c\u5c5e\u6027\u540d\u5bf9\u5e94\u3002\u5982\u679c\u5217\u540d\u548c\u5c5e\u6027\u540d\u4e0d\u540c\uff0c\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u7f16\u5199SELECT\u8bed\u53e5\u7684\u522b\u540d\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"-- \u5217\u540d\u662fcreated_time\uff0c\u5c5e\u6027\u540d\u662fcreatedAt:\nSELECT id, name, email, created_time AS createdAt FROM users\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u6267\u884cINSERT\u8bed\u53e5\u5c31\u7a0d\u5fae\u9ebb\u70e6\u70b9\uff0c\u56e0\u4e3a\u6211\u4eec\u5e0c\u671b\u4f20\u5165User\u5b9e\u4f8b\uff0c\u56e0\u6b64\uff0c\u5b9a\u4e49\u7684\u65b9\u6cd5\u63a5\u53e3\u4e0e",(0,s.jsx)(n.code,{children:"@Insert"}),"\u6ce8\u89e3\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Insert("INSERT INTO users (email, password, name, createdAt) VALUES (#{user.email}, #{user.password}, #{user.name}, #{user.createdAt})")\nvoid insert(@Param("user") User user);\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0a\u8ff0\u65b9\u6cd5\u4f20\u5165\u7684\u53c2\u6570\u540d\u79f0\u662f",(0,s.jsx)(n.code,{children:"user"}),"\uff0c\u53c2\u6570\u7c7b\u578b\u662fUser\u7c7b\uff0c\u5728SQL\u4e2d\u5f15\u7528\u7684\u65f6\u5019\uff0c\u4ee5",(0,s.jsx)(n.code,{children:"#{obj.property}"}),"\u7684\u65b9\u5f0f\u5199\u5360\u4f4d\u7b26\u3002\u548cHibernate\u8fd9\u6837\u7684\u5168\u81ea\u52a8\u5316ORM\u76f8\u6bd4\uff0cMyBatis\u5fc5\u987b\u5199\u51fa\u5b8c\u6574\u7684INSERT\u8bed\u53e5\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c",(0,s.jsx)(n.code,{children:"users"}),"\u8868\u7684",(0,s.jsx)(n.code,{children:"id"}),"\u662f\u81ea\u589e\u4e3b\u952e\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5728SQL\u4e2d\u4e0d\u4f20\u5165",(0,s.jsx)(n.code,{children:"id"}),"\uff0c\u4f46\u5e0c\u671b\u83b7\u53d6\u63d2\u5165\u540e\u7684\u4e3b\u952e\uff0c\u9700\u8981\u518d\u52a0\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"@Options"}),"\u6ce8\u89e3\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Options(useGeneratedKeys = true, keyProperty = "id", keyColumn = "id")\n@Insert("INSERT INTO users (email, password, name, createdAt) VALUES (#{user.email}, #{user.password}, #{user.name}, #{user.createdAt})")\nvoid insert(@Param("user") User user);\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"keyProperty"}),"\u548c",(0,s.jsx)(n.code,{children:"keyColumn"}),"\u5206\u522b\u6307\u51faJavaBean\u7684\u5c5e\u6027\u548c\u6570\u636e\u5e93\u7684\u4e3b\u952e\u5217\u540d\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6267\u884c",(0,s.jsx)(n.code,{children:"UPDATE"}),"\u548c",(0,s.jsx)(n.code,{children:"DELETE"}),"\u8bed\u53e5\u76f8\u5bf9\u6bd4\u8f83\u7b80\u5355\uff0c\u6211\u4eec\u5b9a\u4e49\u65b9\u6cd5\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Update("UPDATE users SET name = #{user.name}, createdAt = #{user.createdAt} WHERE id = #{user.id}")\nvoid update(@Param("user") User user);\n\n@Delete("DELETE FROM users WHERE id = #{id}")\nvoid deleteById(@Param("id") long id);\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6709\u4e86",(0,s.jsx)(n.code,{children:"UserMapper"}),"\u63a5\u53e3\uff0c\u8fd8\u9700\u8981\u5bf9\u5e94\u7684\u5b9e\u73b0\u7c7b\u624d\u80fd\u771f\u6b63\u6267\u884c\u8fd9\u4e9b\u6570\u636e\u5e93\u64cd\u4f5c\u7684\u65b9\u6cd5\u3002\u867d\u7136\u53ef\u4ee5\u81ea\u5df1\u5199\u5b9e\u73b0\u7c7b\uff0c\u4f46\u6211\u4eec\u9664\u4e86\u7f16\u5199",(0,s.jsx)(n.code,{children:"UserMapper"}),"\u63a5\u53e3\u5916\uff0c\u8fd8\u6709",(0,s.jsx)(n.code,{children:"BookMapper"}),"\u3001",(0,s.jsx)(n.code,{children:"BonusMapper"}),"\u2026\u2026\u4e00\u4e2a\u4e00\u4e2a\u5199\u592a\u9ebb\u70e6\uff0c\u56e0\u6b64\uff0cMyBatis\u63d0\u4f9b\u4e86\u4e00\u4e2a",(0,s.jsx)(n.code,{children:"MapperFactoryBean"}),"\u6765\u81ea\u52a8\u521b\u5efa\u6240\u6709Mapper\u7684\u5b9e\u73b0\u7c7b\u3002\u53ef\u4ee5\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u6ce8\u89e3\u6765\u542f\u7528\u5b83\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@MapperScan("com.itranswarp.learnjava.mapper")\n...\u5176\u4ed6\u6ce8\u89e3...\npublic class AppConfig {\n    ...\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6709\u4e86",(0,s.jsx)(n.code,{children:"@MapperScan"}),"\uff0c\u5c31\u53ef\u4ee5\u8ba9MyBatis\u81ea\u52a8\u626b\u63cf\u6307\u5b9a\u5305\u7684\u6240\u6709Mapper\u5e76\u521b\u5efa\u5b9e\u73b0\u7c7b\u3002\u5728\u771f\u6b63\u7684\u4e1a\u52a1\u903b\u8f91\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u6ce8\u5165\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@Component\n@Transactional\npublic class UserService {\n    // \u6ce8\u5165UserMapper:\n    @Autowired\n    UserMapper userMapper;\n\n    public User getUserById(long id) {\n        // \u8c03\u7528Mapper\u65b9\u6cd5:\n        User user = userMapper.getById(id);\n        if (user == null) {\n            throw new RuntimeException("User not found by id.");\n        }\n        return user;\n    }\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u89c1\uff0c\u4e1a\u52a1\u903b\u8f91\u4e3b\u8981\u5c31\u662f\u901a\u8fc7",(0,s.jsx)(n.code,{children:"XxxMapper"}),"\u5b9a\u4e49\u7684\u6570\u636e\u5e93\u65b9\u6cd5\u6765\u8bbf\u95ee\u6570\u636e\u5e93\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"xml\u914d\u7f6e",children:"XML\u914d\u7f6e"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0a\u8ff0\u5728Spring\u4e2d\u96c6\u6210MyBatis\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7528\u5230\u6ce8\u89e3\uff0c\u5e76\u6ca1\u6709\u4efb\u4f55XML\u914d\u7f6e\u6587\u4ef6\u3002MyBatis\u4e5f\u5141\u8bb8\u4f7f\u7528XML\u914d\u7f6e\u6620\u5c04\u5173\u7cfb\u548cSQL\u8bed\u53e5\uff0c\u4f8b\u5982\uff0c\u66f4\u65b0",(0,s.jsx)(n.code,{children:"User"}),"\u65f6\u6839\u636e\u5c5e\u6027\u503c\u6784\u9020\u52a8\u6001SQL\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'<update id="updateUser">\n  UPDATE users SET\n  <set>\n    <if test="user.name != null"> name = #{user.name} </if>\n    <if test="user.hobby != null"> hobby = #{user.hobby} </if>\n    <if test="user.summary != null"> summary = #{user.summary} </if>\n  </set>\n  WHERE id = #{user.id}\n</update>\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u7f16\u5199XML\u914d\u7f6e\u7684\u4f18\u70b9\u662f\u53ef\u4ee5\u7ec4\u88c5\u51fa\u52a8\u6001SQL\uff0c\u5e76\u4e14\u628a\u6240\u6709SQL\u64cd\u4f5c\u96c6\u4e2d\u5728\u4e00\u8d77\u3002\u7f3a\u70b9\u662f\u914d\u7f6e\u8d77\u6765\u592a\u7e41\u7410\uff0c\u8c03\u7528\u65b9\u6cd5\u65f6\u5982\u679c\u60f3\u67e5\u770bSQL\u8fd8\u9700\u8981\u5b9a\u4f4d\u5230XML\u914d\u7f6e\u4e2d\u3002\u8fd9\u91cc\u6211\u4eec\u4e0d\u4ecb\u7ecdXML\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u9700\u8981\u4e86\u89e3\u7684\u7ae5\u978b\u8bf7\u81ea\u884c\u9605\u8bfb",(0,s.jsx)(n.a,{href:"https://mybatis.org/mybatis-3/zh/configuration.html",children:"\u5b98\u65b9\u6587\u6863"}),"\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528MyBatis\u6700\u5927\u7684\u95ee\u9898\u662f\u6240\u6709SQL\u90fd\u9700\u8981\u5168\u90e8\u624b\u5199\uff0c\u4f18\u70b9\u662f\u6267\u884c\u7684SQL\u5c31\u662f\u6211\u4eec\u81ea\u5df1\u5199\u7684SQL\uff0c\u5bf9SQL\u8fdb\u884c\u4f18\u5316\u975e\u5e38\u7b80\u5355\uff0c\u4e5f\u53ef\u4ee5\u7f16\u5199\u4efb\u610f\u590d\u6742\u7684SQL\uff0c\u6216\u8005\u4f7f\u7528\u6570\u636e\u5e93\u7684\u7279\u5b9a\u8bed\u6cd5\uff0c\u4f46\u5207\u6362\u6570\u636e\u5e93\u53ef\u80fd\u5c31\u4e0d\u592a\u5bb9\u6613\u3002\u597d\u6d88\u606f\u662f\u5927\u90e8\u5206\u9879\u76ee\u5e76\u6ca1\u6709\u5207\u6362\u6570\u636e\u5e93\u7684\u9700\u6c42\uff0c\u5b8c\u5168\u53ef\u4ee5\u9488\u5bf9\u67d0\u4e2a\u6570\u636e\u5e93\u7f16\u5199\u5c3d\u53ef\u80fd\u4f18\u5316\u7684SQL\u3002"}),"\n",(0,s.jsx)(n.h1,{id:"\u53c2\u8003\u6587\u7ae0",children:"\u53c2\u8003\u6587\u7ae0"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://www.w3cschool.cn/wkspring",children:"https://www.w3cschool.cn/wkspring"}),"\n",(0,s.jsx)(n.a,{href:"https://www.runoob.com/w3cnote/basic-knowledge-summary-of-spring.html",children:"https://www.runoob.com/w3cnote/basic-knowledge-summary-of-spring.html"}),"\n",(0,s.jsx)(n.a,{href:"http://codepub.cn/2015/06/21/Basic-knowledge-summary-of-Spring",children:"http://codepub.cn/2015/06/21/Basic-knowledge-summary-of-Spring"}),"\n",(0,s.jsx)(n.a,{href:"https://dunwu.github.io/spring-tutorial",children:"https://dunwu.github.io/spring-tutorial"}),"\n",(0,s.jsx)(n.a,{href:"https://mszlu.com/java/spring",children:"https://mszlu.com/java/spring"}),"\n",(0,s.jsx)(n.a,{href:"http://c.biancheng.net/spring/aop-module.html",children:"http://c.biancheng.net/spring/aop-module.html"})]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},88672:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>d});var s=r(50959);const i={},c=s.createContext(i);function d(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);