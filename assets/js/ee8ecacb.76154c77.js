"use strict";(self.webpackChunkcode_note_blog=self.webpackChunkcode_note_blog||[]).push([[9365],{21440:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>a});var i=t(11527),r=t(88672);const c={},o=void 0,s={id:"Spring\u5168\u5bb6\u6876/SpringMVC\u6e90\u7801\u5206\u6790/Spring\u5bb9\u5668\u542f\u52a8Tomcat",title:"Spring\u5bb9\u5668\u542f\u52a8Tomcat",description:"''\u5728 spring mvc \u4e4b springmvc demo \u4e0e @EnableWebMvc \u6ce8\u89e3\u4e00\u6587\u4e2d\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u793a\u4f8b demo\uff0c\u8be5 demo \u4f1a\u5148\u542f\u52a8 servlet \u5bb9\u5668\uff0c\u7136\u540e\u901a\u8fc7 servlet3.0 \u89c4\u8303\u5c06 DispatcherServlet \u6ce8\u518c\u5230 servlet \u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u5728 DispatcherServlet#init \u65b9\u6cd5\u4e2d\u542f\u52a8 spring \u5bb9\u5668\uff0c\u6574\u4e2a\u6d41\u7a0b\u5c31\u50cf\u8fd9\u6837\uff1a",source:"@site/docs/Spring\u5168\u5bb6\u6876/SpringMVC\u6e90\u7801\u5206\u6790/Spring\u5bb9\u5668\u542f\u52a8Tomcat.md",sourceDirName:"Spring\u5168\u5bb6\u6876/SpringMVC\u6e90\u7801\u5206\u6790",slug:"/Spring\u5168\u5bb6\u6876/SpringMVC\u6e90\u7801\u5206\u6790/Spring\u5bb9\u5668\u542f\u52a8Tomcat",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/SpringMVC\u6e90\u7801\u5206\u6790/Spring\u5bb9\u5668\u542f\u52a8Tomcat",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring\u5168\u5bb6\u6876/SpringMVC\u6e90\u7801\u5206\u6790/Spring\u5bb9\u5668\u542f\u52a8Tomcat.md",tags:[],version:"current",frontMatter:{},sidebar:"spring",previous:{title:"RequestMapping\u521d\u59cb\u5316\u6d41\u7a0b",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/SpringMVC\u6e90\u7801\u5206\u6790/RequestMapping\u521d\u59cb\u5316\u6d41\u7a0b"},next:{title:"SpringMVC\u7684Demo\u4e0e@EnableWebMvc\u6ce8\u89e3",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/SpringMVC\u6e90\u7801\u5206\u6790/SpringMVC\u7684Demo\u4e0e@EnableWebMvc\u6ce8\u89e3"}},l={},a=[{value:"1. \u51c6\u5907 <code>DispatcherServlet</code>",id:"1-\u51c6\u5907-dispatcherservlet",level:3},{value:"2. \u51c6\u5907\u4e00\u4e2a <code>WebApplicationInitializer</code> \u5b9e\u73b0\u7c7b",id:"2-\u51c6\u5907\u4e00\u4e2a-webapplicationinitializer-\u5b9e\u73b0\u7c7b",level:3},{value:"3. \u51c6\u5907\u4e00\u4e2a <code>ServletContextAwareProcessor</code> \u7684\u5b50\u7c7b",id:"3-\u51c6\u5907\u4e00\u4e2a-servletcontextawareprocessor-\u7684\u5b50\u7c7b",level:3},{value:"4. \u51c6\u5907\u4e00\u4e2a <code>ApplicationContext</code> \u7684\u5b9e\u73b0\u7c7b",id:"4-\u51c6\u5907\u4e00\u4e2a-applicationcontext-\u7684\u5b9e\u73b0\u7c7b",level:3},{value:"5. \u51c6\u5907\u4e00\u4e2a\u7b80\u5355\u7684 <code>Controller</code>",id:"5-\u51c6\u5907\u4e00\u4e2a\u7b80\u5355\u7684-controller",level:3},{value:"6. \u4e3b\u7c7b",id:"6-\u4e3b\u7c7b",level:3},{value:"7. \u95ee\u9898\uff1a\u542f\u52a8\u540e\uff0c<code>DispatcherServlet#init</code> \u65b9\u6cd5\u4f1a\u518d\u6b21\u542f\u52a8 spring \u5bb9\u5668\u5417\uff1f",id:"7-\u95ee\u9898\u542f\u52a8\u540edispatcherservletinit-\u65b9\u6cd5\u4f1a\u518d\u6b21\u542f\u52a8-spring-\u5bb9\u5668\u5417",level:3}];function p(e){const n={a:"a",code:"code",em:"em",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["''\u5728 ",(0,i.jsx)(n.a,{href:"https://my.oschina.net/funcy/blog/4696657",children:"spring mvc \u4e4b springmvc demo \u4e0e @EnableWebMvc \u6ce8\u89e3"}),"\u4e00\u6587\u4e2d\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u793a\u4f8b demo\uff0c\u8be5 demo \u4f1a\u5148\u542f\u52a8 servlet \u5bb9\u5668\uff0c\u7136\u540e\u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"servlet3.0"})," \u89c4\u8303\u5c06 ",(0,i.jsx)(n.code,{children:"DispatcherServlet"})," \u6ce8\u518c\u5230 ",(0,i.jsx)(n.code,{children:"servlet"})," \u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u5728 ",(0,i.jsx)(n.code,{children:"DispatcherServlet#init"})," \u65b9\u6cd5\u4e2d\u542f\u52a8 spring \u5bb9\u5668\uff0c\u6574\u4e2a\u6d41\u7a0b\u5c31\u50cf\u8fd9\u6837\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-0874fa7ef39ca9c405cdf55d99ca891ebf2.png",alt:""})}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u6ca1\u4ec0\u4e48\u95ee\u9898\uff0c\u80fd\u6b63\u5e38\u542f\u52a8\u4e5f\u8fd0\u884c\u826f\u597d\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u5728 spring \u5bb9\u5668\u4e2d\u65e0\u6cd5\u83b7\u53d6 ",(0,i.jsx)(n.code,{children:"DispatcherServlet"}),"\uff0c\u50cf\u8fd9\u6837\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"@Component\npublic class Test {\n    // \u5728\u524d\u9762\u63d0\u4f9b\u7684\u793a\u4f8b\uff08tomcat\u91cc\u542f\u52a8spring\u5bb9\u5668\uff09\u662f\u6ce8\u5165\u4e0d\u4e86\u7684\n    @Autowired\n    public DispatcherServlet dispatcherServlet;\n\n    ...\n\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u542f\u52a8\u65f6\uff0cspring \u80af\u5b9a\u4f1a\u62a5\u9519\uff0c\u56e0\u4e3a\u627e\u4e0d\u5230 ",(0,i.jsx)(n.code,{children:"DispatcherServlet"})," \u5bf9\u5e94\u7684 bean\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u8fd1\u5728\u770b springboot \u6e90\u7801\u65f6\uff0c\u53d1\u73b0 spring \u5bb9\u5668\u5e76\u4e0d\u662f\u7531 tomcat \u5bb9\u5668\u542f\u52a8\u7684\uff0c\u76f8\u53cd\uff0cspringboot \u662f\u5148\u542f\u52a8 spring \u5bb9\u5668\uff0c\u7136\u540e\u7531 spring \u5bb9\u5668\u542f\u52a8 tomcat \u542f\u52a8\uff0c\u8fd9\u662f\u5982\u4f55\u505a\u5230\u7684\u5462\uff1f\u8fd9\u91cc\u672c\u4eba\u63d0\u4f9b\u4e00\u4e2a demo \u6a21\u62df\u4e0b\u3002"}),"\n",(0,i.jsxs)(n.h3,{id:"1-\u51c6\u5907-dispatcherservlet",children:["1. \u51c6\u5907 ",(0,i.jsx)(n.code,{children:"DispatcherServlet"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'@Component\n@EnableWebMvc\npublic class MvcConfig implements WebMvcConfigurer {\n\n    @Override\n    public void configureViewResolvers(ViewResolverRegistry registry) {\n        InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();\n        viewResolver.setPrefix("/WEB-INF/views/");\n        viewResolver.setSuffix(".html");\n        registry.viewResolver(viewResolver);\n    }\n\n    /**\n     * dispatcherServlet\n     * @param webApplicationContext\n     * @return\n     */\n    @Bean\n    public DispatcherServlet dispatcherServlet(WebApplicationContext webApplicationContext) {\n        return new DispatcherServlet(webApplicationContext);\n    }\n\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u8be5\u7c7b\u8bf4\u660e\u5982\u4e0b\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MvcConfig"})," \u7c7b\u88ab ",(0,i.jsx)(n.code,{children:"@EnableWebMvc"})," \u6ce8\u89e3\u6807\u8bb0\uff0c\u8868\u793a\u9700\u8981\u542f\u52a8\u7528 ",(0,i.jsx)(n.code,{children:"web mvc"})," \u529f\u80fd"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MvcConfig"})," \u5b9e\u73b0\u4e86 ",(0,i.jsx)(n.code,{children:"WebMvcConfigurer"}),"\uff0c\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199 ",(0,i.jsx)(n.code,{children:"WebMvcConfigurer"})," \u7684\u65b9\u6cd5\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49 ",(0,i.jsx)(n.code,{children:"web mvc"})," \u7684\u914d\u7f6e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MvcConfig"})," \u4e2d\u4f1a\u751f\u6210 ",(0,i.jsx)(n.code,{children:"DispatcherServlet"})," bean\uff0c\u8be5 bean \u4f1a\u4fdd\u5b58\u5230 spring \u5bb9\u5668\u4e2d"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"2-\u51c6\u5907\u4e00\u4e2a-webapplicationinitializer-\u5b9e\u73b0\u7c7b",children:["2. \u51c6\u5907\u4e00\u4e2a ",(0,i.jsx)(n.code,{children:"WebApplicationInitializer"})," \u5b9e\u73b0\u7c7b"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'@Component\npublic class MyWebApplicationInitializer implements WebApplicationInitializer {\n\n    private static BeanFactory beanFactory;\n\n    private static AbstractRefreshableWebApplicationContext applicationContext;\n\n    @Override\n    public void onStartup(ServletContext servletContext) {\n        // \u4ece beanFactory \u4e2d\u83b7\u53d6 DispatcherServlet \u5e76\u6ce8\u518c\u5230servlet\u5bb9\u5668\n        DispatcherServlet servlet = beanFactory.getBean(DispatcherServlet.class);\n        ServletRegistration.Dynamic registration = servletContext.addServlet("app", servlet);\n        // loadOnStartup \u8bbe\u7f6e\u6210 -1 \u65f6\uff0c\u53ea\u6709\u5728\u7b2c\u4e00\u6b21\u8bf7\u6c42\u65f6\uff0c\u624d\u4f1a\u8c03\u7528 init \u65b9\u6cd5\n        registration.setLoadOnStartup(-1);\n        registration.addMapping("/*");\n\n        // \u4e3a applicationContext \u8bbe\u7f6e servletContext\n        applicationContext.setServletContext(servletContext);\n    }\n\n    /**\n     * \u8bbe\u7f6e beanFactory\n     * \u4e3a\u4ec0\u4e48\u8981\u8bbe\u7f6e beanFactory\u7684\u503c\uff1f\u56e0\u4e3a DispatcherServlet \u8981\u4ece beanFactory \u4e2d\u83b7\u53d6\n     * @param beanFactory\n     * @throws BeansException\n     */\n    public static void setBeanFactory(BeanFactory beanFactory) throws BeansException {\n        MyWebApplicationInitializer.beanFactory = beanFactory;\n    }\n\n    /**\n     * \u8bbe\u7f6e applicationContext\n     * \u4e3a\u4ec0\u4e48\u8981\u8bbe\u7f6e applicationContext \u7684\u503c\uff1f\u56e0\u4e3a servletContext \u8981\u8bbe\u7f6e\u5230 applicationContext\n     * @param applicationContext\n     */\n    public static void setApplicationContext(\n                AbstractRefreshableWebApplicationContext applicationContext) {\n        MyWebApplicationInitializer.applicationContext = applicationContext;\n    }\n}\n\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"WebApplicationInitializer"})," \u662f spring \u5bf9 servlet 3.0 \u89c4\u8303\u7684\u5b9e\u73b0\uff0c\u5728 ",(0,i.jsx)(n.a,{href:"https://my.oschina.net/funcy/blog/4696657",children:"spring mvc \u4e4b springmvc demo \u4e0e @EnableWebMvc \u6ce8\u89e3"}),"\u4e00\u6587\u4e5f\u8be6\u7ec6\u5206\u6790\u8fc7\uff0ctomcat \u5728\u542f\u52a8\u65f6\uff0c\u4f1a\u6267\u884c ",(0,i.jsx)(n.code,{children:"WebApplicationInitializer#onStartup"})," \u65b9\u6cd5\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9 ",(0,i.jsx)(n.code,{children:"MyWebApplicationInitializer"})," \u8bf4\u660e\u5982\u4e0b:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MyWebApplicationInitializer"})," \u4e2d\u6709\u4e24\u4e2a\u9759\u6001\u6210\u5458\u53d8\u91cf\uff1a",(0,i.jsx)(n.code,{children:"beanFactory"})," \u4e0e ",(0,i.jsx)(n.code,{children:"applicationContext"}),"\uff0c\u5bf9\u5e94\u5730\u63d0\u4f9b\u4e86\u4e24\u4e2a\u9759\u6001 ",(0,i.jsx)(n.code,{children:"set"})," \u65b9\u6cd5\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e24\u4e2a\u9759\u6001 ",(0,i.jsx)(n.code,{children:"set"})," \u65b9\u6cd5\u8981\u5728 ",(0,i.jsx)(n.code,{children:"onStartup()"})," \u65b9\u6cd5\u524d\u8c03\u7528\uff0c\u4e5f\u5c31\u662f tomcat \u542f\u52a8\u524d\u8c03\u7528\u8c03\u7528\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"MyWebApplicationInitializer#onStartup"})," \u65b9\u6cd5\u4e2d\uff0c\u6211\u4eec\u5148\u662f\u4ece ",(0,i.jsx)(n.code,{children:"beanFactory"})," \u4e2d\u83b7\u53d6\u4e86 ",(0,i.jsx)(n.code,{children:"DispatcherServlet"}),"\uff0c\u7136\u540e\u5c06\u5176\u6ce8\u518c\u5230 ",(0,i.jsx)(n.code,{children:"servlet"})," \u5bb9\u5668\u4e2d\uff0c\u7136\u540e\u5c06 ",(0,i.jsx)(n.code,{children:"onStartup(...)"})," \u65b9\u6cd5\u7684\u53c2\u6570 ",(0,i.jsx)(n.code,{children:"servletContext"})," \u8bbe\u7f6e\u5230 ",(0,i.jsx)(n.code,{children:"applicationContext"})," \u4e2d"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"3-\u51c6\u5907\u4e00\u4e2a-servletcontextawareprocessor-\u7684\u5b50\u7c7b",children:["3. \u51c6\u5907\u4e00\u4e2a ",(0,i.jsx)(n.code,{children:"ServletContextAwareProcessor"})," \u7684\u5b50\u7c7b"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"public class MyServletContextAwareProcessor extends ServletContextAwareProcessor {\n\n\tAbstractRefreshableWebApplicationContext webApplicationContext;\n\n\t/**\n\t * \u4f20\u5165 webApplicationContext\n\t * @param webApplicationContext\n\t */\n\tpublic MyServletContextAwareProcessor(\n                AbstractRefreshableWebApplicationContext webApplicationContext) {\n\t\tthis.webApplicationContext = webApplicationContext;\n\t}\n\n\t/**\n\t * \u8fd4\u56de ServletContext\n\t * \u5148\u4ece webApplicationContext \u4e2d\u83b7\u53d6\uff0c\u5982\u679c\u83b7\u53d6\u4e0d\u5230\uff0c\u518d\u4ece\u7236\u7c7b\u65b9\u6cd5\u4e2d\u83b7\u53d6\n\t * @return\n\t */\n\t@Override\n\tprotected ServletContext getServletContext() {\n\t\tServletContext servletContext = this.webApplicationContext.getServletContext();\n\t\treturn (servletContext != null) ? servletContext : super.getServletContext();\n\t}\n\n\t@Override\n\tprotected ServletConfig getServletConfig() {\n\t\tServletConfig servletConfig = this.webApplicationContext.getServletConfig();\n\t\treturn (servletConfig != null) ? servletConfig : super.getServletConfig();\n\t}\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"MyWebApplicationInitializer#onStartup"})," \u65b9\u6cd5\u4e2d\u5bf9 ",(0,i.jsx)(n.code,{children:"applicationContext"})," \u8bbe\u7f6e\u7684 ",(0,i.jsx)(n.code,{children:"servletContext"})," \u5c31\u662f\u5728\u8fd9\u91cc\u4f7f\u7528\u7684\uff0c",(0,i.jsx)(n.code,{children:"MyServletContextAwareProcessor"})," \u7684\u6784\u9020\u65b9\u6cd5\u4f20\u5165\u4e86 ",(0,i.jsx)(n.code,{children:"webApplicationContext"}),"\uff0c\u7136\u540e\u91cd\u5199\u4e86 ",(0,i.jsx)(n.code,{children:"getServletContext()"})," \u65b9\u6cd5\uff0c\u83b7\u53d6 ",(0,i.jsx)(n.code,{children:"servletContext"})," \u65f6\uff0c\u5148\u4ece ",(0,i.jsx)(n.code,{children:"webApplicationContext"})," \u4e2d\u83b7\u53d6\uff0c\u5982\u679c\u83b7\u53d6\u4e0d\u5230\uff0c\u518d\u4ece\u7236\u7c7b\u65b9\u6cd5\u4e2d\u83b7\u53d6\u3002"]}),"\n",(0,i.jsxs)(n.h3,{id:"4-\u51c6\u5907\u4e00\u4e2a-applicationcontext-\u7684\u5b9e\u73b0\u7c7b",children:["4. \u51c6\u5907\u4e00\u4e2a ",(0,i.jsx)(n.code,{children:"ApplicationContext"})," \u7684\u5b9e\u73b0\u7c7b"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ApplicationContext"})," \u81f3\u5173\u91cd\u8981\uff0c\u8fd9\u91cc\u6211\u4eec\u9009\u62e9\u76f4\u63a5\u6269\u5c55 ",(0,i.jsx)(n.code,{children:"AnnotationConfigWebApplicationContext"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'public class MyWebApplicationContext extends AnnotationConfigWebApplicationContext {\n\n    private Tomcat tomcat;\n\n    /**\n     * \u91cd\u5199 postProcessBeanFactory \u65b9\u6cd5\n     * \u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u6dfb\u52a0\u6211\u4eec\u81ea\u5b9a\u4e49\u7684 MyServletContextAwareProcessor\n     * @param beanFactory\n     */\n    @Override\n    protected void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {\n        beanFactory.addBeanPostProcessor(new MyServletContextAwareProcessor(this));\n        beanFactory.ignoreDependencyInterface(ServletContextAware.class);\n        WebApplicationContextUtils.registerWebApplicationScopes(getBeanFactory());\n    }\n\n    /**\n     * \u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u542f\u52a8 tomcat\n     */\n    @Override\n    protected void onRefresh() {\n        // \u5148\u8c03\u7528\u7236\u7c7b\u7684\u65b9\u6cd5\n        super.onRefresh();\n        // \u8bbe\u7f6e MyWebApplicationInitializer \u7684 beanFactory \u4e0e applicationContext\n        MyWebApplicationInitializer.setBeanFactory(getBeanFactory());\n        MyWebApplicationInitializer.setApplicationContext(this);\n\n        // tomcat\u7684\u521b\u5efa\u53ca\u542f\u52a8\n        tomcat = new Tomcat();\n        Connector connector = new Connector();\n        connector.setPort(8080);\n        connector.setURIEncoding("UTF-8");\n        tomcat.getService().addConnector(connector);\n\n        Context context = tomcat.addContext("", System.getProperty("java.io.tmpdir"));\n        LifecycleListener lifecycleListener = null;\n        try {\n            lifecycleListener = (LifecycleListener) \n                    Class.forName(tomcat.getHost().getConfigClass())\n                    .getDeclaredConstructor().newInstance();\n            context.addLifecycleListener(lifecycleListener);\n            // \u542f\u52a8tomcat\n            tomcat.start();\n        } catch (Exception e) {\n            System.out.println("\u542f\u52a8\u5f02\u5e38\uff1a");\n            e.printStackTrace();\n        }\n    }\n\n}\n\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e2a\u7c7b\u6269\u5c55\u4e86 spring \u7684\u542f\u52a8\u6d41\u7a0b\uff0c\u8fd9\u91cc\u4e00\u5171\u91cd\u5199\u4e86\u4e24\u4e2a\u65b9\u6cd5\uff0c\u8fd9\u91cc\u4e00\u4e00\u4ecb\u7ecd\u4e0b:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"postProcessBeanFactory()"}),"\uff1a\u8fd9\u4e2a\u65b9\u6cd5\u4e3b\u8981\u662f\u4e3a\u4e86\u6ce8\u518c ",(0,i.jsx)(n.code,{children:"MyServletContextAwareProcessor"}),"\uff0c\u524d\u9762\u6211\u4eec\u51c6\u5907\u7684 ",(0,i.jsx)(n.code,{children:"MyServletContextAwareProcessor"})," \u5c31\u662f\u5728\u8fd9\u91cc\u6ce8\u518c\u7684\uff0c\u4e4b\u6240\u4ee5\u91cd\u5199\uff0c\u8fd8\u662f\u4e3a\u4e86\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"tomcat"})," \u63d0\u4f9b\u7684 ",(0,i.jsx)(n.code,{children:"ServletContext"}),"\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"onRefresh()"}),"\uff1a\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\uff0c\u5148\u662f\u8bbe\u7f6e ",(0,i.jsx)(n.code,{children:"MyWebApplicationInitializer"})," \u7684 ",(0,i.jsx)(n.code,{children:"beanFactory"})," \u4e0e ",(0,i.jsx)(n.code,{children:"applicationContext"})," \u5c5e\u6027\u503c\uff0c\u7136\u540e\u542f\u52a8 ",(0,i.jsx)(n.code,{children:"tomcat"}),"\uff1b"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"5-\u51c6\u5907\u4e00\u4e2a\u7b80\u5355\u7684-controller",children:["5. \u51c6\u5907\u4e00\u4e2a\u7b80\u5355\u7684 ",(0,i.jsx)(n.code,{children:"Controller"})]}),"\n",(0,i.jsxs)(n.p,{children:["\u51c6\u5907\u4e00\u4e2a ",(0,i.jsx)(n.code,{children:"Controller"}),"\uff0c\u4e3b\u8981\u662f\u5e2e\u52a9\u6211\u4eec\u9a8c\u8bc1\u9879\u76ee\u662f\u5426\u542f\u52a8\u6b63\u5e38\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'@RestController\n@RequestMapping("/test")\npublic class TestController {\n\n    @RequestMapping("/hello")\n    public String hello() {\n        System.out.println("hello!!!");\n        return "hello world!";\n    }\n\n}\n\n'})}),"\n",(0,i.jsx)(n.h3,{id:"6-\u4e3b\u7c7b",children:"6. \u4e3b\u7c7b"}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u540e\u5c31\u662f\u4e3b\u7c7b\u4e86\uff0c\u4e3b\u8981\u662f\u5904\u7406 spring \u7684\u542f\u52a8\u64cd\u4f5c\uff0c\u4e5f\u662f\u76f8\u5f53\u7b80\u5355\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"@ComponentScan\npublic class MvcDemo03Main {\n\n    public static void main(String[] args) throws Exception {\n        MyWebApplicationContext webApplicationContext = new MyWebApplicationContext();\n        webApplicationContext.register(MvcDemo03Main.class);\n        webApplicationContext.refresh();\n    }\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd0\u884c\uff0c\u8bbf\u95ee ",(0,i.jsx)(n.code,{children:"http://localhost:8080/test/hello"}),"\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:"\u9875\u9762\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-d87b4a09e7a87e0535eb52a09759fcc6534.png",alt:""})}),"\n",(0,i.jsx)(n.p,{children:"\u63a7\u5236\u53f0\uff1a"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-c608886c751dcf595d74efb8506e5d67306.png",alt:""})}),"\n",(0,i.jsxs)(n.h3,{id:"7-\u95ee\u9898\u542f\u52a8\u540edispatcherservletinit-\u65b9\u6cd5\u4f1a\u518d\u6b21\u542f\u52a8-spring-\u5bb9\u5668\u5417",children:["7. \u95ee\u9898\uff1a\u542f\u52a8\u540e\uff0c",(0,i.jsx)(n.code,{children:"DispatcherServlet#init"})," \u65b9\u6cd5\u4f1a\u518d\u6b21\u542f\u52a8 spring \u5bb9\u5668\u5417\uff1f"]}),"\n",(0,i.jsxs)(n.p,{children:["\u524d\u9762\u6211\u4eec\u5206\u6790\u5230\uff0c\u4f7f\u7528 tomcat \u542f\u52a8 spring \u5bb9\u5668\u7684\u65b9\u5f0f\u65f6\uff0cspring \u5bb9\u5668\u662f\u5728 ",(0,i.jsx)(n.code,{children:"DispatcherServlet#init"})," \u65b9\u6cd5\u4e2d\u542f\u52a8\u7684\uff0c\u5728\u6211\u4eec\u4f7f\u7528 ",(0,i.jsx)(n.strong,{children:"spring \u5bb9\u5668\u542f\u52a8 tomcat"})," \u7684\u542f\u52a8\u65b9\u5f0f\u65f6\uff0ctomcat \u6267\u884c ",(0,i.jsx)(n.code,{children:"DispatcherServlet#init"})," \u65b9\u6cd5\u65f6\uff0c\u4f1a\u518d\u6b21\u542f\u52a8 spring \u5bb9\u5668\u5417\uff1f"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u8fdb\u5165 ",(0,i.jsx)(n.code,{children:"FrameworkServlet#initWebApplicationContext"})," \u65b9\u6cd5\uff0c\u6253\u4e0a\u65ad\u70b9\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-64ee29f90ef5683f7968f782b9175d42e0f.png",alt:""})}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u91cc\u7684 ",(0,i.jsx)(n.code,{children:"wac"})," \u4e0e ",(0,i.jsx)(n.code,{children:"this.webApplicationContext"})," \u5c31\u662f ",(0,i.jsx)(n.code,{children:"MyWebApplicationContext"})," \u7684\u5b9e\u4f8b\uff0c\u5728\u521b\u5efa ",(0,i.jsx)(n.code,{children:"DispatcherServlet"})," \u65f6\u4f20\u5165\u7684:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"@Bean\npublic DispatcherServlet dispatcherServlet(WebApplicationContext webApplicationContext) {\n    // \u5728\u6784\u9020\u65b9\u6cd5\u7684\u53c2\u6570\u4e2d\u4f20\u5165\u4e86 webApplicationContext\n    return new DispatcherServlet(webApplicationContext);\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5230\u4e8e\u4e3a\u4ec0\u4e48\u6253\u5230\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u90a3\u662f\u56e0\u4e3a ",(0,i.jsx)(n.code,{children:"DispatcherServlet#init"})," \u7ecf\u8fc7\u5c42\u5c42\u8c03\u7528\u540e\uff0c\u6700\u7ec8\u662f\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u5904\u7406 spring \u5bb9\u5668\u7684\u542f\u52a8\u7684\uff0c\u5f53\u65ad\u70b9\u8fd0\u884c\u5230 ",(0,i.jsx)(n.code,{children:"if (!cwac.isActive()) {..."})," \u65f6\uff0c",(0,i.jsx)(n.code,{children:"!cwac.isActive()"})," \u8fd4\u56de\u7ed3\u679c\u4e3a ",(0,i.jsx)(n.code,{children:"false"}),"\uff0c\u56e0\u6b64 ",(0,i.jsx)(n.code,{children:"if"})," \u5757\u91cc\u7684\u542f\u52a8 spring \u5bb9\u5668\u5c31\u4e0d\u4f1a\u6267\u884c\u5230\u4e86\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u7efc\u4e0a\u6240\u8ff0\uff0c\u901a\u8fc7 spring \u5bb9\u5668\u542f\u52a8 tomcat \u540e\uff0c\u5728 ",(0,i.jsx)(n.code,{children:"DispatcherServlet#init"})," \u91cc\u4e0d\u4f1a\u518d\u6b21\u542f\u52a8 spring \u5bb9\u5668\u3002\u8fd9\u6837\u542f\u52a8\u540e\uff0c",(0,i.jsx)(n.code,{children:"DispatcherServlet"})," \u5c31\u662f\u4e00\u4e2a spring bean\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u4ee3\u7801\u91cc\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"@Autowired"})," \u6ce8\u89e3\u5c06\u5176\u6ce8\u5165\u5230\u5176\u4ed6\u7c7b\u4e2d\u4e86\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"@Component\npublic class Test {\n    // \u672c\u6587\u7684\u793a\u4f8b\uff08\u5728 spring \u5bb9\u5668\u4e2d\u542f\u52a8 tomcat\uff09\u662f\u53ef\u4ee5\u6ce8\u5165\u6210\u529f\u7684\n    @Autowired\n    public DispatcherServlet dispatcherServlet;\n\n    ...\n\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5173\u4e8e ",(0,i.jsx)(n.code,{children:"spring"})," \u542f\u52a8 ",(0,i.jsx)(n.code,{children:"tomcat"})," \u7684\u5206\u6790\u5c31\u5230\u8fd9\u91cc\uff0c\u5176\u4e2d\u7684\u96be\u70b9\u5728\u4e8e",(0,i.jsxs)(n.strong,{children:["\u5982\u4f55\u5c06 ",(0,i.jsx)(n.code,{children:"tomcat"})," \u63d0\u4f9b\u7684 ",(0,i.jsx)(n.code,{children:"ServletContext"})," \u8bbe\u7f6e\u5230 ",(0,i.jsx)(n.code,{children:"ServletContextAwareProcessor"})," \u4e2d"]}),"\uff0c\u5176\u4e2d\u7684\u89e3\u51b3\u65b9\u5f0f\u6ce8\u610f\u4f53\u4f1a\u3002"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["\u672c\u6587\u539f\u6587\u94fe\u63a5\uff1a",(0,i.jsx)(n.a,{href:"https://my.oschina.net/funcy/blog/4928222",children:"https://my.oschina.net/funcy/blog/4928222"})," \uff0c\u9650\u4e8e\u4f5c\u8005\u4e2a\u4eba\u6c34\u5e73\uff0c\u6587\u4e2d\u96be\u514d\u6709\u9519\u8bef\u4e4b\u5904\uff0c\u6b22\u8fce\u6307\u6b63\uff01\u539f\u521b\u4e0d\u6613\uff0c\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002"]})})]})}function d(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},88672:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>o});var i=t(50959);const r={},c=i.createContext(r);function o(e){const n=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);