"use strict";(self.webpackChunkcode_note_blog=self.webpackChunkcode_note_blog||[]).push([[3101],{62455:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var t=i(11527),o=i(88672);const r={},s=void 0,a={id:"Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e8c\uff09\uff1aApplicationContext\u7684\u521b\u5efa",title:"Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e8c\uff09\uff1aApplicationContext\u7684\u521b\u5efa",description:"\u5728\u524d\u9762\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5206\u6790\u4e86 spring \u7684\u6574\u4f53\u542f\u52a8\u6d41\u7a0b\uff0c\u4ece\u8fd9\u7bc7\u5f00\u59cb \uff0c\u6211\u4eec\u5c06\u5bf9\u542f\u52a8\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u5173\u952e\u4ee3\u7801\u8fdb\u884c\u5206\u6790\u3002",source:"@site/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e8c\uff09\uff1aApplicationContext\u7684\u521b\u5efa.md",sourceDirName:"Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b",slug:"/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e8c\uff09\uff1aApplicationContext\u7684\u521b\u5efa",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e8c\uff09\uff1aApplicationContext\u7684\u521b\u5efa",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e8c\uff09\uff1aApplicationContext\u7684\u521b\u5efa.md",tags:[],version:"current",frontMatter:{},sidebar:"spring",previous:{title:"Spring\u542f\u52a8\u6d41\u7a0b\uff08\u516b\uff09\uff1a\u5b8c\u6210BeanFactory\u7684\u521d\u59cb\u5316",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u516b\uff09\uff1a\u5b8c\u6210BeanFactory\u7684\u521d\u59cb\u5316"},next:{title:"Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e5d\uff09\uff1a\u5355\u4f8bbean\u7684\u521b\u5efa",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e5d\uff09\uff1a\u5355\u4f8bbean\u7684\u521b\u5efa"}},c={},d=[{value:"1. <code>beanFacotry</code> \u7684\u521b\u5efa",id:"1-beanfacotry-\u7684\u521b\u5efa",level:3},{value:"2. \u603b\u7ed3",id:"2-\u603b\u7ed3",level:3}];function l(n){const e={a:"a",blockquote:"blockquote",code:"code",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-07194ddebd25cb2b71ee5e422bf84e8a397.png",alt:""})}),"\n",(0,t.jsx)(e.p,{children:"\u5728\u524d\u9762\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5206\u6790\u4e86 spring \u7684\u6574\u4f53\u542f\u52a8\u6d41\u7a0b\uff0c\u4ece\u8fd9\u7bc7\u5f00\u59cb \uff0c\u6211\u4eec\u5c06\u5bf9\u542f\u52a8\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u5173\u952e\u4ee3\u7801\u8fdb\u884c\u5206\u6790\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["\u5206\u6790\u4f9d\u65e7\u662f\u57fa\u4e8e\u7684 ",(0,t.jsx)(e.code,{children:"demo01"}),"\uff0c\u6211\u4eec\u76f4\u63a5\u8fdb\u884c ",(0,t.jsx)(e.code,{children:'ApplicationContext context = new AnnotationConfigApplicationContext("org.springframework.learn.demo01");'})," \u7684\u6267\u884c\u4e2d\uff1a"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"AnnotationConfigApplicationContext"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public AnnotationConfigApplicationContext(String... basePackages) {\n    this();\n    scan(basePackages);\n    refresh();\n}\n\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u6709\u4e09\u884c\uff0c\u6bcf\u884c\u4ee3\u7801\u7684\u4f5c\u7528\u5728 ",(0,t.jsx)(e.a,{href:"https://my.oschina.net/funcy/blog/4597493",title:"spring\u542f\u52a8\u6d41\u7a0b\u6982\u89c8",children:"spring \u542f\u52a8\u6d41\u7a0b\u6982\u89c8"}),"\u5df2\u505a\u8fc7\u8bf4\u660e\uff0c\u8fd9\u91cc\u6211\u4eec\u5c06\u5bf9\u8fd9\u4e9b\u65b9\u6cd5\u5c55\u5f00\uff0c\u8be6\u7ec6\u5206\u6790\u91cc\u9762\u7684\u5185\u5bb9\u3002"]}),"\n",(0,t.jsxs)(e.h3,{id:"1-beanfacotry-\u7684\u521b\u5efa",children:["1. ",(0,t.jsx)(e.code,{children:"beanFacotry"})," \u7684\u521b\u5efa"]}),"\n",(0,t.jsxs)(e.p,{children:["\u6211\u4eec\u76f4\u63a5\u8fdb\u884c ",(0,t.jsx)(e.code,{children:"this()"})," \u65b9\u6cd5\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"AnnotationConfigApplicationContext"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public AnnotationConfigApplicationContext() {\n    // AnnotatedBeanDefinitionReader \u89e3\u6790 @Configuration\n    this.reader = new AnnotatedBeanDefinitionReader(this);\n    this.scanner = new ClassPathBeanDefinitionScanner(this);\n}\n\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u8868\u9762\u4e0a\u770b\uff0c\u4ee3\u7801\u53ea\u6709\u4e24\u884c\uff0c\u521b\u5efa\u4e86\u4e24\u4e2a\u5bf9\u8c61\u3002\u4f46\u719f\u6089 java \u57fa\u7840\u8bed\u6cd5\u7684\u90fd\u77e5\u9053\uff0c\u5b50\u7c7b\u5728\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u65f6\uff0c\u4f1a\u5148\u8c03\u7528\u7236\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u518d\u6267\u884c\u5b50\u7c7b\u6784\u9020\u65b9\u6cd5\u7684\u4ee3\u7801\uff0c\u56e0\u4e9b\u6211\u4eec\u8fd8\u9700\u8981\u770b\u770b\u8be5\u7c7b\u7684\u7236\u7c7b\u6784\u9020\u65b9\u6cd5\u91cc\u505a\u4e86\u4ec0\u4e48\uff1a"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"GenericApplicationContext"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public GenericApplicationContext() {\n    this.beanFactory = new DefaultListableBeanFactory();\n}\n\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c\u7236\u7c7b\u7684\u6784\u9020\u65b9\u6cd5\u91cc\u4ec5\u505a\u4e86\u4e00\u4ef6\u4e8b\uff1a\u521b\u5efa ",(0,t.jsx)(e.code,{children:"beanFactory"}),"\u3002\u81ea\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff1a",(0,t.jsxs)(e.strong,{children:[(0,t.jsx)(e.code,{children:"AnnotationConfigApplicationContext"})," \u4f7f\u7528\u7684 ",(0,t.jsx)(e.code,{children:"BeanFacotry"})," \u4e3a ",(0,t.jsx)(e.code,{children:"DefaultListableBeanFactory"})]}),"\u3002"]}),"\n",(0,t.jsxs)(e.p,{children:["\u6211\u4eec\u518d\u56de\u5230 ",(0,t.jsx)(e.code,{children:"AnnotationConfigApplicationContext"})," \u7684\u6784\u9020\u65b9\u6cd5\uff1a"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"AnnotationConfigApplicationContext"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public AnnotationConfigApplicationContext() {\n    // AnnotatedBeanDefinitionReader \u89e3\u6790 @Configuration\n    this.reader = new AnnotatedBeanDefinitionReader(this);\n    this.scanner = new ClassPathBeanDefinitionScanner(this);\n}\n\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u8fd9\u4e2a\u65b9\u6cd5\u867d\u7136\u53ea\u6709\u4e24\u884c\uff0c\u4f5c\u7528\u5374\u4e0d\u5c0f\u3002\u6211\u4eec\u6df1\u5165 ",(0,t.jsx)(e.code,{children:"new AnnotatedBeanDefinitionReader(this);"})," \u770b\u4e0b\uff0c\u7531\u4e8e\u5176\u4e2d\u7684\u65b9\u6cd5\u8c03\u7528\u5e76\u4e0d\u91cd\u8981\uff0c\u8fd9\u91cc\u4ec5\u63d0\u4f9b\u8c03\u7528\u94fe\uff1a"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"AnnotationConfigApplicationContext#AnnotationConfigApplicationContext()\n |-AnnotatedBeanDefinitionReader#AnnotatedBeanDefinitionReader(BeanDefinitionRegistry)\n  |-AnnotatedBeanDefinitionReader#AnnotatedBeanDefinitionReader(BeanDefinitionRegistry, Environment)\n   |-AnnotationConfigUtils#registerAnnotationConfigProcessors(BeanDefinitionRegistry)\n    |-AnnotationConfigUtils#registerAnnotationConfigProcessors(BeanDefinitionRegistry, Object)\n\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c\u6700\u7ec8\u662f\u8c03\u7528\u4e86 ",(0,t.jsx)(e.code,{children:"AnnotationConfigUtils#registerAnnotationConfigProcessors(BeanDefinitionRegistry, Object)"}),"\uff0c\u6211\u4eec\u67e5\u770b\u4e0b\u8be5\u65b9\u6cd5\uff0c\u4e3a\u4e86\u76f4\u89c2\u67e5\u770b\uff0c\u8fd9\u91cc\u7701\u7565\u4e86\u4e0d\u5fc5\u8981\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u4ec5\u5173\u6ce8\u4e3b\u8981\u7684\u6d41\u7a0b\u5373\u53ef\uff1a"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public static Set<BeanDefinitionHolder> registerAnnotationConfigProcessors(\n        BeanDefinitionRegistry registry, @Nullable Object source) {\n    // \u83b7\u5f97beanFactory\n    DefaultListableBeanFactory beanFactory = unwrapDefaultListableBeanFactory(registry);\n\n    // -------- \u5f80beanFactory\u4e2d\u6dfb\u52a0\u5904\u7406\u7c7b\n    if (beanFactory != null) {\n        if (!(beanFactory.getDependencyComparator() instanceof AnnotationAwareOrderComparator)) {\n        beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);\n        }\n        if (!(beanFactory.getAutowireCandidateResolver() \n                instanceof ContextAnnotationAutowireCandidateResolver)) {\n            beanFactory.setAutowireCandidateResolver(new ContextAnnotationAutowireCandidateResolver());\n        }\n    }\n\n    Set<BeanDefinitionHolder> beanDefs = new LinkedHashSet<>(8);\n\n    // ------------  \u5f80beanFactory\u4e2d\u6dfb\u52a0beanDefinition\n    if (!registry.containsBeanDefinition(CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME)) {\n        RootBeanDefinition def = new RootBeanDefinition(ConfigurationClassPostProcessor.class);\n        def.setSource(source);\n        beanDefs.add(registerPostProcessor(registry, def, CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME));\n    }\n\n    if (!registry.containsBeanDefinition(AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME)) {\n        RootBeanDefinition def = new RootBeanDefinition(AutowiredAnnotationBeanPostProcessor.class);\n        def.setSource(source);\n        beanDefs.add(registerPostProcessor(registry, def, AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME));\n    }\n\n    // Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.\n    if (jsr250Present && !registry.containsBeanDefinition(COMMON_ANNOTATION_PROCESSOR_BEAN_NAME)) {\n        RootBeanDefinition def = new RootBeanDefinition(CommonAnnotationBeanPostProcessor.class);\n        def.setSource(source);\n        beanDefs.add(registerPostProcessor(registry, def, COMMON_ANNOTATION_PROCESSOR_BEAN_NAME));\n    }\n\n    // Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.\n    if (jpaPresent && !registry.containsBeanDefinition(PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME)) {\n        RootBeanDefinition def = new RootBeanDefinition();\n        try {\n            def.setBeanClass(ClassUtils.forName(PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME,\n                AnnotationConfigUtils.class.getClassLoader()));\n        }\n        catch (ClassNotFoundException ex) {\n            throw new IllegalStateException(...);\n        }\n        def.setSource(source);\n        beanDefs.add(registerPostProcessor(registry, def, PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME));\n    }\n\n    if (!registry.containsBeanDefinition(EVENT_LISTENER_PROCESSOR_BEAN_NAME)) {\n        RootBeanDefinition def = new RootBeanDefinition(EventListenerMethodProcessor.class);\n        def.setSource(source);\n        beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_PROCESSOR_BEAN_NAME));\n    }\n\n    if (!registry.containsBeanDefinition(EVENT_LISTENER_FACTORY_BEAN_NAME)) {\n        RootBeanDefinition def = new RootBeanDefinition(DefaultEventListenerFactory.class);\n        def.setSource(source);\n        beanDefs.add(registerPostProcessor(registry, def, EVENT_LISTENER_FACTORY_BEAN_NAME));\n    }\n    return beanDefs;\n}\n\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u8fd9\u4e2a\u65b9\u6cd5\u4ee3\u7801\u867d\u7136\u6709\u70b9\u957f\uff0c\u4f46\u529f\u80fd\u5374\u76f8\u5f53\u76f4\u767d\uff0c\u5c31\u662f\u5411 ",(0,t.jsx)(e.code,{children:"beanFactory"})," \u6dfb\u52a0 ",(0,t.jsx)(e.code,{children:"annotation"})," \u76f8\u5173\u7684\u5904\u7406\u5668\u3002\u5b9e\u9645\u4e0a\uff0c\u5728 ",(0,t.jsx)(e.a,{href:"https://my.oschina.net/funcy/blog/4597493",title:"spring\u542f\u52a8\u6d41\u7a0b\u6982\u89c8",children:"spring \u542f\u52a8\u6d41\u7a0b\u6982\u89c8"}),"\u63d0\u5230\u7684 beanDefinitionMap \u4e2d 4 \u4e2a\u9ed8\u8ba4\u7684 beanDefinition \u5c31\u662f\u5728\u8fd9\u91cc\u6dfb\u52a0\u7684\uff1a"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-a490052bdc1379ef24a7754c65584214c1c.png",alt:""})}),"\n",(0,t.jsxs)(e.p,{children:["\u63a5\u7740\u6211\u4eec\u518d\u5173\u6ce8 ",(0,t.jsx)(e.code,{children:"this.scanner = new ClassPathBeanDefinitionScanner(this)"}),"\uff0c\u8fd9\u662f\u521d\u59cb\u5316 ",(0,t.jsx)(e.code,{children:"scanner"})," \u5bf9\u8c61\uff0c\u7c7b\u578b\u4e3a ",(0,t.jsx)(e.code,{children:"ClassPathBeanDefinitionScanner"}),"\uff0c\u8be5\u7c7b\u4ece\u540d\u5b57\u4e0a\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u662f\u4e0e ",(0,t.jsx)(e.code,{children:"classPath"})," \u76f8\u5173\u7684\uff0c",(0,t.jsx)(e.code,{children:"beanDefinition"})," \u626b\u63cf\u5668\uff0c\u901a\u4fd7\u5730\u8bf4\uff0c\u5c31\u662f",(0,t.jsxs)(e.strong,{children:["\u626b\u63cf classPath \u8def\u5f84\uff0c\u5c06 java class \u6587\u4ef6\u7ec4\u88c5\u6210 ",(0,t.jsx)(e.code,{children:"beanDefinition"})," \u5bf9\u8c61"]}),"\u3002"]}),"\n",(0,t.jsx)(e.h3,{id:"2-\u603b\u7ed3",children:"2. \u603b\u7ed3"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"AnnotationConfigApplicationContext#AnnotationConfigApplicationContext(String...)"})," \u4e2d ",(0,t.jsx)(e.code,{children:"this()"})," \u7684\u6267\u884c\u5c31\u5206\u6790\u5230\u8fd9\u91cc\u4e86\uff0c\u8fd9\u4e00 \u884c\u4ee3\u7801\u4e3b\u8981\u505a\u4e86\u8fd9\u51e0\u4ef6\u4e8b\uff1a"]}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\u521b\u5efa\u4e86\u7c7b\u578b\u4e3a ",(0,t.jsx)(e.code,{children:"DefaultListableBeanFactory"})," \u7684 ",(0,t.jsx)(e.code,{children:"beanFactory"})]}),"\n",(0,t.jsxs)(e.li,{children:["\u521b\u5efa\u4e86\u7c7b\u578b\u4e3a ",(0,t.jsx)(e.code,{children:"AnnotatedBeanDefinitionReader"})," \u7684 reader\uff0c\u5728\u5176\u521b\u5efa\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u5f80 ",(0,t.jsx)(e.code,{children:"beanFactory"})," \u6dfb\u52a0 annotation \u76f8\u5173\u7684\u5904\u7406\u5668"]}),"\n",(0,t.jsxs)(e.li,{children:["\u521b\u5efa\u4e86\u7c7b\u578b\u4e3a ",(0,t.jsx)(e.code,{children:"ClassPathBeanDefinitionScanner"})," \u7684 ",(0,t.jsx)(e.code,{children:"scanner"})]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u6587\u6d41\u7a0b\u56fe\u793a\u5982\u4e0b\uff1a"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-b7a7a01b4d38769419a0e25e8f60037cbb5.png",alt:""})}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u6587\u5c31\u5148\u5230\u8fd9\u91cc\u4e86\uff0c\u63a5\u4e0b\u6765\u7684\u6587\u7ae0\u6211\u4eec\u7ee7\u7eed\u5206\u6790\u540e\u7eed\u7684\u4ee3\u7801\u3002"})]})}function p(n={}){const{wrapper:e}={...(0,o.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(l,{...n})}):l(n)}},88672:(n,e,i)=>{i.d(e,{Z:()=>a,a:()=>s});var t=i(50959);const o={},r=t.createContext(o);function s(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);