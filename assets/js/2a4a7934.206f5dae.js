"use strict";(self.webpackChunkcode_note_blog=self.webpackChunkcode_note_blog||[]).push([[6164],{35688:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>u,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>s});var t=r(11527),o=r(88672);const i={},l=void 0,c={id:"Java/concurrency/Java\u5e76\u53d1\u6307\u5357\uff1a\u6df1\u5ea6\u89e3\u8bfbJava\u7ebf\u7a0b\u6c60\u8bbe\u8ba1\u601d\u60f3\u53ca\u6e90\u7801\u5b9e\u73b0",title:"Java\u5e76\u53d1\u6307\u5357\uff1a\u6df1\u5ea6\u89e3\u8bfbJava\u7ebf\u7a0b\u6c60\u8bbe\u8ba1\u601d\u60f3\u53ca\u6e90\u7801\u5b9e\u73b0",description:"\u672c\u6587\u8f6c\u81ea\uff1ahttps://www.javadoop.com/",source:"@site/docs/Java/concurrency/Java\u5e76\u53d1\u6307\u5357\uff1a\u6df1\u5ea6\u89e3\u8bfbJava\u7ebf\u7a0b\u6c60\u8bbe\u8ba1\u601d\u60f3\u53ca\u6e90\u7801\u5b9e\u73b0.md",sourceDirName:"Java/concurrency",slug:"/Java/concurrency/Java\u5e76\u53d1\u6307\u5357\uff1a\u6df1\u5ea6\u89e3\u8bfbJava\u7ebf\u7a0b\u6c60\u8bbe\u8ba1\u601d\u60f3\u53ca\u6e90\u7801\u5b9e\u73b0",permalink:"/code-note-blog/docs/Java/concurrency/Java\u5e76\u53d1\u6307\u5357\uff1a\u6df1\u5ea6\u89e3\u8bfbJava\u7ebf\u7a0b\u6c60\u8bbe\u8ba1\u601d\u60f3\u53ca\u6e90\u7801\u5b9e\u73b0",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Java/concurrency/Java\u5e76\u53d1\u6307\u5357\uff1a\u6df1\u5ea6\u89e3\u8bfbJava\u7ebf\u7a0b\u6c60\u8bbe\u8ba1\u601d\u60f3\u53ca\u6e90\u7801\u5b9e\u73b0.md",tags:[],version:"current",frontMatter:{},sidebar:"java",previous:{title:"Java\u5e76\u53d1\u6307\u5357\uff1a\u89e3\u8bfbJava\u963b\u585e\u961f\u5217BlockingQueue",permalink:"/code-note-blog/docs/Java/concurrency/Java\u5e76\u53d1\u6307\u5357\uff1a\u89e3\u8bfbJava\u963b\u585e\u961f\u5217BlockingQueue"},next:{title:"Java\u5e76\u53d1\u6307\u5357\uff1a\u6df1\u5165\u7406\u89e3Java\u5185\u5b58\u6a21\u578bJMM",permalink:"/code-note-blog/docs/Java/concurrency/Java\u5e76\u53d1\u6307\u5357\uff1a\u6df1\u5165\u7406\u89e3Java\u5185\u5b58\u6a21\u578bJMM"}},u={},s=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u603b\u89c8",id:"\u603b\u89c8",level:2},{value:"Executor \u63a5\u53e3",id:"executor-\u63a5\u53e3",level:2},{value:"ExecutorService",id:"executorservice",level:2},{value:"FutureTask",id:"futuretask",level:2},{value:"AbstractExecutorService",id:"abstractexecutorservice",level:2},{value:"ThreadPoolExecutor",id:"threadpoolexecutor",level:2},{value:"Executors",id:"executors",level:2},{value:"getTask",id:"gettask",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:["\u672c\u6587\u8f6c\u81ea\uff1a",(0,t.jsx)(e.a,{href:"https://www.javadoop.com/",children:"https://www.javadoop.com/"})]}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u7cfb\u5217\u6587\u7ae0\u5c06\u6574\u7406\u5230\u6211\u5728GitHub\u4e0a\u7684\u300aJava\u9762\u8bd5\u6307\u5357\u300b\u4ed3\u5e93\uff0c\u66f4\u591a\u7cbe\u5f69\u5185\u5bb9\u8bf7\u5230\u6211\u7684\u4ed3\u5e93\u91cc\u67e5\u770b"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.a,{href:"https://github.com/h2pl/Java-Tutorial",children:"https://github.com/h2pl/Java-Tutorial"})}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u559c\u6b22\u7684\u8bdd\u9ebb\u70e6\u70b9\u4e0bStar\u54c8"}),"\n",(0,t.jsx)(e.p,{children:"\u6587\u7ae0\u540c\u6b65\u53d1\u4e8e\u6211\u7684\u4e2a\u4eba\u535a\u5ba2\uff1a"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.a,{href:"http://www.how2playlife.com",children:"www.how2playlife.com"})}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u6587\u662f\u5fae\u4fe1\u516c\u4f17\u53f7\u3010Java\u6280\u672f\u6c5f\u6e56\u3011\u7684\u300aJava\u5e76\u53d1\u6307\u5357\u300b\u5176\u4e2d\u4e00\u7bc7\uff0c\u672c\u6587\u5927\u90e8\u5206\u5185\u5bb9\u6765\u6e90\u4e8e\u7f51\u7edc\uff0c\u4e3a\u4e86\u628a\u672c\u6587\u4e3b\u9898\u8bb2\u5f97\u6e05\u6670\u900f\u5f7b\uff0c\u4e5f\u6574\u5408\u4e86\u5f88\u591a\u6211\u8ba4\u4e3a\u4e0d\u9519\u7684\u6280\u672f\u535a\u5ba2\u5185\u5bb9\uff0c\u5f15\u7528\u5176\u4e2d\u4e86\u4e00\u4e9b\u6bd4\u8f83\u597d\u7684\u535a\u5ba2\u6587\u7ae0\uff0c\u5982\u6709\u4fb5\u6743\uff0c\u8bf7\u8054\u7cfb\u4f5c\u8005\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u8be5\u7cfb\u5217\u535a\u6587\u4f1a\u544a\u8bc9\u4f60\u5982\u4f55\u5168\u9762\u6df1\u5165\u5730\u5b66\u4e60Java\u5e76\u53d1\u6280\u672f\uff0c\u4eceJava\u591a\u7ebf\u7a0b\u57fa\u7840\uff0c\u518d\u5230\u5e76\u53d1\u7f16\u7a0b\u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u4eceJava\u5e76\u53d1\u5305\u7684\u5165\u95e8\u548c\u5b9e\u6218\uff0c\u518d\u5230JUC\u7684\u6e90\u7801\u5256\u6790\uff0c\u4e00\u6b65\u6b65\u5730\u5b66\u4e60Java\u5e76\u53d1\u7f16\u7a0b\uff0c\u5e76\u4e0a\u624b\u8fdb\u884c\u5b9e\u6218\uff0c\u4ee5\u4fbf\u8ba9\u4f60\u66f4\u5b8c\u6574\u5730\u4e86\u89e3\u6574\u4e2aJava\u5e76\u53d1\u7f16\u7a0b\u77e5\u8bc6\u4f53\u7cfb\uff0c\u5f62\u6210\u81ea\u5df1\u7684\u77e5\u8bc6\u6846\u67b6\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u4e3a\u4e86\u66f4\u597d\u5730\u603b\u7ed3\u548c\u68c0\u9a8c\u4f60\u7684\u5b66\u4e60\u6210\u679c\uff0c\u672c\u7cfb\u5217\u6587\u7ae0\u4e5f\u4f1a\u63d0\u4f9b\u4e00\u4e9b\u5bf9\u5e94\u7684\u9762\u8bd5\u9898\u4ee5\u53ca\u53c2\u8003\u7b54\u6848\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u5982\u679c\u5bf9\u672c\u7cfb\u5217\u6587\u7ae0\u6709\u4ec0\u4e48\u5efa\u8bae\uff0c\u6216\u8005\u662f\u6709\u4ec0\u4e48\u7591\u95ee\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u5173\u6ce8\u516c\u4f17\u53f7\u3010Java\u6280\u672f\u6c5f\u6e56\u3011\u8054\u7cfb\u4f5c\u8005\uff0c\u6b22\u8fce\u4f60\u53c2\u4e0e\u672c\u7cfb\u5217\u535a\u6587\u7684\u521b\u4f5c\u548c\u4fee\u8ba2\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"\u524d\u8a00",children:"\u524d\u8a00"}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u76f8\u4fe1\u5927\u5bb6\u90fd\u770b\u8fc7\u5f88\u591a\u7684\u5173\u4e8e\u7ebf\u7a0b\u6c60\u7684\u6587\u7ae0\uff0c\u57fa\u672c\u4e0a\u4e5f\u662f\u9762\u8bd5\u7684\u65f6\u5019\u5fc5\u95ee\u7684\uff0c\u5982\u679c\u4f60\u5728\u770b\u8fc7\u5f88\u591a\u6587\u7ae0\u4ee5\u540e\uff0c\u8fd8\u662f\u4e00\u77e5\u534a\u89e3\u7684\uff0c\u90a3\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\u80fd\u8ba9\u4f60\u771f\u6b63\u7684\u638c\u63e1\u597d Java \u7ebf\u7a0b\u6c60\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u6587\u4e00\u5927\u91cd\u70b9\u662f\u6e90\u7801\u89e3\u6790\uff0c\u540c\u65f6\u4f1a\u6709\u5c11\u91cf\u7bc7\u5e45\u4ecb\u7ecd\u7ebf\u7a0b\u6c60\u8bbe\u8ba1\u601d\u60f3\u4ee5\u53ca\u4f5c\u8005 Doug Lea \u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u5de7\u5999\u7528\u6cd5\u3002\u672c\u6587\u8fd8\u662f\u4f1a\u4e00\u884c\u884c\u5173\u952e\u4ee3\u7801\u8fdb\u884c\u5206\u6790\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u8ba9\u90a3\u4e9b\u81ea\u5df1\u770b\u6e90\u7801\u4e0d\u662f\u5f88\u7406\u89e3\u7684\u540c\u5b66\u53ef\u4ee5\u5f97\u5230\u53c2\u8003\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u7ebf\u7a0b\u6c60\u662f\u975e\u5e38\u91cd\u8981\u7684\u5de5\u5177\uff0c\u5982\u679c\u4f60\u8981\u6210\u4e3a\u4e00\u4e2a\u597d\u7684\u5de5\u7a0b\u5e08\uff0c\u8fd8\u662f\u5f97\u6bd4\u8f83\u597d\u5730\u638c\u63e1\u8fd9\u4e2a\u77e5\u8bc6\uff0c\u5f88\u591a\u7ebf\u4e0a\u95ee\u9898\u90fd\u662f\u56e0\u4e3a\u6ca1\u6709\u7528\u597d\u7ebf\u7a0b\u6c60\u5bfc\u81f4\u7684\u3002\u5373\u4f7f\u4f60\u4e3a\u4e86\u8c0b\u751f\uff0c\u4e5f\u8981\u77e5\u9053\uff0c\u8fd9\u57fa\u672c\u4e0a\u662f\u9762\u8bd5\u5fc5\u95ee\u7684\u9898\u76ee\uff0c\u800c\u4e14\u9762\u8bd5\u5b98\u5f88\u5bb9\u6613\u4ece\u88ab\u9762\u8bd5\u8005\u7684\u56de\u7b54\u4e2d\u6355\u6349\u5230\u88ab\u9762\u8bd5\u8005\u7684\u6280\u672f\u6c34\u5e73\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["\u672c\u6587\u7565\u957f\uff0c\u5efa\u8bae\u5728 pc \u4e0a\u9605\u8bfb\uff0c\u8fb9\u770b\u6587\u7ae0\u8fb9\u7ffb\u6e90\u7801\uff08Java7 \u548c Java8 \u90fd\u4e00\u6837\uff09\uff0c\u5efa\u8bae\u60f3\u597d\u597d\u770b\u7684\u8bfb\u8005\u62bd\u51fa\u81f3\u5c11 30 \u5206\u949f\u7684\u6574\u5757\u65f6\u95f4\u6765\u9605\u8bfb\u3002\u5f53\u7136\uff0c\u5982\u679c\u8bfb\u8005\u4ec5\u4e3a\u9762\u8bd5\u51c6\u5907\uff0c\u53ef\u4ee5\u76f4\u63a5\u6ed1\u5230\u6700\u540e\u7684",(0,t.jsx)(e.strong,{children:"\u603b\u7ed3"}),"\u90e8\u5206\u3002"]}),"\n",(0,t.jsx)(e.h2,{id:"\u603b\u89c8",children:"\u603b\u89c8"}),"\n",(0,t.jsx)(e.p,{children:"\u5f00\u7bc7\u6765\u4e00\u4e9b\u5e9f\u8bdd\u3002\u4e0b\u56fe\u662f java \u7ebf\u7a0b\u6c60\u51e0\u4e2a\u76f8\u5173\u7c7b\u7684\u7ee7\u627f\u7ed3\u6784\uff1a"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://www.javadoop.com/blogimages/java-thread-pool/1.jpg",alt:"1"})}),"\n",(0,t.jsx)(e.p,{children:"\u5148\u7b80\u5355\u8bf4\u8bf4\u8fd9\u4e2a\u7ee7\u627f\u7ed3\u6784\uff0cExecutor \u4f4d\u4e8e\u6700\u9876\u5c42\uff0c\u4e5f\u662f\u6700\u7b80\u5355\u7684\uff0c\u5c31\u4e00\u4e2a execute(Runnable runnable) \u63a5\u53e3\u65b9\u6cd5\u5b9a\u4e49\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["ExecutorService \u4e5f\u662f\u63a5\u53e3\uff0c\u5728 Executor \u63a5\u53e3\u7684\u57fa\u7840\u4e0a\u6dfb\u52a0\u4e86\u5f88\u591a\u7684\u63a5\u53e3\u65b9\u6cd5\uff0c\u6240\u4ee5",(0,t.jsx)(e.strong,{children:"\u4e00\u822c\u6765\u8bf4\u6211\u4eec\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u63a5\u53e3"}),"\u3002"]}),"\n",(0,t.jsx)(e.p,{children:"\u7136\u540e\u518d\u4e0b\u6765\u4e00\u5c42\u662f AbstractExecutorService\uff0c\u4ece\u540d\u5b57\u6211\u4eec\u5c31\u77e5\u9053\uff0c\u8fd9\u662f\u62bd\u8c61\u7c7b\uff0c\u8fd9\u91cc\u5b9e\u73b0\u4e86\u975e\u5e38\u6709\u7528\u7684\u4e00\u4e9b\u65b9\u6cd5\u4f9b\u5b50\u7c7b\u76f4\u63a5\u4f7f\u7528\uff0c\u4e4b\u540e\u6211\u4eec\u518d\u7ec6\u8bf4\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u7136\u540e\u624d\u5230\u6211\u4eec\u7684\u91cd\u70b9\u90e8\u5206 ThreadPoolExecutor \u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u63d0\u4f9b\u4e86\u5173\u4e8e\u7ebf\u7a0b\u6c60\u6240\u9700\u7684\u975e\u5e38\u4e30\u5bcc\u7684\u529f\u80fd\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u53e6\u5916\uff0c\u6211\u4eec\u8fd8\u6d89\u53ca\u5230\u4e0b\u56fe\u4e2d\u7684\u8fd9\u4e9b\u7c7b\uff1a"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://www.javadoop.com/blogimages/java-thread-pool/others.png",alt:"others"})}),"\n",(0,t.jsx)(e.p,{children:"\u540c\u5728\u5e76\u53d1\u5305\u4e2d\u7684 Executors \u7c7b\uff0c\u7c7b\u540d\u4e2d\u5e26\u5b57\u6bcd s\uff0c\u6211\u4eec\u731c\u5230\u8fd9\u4e2a\u662f\u5de5\u5177\u7c7b\uff0c\u91cc\u9762\u7684\u65b9\u6cd5\u90fd\u662f\u9759\u6001\u65b9\u6cd5\uff0c\u5982\u4ee5\u4e0b\u6211\u4eec\u6700\u5e38\u7528\u7684\u7528\u4e8e\u751f\u6210 ThreadPoolExecutor \u7684\u5b9e\u4f8b\u7684\u4e00\u4e9b\u65b9\u6cd5\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue<Runnable>());\n}\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n    return new ThreadPoolExecutor(nThreads, nThreads,\n                                  0L, TimeUnit.MILLISECONDS,\n                                  new LinkedBlockingQueue<Runnable>());\n}\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u53e6\u5916\uff0c\u7531\u4e8e\u7ebf\u7a0b\u6c60\u652f\u6301",(0,t.jsx)(e.strong,{children:"\u83b7\u53d6\u7ebf\u7a0b\u6267\u884c\u7684\u7ed3\u679c"}),"\uff0c\u6240\u4ee5\uff0c\u5f15\u5165\u4e86 Future \u63a5\u53e3\uff0cRunnableFuture \u7ee7\u627f\u81ea\u6b64\u63a5\u53e3\uff0c\u7136\u540e\u6211\u4eec\u6700\u9700\u8981\u5173\u5fc3\u7684\u5c31\u662f\u5b83\u7684\u5b9e\u73b0\u7c7b FutureTask\u3002\u5230\u8fd9\u91cc\uff0c\u8bb0\u4f4f\u8fd9\u4e2a\u6982\u5ff5\uff0c\u5728\u7ebf\u7a0b\u6c60\u7684\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u662f\u5f80\u7ebf\u7a0b\u6c60\u63d0\u4ea4\u4efb\u52a1\uff08task\uff09\uff0c\u4f7f\u7528\u8fc7\u7ebf\u7a0b\u6c60\u7684\u90fd\u77e5\u9053\uff0c\u6211\u4eec\u63d0\u4ea4\u7684\u6bcf\u4e2a\u4efb\u52a1\u662f\u5b9e\u73b0\u4e86 Runnable \u63a5\u53e3\u7684\uff0c\u5176\u5b9e\u5c31\u662f\u5148\u5c06 Runnable \u7684\u4efb\u52a1\u5305\u88c5\u6210 FutureTask\uff0c\u7136\u540e\u518d\u63d0\u4ea4\u5230\u7ebf\u7a0b\u6c60\u3002\u8fd9\u6837\uff0c\u8bfb\u8005\u624d\u80fd\u6bd4\u8f83\u5bb9\u6613\u8bb0\u4f4f FutureTask \u8fd9\u4e2a\u7c7b\u540d\uff1a\u5b83\u9996\u5148\u662f\u4e00\u4e2a\u4efb\u52a1\uff08Task\uff09\uff0c\u7136\u540e\u5177\u6709 Future \u63a5\u53e3\u7684\u8bed\u4e49\uff0c\u5373\u53ef\u4ee5\u5728\u5c06\u6765\uff08Future\uff09\u5f97\u5230\u6267\u884c\u7684\u7ed3\u679c\u3002"]}),"\n",(0,t.jsx)(e.p,{children:"\u5f53\u7136\uff0c\u7ebf\u7a0b\u6c60\u4e2d\u7684 BlockingQueue \u4e5f\u662f\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\uff0c\u5982\u679c\u7ebf\u7a0b\u6570\u8fbe\u5230 corePoolSize\uff0c\u6211\u4eec\u7684\u6bcf\u4e2a\u4efb\u52a1\u4f1a\u63d0\u4ea4\u5230\u7b49\u5f85\u961f\u5217\u4e2d\uff0c\u7b49\u5f85\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6765\u53d6\u4efb\u52a1\u5e76\u6267\u884c\u3002\u8fd9\u91cc\u7684 BlockingQueue \u901a\u5e38\u6211\u4eec\u4f7f\u7528\u5176\u5b9e\u73b0\u7c7b LinkedBlockingQueue\u3001ArrayBlockingQueue \u548c SynchronousQueue\uff0c\u6bcf\u4e2a\u5b9e\u73b0\u7c7b\u90fd\u6709\u4e0d\u540c\u7684\u7279\u5f81\uff0c\u4f7f\u7528\u573a\u666f\u4e4b\u540e\u4f1a\u6162\u6162\u5206\u6790\u3002\u60f3\u8981\u8be6\u7ec6\u4e86\u89e3\u5404\u4e2a BlockingQueue \u7684\u8bfb\u8005\uff0c\u53ef\u4ee5\u53c2\u8003\u6211\u7684\u524d\u9762\u7684\u4e00\u7bc7\u5bf9 BlockingQueue \u7684\u5404\u4e2a\u5b9e\u73b0\u7c7b\u8fdb\u884c\u8be6\u7ec6\u5206\u6790\u7684\u6587\u7ae0\u3002"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u628a\u4e8b\u60c5\u8bf4\u5b8c\u6574\uff1a\u9664\u4e86\u4e0a\u9762\u8bf4\u7684\u8fd9\u4e9b\u7c7b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u7c7b\uff0c\u5c31\u662f\u5b9a\u65f6\u4efb\u52a1\u5b9e\u73b0\u7c7b ScheduledThreadPoolExecutor\uff0c\u5b83\u7ee7\u627f\u81ea\u672c\u6587\u8981\u91cd\u70b9\u8bb2\u89e3\u7684 ThreadPoolExecutor\uff0c\u7528\u4e8e\u5b9e\u73b0\u5b9a\u65f6\u6267\u884c\u3002\u4e0d\u8fc7\u672c\u6587\u4e0d\u4f1a\u4ecb\u7ecd\u5b83\u7684\u5b9e\u73b0\uff0c\u6211\u76f8\u4fe1\u8bfb\u8005\u770b\u5b8c\u672c\u6587\u540e\u53ef\u4ee5\u6bd4\u8f83\u5bb9\u6613\u5730\u770b\u61c2\u5b83\u7684\u6e90\u7801\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u4ee5\u4e0a\u5c31\u662f\u672c\u6587\u8981\u4ecb\u7ecd\u7684\u77e5\u8bc6\uff0c\u5e9f\u8bdd\u4e0d\u591a\u8bf4\uff0c\u5f00\u59cb\u8fdb\u5165\u6b63\u6587\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"executor-\u63a5\u53e3",children:"Executor \u63a5\u53e3"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"/* \n * @since 1.5\n * @author Doug Lea\n */\npublic interface Executor {\n    void execute(Runnable command);\n}\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u6211\u4eec\u53ef\u4ee5\u770b\u5230 Executor \u63a5\u53e3\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u4e00\u4e2a",(0,t.jsx)(e.code,{children:"void execute(Runnable command)"}),"\u65b9\u6cd5\uff0c\u4ee3\u8868\u63d0\u4ea4\u4e00\u4e2a\u4efb\u52a1\u3002\u4e3a\u4e86\u8ba9\u5927\u5bb6\u7406\u89e3 java \u7ebf\u7a0b\u6c60\u7684\u6574\u4e2a\u8bbe\u8ba1\u65b9\u6848\uff0c\u6211\u4f1a\u6309\u7167 Doug Lea \u7684\u8bbe\u8ba1\u601d\u8def\u6765\u591a\u8bf4\u4e00\u4e9b\u76f8\u5173\u7684\u4e1c\u897f\u3002"]}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4eec\u7ecf\u5e38\u8fd9\u6837\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"new Thread(new Runnable(){\n  // do something\n}).start();\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u7528\u4e86\u7ebf\u7a0b\u6c60 Executor \u540e\u5c31\u53ef\u4ee5\u50cf\u4e0b\u9762\u8fd9\u4e48\u4f7f\u7528\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"Executor executor = anExecutor;\nexecutor.execute(new RunnableTask1());\nexecutor.execute(new RunnableTask2());\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u5982\u679c\u6211\u4eec\u5e0c\u671b\u7ebf\u7a0b\u6c60\u540c\u6b65\u6267\u884c\u6bcf\u4e00\u4e2a\u4efb\u52a1\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5b9e\u73b0\u8fd9\u4e2a\u63a5\u53e3\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"class DirectExecutor implements Executor {\n    public void execute(Runnable r) {\n        r.run();// \u8fd9\u91cc\u4e0d\u662f\u7528\u7684new Thread(r).start()\uff0c\u4e5f\u5c31\u662f\u8bf4\u6ca1\u6709\u542f\u52a8\u4efb\u4f55\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u3002\n    }\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4eec\u5e0c\u671b\u6bcf\u4e2a\u4efb\u52a1\u63d0\u4ea4\u8fdb\u6765\u540e\uff0c\u76f4\u63a5\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u6765\u6267\u884c\u8fd9\u4e2a\u4efb\u52a1\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5b9e\u73b0\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"class ThreadPerTaskExecutor implements Executor {\n    public void execute(Runnable r) {\n        new Thread(r).start();  // \u6bcf\u4e2a\u4efb\u52a1\u90fd\u7528\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u6765\u6267\u884c\n    }\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4eec\u518d\u6765\u770b\u4e0b\u600e\u4e48\u7ec4\u5408\u4e24\u4e2a Executor \u6765\u4f7f\u7528\uff0c\u4e0b\u9762\u8fd9\u4e2a\u5b9e\u73b0\u662f\u5c06\u6240\u6709\u7684\u4efb\u52a1\u90fd\u52a0\u5230\u4e00\u4e2a queue \u4e2d\uff0c\u7136\u540e\u4ece queue \u4e2d\u53d6\u4efb\u52a1\uff0c\u4ea4\u7ed9\u771f\u6b63\u7684\u6267\u884c\u5668\u6267\u884c\uff0c\u8fd9\u91cc\u91c7\u7528 synchronized \u8fdb\u884c\u5e76\u53d1\u63a7\u5236\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"class SerialExecutor implements Executor {\n    // \u4efb\u52a1\u961f\u5217\n    final Queue<Runnable> tasks = new ArrayDeque<Runnable>();\n    // \u8fd9\u4e2a\u624d\u662f\u771f\u6b63\u7684\u6267\u884c\u5668\n    final Executor executor;\n    // \u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\n    Runnable active;\n\n    // \u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u6307\u5b9a\u6267\u884c\u5668\n    SerialExecutor(Executor executor) {\n        this.executor = executor;\n    }\n\n    // \u6dfb\u52a0\u4efb\u52a1\u5230\u7ebf\u7a0b\u6c60: \u5c06\u4efb\u52a1\u6dfb\u52a0\u5230\u4efb\u52a1\u961f\u5217\uff0cscheduleNext \u89e6\u53d1\u6267\u884c\u5668\u53bb\u4efb\u52a1\u961f\u5217\u53d6\u4efb\u52a1\n    public synchronized void execute(final Runnable r) {\n        tasks.offer(new Runnable() {\n            public void run() {\n                try {\n                    r.run();\n                } finally {\n                    scheduleNext();\n                }\n            }\n        });\n        if (active == null) {\n            scheduleNext();\n        }\n    }\n\n    protected synchronized void scheduleNext() {\n        if ((active = tasks.poll()) != null) {\n            // \u5177\u4f53\u7684\u6267\u884c\u8f6c\u7ed9\u771f\u6b63\u7684\u6267\u884c\u5668 executor\n            executor.execute(active);\n        }\n    }\n}\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u5f53\u7136\u4e86\uff0cExecutor \u8fd9\u4e2a\u63a5\u53e3\u53ea\u6709\u63d0\u4ea4\u4efb\u52a1\u7684\u529f\u80fd\uff0c\u592a\u7b80\u5355\u4e86\uff0c\u6211\u4eec\u60f3\u8981\u66f4\u4e30\u5bcc\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u77e5\u9053\u6267\u884c\u7ed3\u679c\u3001\u6211\u4eec\u60f3\u77e5\u9053\u5f53\u524d\u7ebf\u7a0b\u6c60\u6709\u591a\u5c11\u4e2a\u7ebf\u7a0b\u6d3b\u7740\u3001\u5df2\u7ecf\u5b8c\u6210\u4e86\u591a\u5c11\u4efb\u52a1\u7b49\u7b49\uff0c\u8fd9\u4e9b\u90fd\u662f\u8fd9\u4e2a\u63a5\u53e3\u7684\u4e0d\u8db3\u7684\u5730\u65b9\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u4ecb\u7ecd\u7684\u662f\u7ee7\u627f\u81ea",(0,t.jsx)(e.code,{children:"Executor"}),"\u63a5\u53e3\u7684",(0,t.jsx)(e.code,{children:"ExecutorService"}),"\u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u63d0\u4f9b\u4e86\u6bd4\u8f83\u4e30\u5bcc\u7684\u529f\u80fd\uff0c\u4e5f\u662f\u6211\u4eec\u6700\u5e38\u4f7f\u7528\u5230\u7684\u63a5\u53e3\u3002"]}),"\n",(0,t.jsx)(e.h2,{id:"executorservice",children:"ExecutorService"}),"\n",(0,t.jsx)(e.p,{children:"\u4e00\u822c\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u7684\u65f6\u5019\uff0c\u5f80\u5f80\u90fd\u662f\u4f7f\u7528\u8fd9\u4e2a\u63a5\u53e3\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"ExecutorService executor = Executors.newFixedThreadPool(args...);\nExecutorService executor = Executors.newCachedThreadPool(args...);\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u56e0\u4e3a\u8fd9\u4e2a\u63a5\u53e3\u4e2d\u5b9a\u4e49\u7684\u4e00\u7cfb\u5217\u65b9\u6cd5\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u5df2\u7ecf\u53ef\u4ee5\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u8981\u4e86\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u90a3\u4e48\u6211\u4eec\u7b80\u5355\u521d\u7565\u5730\u6765\u770b\u4e00\u4e0b\u8fd9\u4e2a\u63a5\u53e3\u4e2d\u90fd\u6709\u54ea\u4e9b\u65b9\u6cd5\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public interface ExecutorService extends Executor {\n\n    // \u5173\u95ed\u7ebf\u7a0b\u6c60\uff0c\u5df2\u63d0\u4ea4\u7684\u4efb\u52a1\u7ee7\u7eed\u6267\u884c\uff0c\u4e0d\u63a5\u53d7\u7ee7\u7eed\u63d0\u4ea4\u65b0\u4efb\u52a1\n    void shutdown();\n\n    // \u5173\u95ed\u7ebf\u7a0b\u6c60\uff0c\u5c1d\u8bd5\u505c\u6b62\u6b63\u5728\u6267\u884c\u7684\u6240\u6709\u4efb\u52a1\uff0c\u4e0d\u63a5\u53d7\u7ee7\u7eed\u63d0\u4ea4\u65b0\u4efb\u52a1\n    // \u5b83\u548c\u524d\u9762\u7684\u65b9\u6cd5\u76f8\u6bd4\uff0c\u52a0\u4e86\u4e00\u4e2a\u5355\u8bcd\u201cnow\u201d\uff0c\u533a\u522b\u5728\u4e8e\u5b83\u4f1a\u53bb\u505c\u6b62\u5f53\u524d\u6b63\u5728\u8fdb\u884c\u7684\u4efb\u52a1\n    List<Runnable> shutdownNow();\n\n    // \u7ebf\u7a0b\u6c60\u662f\u5426\u5df2\u5173\u95ed\n    boolean isShutdown();\n\n    // \u5982\u679c\u8c03\u7528\u4e86 shutdown() \u6216 shutdownNow() \u65b9\u6cd5\u540e\uff0c\u6240\u6709\u4efb\u52a1\u7ed3\u675f\u4e86\uff0c\u90a3\u4e48\u8fd4\u56detrue\n    // \u8fd9\u4e2a\u65b9\u6cd5\u5fc5\u987b\u5728\u8c03\u7528shutdown\u6216shutdownNow\u65b9\u6cd5\u4e4b\u540e\u8c03\u7528\u624d\u4f1a\u8fd4\u56detrue\n    boolean isTerminated();\n\n    // \u7b49\u5f85\u6240\u6709\u4efb\u52a1\u5b8c\u6210\uff0c\u5e76\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\n    // \u6211\u4eec\u8fd9\u4e48\u7406\u89e3\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\u662f\uff0c\u5148\u8c03\u7528 shutdown \u6216 shutdownNow\uff0c\n    // \u7136\u540e\u518d\u8c03\u8fd9\u4e2a\u65b9\u6cd5\u7b49\u5f85\u6240\u6709\u7684\u7ebf\u7a0b\u771f\u6b63\u5730\u5b8c\u6210\uff0c\u8fd4\u56de\u503c\u610f\u5473\u7740\u6709\u6ca1\u6709\u8d85\u65f6\n    boolean awaitTermination(long timeout, TimeUnit unit)\n            throws InterruptedException;\n\n    // \u63d0\u4ea4\u4e00\u4e2a Callable \u4efb\u52a1\n    <T> Future<T> submit(Callable<T> task);\n\n    // \u63d0\u4ea4\u4e00\u4e2a Runnable \u4efb\u52a1\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5c06\u4f1a\u653e\u5230 Future \u4e2d\uff0c\u4f5c\u4e3a\u8fd4\u56de\u503c\uff0c\n    // \u56e0\u4e3a Runnable \u7684 run \u65b9\u6cd5\u672c\u8eab\u5e76\u4e0d\u8fd4\u56de\u4efb\u4f55\u4e1c\u897f\n    <T> Future<T> submit(Runnable task, T result);\n\n    // \u63d0\u4ea4\u4e00\u4e2a Runnable \u4efb\u52a1\n    Future<?> submit(Runnable task);\n\n    // \u6267\u884c\u6240\u6709\u4efb\u52a1\uff0c\u8fd4\u56de Future \u7c7b\u578b\u7684\u4e00\u4e2a list\n    <T> List<Future<T>> invokeAll(Collection<? extends Callable<T>> tasks)\n            throws InterruptedException;\n\n    // \u4e5f\u662f\u6267\u884c\u6240\u6709\u4efb\u52a1\uff0c\u4f46\u662f\u8fd9\u91cc\u8bbe\u7f6e\u4e86\u8d85\u65f6\u65f6\u95f4\n    <T> List<Future<T>> invokeAll(Collection<? extends Callable<T>> tasks,\n                                  long timeout, TimeUnit unit)\n            throws InterruptedException;\n\n    // \u53ea\u6709\u5176\u4e2d\u7684\u4e00\u4e2a\u4efb\u52a1\u7ed3\u675f\u4e86\uff0c\u5c31\u53ef\u4ee5\u8fd4\u56de\uff0c\u8fd4\u56de\u6267\u884c\u5b8c\u7684\u90a3\u4e2a\u4efb\u52a1\u7684\u7ed3\u679c\n    <T> T invokeAny(Collection<? extends Callable<T>> tasks)\n            throws InterruptedException, ExecutionException;\n\n    // \u540c\u4e0a\u4e00\u4e2a\u65b9\u6cd5\uff0c\u53ea\u6709\u5176\u4e2d\u7684\u4e00\u4e2a\u4efb\u52a1\u7ed3\u675f\u4e86\uff0c\u5c31\u53ef\u4ee5\u8fd4\u56de\uff0c\u8fd4\u56de\u6267\u884c\u5b8c\u7684\u90a3\u4e2a\u4efb\u52a1\u7684\u7ed3\u679c\uff0c\n    // \u4e0d\u8fc7\u8fd9\u4e2a\u5e26\u8d85\u65f6\uff0c\u8d85\u8fc7\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u629b\u51fa TimeoutException \u5f02\u5e38\n    <T> T invokeAny(Collection<? extends Callable<T>> tasks,\n                    long timeout, TimeUnit unit)\n            throws InterruptedException, ExecutionException, TimeoutException;\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u8fd9\u4e9b\u65b9\u6cd5\u90fd\u5f88\u597d\u7406\u89e3\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u7ebf\u7a0b\u6c60\u4e3b\u8981\u5c31\u662f\u8fd9\u4e9b\u529f\u80fd\uff0c\u80fd\u63d0\u4ea4\u4efb\u52a1\uff0c\u80fd\u83b7\u53d6\u7ed3\u679c\uff0c\u80fd\u5173\u95ed\u7ebf\u7a0b\u6c60\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u6211\u4eec\u7ecf\u5e38\u7528\u8fd9\u4e2a\u63a5\u53e3\u7684\u539f\u56e0\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"futuretask",children:"FutureTask"}),"\n",(0,t.jsx)(e.p,{children:"\u5728\u7ee7\u7eed\u5f80\u4e0b\u5c42\u4ecb\u7ecd ExecutorService \u7684\u5b9e\u73b0\u7c7b\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u8bf4\u8bf4\u76f8\u5173\u7684\u7c7b FutureTask\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"Future      Runnable\n   \\           /\n    \\         /\n   RunnableFuture\n          |\n          |\n      FutureTask\n\nFutureTask \u901a\u8fc7 RunnableFuture \u95f4\u63a5\u5b9e\u73b0\u4e86 Runnable \u63a5\u53e3\uff0c\n\u6240\u4ee5\u6bcf\u4e2a Runnable \u901a\u5e38\u90fd\u5148\u5305\u88c5\u6210 FutureTask\uff0c\n\u7136\u540e\u8c03\u7528 executor.execute(Runnable command) \u5c06\u5176\u63d0\u4ea4\u7ed9\u7ebf\u7a0b\u6c60\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4eec\u77e5\u9053\uff0cRunnable \u7684 void run() \u65b9\u6cd5\u662f\u6ca1\u6709\u8fd4\u56de\u503c\u7684\uff0c\u6240\u4ee5\uff0c\u901a\u5e38\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u7684\u8bdd\uff0c\u4f1a\u5728 submit \u4e2d\u6307\u5b9a\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f5c\u4e3a\u8fd4\u56de\u503c\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"<T> Future<T> submit(Runnable task, T result);\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u5176\u5b9e\u5230\u65f6\u5019\u4f1a\u901a\u8fc7\u8fd9\u4e24\u4e2a\u53c2\u6570\uff0c\u5c06\u5176\u5305\u88c5\u6210 Callable\u3002\u5b83\u548c Runnable \u7684\u533a\u522b\u5728\u4e8e run() \u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u800c Callable \u7684 call() \u65b9\u6cd5\u6709\u8fd4\u56de\u503c\uff0c\u540c\u65f6\uff0c\u5982\u679c\u8fd0\u884c\u51fa\u73b0\u5f02\u5e38\uff0ccall() \u65b9\u6cd5\u4f1a\u629b\u51fa\u5f02\u5e38\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public interface Callable<V> {\n\n    V call() throws Exception;\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u5728\u8fd9\u91cc\uff0c\u5c31\u4e0d\u5c55\u5f00\u8bf4 FutureTask \u7c7b\u4e86\uff0c\u56e0\u4e3a\u672c\u6587\u7bc7\u5e45\u672c\u6765\u5c31\u591f\u5927\u4e86\uff0c\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u77e5\u9053\u600e\u4e48\u7528\u5c31\u884c\u4e86\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["\u4e0b\u9762\uff0c\u6211\u4eec\u6765\u770b\u770b",(0,t.jsx)(e.code,{children:"ExecutorService"}),"\u7684\u62bd\u8c61\u5b9e\u73b0",(0,t.jsx)(e.code,{children:"AbstractExecutorService"}),"\u3002"]}),"\n",(0,t.jsx)(e.h2,{id:"abstractexecutorservice",children:"AbstractExecutorService"}),"\n",(0,t.jsx)(e.p,{children:"AbstractExecutorService \u62bd\u8c61\u7c7b\u6d3e\u751f\u81ea ExecutorService \u63a5\u53e3\uff0c\u7136\u540e\u5728\u5176\u57fa\u7840\u4e0a\u5b9e\u73b0\u4e86\u51e0\u4e2a\u5b9e\u7528\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u63d0\u4f9b\u7ed9\u5b50\u7c7b\u8fdb\u884c\u8c03\u7528\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["\u8fd9\u4e2a\u62bd\u8c61\u7c7b\u5b9e\u73b0\u4e86 invokeAny \u65b9\u6cd5\u548c invokeAll \u65b9\u6cd5\uff0c\u8fd9\u91cc\u7684\u4e24\u4e2a newTaskFor \u65b9\u6cd5\u4e5f\u6bd4\u8f83\u6709\u7528\uff0c\u7528\u4e8e\u5c06\u4efb\u52a1\u5305\u88c5\u6210 FutureTask\u3002\u5b9a\u4e49\u4e8e\u6700\u4e0a\u5c42\u63a5\u53e3 Executor\u4e2d\u7684",(0,t.jsx)(e.code,{children:"void execute(Runnable command)"}),"\u7531\u4e8e\u4e0d\u9700\u8981\u83b7\u53d6\u7ed3\u679c\uff0c\u4e0d\u4f1a\u8fdb\u884c FutureTask \u7684\u5305\u88c5\u3002"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u9700\u8981\u83b7\u53d6\u7ed3\u679c\uff08FutureTask\uff09\uff0c\u7528 submit \u65b9\u6cd5\uff0c\u4e0d\u9700\u8981\u83b7\u53d6\u7ed3\u679c\uff0c\u53ef\u4ee5\u7528 execute \u65b9\u6cd5\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u4e0b\u9762\uff0c\u6211\u5c06\u4e00\u884c\u4e00\u884c\u6e90\u7801\u5730\u6765\u5206\u6790\u8fd9\u4e2a\u7c7b\uff0c\u8ddf\u7740\u6e90\u7801\u6765\u770b\u770b\u5176\u5b9e\u73b0\u5427\uff1a"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Tips: invokeAny \u548c invokeAll \u65b9\u6cd5\u5360\u4e86\u8fd9\u6574\u4e2a\u7c7b\u7684\u7edd\u5927\u591a\u6570\u7bc7\u5e45\uff0c\u8bfb\u8005\u53ef\u4ee5\u9009\u62e9\u9002\u5f53\u8df3\u8fc7\uff0c\u56e0\u4e3a\u5b83\u4eec\u53ef\u80fd\u5728\u4f60\u7684\u5b9e\u8df5\u4e2d\u4f7f\u7528\u7684\u9891\u6b21\u6bd4\u8f83\u4f4e\uff0c\u800c\u4e14\u5b83\u4eec\u4e0d\u5e26\u6709\u627f\u524d\u542f\u540e\u7684\u4f5c\u7528\uff0c\u4e0d\u7528\u62c5\u5fc3\u4f1a\u6f0f\u6389\u4ec0\u4e48\u5bfc\u81f4\u770b\u4e0d\u61c2\u540e\u9762\u7684\u4ee3\u7801\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public abstract class AbstractExecutorService implements ExecutorService {\n\n    // RunnableFuture \u662f\u7528\u4e8e\u83b7\u53d6\u6267\u884c\u7ed3\u679c\u7684\uff0c\u6211\u4eec\u5e38\u7528\u5b83\u7684\u5b50\u7c7b FutureTask\n    // \u4e0b\u9762\u4e24\u4e2a newTaskFor \u65b9\u6cd5\u7528\u4e8e\u5c06\u6211\u4eec\u7684\u4efb\u52a1\u5305\u88c5\u6210 FutureTask \u63d0\u4ea4\u5230\u7ebf\u7a0b\u6c60\u4e2d\u6267\u884c\n    protected <T> RunnableFuture<T> newTaskFor(Runnable runnable, T value) {\n        return new FutureTask<T>(runnable, value);\n    }\n\n    protected <T> RunnableFuture<T> newTaskFor(Callable<T> callable) {\n        return new FutureTask<T>(callable);\n    }\n\n    // \u63d0\u4ea4\u4efb\u52a1\n    public Future<?> submit(Runnable task) {\n        if (task == null) throw new NullPointerException();\n        // 1\\. \u5c06\u4efb\u52a1\u5305\u88c5\u6210 FutureTask\n        RunnableFuture<Void> ftask = newTaskFor(task, null);\n        // 2\\. \u4ea4\u7ed9\u6267\u884c\u5668\u6267\u884c\uff0cexecute \u65b9\u6cd5\u7531\u5177\u4f53\u7684\u5b50\u7c7b\u6765\u5b9e\u73b0\n        // \u524d\u9762\u4e5f\u8bf4\u4e86\uff0cFutureTask \u95f4\u63a5\u5b9e\u73b0\u4e86Runnable \u63a5\u53e3\u3002\n        execute(ftask);\n        return ftask;\n    }\n\n    public <T> Future<T> submit(Runnable task, T result) {\n        if (task == null) throw new NullPointerException();\n        // 1\\. \u5c06\u4efb\u52a1\u5305\u88c5\u6210 FutureTask\n        RunnableFuture<T> ftask = newTaskFor(task, result);\n        // 2\\. \u4ea4\u7ed9\u6267\u884c\u5668\u6267\u884c\n        execute(ftask);\n        return ftask;\n    }\n\n    public <T> Future<T> submit(Callable<T> task) {\n        if (task == null) throw new NullPointerException();\n        // 1\\. \u5c06\u4efb\u52a1\u5305\u88c5\u6210 FutureTask\n        RunnableFuture<T> ftask = newTaskFor(task);\n        // 2\\. \u4ea4\u7ed9\u6267\u884c\u5668\u6267\u884c\n        execute(ftask);\n        return ftask;\n    }\n\n    // \u6b64\u65b9\u6cd5\u76ee\u7684\uff1a\u5c06 tasks \u96c6\u5408\u4e2d\u7684\u4efb\u52a1\u63d0\u4ea4\u5230\u7ebf\u7a0b\u6c60\u6267\u884c\uff0c\u4efb\u610f\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u5b8c\u540e\u5c31\u53ef\u4ee5\u7ed3\u675f\u4e86\n    // \u7b2c\u4e8c\u4e2a\u53c2\u6570 timed \u4ee3\u8868\u662f\u5426\u8bbe\u7f6e\u8d85\u65f6\u673a\u5236\uff0c\u8d85\u65f6\u65f6\u95f4\u4e3a\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\n    // \u5982\u679c timed \u4e3a true\uff0c\u540c\u65f6\u8d85\u65f6\u4e86\u8fd8\u6ca1\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8fd4\u56de\u7ed3\u679c\uff0c\u90a3\u4e48\u629b\u51fa TimeoutException \u5f02\u5e38\n    private <T> T doInvokeAny(Collection<? extends Callable<T>> tasks,\n                            boolean timed, long nanos)\n        throws InterruptedException, ExecutionException, TimeoutException {\n        if (tasks == null)\n            throw new NullPointerException();\n        // \u4efb\u52a1\u6570\n        int ntasks = tasks.size();\n        if (ntasks == 0)\n            throw new IllegalArgumentException();\n        // \n        List<Future<T>> futures= new ArrayList<Future<T>>(ntasks);\n\n        // ExecutorCompletionService \u4e0d\u662f\u4e00\u4e2a\u771f\u6b63\u7684\u6267\u884c\u5668\uff0c\u53c2\u6570 this \u624d\u662f\u771f\u6b63\u7684\u6267\u884c\u5668\n        // \u5b83\u5bf9\u6267\u884c\u5668\u8fdb\u884c\u4e86\u5305\u88c5\uff0c\u6bcf\u4e2a\u4efb\u52a1\u7ed3\u675f\u540e\uff0c\u5c06\u7ed3\u679c\u4fdd\u5b58\u5230\u5185\u90e8\u7684\u4e00\u4e2a completionQueue \u961f\u5217\u4e2d\n        // \u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u7c7b\u7684\u540d\u5b57\u91cc\u9762\u6709\u4e2a Completion \u7684\u539f\u56e0\u5427\u3002\n        ExecutorCompletionService<T> ecs =\n            new ExecutorCompletionService<T>(this);\n        try {\n            // \u7528\u4e8e\u4fdd\u5b58\u5f02\u5e38\u4fe1\u606f\uff0c\u6b64\u65b9\u6cd5\u5982\u679c\u6ca1\u6709\u5f97\u5230\u4efb\u4f55\u6709\u6548\u7684\u7ed3\u679c\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u629b\u51fa\u6700\u540e\u5f97\u5230\u7684\u4e00\u4e2a\u5f02\u5e38\n            ExecutionException ee = null;\n            long lastTime = timed ? System.nanoTime() : 0;\n            Iterator<? extends Callable<T>> it = tasks.iterator();\n\n            // \u9996\u5148\u5148\u63d0\u4ea4\u4e00\u4e2a\u4efb\u52a1\uff0c\u540e\u9762\u7684\u4efb\u52a1\u5230\u4e0b\u9762\u7684 for \u5faa\u73af\u4e00\u4e2a\u4e2a\u63d0\u4ea4\n            futures.add(ecs.submit(it.next()));\n            // \u63d0\u4ea4\u4e86\u4e00\u4e2a\u4efb\u52a1\uff0c\u6240\u4ee5\u4efb\u52a1\u6570\u91cf\u51cf 1\n            --ntasks;\n            // \u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\u6570(\u63d0\u4ea4\u7684\u65f6\u5019 +1\uff0c\u4efb\u52a1\u7ed3\u675f\u7684\u65f6\u5019 -1)\n            int active = 1;\n\n            for (;;) {\n                // ecs \u4e0a\u9762\u8bf4\u4e86\uff0c\u5176\u5185\u90e8\u6709\u4e00\u4e2a completionQueue \u7528\u4e8e\u4fdd\u5b58\u6267\u884c\u5b8c\u6210\u7684\u7ed3\u679c\n                // BlockingQueue \u7684 poll \u65b9\u6cd5\u4e0d\u963b\u585e\uff0c\u8fd4\u56de null \u4ee3\u8868\u961f\u5217\u4e3a\u7a7a\n                Future<T> f = ecs.poll();\n                // \u4e3a null\uff0c\u8bf4\u660e\u521a\u521a\u63d0\u4ea4\u7684\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u8fd8\u6ca1\u6709\u6267\u884c\u5b8c\u6210\n                // \u5728\u524d\u9762\u5148\u63d0\u4ea4\u4e00\u4e2a\u4efb\u52a1\uff0c\u52a0\u4e0a\u8fd9\u91cc\u505a\u4e00\u6b21\u68c0\u67e5\uff0c\u4e5f\u662f\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\n                if (f == null) {\n                    if (ntasks > 0) {\n                        --ntasks;\n                        futures.add(ecs.submit(it.next()));\n                        ++active;\n                    }\n                    // \u8fd9\u91cc\u662f else if\uff0c\u4e0d\u662f if\u3002\u8fd9\u91cc\u8bf4\u660e\uff0c\u6ca1\u6709\u4efb\u52a1\u4e86\uff0c\u540c\u65f6 active \u4e3a 0 \u8bf4\u660e\n                    // \u4efb\u52a1\u90fd\u6267\u884c\u5b8c\u6210\u4e86\u3002\u5176\u5b9e\u6211\u4e5f\u6ca1\u7406\u89e3\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u505a\u4e00\u6b21 break\uff1f\n                    // \u56e0\u4e3a\u6211\u8ba4\u4e3a active \u4e3a 0 \u7684\u60c5\u51b5\uff0c\u5fc5\u7136\u4ece\u4e0b\u9762\u7684 f.get() \u8fd4\u56de\u4e86\n\n                    // 2018-02-23 \u611f\u8c22\u8bfb\u8005 newmicro \u7684 comment\uff0c\n                    //  \u8fd9\u91cc\u7684 active == 0\uff0c\u8bf4\u660e\u6240\u6709\u7684\u4efb\u52a1\u90fd\u6267\u884c\u5931\u8d25\uff0c\u90a3\u4e48\u8fd9\u91cc\u662f for \u5faa\u73af\u51fa\u53e3\n                    else if (active == 0)\n                        break;\n                    // \u8fd9\u91cc\u4e5f\u662f else if\u3002\u8fd9\u91cc\u8bf4\u7684\u662f\uff0c\u6ca1\u6709\u4efb\u52a1\u4e86\uff0c\u4f46\u662f\u8bbe\u7f6e\u4e86\u8d85\u65f6\u65f6\u95f4\uff0c\u8fd9\u91cc\u68c0\u6d4b\u662f\u5426\u8d85\u65f6\n                    else if (timed) {\n                        // \u5e26\u7b49\u5f85\u7684 poll \u65b9\u6cd5\n                        f = ecs.poll(nanos, TimeUnit.NANOSECONDS);\n                        // \u5982\u679c\u5df2\u7ecf\u8d85\u65f6\uff0c\u629b\u51fa TimeoutException \u5f02\u5e38\uff0c\u8fd9\u6574\u4e2a\u65b9\u6cd5\u5c31\u7ed3\u675f\u4e86\n                        if (f == null)\n                            throw new TimeoutException();\n                        long now = System.nanoTime();\n                        nanos -= now - lastTime;\n                        lastTime = now;\n                    }\n                    // \u8fd9\u91cc\u662f else\u3002\u8bf4\u660e\uff0c\u6ca1\u6709\u4efb\u52a1\u9700\u8981\u63d0\u4ea4\uff0c\u4f46\u662f\u6c60\u4e2d\u7684\u4efb\u52a1\u6ca1\u6709\u5b8c\u6210\uff0c\u8fd8\u6ca1\u6709\u8d85\u65f6(\u5982\u679c\u8bbe\u7f6e\u4e86\u8d85\u65f6)\n                    // take() \u65b9\u6cd5\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u6709\u5143\u7d20\u8fd4\u56de\uff0c\u8bf4\u660e\u6709\u4efb\u52a1\u7ed3\u675f\u4e86\n                    else\n                        f = ecs.take();\n                }\n                /*\n                 * \u6211\u611f\u89c9\u4e0a\u9762\u8fd9\u4e00\u6bb5\u5e76\u4e0d\u662f\u5f88\u597d\u7406\u89e3\uff0c\u8fd9\u91cc\u7b80\u5355\u8bf4\u4e0b\u3002\n                 * 1\\. \u9996\u5148\uff0c\u8fd9\u5728\u4e00\u4e2a for \u5faa\u73af\u4e2d\uff0c\u6211\u4eec\u8bbe\u60f3\u6bcf\u4e00\u4e2a\u4efb\u52a1\u90fd\u6ca1\u90a3\u4e48\u5feb\u7ed3\u675f\uff0c\n                 *     \u90a3\u4e48\uff0c\u6bcf\u4e00\u6b21\u90fd\u4f1a\u8fdb\u5230\u7b2c\u4e00\u4e2a\u5206\u652f\uff0c\u8fdb\u884c\u63d0\u4ea4\u4efb\u52a1\uff0c\u76f4\u5230\u5c06\u6240\u6709\u7684\u4efb\u52a1\u90fd\u63d0\u4ea4\u4e86\n                 * 2\\. \u4efb\u52a1\u90fd\u63d0\u4ea4\u5b8c\u6210\u540e\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u8d85\u65f6\uff0c\u90a3\u4e48 for \u5faa\u73af\u5176\u5b9e\u8fdb\u5165\u4e86\u201c\u4e00\u76f4\u68c0\u6d4b\u662f\u5426\u8d85\u65f6\u201d\n                       \u8fd9\u4ef6\u4e8b\u60c5\u4e0a\n                 * 3\\. \u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u8d85\u65f6\u673a\u5236\uff0c\u90a3\u4e48\u4e0d\u5fc5\u8981\u68c0\u6d4b\u8d85\u65f6\uff0c\u90a3\u5c31\u4f1a\u963b\u585e\u5728 ecs.take() \u65b9\u6cd5\u4e0a\uff0c\n                       \u7b49\u5f85\u83b7\u53d6\u7b2c\u4e00\u4e2a\u6267\u884c\u7ed3\u679c\n                 * 4\\. \u5982\u679c\u6240\u6709\u7684\u4efb\u52a1\u90fd\u6267\u884c\u5931\u8d25\uff0c\u4e5f\u5c31\u662f\u8bf4 future \u90fd\u8fd4\u56de\u4e86\uff0c\n                       \u4f46\u662f f.get() \u629b\u51fa\u5f02\u5e38\uff0c\u90a3\u4e48\u4ece active == 0 \u5206\u652f\u51fa\u53bb(\u611f\u8c22 newmicro \u63d0\u51fa)\n                         // \u5f53\u7136\uff0c\u8fd9\u4e2a\u9700\u8981\u770b\u4e0b\u9762\u7684 if \u5206\u652f\u3002\n                 */\n\n                // \u6709\u4efb\u52a1\u7ed3\u675f\u4e86\n                if (f != null) {\n                    --active;\n                    try {\n                        // \u8fd4\u56de\u6267\u884c\u7ed3\u679c\uff0c\u5982\u679c\u6709\u5f02\u5e38\uff0c\u90fd\u5305\u88c5\u6210 ExecutionException\n                        return f.get();\n                    } catch (ExecutionException eex) {\n                        ee = eex;\n                    } catch (RuntimeException rex) {\n                        ee = new ExecutionException(rex);\n                    }\n                }\n            }// \u6ce8\u610f\u770b for \u5faa\u73af\u7684\u8303\u56f4\uff0c\u4e00\u76f4\u5230\u8fd9\u91cc\n\n            if (ee == null)\n                ee = new ExecutionException();\n            throw ee;\n\n        } finally {\n            // \u65b9\u6cd5\u9000\u51fa\u4e4b\u524d\uff0c\u53d6\u6d88\u5176\u4ed6\u7684\u4efb\u52a1\n            for (Future<T> f : futures)\n                f.cancel(true);\n        }\n    }\n\n    public <T> T invokeAny(Collection<? extends Callable<T>> tasks)\n        throws InterruptedException, ExecutionException {\n        try {\n            return doInvokeAny(tasks, false, 0);\n        } catch (TimeoutException cannotHappen) {\n            assert false;\n            return null;\n        }\n    }\n\n    public <T> T invokeAny(Collection<? extends Callable<T>> tasks,\n                           long timeout, TimeUnit unit)\n        throws InterruptedException, ExecutionException, TimeoutException {\n        return doInvokeAny(tasks, true, unit.toNanos(timeout));\n    }\n\n    // \u6267\u884c\u6240\u6709\u7684\u4efb\u52a1\uff0c\u8fd4\u56de\u4efb\u52a1\u7ed3\u679c\u3002\n    // \u5148\u4e0d\u8981\u770b\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u6211\u4eec\u5148\u60f3\u60f3\uff0c\u5176\u5b9e\u6211\u4eec\u81ea\u5df1\u63d0\u4ea4\u4efb\u52a1\u5230\u7ebf\u7a0b\u6c60\uff0c\u4e5f\u662f\u60f3\u8981\u7ebf\u7a0b\u6c60\u6267\u884c\u6240\u6709\u7684\u4efb\u52a1\n    // \u53ea\u4e0d\u8fc7\uff0c\u6211\u4eec\u662f\u6bcf\u6b21 submit \u4e00\u4e2a\u4efb\u52a1\uff0c\u8fd9\u91cc\u4ee5\u4e00\u4e2a\u96c6\u5408\u4f5c\u4e3a\u53c2\u6570\u63d0\u4ea4\n    public <T> List<Future<T>> invokeAll(Collection<? extends Callable<T>> tasks)\n        throws InterruptedException {\n        if (tasks == null)\n            throw new NullPointerException();\n        List<Future<T>> futures = new ArrayList<Future<T>>(tasks.size());\n        boolean done = false;\n        try {\n            // \u8fd9\u4e2a\u5f88\u7b80\u5355\n            for (Callable<T> t : tasks) {\n                // \u5305\u88c5\u6210 FutureTask\n                RunnableFuture<T> f = newTaskFor(t);\n                futures.add(f);\n                // \u63d0\u4ea4\u4efb\u52a1\n                execute(f);\n            }\n            for (Future<T> f : futures) {\n                if (!f.isDone()) {\n                    try {\n                        // \u8fd9\u662f\u4e00\u4e2a\u963b\u585e\u65b9\u6cd5\uff0c\u76f4\u5230\u83b7\u53d6\u5230\u503c\uff0c\u6216\u629b\u51fa\u4e86\u5f02\u5e38\n                        // \u8fd9\u91cc\u6709\u4e2a\u5c0f\u7ec6\u8282\uff0c\u5176\u5b9e get \u65b9\u6cd5\u7b7e\u540d\u4e0a\u662f\u4f1a\u629b\u51fa InterruptedException \u7684\n                        // \u53ef\u662f\u8fd9\u91cc\u6ca1\u6709\u8fdb\u884c\u5904\u7406\uff0c\u800c\u662f\u629b\u7ed9\u5916\u5c42\u53bb\u4e86\u3002\u6b64\u5f02\u5e38\u53d1\u751f\u4e8e\u8fd8\u6ca1\u6267\u884c\u5b8c\u7684\u4efb\u52a1\u88ab\u53d6\u6d88\u4e86\n                        f.get();\n                    } catch (CancellationException ignore) {\n                    } catch (ExecutionException ignore) {\n                    }\n                }\n            }\n            done = true;\n            // \u8fd9\u4e2a\u65b9\u6cd5\u8fd4\u56de\uff0c\u4e0d\u50cf\u5176\u4ed6\u7684\u573a\u666f\uff0c\u8fd4\u56de List<Future>\uff0c\u5176\u5b9e\u6267\u884c\u7ed3\u679c\u8fd8\u6ca1\u51fa\u6765\n            // \u8fd9\u4e2a\u65b9\u6cd5\u8fd4\u56de\u662f\u771f\u6b63\u7684\u8fd4\u56de\uff0c\u4efb\u52a1\u90fd\u7ed3\u675f\u4e86\n            return futures;\n        } finally {\n            // \u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e2a\uff1f\u5c31\u662f\u4e0a\u9762\u8bf4\u7684\u6709\u5f02\u5e38\u7684\u60c5\u51b5\n            if (!done)\n                for (Future<T> f : futures)\n                    f.cancel(true);\n        }\n    }\n\n    // \u5e26\u8d85\u65f6\u7684 invokeAll\uff0c\u6211\u4eec\u627e\u4e0d\u540c\u5427\n    public <T> List<Future<T>> invokeAll(Collection<? extends Callable<T>> tasks,\n                                         long timeout, TimeUnit unit)\n        throws InterruptedException {\n        if (tasks == null || unit == null)\n            throw new NullPointerException();\n        long nanos = unit.toNanos(timeout);\n        List<Future<T>> futures = new ArrayList<Future<T>>(tasks.size());\n        boolean done = false;\n        try {\n            for (Callable<T> t : tasks)\n                futures.add(newTaskFor(t));\n\n            long lastTime = System.nanoTime();\n\n            Iterator<Future<T>> it = futures.iterator();\n            // \u6bcf\u63d0\u4ea4\u4e00\u4e2a\u4efb\u52a1\uff0c\u68c0\u6d4b\u4e00\u6b21\u662f\u5426\u8d85\u65f6\n            while (it.hasNext()) {\n                execute((Runnable)(it.next()));\n                long now = System.nanoTime();\n                nanos -= now - lastTime;\n                lastTime = now;\n                // \u8d85\u65f6\n                if (nanos <= 0)\n                    return futures;\n            }\n\n            for (Future<T> f : futures) {\n                if (!f.isDone()) {\n                    if (nanos <= 0)\n                        return futures;\n                    try {\n                        // \u8c03\u7528\u5e26\u8d85\u65f6\u7684 get \u65b9\u6cd5\uff0c\u8fd9\u91cc\u7684\u53c2\u6570 nanos \u662f\u5269\u4f59\u7684\u65f6\u95f4\uff0c\n                        // \u56e0\u4e3a\u4e0a\u9762\u5176\u5b9e\u5df2\u7ecf\u7528\u6389\u4e86\u4e00\u4e9b\u65f6\u95f4\u4e86\n                        f.get(nanos, TimeUnit.NANOSECONDS);\n                    } catch (CancellationException ignore) {\n                    } catch (ExecutionException ignore) {\n                    } catch (TimeoutException toe) {\n                        return futures;\n                    }\n                    long now = System.nanoTime();\n                    nanos -= now - lastTime;\n                    lastTime = now;\n                }\n            }\n            done = true;\n            return futures;\n        } finally {\n            if (!done)\n                for (Future<T> f : futures)\n                    f.cancel(true);\n        }\n    }\n\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e2a\u62bd\u8c61\u7c7b\u5305\u88c5\u4e86\u4e00\u4e9b\u57fa\u672c\u7684\u65b9\u6cd5\uff0c\u53ef\u662f\u50cf submit\u3001invokeAny\u3001invokeAll \u7b49\u65b9\u6cd5\uff0c\u5b83\u4eec\u90fd\u6ca1\u6709\u771f\u6b63\u5f00\u542f\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\uff0c\u5b83\u4eec\u90fd\u53ea\u662f\u5728\u65b9\u6cd5\u5185\u90e8\u8c03\u7528\u4e86 execute \u65b9\u6cd5\uff0c\u6240\u4ee5\u6700\u91cd\u8981\u7684 execute(Runnable runnable) \u65b9\u6cd5\u8fd8\u6ca1\u51fa\u73b0\uff0c\u9700\u8981\u7b49\u5177\u4f53\u6267\u884c\u5668\u6765\u5b9e\u73b0\u8fd9\u4e2a\u6700\u91cd\u8981\u7684\u90e8\u5206\uff0c\u8fd9\u91cc\u6211\u4eec\u8981\u8bf4\u7684\u5c31\u662f ThreadPoolExecutor \u7c7b\u4e86\u3002"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u9274\u4e8e\u672c\u6587\u7684\u7bc7\u5e45\uff0c\u6211\u89c9\u5f97\u770b\u5230\u8fd9\u91cc\u7684\u8bfb\u8005\u5e94\u8be5\u5df2\u7ecf\u4e0d\u591a\u4e86\uff0c\u5927\u5bb6\u90fd\u4e60\u60ef\u4e86\u5feb\u9910\u6587\u5316\u3002\u6211\u5199\u7684\u6bcf\u7bc7\u6587\u7ae0\u90fd\u529b\u6c42\u8ba9\u8bfb\u8005\u53ef\u4ee5\u901a\u8fc7\u6211\u7684\u4e00\u7bc7\u6587\u7ae0\u800c\u5bf9\u76f8\u5173\u5185\u5bb9\u6709\u5168\u9762\u7684\u4e86\u89e3\uff0c\u6240\u4ee5\u7bc7\u5e45\u4e0d\u514d\u957f\u4e86\u4e9b\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"threadpoolexecutor",children:"ThreadPoolExecutor"}),"\n",(0,t.jsx)(e.p,{children:"ThreadPoolExecutor \u662f JDK \u4e2d\u7684\u7ebf\u7a0b\u6c60\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u9700\u8981\u7684\u5404\u4e2a\u65b9\u6cd5\uff0c\u5b83\u5b9e\u73b0\u4e86\u4efb\u52a1\u63d0\u4ea4\u3001\u7ebf\u7a0b\u7ba1\u7406\u3001\u76d1\u63a7\u7b49\u7b49\u65b9\u6cd5\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u5b83\u6765\u8fdb\u884c\u4e1a\u52a1\u4e0a\u7684\u6269\u5c55\uff0c\u4ee5\u5b9e\u73b0\u6211\u4eec\u9700\u8981\u7684\u5176\u4ed6\u529f\u80fd\uff0c\u6bd4\u5982\u5b9e\u73b0\u5b9a\u65f6\u4efb\u52a1\u7684\u7c7b ScheduledThreadPoolExecutor \u5c31\u7ee7\u627f\u81ea ThreadPoolExecutor\u3002\u5f53\u7136\uff0c\u8fd9\u4e0d\u662f\u672c\u6587\u5173\u6ce8\u7684\u91cd\u70b9\uff0c\u4e0b\u9762\uff0c\u8fd8\u662f\u8d76\u7d27\u8fdb\u884c\u6e90\u7801\u5206\u6790\u5427\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u9996\u5148\uff0c\u6211\u4eec\u6765\u770b\u770b\u7ebf\u7a0b\u6c60\u5b9e\u73b0\u4e2d\u7684\u51e0\u4e2a\u6982\u5ff5\u548c\u5904\u7406\u6d41\u7a0b\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4eec\u5148\u56de\u987e\u4e0b\u63d0\u4ea4\u4efb\u52a1\u7684\u51e0\u4e2a\u65b9\u6cd5\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public Future<?> submit(Runnable task) {\n    if (task == null) throw new NullPointerException();\n    RunnableFuture<Void> ftask = newTaskFor(task, null);\n    execute(ftask);\n    return ftask;\n}\npublic <T> Future<T> submit(Runnable task, T result) {\n    if (task == null) throw new NullPointerException();\n    RunnableFuture<T> ftask = newTaskFor(task, result);\n    execute(ftask);\n    return ftask;\n}\npublic <T> Future<T> submit(Callable<T> task) {\n    if (task == null) throw new NullPointerException();\n    RunnableFuture<T> ftask = newTaskFor(task);\n    execute(ftask);\n    return ftask;\n}\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u4e00\u4e2a\u6700\u57fa\u672c\u7684\u6982\u5ff5\u662f\uff0csubmit \u65b9\u6cd5\u4e2d\uff0c\u53c2\u6570\u662f Runnable \u7c7b\u578b\uff08\u4e5f\u6709Callable \u7c7b\u578b\uff09\uff0c\u8fd9\u4e2a\u53c2\u6570\u4e0d\u662f\u7528\u4e8e new Thread(",(0,t.jsx)(e.strong,{children:"runnable"}),").start() \u4e2d\u7684\uff0c\u6b64\u5904\u7684\u8fd9\u4e2a\u53c2\u6570\u4e0d\u662f\u7528\u4e8e\u542f\u52a8\u7ebf\u7a0b\u7684\uff0c\u8fd9\u91cc\u6307\u7684\u662f",(0,t.jsx)(e.strong,{children:"\u4efb\u52a1"}),"\uff0c\u4efb\u52a1\u8981\u505a\u7684\u4e8b\u60c5\u662f run() \u65b9\u6cd5\u91cc\u9762\u5b9a\u4e49\u7684\u6216 Callable \u4e2d\u7684 call() \u65b9\u6cd5\u91cc\u9762\u5b9a\u4e49\u7684\u3002"]}),"\n",(0,t.jsx)(e.p,{children:"\u521d\u5b66\u8005\u5f80\u5f80\u4f1a\u641e\u6df7\u8fd9\u4e2a\uff0c\u56e0\u4e3a Runnable \u603b\u662f\u5728\u5404\u4e2a\u5730\u65b9\u51fa\u73b0\uff0c\u7ecf\u5e38\u628a\u4e00\u4e2a Runnable \u5305\u5230\u53e6\u4e00\u4e2a Runnable \u4e2d\u3002\u8bf7\u628a\u5b83\u60f3\u8c61\u6210\u6709\u4e2a Task \u63a5\u53e3\uff0c\u8fd9\u4e2a\u63a5\u53e3\u91cc\u9762\u6709\u4e00\u4e2a run() \u65b9\u6cd5\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4eec\u56de\u8fc7\u795e\u6765\u7ee7\u7eed\u5f80\u4e0b\u770b\uff0c\u6211\u753b\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u610f\u56fe\u6765\u63cf\u8ff0\u7ebf\u7a0b\u6c60\u4e2d\u7684\u4e00\u4e9b\u4e3b\u8981\u7684\u6784\u4ef6\uff1a"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"https://www.javadoop.com/blogimages/java-thread-pool/pool-1.png",alt:"pool-1"})}),"\n",(0,t.jsx)(e.p,{children:"\u5f53\u7136\uff0c\u4e0a\u56fe\u6ca1\u6709\u8003\u8651\u961f\u5217\u662f\u5426\u6709\u754c\uff0c\u63d0\u4ea4\u4efb\u52a1\u65f6\u961f\u5217\u6ee1\u4e86\u600e\u4e48\u529e\uff1f\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\uff1f\u63d0\u4ea4\u4efb\u52a1\u65f6\u7ebf\u7a0b\u6c60\u6ee1\u4e86\u600e\u4e48\u529e\uff1f\u7a7a\u95f2\u7ebf\u7a0b\u600e\u4e48\u5173\u6389\uff1f\u8fd9\u4e9b\u95ee\u9898\u4e0b\u9762\u6211\u4eec\u4f1a\u4e00\u4e00\u89e3\u51b3\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["\u6211\u4eec\u7ecf\u5e38\u4f1a\u4f7f\u7528",(0,t.jsx)(e.code,{children:"Executors"}),"\u8fd9\u4e2a\u5de5\u5177\u7c7b\u6765\u5feb\u901f\u6784\u9020\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff0c\u5bf9\u4e8e\u521d\u5b66\u8005\u800c\u8a00\uff0c\u8fd9\u79cd\u5de5\u5177\u7c7b\u662f\u5f88\u6709\u7528\u7684\uff0c\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u5173\u6ce8\u592a\u591a\u7684\u7ec6\u8282\uff0c\u53ea\u8981\u77e5\u9053\u81ea\u5df1\u9700\u8981\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff0c\u4ec5\u4ec5\u63d0\u4f9b\u5fc5\u9700\u7684\u53c2\u6570\u5c31\u53ef\u4ee5\u4e86\uff0c\u5176\u4ed6\u53c2\u6570\u90fd\u91c7\u7528\u4f5c\u8005\u63d0\u4f9b\u7684\u9ed8\u8ba4\u503c\u3002"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public static ExecutorService newFixedThreadPool(int nThreads) {\n    return new ThreadPoolExecutor(nThreads, nThreads,\n                                  0L, TimeUnit.MILLISECONDS,\n                                  new LinkedBlockingQueue<Runnable>());\n}\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue<Runnable>());\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u8fd9\u91cc\u5148\u4e0d\u8bf4\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u5b83\u4eec\u6700\u7ec8\u90fd\u4f1a\u5bfc\u5411\u8fd9\u4e2a\u6784\u9020\u65b9\u6cd5\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"    public ThreadPoolExecutor(int corePoolSize,\n                              int maximumPoolSize,\n                              long keepAliveTime,\n                              TimeUnit unit,\n                              BlockingQueue<Runnable> workQueue,\n                              ThreadFactory threadFactory,\n                              RejectedExecutionHandler handler) {\n        if (corePoolSize < 0 ||\n            maximumPoolSize <= 0 ||\n            maximumPoolSize < corePoolSize ||\n            keepAliveTime < 0)\n            throw new IllegalArgumentException();\n        // \u8fd9\u51e0\u4e2a\u53c2\u6570\u90fd\u662f\u5fc5\u987b\u8981\u6709\u7684\n        if (workQueue == null || threadFactory == null || handler == null)\n            throw new NullPointerException();\n\n        this.corePoolSize = corePoolSize;\n        this.maximumPoolSize = maximumPoolSize;\n        this.workQueue = workQueue;\n        this.keepAliveTime = unit.toNanos(keepAliveTime);\n        this.threadFactory = threadFactory;\n        this.handler = handler;\n    }\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u57fa\u672c\u4e0a\uff0c\u4e0a\u9762\u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u5217\u51fa\u4e86\u6211\u4eec\u6700\u9700\u8981\u5173\u5fc3\u7684\u51e0\u4e2a\u5c5e\u6027\u4e86\uff0c\u4e0b\u9762\u9010\u4e2a\u4ecb\u7ecd\u4e0b\u6784\u9020\u65b9\u6cd5\u4e2d\u51fa\u73b0\u7684\u8fd9\u51e0\u4e2a\u5c5e\u6027\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"corePoolSize"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u4e0d\u8981\u62a0\u5b57\u773c\uff0c\u53cd\u6b63\u5148\u8bb0\u7740\u6709\u8fd9\u4e48\u4e2a\u5c5e\u6027\u5c31\u53ef\u4ee5\u4e86\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"maximumPoolSize"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u7ebf\u7a0b\u6c60\u5141\u8bb8\u521b\u5efa\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"workQueue"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u4efb\u52a1\u961f\u5217\uff0cBlockingQueue \u63a5\u53e3\u7684\u67d0\u4e2a\u5b9e\u73b0\uff08\u5e38\u4f7f\u7528 ArrayBlockingQueue \u548c LinkedBlockingQueue\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"keepAliveTime"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.p,{children:["\u7a7a\u95f2\u7ebf\u7a0b\u7684\u4fdd\u6d3b\u65f6\u95f4\uff0c\u5982\u679c\u67d0\u7ebf\u7a0b\u7684\u7a7a\u95f2\u65f6\u95f4\u8d85\u8fc7\u8fd9\u4e2a\u503c\u90fd\u6ca1\u6709\u4efb\u52a1\u7ed9\u5b83\u505a\uff0c\u90a3\u4e48\u53ef\u4ee5\u88ab\u5173\u95ed\u4e86\u3002\u6ce8\u610f\u8fd9\u4e2a\u503c\u5e76\u4e0d\u4f1a\u5bf9\u6240\u6709\u7ebf\u7a0b\u8d77\u4f5c\u7528\uff0c\u5982\u679c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u5c11\u4e8e\u7b49\u4e8e\u6838\u5fc3\u7ebf\u7a0b\u6570 corePoolSize\uff0c\u90a3\u4e48\u8fd9\u4e9b\u7ebf\u7a0b\u4e0d\u4f1a\u56e0\u4e3a\u7a7a\u95f2\u592a\u957f\u65f6\u95f4\u800c\u88ab\u5173\u95ed\uff0c\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528",(0,t.jsx)(e.code,{children:"allowCoreThreadTimeOut(true)"}),"\u4f7f\u6838\u5fc3\u7ebf\u7a0b\u6570\u5185\u7684\u7ebf\u7a0b\u4e5f\u53ef\u4ee5\u88ab\u56de\u6536\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"threadFactory"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u7528\u4e8e\u751f\u6210\u7ebf\u7a0b\uff0c\u4e00\u822c\u6211\u4eec\u53ef\u4ee5\u7528\u9ed8\u8ba4\u7684\u5c31\u53ef\u4ee5\u4e86\u3002\u901a\u5e38\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b83\u5c06\u6211\u4eec\u7684\u7ebf\u7a0b\u7684\u540d\u5b57\u8bbe\u7f6e\u5f97\u6bd4\u8f83\u53ef\u8bfb\u4e00\u4e9b\uff0c\u5982 Message-Thread-1\uff0c Message-Thread-2 \u7c7b\u4f3c\u8fd9\u6837\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"handler\uff1a"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u5f53\u7ebf\u7a0b\u6c60\u5df2\u7ecf\u6ee1\u4e86\uff0c\u4f46\u662f\u53c8\u6709\u65b0\u7684\u4efb\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u8be5\u91c7\u53d6\u4ec0\u4e48\u7b56\u7565\u7531\u8fd9\u4e2a\u6765\u6307\u5b9a\u3002\u6709\u51e0\u79cd\u65b9\u5f0f\u53ef\u4f9b\u9009\u62e9\uff0c\u50cf\u629b\u51fa\u5f02\u5e38\u3001\u76f4\u63a5\u62d2\u7edd\u7136\u540e\u8fd4\u56de\u7b49\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u76f8\u5e94\u7684\u63a5\u53e3\u5b9e\u73b0\u81ea\u5df1\u7684\u903b\u8f91\uff0c\u8fd9\u4e2a\u4e4b\u540e\u518d\u8bf4\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u9664\u4e86\u4e0a\u9762\u51e0\u4e2a\u5c5e\u6027\u5916\uff0c\u6211\u4eec\u518d\u770b\u770b\u5176\u4ed6\u91cd\u8981\u7684\u5c5e\u6027\u3002"}),"\n",(0,t.jsx)(e.p,{children:"Doug Lea \u91c7\u7528\u4e00\u4e2a 32 \u4f4d\u7684\u6574\u6570\u6765\u5b58\u653e\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u548c\u5f53\u524d\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\uff0c\u5176\u4e2d\u9ad8 3 \u4f4d\u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u6c60\u72b6\u6001\uff0c\u4f4e 29 \u4f4d\u8868\u793a\u7ebf\u7a0b\u6570\uff08\u5373\u4f7f\u53ea\u6709 29 \u4f4d\uff0c\u4e5f\u5df2\u7ecf\u4e0d\u5c0f\u4e86\uff0c\u5927\u6982 5 \u4ebf\u591a\uff0c\u73b0\u5728\u8fd8\u6ca1\u6709\u54ea\u4e2a\u673a\u5668\u80fd\u8d77\u8fd9\u4e48\u591a\u7ebf\u7a0b\u7684\u5427\uff09\u3002\u6211\u4eec\u77e5\u9053\uff0cjava \u8bed\u8a00\u5728\u6574\u6570\u7f16\u7801\u4e0a\u662f\u7edf\u4e00\u7684\uff0c\u90fd\u662f\u91c7\u7528\u8865\u7801\u7684\u5f62\u5f0f\uff0c\u4e0b\u9762\u662f\u7b80\u5355\u7684\u79fb\u4f4d\u64cd\u4f5c\u548c\u5e03\u5c14\u64cd\u4f5c\uff0c\u90fd\u662f\u633a\u7b80\u5355\u7684\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"\nprivate final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));\n\n// \u8fd9\u91cc COUNT_BITS \u8bbe\u7f6e\u4e3a 29(32-3)\uff0c\u610f\u5473\u7740\u524d\u4e09\u4f4d\u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u72b6\u6001\uff0c\u540e29\u4f4d\u7528\u4e8e\u5b58\u653e\u7ebf\u7a0b\u6570\n// \u5f88\u591a\u521d\u5b66\u8005\u5f88\u559c\u6b22\u5728\u81ea\u5df1\u7684\u4ee3\u7801\u4e2d\u5199\u5f88\u591a 29 \u8fd9\u79cd\u6570\u5b57\uff0c\u6216\u8005\u67d0\u4e2a\u7279\u6b8a\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u5206\u5e03\u5728\u5404\u4e2a\u5730\u65b9\uff0c\u8fd9\u662f\u975e\u5e38\u7cdf\u7cd5\u7684\nprivate static final int COUNT_BITS = Integer.SIZE - 3;\n\n// 000 11111111111111111111111111111\n// \u8fd9\u91cc\u5f97\u5230\u7684\u662f 29 \u4e2a 1\uff0c\u4e5f\u5c31\u662f\u8bf4\u7ebf\u7a0b\u6c60\u7684\u6700\u5927\u7ebf\u7a0b\u6570\u662f 2^29-1=536870911\n// \u4ee5\u6211\u4eec\u73b0\u5728\u8ba1\u7b97\u673a\u7684\u5b9e\u9645\u60c5\u51b5\uff0c\u8fd9\u4e2a\u6570\u91cf\u8fd8\u662f\u591f\u7528\u7684\nprivate static final int CAPACITY   = (1 << COUNT_BITS) - 1;\n\n// \u6211\u4eec\u8bf4\u4e86\uff0c\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u5b58\u653e\u5728\u9ad8 3 \u4f4d\u4e2d\n// \u8fd0\u7b97\u7ed3\u679c\u4e3a 111\u8ddf29\u4e2a0\uff1a111 00000000000000000000000000000\nprivate static final int RUNNING    = -1 << COUNT_BITS;\n// 000 00000000000000000000000000000\nprivate static final int SHUTDOWN   =  0 << COUNT_BITS;\n// 001 00000000000000000000000000000\nprivate static final int STOP       =  1 << COUNT_BITS;\n// 010 00000000000000000000000000000\nprivate static final int TIDYING    =  2 << COUNT_BITS;\n// 011 00000000000000000000000000000\nprivate static final int TERMINATED =  3 << COUNT_BITS;\n\n// \u5c06\u6574\u6570 c \u7684\u4f4e 29 \u4f4d\u4fee\u6539\u4e3a 0\uff0c\u5c31\u5f97\u5230\u4e86\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\nprivate static int runStateOf(int c)     { return c & ~CAPACITY; }\n// \u5c06\u6574\u6570 c \u7684\u9ad8 3 \u4e3a\u4fee\u6539\u4e3a 0\uff0c\u5c31\u5f97\u5230\u4e86\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\nprivate static int workerCountOf(int c)  { return c & CAPACITY; }\n\nprivate static int ctlOf(int rs, int wc) { return rs | wc; }\n\n/*\n * Bit field accessors that don't require unpacking ctl.\n * These depend on the bit layout and on workerCount being never negative.\n */\n\nprivate static boolean runStateLessThan(int c, int s) {\n    return c < s;\n}\n\nprivate static boolean runStateAtLeast(int c, int s) {\n    return c >= s;\n}\n\nprivate static boolean isRunning(int c) {\n    return c < SHUTDOWN;\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u4e0a\u9762\u5c31\u662f\u5bf9\u4e00\u4e2a\u6574\u6570\u7684\u7b80\u5355\u7684\u4f4d\u64cd\u4f5c\uff0c\u51e0\u4e2a\u64cd\u4f5c\u65b9\u6cd5\u5c06\u4f1a\u5728\u540e\u9762\u7684\u6e90\u7801\u4e2d\u4e00\u76f4\u51fa\u73b0\uff0c\u6240\u4ee5\u8bfb\u8005\u6700\u597d\u628a\u65b9\u6cd5\u540d\u5b57\u548c\u5176\u4ee3\u8868\u7684\u529f\u80fd\u8bb0\u4f4f\uff0c\u770b\u6e90\u7801\u7684\u65f6\u5019\u4e5f\u5c31\u4e0d\u9700\u8981\u6765\u6765\u56de\u56de\u7ffb\u4e86\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u5728\u8fd9\u91cc\uff0c\u4ecb\u7ecd\u4e0b\u7ebf\u7a0b\u6c60\u4e2d\u7684\u5404\u4e2a\u72b6\u6001\u548c\u72b6\u6001\u53d8\u5316\u7684\u8f6c\u6362\u8fc7\u7a0b\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"RUNNING\uff1a\u8fd9\u4e2a\u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u8fd9\u662f\u6700\u6b63\u5e38\u7684\u72b6\u6001\uff1a\u63a5\u53d7\u65b0\u7684\u4efb\u52a1\uff0c\u5904\u7406\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u4efb\u52a1"}),"\n",(0,t.jsx)(e.li,{children:"SHUTDOWN\uff1a\u4e0d\u63a5\u53d7\u65b0\u7684\u4efb\u52a1\u63d0\u4ea4\uff0c\u4f46\u662f\u4f1a\u7ee7\u7eed\u5904\u7406\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u4efb\u52a1"}),"\n",(0,t.jsx)(e.li,{children:"STOP\uff1a\u4e0d\u63a5\u53d7\u65b0\u7684\u4efb\u52a1\u63d0\u4ea4\uff0c\u4e0d\u518d\u5904\u7406\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u4efb\u52a1\uff0c\u4e2d\u65ad\u6b63\u5728\u6267\u884c\u4efb\u52a1\u7684\u7ebf\u7a0b"}),"\n",(0,t.jsx)(e.li,{children:"TIDYING\uff1a\u6240\u6709\u7684\u4efb\u52a1\u90fd\u9500\u6bc1\u4e86\uff0cworkCount \u4e3a 0\u3002\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u5728\u8f6c\u6362\u4e3a TIDYING \u72b6\u6001\u65f6\uff0c\u4f1a\u6267\u884c\u94a9\u5b50\u65b9\u6cd5 terminated()"}),"\n",(0,t.jsx)(e.li,{children:"TERMINATED\uff1aterminated() \u65b9\u6cd5\u7ed3\u675f\u540e\uff0c\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u5c31\u4f1a\u53d8\u6210\u8fd9\u4e2a"}),"\n"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"RUNNING \u5b9a\u4e49\u4e3a -1\uff0cSHUTDOWN \u5b9a\u4e49\u4e3a 0\uff0c\u5176\u4ed6\u7684\u90fd\u6bd4 0 \u5927\uff0c\u6240\u4ee5\u7b49\u4e8e 0 \u7684\u65f6\u5019\u4e0d\u80fd\u63d0\u4ea4\u4efb\u52a1\uff0c\u5927\u4e8e 0 \u7684\u8bdd\uff0c\u8fde\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\u4e5f\u9700\u8981\u4e2d\u65ad\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u770b\u4e86\u8fd9\u51e0\u79cd\u72b6\u6001\u7684\u4ecb\u7ecd\uff0c\u8bfb\u8005\u5927\u4f53\u4e5f\u53ef\u4ee5\u731c\u5230\u5341\u4e4b\u516b\u4e5d\u7684\u72b6\u6001\u8f6c\u6362\u4e86\uff0c\u5404\u4e2a\u72b6\u6001\u7684\u8f6c\u6362\u8fc7\u7a0b\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"RUNNING -> SHUTDOWN\uff1a\u5f53\u8c03\u7528\u4e86 shutdown() \u540e\uff0c\u4f1a\u53d1\u751f\u8fd9\u4e2a\u72b6\u6001\u8f6c\u6362\uff0c\u8fd9\u4e5f\u662f\u6700\u91cd\u8981\u7684"}),"\n",(0,t.jsx)(e.li,{children:"(RUNNING or SHUTDOWN) -> STOP\uff1a\u5f53\u8c03\u7528 shutdownNow() \u540e\uff0c\u4f1a\u53d1\u751f\u8fd9\u4e2a\u72b6\u6001\u8f6c\u6362\uff0c\u8fd9\u4e0b\u8981\u6e05\u695a shutDown() \u548c shutDownNow() \u7684\u533a\u522b\u4e86"}),"\n",(0,t.jsx)(e.li,{children:"SHUTDOWN -> TIDYING\uff1a\u5f53\u4efb\u52a1\u961f\u5217\u548c\u7ebf\u7a0b\u6c60\u90fd\u6e05\u7a7a\u540e\uff0c\u4f1a\u7531 SHUTDOWN \u8f6c\u6362\u4e3a TIDYING"}),"\n",(0,t.jsx)(e.li,{children:"STOP -> TIDYING\uff1a\u5f53\u4efb\u52a1\u961f\u5217\u6e05\u7a7a\u540e\uff0c\u53d1\u751f\u8fd9\u4e2a\u8f6c\u6362"}),"\n",(0,t.jsx)(e.li,{children:"TIDYING -> TERMINATED\uff1a\u8fd9\u4e2a\u524d\u9762\u8bf4\u4e86\uff0c\u5f53 terminated() \u65b9\u6cd5\u7ed3\u675f\u540e"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u4e0a\u9762\u7684\u51e0\u4e2a\u8bb0\u4f4f\u6838\u5fc3\u7684\u5c31\u53ef\u4ee5\u4e86\uff0c\u5c24\u5176\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e8c\u4e2a\u3002"}),"\n",(0,t.jsxs)(e.p,{children:["\u53e6\u5916\uff0c\u6211\u4eec\u8fd8\u8981\u770b\u770b\u4e00\u4e2a\u5185\u90e8\u7c7b Worker\uff0c\u56e0\u4e3a Doug Lea \u628a\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u5305\u88c5\u6210\u4e86\u4e00\u4e2a\u4e2a Worker\uff0c\u7ffb\u8bd1\u6210\u5de5\u4eba\uff0c\u5c31\u662f\u7ebf\u7a0b\u6c60\u4e2d\u505a\u4efb\u52a1\u7684\u7ebf\u7a0b\u3002\u6240\u4ee5\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u77e5\u9053",(0,t.jsx)(e.strong,{children:"\u4efb\u52a1\u662f Runnable\uff08\u5185\u90e8\u53d8\u91cf\u540d\u53eb task \u6216 command\uff09\uff0c\u7ebf\u7a0b\u662f Worker"}),"\u3002"]}),"\n",(0,t.jsx)(e.p,{children:"Worker \u8fd9\u91cc\u53c8\u7528\u5230\u4e86\u62bd\u8c61\u7c7b AbstractQueuedSynchronizer\u3002\u9898\u5916\u8bdd\uff0cAQS \u5728\u5e76\u53d1\u4e2d\u771f\u7684\u662f\u5230\u5904\u51fa\u73b0\uff0c\u800c\u4e14\u975e\u5e38\u5bb9\u6613\u4f7f\u7528\uff0c\u5199\u5c11\u91cf\u7684\u4ee3\u7801\u5c31\u80fd\u5b9e\u73b0\u81ea\u5df1\u9700\u8981\u7684\u540c\u6b65\u65b9\u5f0f\uff08\u5bf9 AQS \u6e90\u7801\u611f\u5174\u8da3\u7684\u8bfb\u8005\u8bf7\u53c2\u770b\u6211\u4e4b\u524d\u5199\u7684\u51e0\u7bc7\u6587\u7ae0\uff09\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"private final class Worker\n    extends AbstractQueuedSynchronizer\n    implements Runnable\n{\n    private static final long serialVersionUID = 6138294804551838833L;\n\n    // \u8fd9\u4e2a\u662f\u771f\u6b63\u7684\u7ebf\u7a0b\uff0c\u4efb\u52a1\u9760\u4f60\u5566\n    final Thread thread;\n\n    // \u524d\u9762\u8bf4\u4e86\uff0c\u8fd9\u91cc\u7684 Runnable \u662f\u4efb\u52a1\u3002\u4e3a\u4ec0\u4e48\u53eb firstTask\uff1f\u56e0\u4e3a\u5728\u521b\u5efa\u7ebf\u7a0b\u7684\u65f6\u5019\uff0c\u5982\u679c\u540c\u65f6\u6307\u5b9a\u4e86\n    // \u8fd9\u4e2a\u7ebf\u7a0b\u8d77\u6765\u4ee5\u540e\u9700\u8981\u6267\u884c\u7684\u7b2c\u4e00\u4e2a\u4efb\u52a1\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u4efb\u52a1\u5c31\u662f\u5b58\u653e\u5728\u8fd9\u91cc\u7684(\u7ebf\u7a0b\u53ef\u4e0d\u6b62\u6267\u884c\u8fd9\u4e00\u4e2a\u4efb\u52a1)\n    // \u5f53\u7136\u4e86\uff0c\u4e5f\u53ef\u4ee5\u4e3a null\uff0c\u8fd9\u6837\u7ebf\u7a0b\u8d77\u6765\u4e86\uff0c\u81ea\u5df1\u5230\u4efb\u52a1\u961f\u5217\uff08BlockingQueue\uff09\u4e2d\u53d6\u4efb\u52a1\uff08getTask \u65b9\u6cd5\uff09\u5c31\u884c\u4e86\n    Runnable firstTask;\n\n    // \u7528\u4e8e\u5b58\u653e\u6b64\u7ebf\u7a0b\u5b8c\u6210\u7684\u4efb\u52a1\u6570\uff0c\u6ce8\u610f\u4e86\uff0c\u8fd9\u91cc\u7528\u4e86 volatile\uff0c\u4fdd\u8bc1\u53ef\u89c1\u6027\n    volatile long completedTasks;\n\n    // Worker \u53ea\u6709\u8fd9\u4e00\u4e2a\u6784\u9020\u65b9\u6cd5\uff0c\u4f20\u5165 firstTask\uff0c\u4e5f\u53ef\u4ee5\u4f20 null\n    Worker(Runnable firstTask) {\n        setState(-1); // inhibit interrupts until runWorker\n        this.firstTask = firstTask;\n        // \u8c03\u7528 ThreadFactory \u6765\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\n        this.thread = getThreadFactory().newThread(this);\n    }\n\n    // \u8fd9\u91cc\u8c03\u7528\u4e86\u5916\u90e8\u7c7b\u7684 runWorker \u65b9\u6cd5\n    public void run() {\n        runWorker(this);\n    }\n\n    ...// \u5176\u4ed6\u51e0\u4e2a\u65b9\u6cd5\u6ca1\u4ec0\u4e48\u597d\u770b\u7684\uff0c\u5c31\u662f\u7528 AQS \u64cd\u4f5c\uff0c\u6765\u83b7\u53d6\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\u6743\uff0c\u7528\u4e86\u72ec\u5360\u9501\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u524d\u9762\u867d\u7136\u5570\u55e6\uff0c\u4f46\u662f\u7b80\u5355\u3002\u6709\u4e86\u4e0a\u9762\u7684\u8fd9\u4e9b\u57fa\u7840\u540e\uff0c\u6211\u4eec\u7ec8\u4e8e\u53ef\u4ee5\u770b\u770b ThreadPoolExecutor \u7684 execute \u65b9\u6cd5\u4e86\uff0c\u524d\u9762\u6e90\u7801\u5206\u6790\u7684\u65f6\u5019\u4e5f\u8bf4\u4e86\uff0c\u5404\u79cd\u65b9\u6cd5\u90fd\u6700\u7ec8\u4f9d\u8d56\u4e8e execute \u65b9\u6cd5\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public void execute(Runnable command) {\n    if (command == null)\n        throw new NullPointerException();\n\n    // \u524d\u9762\u8bf4\u7684\u90a3\u4e2a\u8868\u793a \u201c\u7ebf\u7a0b\u6c60\u72b6\u6001\u201d \u548c \u201c\u7ebf\u7a0b\u6570\u201d \u7684\u6574\u6570\n    int c = ctl.get();\n\n    // \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6570\u5c11\u4e8e\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u90a3\u4e48\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2a worker \u6765\u6267\u884c\u4efb\u52a1\uff0c\n    // \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u5e76\u628a\u5f53\u524d\u4efb\u52a1 command \u4f5c\u4e3a\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u7b2c\u4e00\u4e2a\u4efb\u52a1(firstTask)\n    if (workerCountOf(c) < corePoolSize) {\n        // \u6dfb\u52a0\u4efb\u52a1\u6210\u529f\uff0c\u90a3\u4e48\u5c31\u7ed3\u675f\u4e86\u3002\u63d0\u4ea4\u4efb\u52a1\u561b\uff0c\u7ebf\u7a0b\u6c60\u5df2\u7ecf\u63a5\u53d7\u4e86\u8fd9\u4e2a\u4efb\u52a1\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u5c31\u53ef\u4ee5\u8fd4\u56de\u4e86\n        // \u81f3\u4e8e\u6267\u884c\u7684\u7ed3\u679c\uff0c\u5230\u65f6\u5019\u4f1a\u5305\u88c5\u5230 FutureTask \u4e2d\u3002\n        // \u8fd4\u56de false \u4ee3\u8868\u7ebf\u7a0b\u6c60\u4e0d\u5141\u8bb8\u63d0\u4ea4\u4efb\u52a1\n        if (addWorker(command, true))\n            return;\n        c = ctl.get();\n    }\n    // \u5230\u8fd9\u91cc\u8bf4\u660e\uff0c\u8981\u4e48\u5f53\u524d\u7ebf\u7a0b\u6570\u5927\u4e8e\u7b49\u4e8e\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u8981\u4e48\u521a\u521a addWorker \u5931\u8d25\u4e86\n\n    // \u5982\u679c\u7ebf\u7a0b\u6c60\u5904\u4e8e RUNNING \u72b6\u6001\uff0c\u628a\u8fd9\u4e2a\u4efb\u52a1\u6dfb\u52a0\u5230\u4efb\u52a1\u961f\u5217 workQueue \u4e2d\n    if (isRunning(c) && workQueue.offer(command)) {\n        /* \u8fd9\u91cc\u9762\u8bf4\u7684\u662f\uff0c\u5982\u679c\u4efb\u52a1\u8fdb\u5165\u4e86 workQueue\uff0c\u6211\u4eec\u662f\u5426\u9700\u8981\u5f00\u542f\u65b0\u7684\u7ebf\u7a0b\n         * \u56e0\u4e3a\u7ebf\u7a0b\u6570\u5728 [0, corePoolSize) \u662f\u65e0\u6761\u4ef6\u5f00\u542f\u65b0\u7684\u7ebf\u7a0b\n         * \u5982\u679c\u7ebf\u7a0b\u6570\u5df2\u7ecf\u5927\u4e8e\u7b49\u4e8e corePoolSize\uff0c\u90a3\u4e48\u5c06\u4efb\u52a1\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\uff0c\u7136\u540e\u8fdb\u5230\u8fd9\u91cc\n         */\n        int recheck = ctl.get();\n        // \u5982\u679c\u7ebf\u7a0b\u6c60\u5df2\u4e0d\u5904\u4e8e RUNNING \u72b6\u6001\uff0c\u90a3\u4e48\u79fb\u9664\u5df2\u7ecf\u5165\u961f\u7684\u8fd9\u4e2a\u4efb\u52a1\uff0c\u5e76\u4e14\u6267\u884c\u62d2\u7edd\u7b56\u7565\n        if (! isRunning(recheck) && remove(command))\n            reject(command);\n        // \u5982\u679c\u7ebf\u7a0b\u6c60\u8fd8\u662f RUNNING \u7684\uff0c\u5e76\u4e14\u7ebf\u7a0b\u6570\u4e3a 0\uff0c\u90a3\u4e48\u5f00\u542f\u65b0\u7684\u7ebf\u7a0b\n        // \u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u8fd9\u5757\u4ee3\u7801\u7684\u771f\u6b63\u610f\u56fe\u662f\uff1a\u62c5\u5fc3\u4efb\u52a1\u63d0\u4ea4\u5230\u961f\u5217\u4e2d\u4e86\uff0c\u4f46\u662f\u7ebf\u7a0b\u90fd\u5173\u95ed\u4e86\n        else if (workerCountOf(recheck) == 0)\n            addWorker(null, false);\n    }\n    // \u5982\u679c workQueue \u961f\u5217\u6ee1\u4e86\uff0c\u90a3\u4e48\u8fdb\u5165\u5230\u8fd9\u4e2a\u5206\u652f\n    // \u4ee5 maximumPoolSize \u4e3a\u754c\u521b\u5efa\u65b0\u7684 worker\uff0c\n    // \u5982\u679c\u5931\u8d25\uff0c\u8bf4\u660e\u5f53\u524d\u7ebf\u7a0b\u6570\u5df2\u7ecf\u8fbe\u5230 maximumPoolSize\uff0c\u6267\u884c\u62d2\u7edd\u7b56\u7565\n    else if (!addWorker(command, false))\n        reject(command);\n}\n"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u5bf9\u521b\u5efa\u7ebf\u7a0b\u7684\u9519\u8bef\u7406\u89e3\uff1a\u5982\u679c\u7ebf\u7a0b\u6570\u5c11\u4e8e corePoolSize\uff0c\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u5982\u679c\u7ebf\u7a0b\u6570\u5728 [corePoolSize, maximumPoolSize] \u4e4b\u95f4\u90a3\u4e48\u53ef\u4ee5\u521b\u5efa\u7ebf\u7a0b\u6216\u590d\u7528\u7a7a\u95f2\u7ebf\u7a0b\uff0ckeepAliveTime \u5bf9\u8fd9\u4e2a\u533a\u95f4\u7684\u7ebf\u7a0b\u6709\u6548\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u4ece\u4e0a\u9762\u7684\u51e0\u4e2a\u5206\u652f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u770b\u51fa\uff0c\u4e0a\u9762\u7684\u8fd9\u6bb5\u8bdd\u662f\u9519\u8bef\u7684\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u4e0a\u9762\u8fd9\u4e9b\u4e00\u65f6\u534a\u4f1a\u4e5f\u4e0d\u53ef\u80fd\u5168\u90e8\u6d88\u5316\u641e\u5b9a\uff0c\u6211\u4eec\u5148\u7ee7\u7eed\u5f80\u4e0b\u5427\uff0c\u5230\u65f6\u5019\u518d\u56de\u5934\u770b\u51e0\u904d\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u8fd9\u4e2a\u65b9\u6cd5\u975e\u5e38\u91cd\u8981 addWorker(Runnable firstTask, boolean core) \u65b9\u6cd5\uff0c\u6211\u4eec\u770b\u770b\u5b83\u662f\u600e\u4e48\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u7684\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"// \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u51c6\u5907\u63d0\u4ea4\u7ed9\u8fd9\u4e2a\u7ebf\u7a0b\u6267\u884c\u7684\u4efb\u52a1\uff0c\u4e4b\u524d\u8bf4\u4e86\uff0c\u53ef\u4ee5\u4e3a null\n// \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a true \u4ee3\u8868\u4f7f\u7528\u6838\u5fc3\u7ebf\u7a0b\u6570 corePoolSize \u4f5c\u4e3a\u521b\u5efa\u7ebf\u7a0b\u7684\u754c\u9650\uff0c\u4e5f\u5c31\u8bf4\u521b\u5efa\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u65f6\u5019\uff0c\n//         \u5982\u679c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u603b\u6570\u5df2\u7ecf\u8fbe\u5230 corePoolSize\uff0c\u90a3\u4e48\u4e0d\u80fd\u54cd\u5e94\u8fd9\u6b21\u521b\u5efa\u7ebf\u7a0b\u7684\u8bf7\u6c42\n//         \u5982\u679c\u662f false\uff0c\u4ee3\u8868\u4f7f\u7528\u6700\u5927\u7ebf\u7a0b\u6570 maximumPoolSize \u4f5c\u4e3a\u754c\u9650\nprivate boolean addWorker(Runnable firstTask, boolean core) {\n    retry:\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n\n        // \u8fd9\u4e2a\u975e\u5e38\u4e0d\u597d\u7406\u89e3\n        // \u5982\u679c\u7ebf\u7a0b\u6c60\u5df2\u5173\u95ed\uff0c\u5e76\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u4e4b\u4e00\uff0c\u90a3\u4e48\u4e0d\u521b\u5efa\u65b0\u7684 worker\uff1a\n        // 1\\. \u7ebf\u7a0b\u6c60\u72b6\u6001\u5927\u4e8e SHUTDOWN\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f STOP, TIDYING, \u6216 TERMINATED\n        // 2\\. firstTask != null\n        // 3\\. workQueue.isEmpty()\n        // \u7b80\u5355\u5206\u6790\u4e0b\uff1a\n        // \u8fd8\u662f\u72b6\u6001\u63a7\u5236\u7684\u95ee\u9898\uff0c\u5f53\u7ebf\u7a0b\u6c60\u5904\u4e8e SHUTDOWN \u7684\u65f6\u5019\uff0c\u4e0d\u5141\u8bb8\u63d0\u4ea4\u4efb\u52a1\uff0c\u4f46\u662f\u5df2\u6709\u7684\u4efb\u52a1\u7ee7\u7eed\u6267\u884c\n        // \u5f53\u72b6\u6001\u5927\u4e8e SHUTDOWN \u65f6\uff0c\u4e0d\u5141\u8bb8\u63d0\u4ea4\u4efb\u52a1\uff0c\u4e14\u4e2d\u65ad\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\n        // \u591a\u8bf4\u4e00\u53e5\uff1a\u5982\u679c\u7ebf\u7a0b\u6c60\u5904\u4e8e SHUTDOWN\uff0c\u4f46\u662f firstTask \u4e3a null\uff0c\u4e14 workQueue \u975e\u7a7a\uff0c\u90a3\u4e48\u662f\u5141\u8bb8\u521b\u5efa worker \u7684\n        // \u8fd9\u662f\u56e0\u4e3a SHUTDOWN \u7684\u8bed\u4e49\uff1a\u4e0d\u5141\u8bb8\u63d0\u4ea4\u65b0\u7684\u4efb\u52a1\uff0c\u4f46\u662f\u8981\u628a\u5df2\u7ecf\u8fdb\u5165\u5230 workQueue \u7684\u4efb\u52a1\u6267\u884c\u5b8c\uff0c\u6240\u4ee5\u5728\u6ee1\u8db3\u6761\u4ef6\u7684\u57fa\u7840\u4e0a\uff0c\u662f\u5141\u8bb8\u521b\u5efa\u65b0\u7684 Worker \u7684\n        if (rs >= SHUTDOWN &&\n            ! (rs == SHUTDOWN &&\n               firstTask == null &&\n               ! workQueue.isEmpty()))\n            return false;\n\n        for (;;) {\n            int wc = workerCountOf(c);\n            if (wc >= CAPACITY ||\n                wc >= (core ? corePoolSize : maximumPoolSize))\n                return false;\n            // \u5982\u679c\u6210\u529f\uff0c\u90a3\u4e48\u5c31\u662f\u6240\u6709\u521b\u5efa\u7ebf\u7a0b\u524d\u7684\u6761\u4ef6\u6821\u9a8c\u90fd\u6ee1\u8db3\u4e86\uff0c\u51c6\u5907\u521b\u5efa\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u4e86\n            // \u8fd9\u91cc\u5931\u8d25\u7684\u8bdd\uff0c\u8bf4\u660e\u6709\u5176\u4ed6\u7ebf\u7a0b\u4e5f\u5728\u5c1d\u8bd5\u5f80\u7ebf\u7a0b\u6c60\u4e2d\u521b\u5efa\u7ebf\u7a0b\n            if (compareAndIncrementWorkerCount(c))\n                break retry;\n            // \u7531\u4e8e\u6709\u5e76\u53d1\uff0c\u91cd\u65b0\u518d\u8bfb\u53d6\u4e00\u4e0b ctl\n            c = ctl.get();\n            // \u6b63\u5e38\u5982\u679c\u662f CAS \u5931\u8d25\u7684\u8bdd\uff0c\u8fdb\u5230\u4e0b\u4e00\u4e2a\u91cc\u5c42\u7684for\u5faa\u73af\u5c31\u53ef\u4ee5\u4e86\n            // \u53ef\u662f\u5982\u679c\u662f\u56e0\u4e3a\u5176\u4ed6\u7ebf\u7a0b\u7684\u64cd\u4f5c\uff0c\u5bfc\u81f4\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u53d1\u751f\u4e86\u53d8\u66f4\uff0c\u5982\u6709\u5176\u4ed6\u7ebf\u7a0b\u5173\u95ed\u4e86\u8fd9\u4e2a\u7ebf\u7a0b\u6c60\n            // \u90a3\u4e48\u9700\u8981\u56de\u5230\u5916\u5c42\u7684for\u5faa\u73af\n            if (runStateOf(c) != rs)\n                continue retry;\n            // else CAS failed due to workerCount change; retry inner loop\n        }\n    }\n\n    /* \n     * \u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u8ba4\u4e3a\u5728\u5f53\u524d\u8fd9\u4e2a\u65f6\u523b\uff0c\u53ef\u4ee5\u5f00\u59cb\u521b\u5efa\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\u4e86\uff0c\n     * \u56e0\u4e3a\u8be5\u6821\u9a8c\u7684\u90fd\u6821\u9a8c\u4e86\uff0c\u81f3\u4e8e\u4ee5\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff0c\u90a3\u662f\u4ee5\u540e\u7684\u4e8b\uff0c\u81f3\u5c11\u5f53\u524d\u662f\u6ee1\u8db3\u6761\u4ef6\u7684\n     */\n\n    // worker \u662f\u5426\u5df2\u7ecf\u542f\u52a8\n    boolean workerStarted = false;\n    // \u662f\u5426\u5df2\u5c06\u8fd9\u4e2a worker \u6dfb\u52a0\u5230 workers \u8fd9\u4e2a HashSet \u4e2d\n    boolean workerAdded = false;\n    Worker w = null;\n    try {\n        final ReentrantLock mainLock = this.mainLock;\n        // \u628a firstTask \u4f20\u7ed9 worker \u7684\u6784\u9020\u65b9\u6cd5\n        w = new Worker(firstTask);\n        // \u53d6 worker \u4e2d\u7684\u7ebf\u7a0b\u5bf9\u8c61\uff0c\u4e4b\u524d\u8bf4\u4e86\uff0cWorker\u7684\u6784\u9020\u65b9\u6cd5\u4f1a\u8c03\u7528 ThreadFactory \u6765\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\n        final Thread t = w.thread;\n        if (t != null) {\n            // \u8fd9\u4e2a\u662f\u6574\u4e2a\u7ebf\u7a0b\u6c60\u7684\u5168\u5c40\u9501\uff0c\u6301\u6709\u8fd9\u4e2a\u9501\u624d\u80fd\u8ba9\u4e0b\u9762\u7684\u64cd\u4f5c\u201c\u987a\u7406\u6210\u7ae0\u201d\uff0c\n            // \u56e0\u4e3a\u5173\u95ed\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u9700\u8981\u8fd9\u4e2a\u9501\uff0c\u81f3\u5c11\u6211\u6301\u6709\u9501\u7684\u671f\u95f4\uff0c\u7ebf\u7a0b\u6c60\u4e0d\u4f1a\u88ab\u5173\u95ed\n            mainLock.lock();\n            try {\n\n                int c = ctl.get();\n                int rs = runStateOf(c);\n\n                // \u5c0f\u4e8e SHUTTDOWN \u90a3\u5c31\u662f RUNNING\uff0c\u8fd9\u4e2a\u81ea\u4e0d\u5fc5\u8bf4\uff0c\u662f\u6700\u6b63\u5e38\u7684\u60c5\u51b5\n                // \u5982\u679c\u7b49\u4e8e SHUTDOWN\uff0c\u524d\u9762\u8bf4\u4e86\uff0c\u4e0d\u63a5\u53d7\u65b0\u7684\u4efb\u52a1\uff0c\u4f46\u662f\u4f1a\u7ee7\u7eed\u6267\u884c\u7b49\u5f85\u961f\u5217\u4e2d\u7684\u4efb\u52a1\n                if (rs < SHUTDOWN ||\n                    (rs == SHUTDOWN && firstTask == null)) {\n                    // worker \u91cc\u9762\u7684 thread \u53ef\u4e0d\u80fd\u662f\u5df2\u7ecf\u542f\u52a8\u7684\n                    if (t.isAlive())\n                        throw new IllegalThreadStateException();\n                    // \u52a0\u5230 workers \u8fd9\u4e2a HashSet \u4e2d\n                    workers.add(w);\n                    int s = workers.size();\n                    // largestPoolSize \u7528\u4e8e\u8bb0\u5f55 workers \u4e2d\u7684\u4e2a\u6570\u7684\u6700\u5927\u503c\n                    // \u56e0\u4e3a workers \u662f\u4e0d\u65ad\u589e\u52a0\u51cf\u5c11\u7684\uff0c\u901a\u8fc7\u8fd9\u4e2a\u503c\u53ef\u4ee5\u77e5\u9053\u7ebf\u7a0b\u6c60\u7684\u5927\u5c0f\u66fe\u7ecf\u8fbe\u5230\u7684\u6700\u5927\u503c\n                    if (s > largestPoolSize)\n                        largestPoolSize = s;\n                    workerAdded = true;\n                }\n            } finally {\n                mainLock.unlock();\n            }\n            // \u6dfb\u52a0\u6210\u529f\u7684\u8bdd\uff0c\u542f\u52a8\u8fd9\u4e2a\u7ebf\u7a0b\n            if (workerAdded) {\n                // \u542f\u52a8\u7ebf\u7a0b\n                t.start();\n                workerStarted = true;\n            }\n        }\n    } finally {\n        // \u5982\u679c\u7ebf\u7a0b\u6ca1\u6709\u542f\u52a8\uff0c\u9700\u8981\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff0c\u5982\u524d\u9762 workCount \u52a0\u4e86 1\uff0c\u5c06\u5176\u51cf\u6389\n        if (! workerStarted)\n            addWorkerFailed(w);\n    }\n    // \u8fd4\u56de\u7ebf\u7a0b\u662f\u5426\u542f\u52a8\u6210\u529f\n    return workerStarted;\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u7b80\u5355\u770b\u4e0b addWorkFailed \u7684\u5904\u7406\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"// workers \u4e2d\u5220\u9664\u6389\u76f8\u5e94\u7684 worker\n// workCount \u51cf 1\nprivate void addWorkerFailed(Worker w) {\n    final ReentrantLock mainLock = this.mainLock;\n    mainLock.lock();\n    try {\n        if (w != null)\n            workers.remove(w);\n        decrementWorkerCount();\n        // rechecks for termination, in case the existence of this worker was holding up termination\n        tryTerminate();\n    } finally {\n        mainLock.unlock();\n    }\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u56de\u8fc7\u5934\u6765\uff0c\u7ee7\u7eed\u5f80\u4e0b\u8d70\u3002\u6211\u4eec\u77e5\u9053\uff0cworker \u4e2d\u7684\u7ebf\u7a0b start \u540e\uff0c\u5176 run \u65b9\u6cd5\u4f1a\u8c03\u7528 runWorker \u65b9\u6cd5\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"// Worker \u7c7b\u7684 run() \u65b9\u6cd5\npublic void run() {\n    runWorker(this);\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u7ee7\u7eed\u5f80\u4e0b\u770b runWorker \u65b9\u6cd5\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"// \u6b64\u65b9\u6cd5\u7531 worker \u7ebf\u7a0b\u542f\u52a8\u540e\u8c03\u7528\uff0c\u8fd9\u91cc\u7528\u4e00\u4e2a while \u5faa\u73af\u6765\u4e0d\u65ad\u5730\u4ece\u7b49\u5f85\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\u5e76\u6267\u884c\n// \u524d\u9762\u8bf4\u4e86\uff0cworker \u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6307\u5b9a firstTask\uff0c\u90a3\u4e48\u7b2c\u4e00\u4e2a\u4efb\u52a1\u4e5f\u5c31\u53ef\u4ee5\u4e0d\u9700\u8981\u4ece\u961f\u5217\u4e2d\u83b7\u53d6\nfinal void runWorker(Worker w) {\n    // \n    Thread wt = Thread.currentThread();\n    // \u8be5\u7ebf\u7a0b\u7684\u7b2c\u4e00\u4e2a\u4efb\u52a1(\u5982\u679c\u6709\u7684\u8bdd)\n    Runnable task = w.firstTask;\n    w.firstTask = null;\n    w.unlock(); // allow interrupts\n    boolean completedAbruptly = true;\n    try {\n        // \u5faa\u73af\u8c03\u7528 getTask \u83b7\u53d6\u4efb\u52a1\n        while (task != null || (task = getTask()) != null) {\n            w.lock();          \n            // \u5982\u679c\u7ebf\u7a0b\u6c60\u72b6\u6001\u5927\u4e8e\u7b49\u4e8e STOP\uff0c\u90a3\u4e48\u610f\u5473\u7740\u8be5\u7ebf\u7a0b\u4e5f\u8981\u4e2d\u65ad\n            if ((runStateAtLeast(ctl.get(), STOP) ||\n                 (Thread.interrupted() &&\n                  runStateAtLeast(ctl.get(), STOP))) &&\n                !wt.isInterrupted())\n                wt.interrupt();\n            try {\n                // \u8fd9\u662f\u4e00\u4e2a\u94a9\u5b50\u65b9\u6cd5\uff0c\u7559\u7ed9\u9700\u8981\u7684\u5b50\u7c7b\u5b9e\u73b0\n                beforeExecute(wt, task);\n                Throwable thrown = null;\n                try {\n                    // \u5230\u8fd9\u91cc\u7ec8\u4e8e\u53ef\u4ee5\u6267\u884c\u4efb\u52a1\u4e86\n                    task.run();\n                } catch (RuntimeException x) {\n                    thrown = x; throw x;\n                } catch (Error x) {\n                    thrown = x; throw x;\n                } catch (Throwable x) {\n                    // \u8fd9\u91cc\u4e0d\u5141\u8bb8\u629b\u51fa Throwable\uff0c\u6240\u4ee5\u8f6c\u6362\u4e3a Error\n                    thrown = x; throw new Error(x);\n                } finally {\n                    // \u4e5f\u662f\u4e00\u4e2a\u94a9\u5b50\u65b9\u6cd5\uff0c\u5c06 task \u548c\u5f02\u5e38\u4f5c\u4e3a\u53c2\u6570\uff0c\u7559\u7ed9\u9700\u8981\u7684\u5b50\u7c7b\u5b9e\u73b0\n                    afterExecute(task, thrown);\n                }\n            } finally {\n                // \u7f6e\u7a7a task\uff0c\u51c6\u5907 getTask \u83b7\u53d6\u4e0b\u4e00\u4e2a\u4efb\u52a1\n                task = null;\n                // \u7d2f\u52a0\u5b8c\u6210\u7684\u4efb\u52a1\u6570\n                w.completedTasks++;\n                // \u91ca\u653e\u6389 worker \u7684\u72ec\u5360\u9501\n                w.unlock();\n            }\n        }\n        completedAbruptly = false;\n    } finally {\n        // \u5982\u679c\u5230\u8fd9\u91cc\uff0c\u9700\u8981\u6267\u884c\u7ebf\u7a0b\u5173\u95ed\uff1a\n        // 1\\. \u8bf4\u660e getTask \u8fd4\u56de null\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u961f\u5217\u4e2d\u5df2\u7ecf\u6ca1\u6709\u4efb\u52a1\u9700\u8981\u6267\u884c\u4e86\uff0c\u6267\u884c\u5173\u95ed\n        // 2\\. \u4efb\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u5f02\u5e38\n        // \u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u5df2\u7ecf\u5728\u4ee3\u7801\u5904\u7406\u4e86\u5c06 workCount \u51cf 1\uff0c\u8fd9\u4e2a\u5728 getTask \u65b9\u6cd5\u5206\u6790\u4e2d\u4f1a\u8bf4\n        // \u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0cworkCount \u6ca1\u6709\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u9700\u8981\u5728 processWorkerExit \u4e2d\u5904\u7406\n        // \u9650\u4e8e\u7bc7\u5e45\uff0c\u6211\u4e0d\u51c6\u5907\u5206\u6790\u8fd9\u4e2a\u65b9\u6cd5\u4e86\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u8bf7\u81ea\u884c\u5206\u6790\u6e90\u7801\n        processWorkerExit(w, completedAbruptly);\n    }\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4eec\u770b\u770b getTask() \u662f\u600e\u4e48\u83b7\u53d6\u4efb\u52a1\u7684\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5199\u5f97\u771f\u7684\u5f88\u597d\uff0c\u6bcf\u4e00\u884c\u90fd\u5f88\u7b80\u5355\uff0c\u7ec4\u5408\u8d77\u6765\u5374\u6240\u6709\u7684\u60c5\u51b5\u90fd\u60f3\u597d\u4e86\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"// \u6b64\u65b9\u6cd5\u6709\u4e09\u79cd\u53ef\u80fd\uff1a\n// 1\\. \u963b\u585e\u76f4\u5230\u83b7\u53d6\u5230\u4efb\u52a1\u8fd4\u56de\u3002\u6211\u4eec\u77e5\u9053\uff0c\u9ed8\u8ba4 corePoolSize \u4e4b\u5185\u7684\u7ebf\u7a0b\u662f\u4e0d\u4f1a\u88ab\u56de\u6536\u7684\uff0c\n//      \u5b83\u4eec\u4f1a\u4e00\u76f4\u7b49\u5f85\u4efb\u52a1\n// 2\\. \u8d85\u65f6\u9000\u51fa\u3002keepAliveTime \u8d77\u4f5c\u7528\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f\u5982\u679c\u8fd9\u4e48\u591a\u65f6\u95f4\u5185\u90fd\u6ca1\u6709\u4efb\u52a1\uff0c\u90a3\u4e48\u5e94\u8be5\u6267\u884c\u5173\u95ed\n// 3\\. \u5982\u679c\u53d1\u751f\u4e86\u4ee5\u4e0b\u6761\u4ef6\uff0c\u6b64\u65b9\u6cd5\u5fc5\u987b\u8fd4\u56de null:\n//    - \u6c60\u4e2d\u6709\u5927\u4e8e maximumPoolSize \u4e2a workers \u5b58\u5728(\u901a\u8fc7\u8c03\u7528 setMaximumPoolSize \u8fdb\u884c\u8bbe\u7f6e)\n//    - \u7ebf\u7a0b\u6c60\u5904\u4e8e SHUTDOWN\uff0c\u800c\u4e14 workQueue \u662f\u7a7a\u7684\uff0c\u524d\u9762\u8bf4\u4e86\uff0c\u8fd9\u79cd\u4e0d\u518d\u63a5\u53d7\u65b0\u7684\u4efb\u52a1\n//    - \u7ebf\u7a0b\u6c60\u5904\u4e8e STOP\uff0c\u4e0d\u4ec5\u4e0d\u63a5\u53d7\u65b0\u7684\u7ebf\u7a0b\uff0c\u8fde workQueue \u4e2d\u7684\u7ebf\u7a0b\u4e5f\u4e0d\u518d\u6267\u884c\nprivate Runnable getTask() {\n    boolean timedOut = false; // Did the last poll() time out?\n\n    retry:\n    for (;;) {\n        int c = ctl.get();\n        int rs = runStateOf(c);\n        // \u4e24\u79cd\u53ef\u80fd\n        // 1\\. rs == SHUTDOWN && workQueue.isEmpty()\n        // 2\\. rs >= STOP\n        if (rs >= SHUTDOWN && (rs >= STOP || workQueue.isEmpty())) {\n            // CAS \u64cd\u4f5c\uff0c\u51cf\u5c11\u5de5\u4f5c\u7ebf\u7a0b\u6570\n            decrementWorkerCount();\n            return null;\n        }\n\n        boolean timed;      // Are workers subject to culling?\n        for (;;) {\n            int wc = workerCountOf(c);\n            // \u5141\u8bb8\u6838\u5fc3\u7ebf\u7a0b\u6570\u5185\u7684\u7ebf\u7a0b\u56de\u6536\uff0c\u6216\u5f53\u524d\u7ebf\u7a0b\u6570\u8d85\u8fc7\u4e86\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u90a3\u4e48\u6709\u53ef\u80fd\u53d1\u751f\u8d85\u65f6\u5173\u95ed\n            timed = allowCoreThreadTimeOut || wc > corePoolSize;\n\n            // \u8fd9\u91cc break\uff0c\u662f\u4e3a\u4e86\u4e0d\u5f80\u4e0b\u6267\u884c\u540e\u4e00\u4e2a if (compareAndDecrementWorkerCount(c))\n            // \u4e24\u4e2a if \u4e00\u8d77\u770b\uff1a\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6570 wc > maximumPoolSize\uff0c\u6216\u8005\u8d85\u65f6\uff0c\u90fd\u8fd4\u56de null\n            // \u90a3\u8fd9\u91cc\u7684\u95ee\u9898\u6765\u4e86\uff0cwc > maximumPoolSize \u7684\u60c5\u51b5\uff0c\u4e3a\u4ec0\u4e48\u8981\u8fd4\u56de null\uff1f\n            //    \u6362\u53e5\u8bdd\u8bf4\uff0c\u8fd4\u56de null \u610f\u5473\u7740\u5173\u95ed\u7ebf\u7a0b\u3002\n            // \u90a3\u662f\u56e0\u4e3a\u6709\u53ef\u80fd\u5f00\u53d1\u8005\u8c03\u7528\u4e86 setMaximumPoolSize() \u5c06\u7ebf\u7a0b\u6c60\u7684 maximumPoolSize \u8c03\u5c0f\u4e86\uff0c\u90a3\u4e48\u591a\u4f59\u7684 Worker \u5c31\u9700\u8981\u88ab\u5173\u95ed\n            if (wc <= maximumPoolSize && ! (timedOut && timed))\n                break;\n            if (compareAndDecrementWorkerCount(c))\n                return null;\n            c = ctl.get();  // Re-read ctl\n            // compareAndDecrementWorkerCount(c) \u5931\u8d25\uff0c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u53d1\u751f\u4e86\u6539\u53d8\n            if (runStateOf(c) != rs)\n                continue retry;\n            // else CAS failed due to workerCount change; retry inner loop\n        }\n        // wc <= maximumPoolSize \u540c\u65f6\u6ca1\u6709\u8d85\u65f6\n        try {\n            // \u5230 workQueue \u4e2d\u83b7\u53d6\u4efb\u52a1\n            Runnable r = timed ?\n                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :\n                workQueue.take();\n            if (r != null)\n                return r;\n            timedOut = true;\n        } catch (InterruptedException retry) {\n            // \u5982\u679c\u6b64 worker \u53d1\u751f\u4e86\u4e2d\u65ad\uff0c\u91c7\u53d6\u7684\u65b9\u6848\u662f\u91cd\u8bd5\n            // \u89e3\u91ca\u4e0b\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u4e2d\u65ad\uff0c\u8fd9\u4e2a\u8bfb\u8005\u8981\u53bb\u770b setMaximumPoolSize \u65b9\u6cd5\u3002\n\n            // \u5982\u679c\u5f00\u53d1\u8005\u5c06 maximumPoolSize \u8c03\u5c0f\u4e86\uff0c\u5bfc\u81f4\u5176\u5c0f\u4e8e\u5f53\u524d\u7684 workers \u6570\u91cf\uff0c\n            // \u90a3\u4e48\u610f\u5473\u7740\u8d85\u51fa\u7684\u90e8\u5206\u7ebf\u7a0b\u8981\u88ab\u5173\u95ed\u3002\u91cd\u65b0\u8fdb\u5165 for \u5faa\u73af\uff0c\u81ea\u7136\u4f1a\u6709\u90e8\u5206\u7ebf\u7a0b\u4f1a\u8fd4\u56de null\n            timedOut = false;\n        }\n    }\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u5230\u8fd9\u91cc\uff0c\u57fa\u672c\u4e0a\u4e5f\u8bf4\u5b8c\u4e86\u6574\u4e2a\u6d41\u7a0b\uff0c\u8bfb\u8005\u8fd9\u4e2a\u65f6\u5019\u5e94\u8be5\u56de\u5230 execute(Runnable command) \u65b9\u6cd5\uff0c\u770b\u770b\u5404\u4e2a\u5206\u652f\uff0c\u6211\u628a\u4ee3\u7801\u8d34\u8fc7\u6765\u4e00\u4e0b\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public void execute(Runnable command) {\n    if (command == null)\n        throw new NullPointerException();\n\n    // \u524d\u9762\u8bf4\u7684\u90a3\u4e2a\u8868\u793a \u201c\u7ebf\u7a0b\u6c60\u72b6\u6001\u201d \u548c \u201c\u7ebf\u7a0b\u6570\u201d \u7684\u6574\u6570\n    int c = ctl.get();\n\n    // \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6570\u5c11\u4e8e\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u90a3\u4e48\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2a worker \u6765\u6267\u884c\u4efb\u52a1\uff0c\n    // \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u5e76\u628a\u5f53\u524d\u4efb\u52a1 command \u4f5c\u4e3a\u8fd9\u4e2a\u7ebf\u7a0b\u7684\u7b2c\u4e00\u4e2a\u4efb\u52a1(firstTask)\n    if (workerCountOf(c) < corePoolSize) {\n        // \u6dfb\u52a0\u4efb\u52a1\u6210\u529f\uff0c\u90a3\u4e48\u5c31\u7ed3\u675f\u4e86\u3002\u63d0\u4ea4\u4efb\u52a1\u561b\uff0c\u7ebf\u7a0b\u6c60\u5df2\u7ecf\u63a5\u53d7\u4e86\u8fd9\u4e2a\u4efb\u52a1\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e5f\u5c31\u53ef\u4ee5\u8fd4\u56de\u4e86\n        // \u81f3\u4e8e\u6267\u884c\u7684\u7ed3\u679c\uff0c\u5230\u65f6\u5019\u4f1a\u5305\u88c5\u5230 FutureTask \u4e2d\u3002\n        // \u8fd4\u56de false \u4ee3\u8868\u7ebf\u7a0b\u6c60\u4e0d\u5141\u8bb8\u63d0\u4ea4\u4efb\u52a1\n        if (addWorker(command, true))\n            return;\n        c = ctl.get();\n    }\n    // \u5230\u8fd9\u91cc\u8bf4\u660e\uff0c\u8981\u4e48\u5f53\u524d\u7ebf\u7a0b\u6570\u5927\u4e8e\u7b49\u4e8e\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u8981\u4e48\u521a\u521a addWorker \u5931\u8d25\u4e86\n\n    // \u5982\u679c\u7ebf\u7a0b\u6c60\u5904\u4e8e RUNNING \u72b6\u6001\uff0c\u628a\u8fd9\u4e2a\u4efb\u52a1\u6dfb\u52a0\u5230\u4efb\u52a1\u961f\u5217 workQueue \u4e2d\n    if (isRunning(c) && workQueue.offer(command)) {\n        /* \u8fd9\u91cc\u9762\u8bf4\u7684\u662f\uff0c\u5982\u679c\u4efb\u52a1\u8fdb\u5165\u4e86 workQueue\uff0c\u6211\u4eec\u662f\u5426\u9700\u8981\u5f00\u542f\u65b0\u7684\u7ebf\u7a0b\n         * \u56e0\u4e3a\u7ebf\u7a0b\u6570\u5728 [0, corePoolSize) \u662f\u65e0\u6761\u4ef6\u5f00\u542f\u65b0\u7684\u7ebf\u7a0b\n         * \u5982\u679c\u7ebf\u7a0b\u6570\u5df2\u7ecf\u5927\u4e8e\u7b49\u4e8e corePoolSize\uff0c\u90a3\u4e48\u5c06\u4efb\u52a1\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\uff0c\u7136\u540e\u8fdb\u5230\u8fd9\u91cc\n         */\n        int recheck = ctl.get();\n        // \u5982\u679c\u7ebf\u7a0b\u6c60\u5df2\u4e0d\u5904\u4e8e RUNNING \u72b6\u6001\uff0c\u90a3\u4e48\u79fb\u9664\u5df2\u7ecf\u5165\u961f\u7684\u8fd9\u4e2a\u4efb\u52a1\uff0c\u5e76\u4e14\u6267\u884c\u62d2\u7edd\u7b56\u7565\n        if (! isRunning(recheck) && remove(command))\n            reject(command);\n        // \u5982\u679c\u7ebf\u7a0b\u6c60\u8fd8\u662f RUNNING \u7684\uff0c\u5e76\u4e14\u7ebf\u7a0b\u6570\u4e3a 0\uff0c\u90a3\u4e48\u5f00\u542f\u65b0\u7684\u7ebf\u7a0b\n        // \u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u8fd9\u5757\u4ee3\u7801\u7684\u771f\u6b63\u610f\u56fe\u662f\uff1a\u62c5\u5fc3\u4efb\u52a1\u63d0\u4ea4\u5230\u961f\u5217\u4e2d\u4e86\uff0c\u4f46\u662f\u7ebf\u7a0b\u90fd\u5173\u95ed\u4e86\n        else if (workerCountOf(recheck) == 0)\n            addWorker(null, false);\n    }\n    // \u5982\u679c workQueue \u961f\u5217\u6ee1\u4e86\uff0c\u90a3\u4e48\u8fdb\u5165\u5230\u8fd9\u4e2a\u5206\u652f\n    // \u4ee5 maximumPoolSize \u4e3a\u754c\u521b\u5efa\u65b0\u7684 worker\uff0c\n    // \u5982\u679c\u5931\u8d25\uff0c\u8bf4\u660e\u5f53\u524d\u7ebf\u7a0b\u6570\u5df2\u7ecf\u8fbe\u5230 maximumPoolSize\uff0c\u6267\u884c\u62d2\u7edd\u7b56\u7565\n    else if (!addWorker(command, false))\n        reject(command);\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u4e0a\u9762\u5404\u4e2a\u5206\u652f\u4e2d\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\u4f1a\u8c03\u7528 reject(command) \u6765\u5904\u7406\u4efb\u52a1\uff0c\u56e0\u4e3a\u6309\u7167\u6b63\u5e38\u7684\u6d41\u7a0b\uff0c\u7ebf\u7a0b\u6c60\u6b64\u65f6\u4e0d\u80fd\u63a5\u53d7\u8fd9\u4e2a\u4efb\u52a1\uff0c\u6240\u4ee5\u9700\u8981\u6267\u884c\u6211\u4eec\u7684\u62d2\u7edd\u7b56\u7565\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8bf4\u4e00\u8bf4 ThreadPoolExecutor \u4e2d\u7684\u62d2\u7edd\u7b56\u7565\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"final void reject(Runnable command) {\n    // \u6267\u884c\u62d2\u7edd\u7b56\u7565\n    handler.rejectedExecution(command, this);\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u6b64\u5904\u7684 handler \u6211\u4eec\u9700\u8981\u5728\u6784\u9020\u7ebf\u7a0b\u6c60\u7684\u65f6\u5019\u5c31\u4f20\u5165\u8fd9\u4e2a\u53c2\u6570\uff0c\u5b83\u662f RejectedExecutionHandler \u7684\u5b9e\u4f8b\u3002"}),"\n",(0,t.jsx)(e.p,{children:"RejectedExecutionHandler \u5728 ThreadPoolExecutor \u4e2d\u6709\u56db\u4e2a\u5df2\u7ecf\u5b9a\u4e49\u597d\u7684\u5b9e\u73b0\u7c7b\u53ef\u4f9b\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\uff0c\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5df1\u7684\u7b56\u7565\uff0c\u4e0d\u8fc7\u4e00\u822c\u4e5f\u6ca1\u6709\u5fc5\u8981\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'// \u53ea\u8981\u7ebf\u7a0b\u6c60\u6ca1\u6709\u88ab\u5173\u95ed\uff0c\u90a3\u4e48\u7531\u63d0\u4ea4\u4efb\u52a1\u7684\u7ebf\u7a0b\u81ea\u5df1\u6765\u6267\u884c\u8fd9\u4e2a\u4efb\u52a1\u3002\npublic static class CallerRunsPolicy implements RejectedExecutionHandler {\n    public CallerRunsPolicy() { }\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n        if (!e.isShutdown()) {\n            r.run();\n        }\n    }\n}\n\n// \u4e0d\u7ba1\u600e\u6837\uff0c\u76f4\u63a5\u629b\u51fa RejectedExecutionException \u5f02\u5e38\n// \u8fd9\u4e2a\u662f\u9ed8\u8ba4\u7684\u7b56\u7565\uff0c\u5982\u679c\u6211\u4eec\u6784\u9020\u7ebf\u7a0b\u6c60\u7684\u65f6\u5019\u4e0d\u4f20\u76f8\u5e94\u7684 handler \u7684\u8bdd\uff0c\u90a3\u5c31\u4f1a\u6307\u5b9a\u4f7f\u7528\u8fd9\u4e2a\npublic static class AbortPolicy implements RejectedExecutionHandler {\n    public AbortPolicy() { }\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n        throw new RejectedExecutionException("Task " + r.toString() +\n                                             " rejected from " +\n                                             e.toString());\n    }\n}\n\n// \u4e0d\u505a\u4efb\u4f55\u5904\u7406\uff0c\u76f4\u63a5\u5ffd\u7565\u6389\u8fd9\u4e2a\u4efb\u52a1\npublic static class DiscardPolicy implements RejectedExecutionHandler {\n    public DiscardPolicy() { }\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n    }\n}\n\n// \u8fd9\u4e2a\u76f8\u5bf9\u9738\u9053\u4e00\u70b9\uff0c\u5982\u679c\u7ebf\u7a0b\u6c60\u6ca1\u6709\u88ab\u5173\u95ed\u7684\u8bdd\uff0c\n// \u628a\u961f\u5217\u961f\u5934\u7684\u4efb\u52a1(\u4e5f\u5c31\u662f\u7b49\u5f85\u4e86\u6700\u957f\u65f6\u95f4\u7684)\u76f4\u63a5\u6254\u6389\uff0c\u7136\u540e\u63d0\u4ea4\u8fd9\u4e2a\u4efb\u52a1\u5230\u7b49\u5f85\u961f\u5217\u4e2d\npublic static class DiscardOldestPolicy implements RejectedExecutionHandler {\n    public DiscardOldestPolicy() { }\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n        if (!e.isShutdown()) {\n            e.getQueue().poll();\n            e.execute(r);\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(e.p,{children:"\u5230\u8fd9\u91cc\uff0cThreadPoolExecutor \u7684\u6e90\u7801\u7b97\u662f\u5206\u6790\u7ed3\u675f\u4e86\u3002\u5355\u7eaf\u4ece\u6e90\u7801\u7684\u96be\u6613\u7a0b\u5ea6\u6765\u8bf4\uff0cThreadPoolExecutor \u7684\u6e90\u7801\u8fd8\u7b97\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u53ea\u662f\u9700\u8981\u6211\u4eec\u9759\u4e0b\u5fc3\u6765\u597d\u597d\u770b\u770b\u7f62\u4e86\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"executors",children:"Executors"}),"\n",(0,t.jsx)(e.p,{children:"\u8fd9\u8282\u5176\u5b9e\u4e5f\u4e0d\u662f\u5206\u6790 Executors \u8fd9\u4e2a\u7c7b\uff0c\u56e0\u4e3a\u5b83\u4ec5\u4ec5\u662f\u5de5\u5177\u7c7b\uff0c\u5b83\u7684\u6240\u6709\u65b9\u6cd5\u90fd\u662f static \u7684\u3002"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u751f\u6210\u4e00\u4e2a\u56fa\u5b9a\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\uff1a"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public static ExecutorService newFixedThreadPool(int nThreads) {\n    return new ThreadPoolExecutor(nThreads, nThreads,\n                                  0L, TimeUnit.MILLISECONDS,\n                                  new LinkedBlockingQueue<Runnable>());\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u6700\u5927\u7ebf\u7a0b\u6570\u8bbe\u7f6e\u4e3a\u4e0e\u6838\u5fc3\u7ebf\u7a0b\u6570\u76f8\u7b49\uff0c\u6b64\u65f6 keepAliveTime \u8bbe\u7f6e\u4e3a 0\uff08\u56e0\u4e3a\u8fd9\u91cc\u5b83\u662f\u6ca1\u7528\u7684\uff0c\u5373\u4f7f\u4e0d\u4e3a 0\uff0c\u7ebf\u7a0b\u6c60\u9ed8\u8ba4\u4e5f\u4e0d\u4f1a\u56de\u6536 corePoolSize \u5185\u7684\u7ebf\u7a0b\uff09\uff0c\u4efb\u52a1\u961f\u5217\u91c7\u7528 LinkedBlockingQueue\uff0c\u65e0\u754c\u961f\u5217\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u8fc7\u7a0b\u5206\u6790\uff1a\u521a\u5f00\u59cb\uff0c\u6bcf\u63d0\u4ea4\u4e00\u4e2a\u4efb\u52a1\u90fd\u521b\u5efa\u4e00\u4e2a worker\uff0c\u5f53 worker \u7684\u6570\u91cf\u8fbe\u5230 nThreads \u540e\uff0c\u4e0d\u518d\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\uff0c\u800c\u662f\u628a\u4efb\u52a1\u63d0\u4ea4\u5230 LinkedBlockingQueue \u4e2d\uff0c\u800c\u4e14\u4e4b\u540e\u7ebf\u7a0b\u6570\u59cb\u7ec8\u4e3a nThreads\u3002"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u751f\u6210\u53ea\u6709",(0,t.jsx)(e.strong,{children:"\u4e00\u4e2a\u7ebf\u7a0b"}),"\u7684\u56fa\u5b9a\u7ebf\u7a0b\u6c60\uff0c\u8fd9\u4e2a\u66f4\u7b80\u5355\uff0c\u548c\u4e0a\u9762\u7684\u4e00\u6837\uff0c\u53ea\u8981\u8bbe\u7f6e\u7ebf\u7a0b\u6570\u4e3a 1 \u5c31\u53ef\u4ee5\u4e86\uff1a"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public static ExecutorService newSingleThreadExecutor() {\n    return new FinalizableDelegatedExecutorService\n        (new ThreadPoolExecutor(1, 1,\n                                0L, TimeUnit.MILLISECONDS,\n                                new LinkedBlockingQueue<Runnable>()));\n}\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u751f\u6210\u4e00\u4e2a\u9700\u8981\u7684\u65f6\u5019\u5c31\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\uff0c\u540c\u65f6\u53ef\u4ee5\u590d\u7528\u4e4b\u524d\u521b\u5efa\u7684\u7ebf\u7a0b\uff08\u5982\u679c\u8fd9\u4e2a\u7ebf\u7a0b\u5f53\u524d\u6ca1\u6709\u4efb\u52a1\uff09\u7684\u7ebf\u7a0b\u6c60\uff1a"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"public static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue<Runnable>());\n}\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u6838\u5fc3\u7ebf\u7a0b\u6570\u4e3a 0\uff0c\u6700\u5927\u7ebf\u7a0b\u6570\u4e3a Integer.MAX_VALUE\uff0ckeepAliveTime \u4e3a 60 \u79d2\uff0c\u4efb\u52a1\u961f\u5217\u91c7\u7528 SynchronousQueue\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u8fd9\u79cd\u7ebf\u7a0b\u6c60\u5bf9\u4e8e\u4efb\u52a1\u53ef\u4ee5\u6bd4\u8f83\u5feb\u901f\u5730\u5b8c\u6210\u7684\u60c5\u51b5\u6709\u6bd4\u8f83\u597d\u7684\u6027\u80fd\u3002\u5982\u679c\u7ebf\u7a0b\u7a7a\u95f2\u4e86 60 \u79d2\u90fd\u6ca1\u6709\u4efb\u52a1\uff0c\u90a3\u4e48\u5c06\u5173\u95ed\u6b64\u7ebf\u7a0b\u5e76\u4ece\u7ebf\u7a0b\u6c60\u4e2d\u79fb\u9664\u3002\u6240\u4ee5\u5982\u679c\u7ebf\u7a0b\u6c60\u7a7a\u95f2\u4e86\u5f88\u957f\u65f6\u95f4\u4e5f\u4e0d\u4f1a\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u968f\u7740\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u5173\u95ed\uff0c\u6574\u4e2a\u7ebf\u7a0b\u6c60\u4e0d\u4f1a\u5360\u7528\u4efb\u4f55\u7684\u7cfb\u7edf\u8d44\u6e90\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u8fc7\u7a0b\u5206\u6790\uff1a\u6211\u628a execute \u65b9\u6cd5\u7684\u4e3b\u4f53\u9ecf\u8d34\u8fc7\u6765\uff0c\u8ba9\u5927\u5bb6\u770b\u5f97\u660e\u767d\u4e9b\u3002\u9274\u4e8e corePoolSize \u662f 0\uff0c\u90a3\u4e48\u63d0\u4ea4\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u5c06\u4efb\u52a1\u63d0\u4ea4\u5230\u961f\u5217\u4e2d\uff0c\u7531\u4e8e\u91c7\u7528\u4e86 SynchronousQueue\uff0c\u6240\u4ee5\u5982\u679c\u662f\u7b2c\u4e00\u4e2a\u4efb\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0coffer \u65b9\u6cd5\u80af\u5b9a\u4f1a\u8fd4\u56de false\uff0c\u56e0\u4e3a\u6b64\u65f6\u6ca1\u6709\u4efb\u4f55 worker \u5bf9\u8fd9\u4e2a\u4efb\u52a1\u8fdb\u884c\u63a5\u6536\uff0c\u90a3\u4e48\u5c06\u8fdb\u5165\u5230\u6700\u540e\u4e00\u4e2a\u5206\u652f\u6765\u521b\u5efa\u7b2c\u4e00\u4e2a worker\u3002\u4e4b\u540e\u518d\u63d0\u4ea4\u4efb\u52a1\u7684\u8bdd\uff0c\u53d6\u51b3\u4e8e\u662f\u5426\u6709\u7a7a\u95f2\u4e0b\u6765\u7684\u7ebf\u7a0b\u5bf9\u4efb\u52a1\u8fdb\u884c\u63a5\u6536\uff0c\u5982\u679c\u6709\uff0c\u4f1a\u8fdb\u5165\u5230\u7b2c\u4e8c\u4e2a if \u8bed\u53e5\u5757\u4e2d\uff0c\u5426\u5219\u5c31\u662f\u548c\u7b2c\u4e00\u4e2a\u4efb\u52a1\u4e00\u6837\uff0c\u8fdb\u5230\u6700\u540e\u7684 else if \u5206\u652f\u521b\u5efa\u65b0\u7ebf\u7a0b\u3002"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"int c = ctl.get();\n// corePoolSize \u4e3a 0\uff0c\u6240\u4ee5\u4e0d\u4f1a\u8fdb\u5230\u8fd9\u4e2a if \u5206\u652f\nif (workerCountOf(c) < corePoolSize) {\n    if (addWorker(command, true))\n        return;\n    c = ctl.get();\n}\n// offer \u5982\u679c\u6709\u7a7a\u95f2\u7ebf\u7a0b\u521a\u597d\u53ef\u4ee5\u63a5\u6536\u6b64\u4efb\u52a1\uff0c\u90a3\u4e48\u8fd4\u56de true\uff0c\u5426\u5219\u8fd4\u56de false\nif (isRunning(c) && workQueue.offer(command)) {\n    int recheck = ctl.get();\n    if (! isRunning(recheck) && remove(command))\n        reject(command);\n    else if (workerCountOf(recheck) == 0)\n        addWorker(null, false);\n}\nelse if (!addWorker(command, false))\n    reject(command);\n"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"SynchronousQueue \u662f\u4e00\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684 BlockingQueue\uff0c\u5176\u672c\u8eab\u4e0d\u50a8\u5b58\u4efb\u4f55\u5143\u7d20\uff0c\u5b83\u6709\u4e00\u4e2a\u865a\u62df\u961f\u5217\uff08\u6216\u865a\u62df\u6808\uff09\uff0c\u4e0d\u7ba1\u8bfb\u64cd\u4f5c\u8fd8\u662f\u5199\u64cd\u4f5c\uff0c\u5982\u679c\u5f53\u524d\u961f\u5217\u4e2d\u5b58\u50a8\u7684\u662f\u4e0e\u5f53\u524d\u64cd\u4f5c\u76f8\u540c\u6a21\u5f0f\u7684\u7ebf\u7a0b\uff0c\u90a3\u4e48\u5f53\u524d\u64cd\u4f5c\u4e5f\u8fdb\u5165\u961f\u5217\u4e2d\u7b49\u5f85\uff1b\u5982\u679c\u662f\u76f8\u53cd\u6a21\u5f0f\uff0c\u5219\u914d\u5bf9\u6210\u529f\uff0c\u4ece\u5f53\u524d\u961f\u5217\u4e2d\u53d6\u961f\u5934\u8282\u70b9\u3002\u5177\u4f53\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u6211\u7684\u53e6\u4e00\u7bc7\u5173\u4e8e BlockingQueue \u7684\u6587\u7ae0\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"gettask",children:"getTask"}),"\n",(0,t.jsxs)(e.p,{children:["\u524d\u6587\u5df2\u7ecf\u5206\u6790\u4e86",(0,t.jsx)(e.code,{children:"runWorker"}),"\u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8be5\u65b9\u6cd5\u4e2d\u6709\u4e00\u884c\u8fd9\u6837\u7684\u4ee3\u7801"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:"//...\n while (task != null || (task = getTask()) != null) {\n//...\n"})}),"\n",(0,t.jsxs)(e.p,{children:["\u8fd9\u4e00\u884c\u4ee3\u7801\u5982\u679c",(0,t.jsx)(e.code,{children:"task!=null"}),"\uff0c\u5373\u524d\u4e00\u4e2a\u6761\u4ef6\u4e3a",(0,t.jsx)(e.code,{children:"true"}),"\u65f6\u610f\u5473\u7740\u4f20\u5165\u7684\u4e00\u4e2a\u975e",(0,t.jsx)(e.code,{children:"null"}),"\u7684",(0,t.jsx)(e.code,{children:"task"}),"\uff0c\u540c\u65f6\u4ee3\u7801\u4f1a\u4f18\u5316\u4f7f\u5f97\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u4e0d\u53bb\u6267\u884c\uff1b\u90a3\u4e48\u524d\u4e00\u4e2a\u6761\u4ef6\u4e3a",(0,t.jsx)(e.code,{children:"false"}),"\u65f6\uff0c\u5c31\u4f1a\u5c1d\u8bd5\u8c03\u7528",(0,t.jsx)(e.code,{children:"getTask"}),"\u65b9\u6cd5\u3002\u5728\u8fd9\u4e00\u4e2a\u65b9\u6cd5\u4e2d\uff0c",(0,t.jsx)(e.code,{children:"worker"}),"\u4f1a\u5c1d\u8bd5\u4ece\u5de5\u4f5c\u961f\u5217\u4e2d\u53d6\u51fa\u4efb\u52a1\u6765\u8fdb\u884c\u6267\u884c\u3002"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",children:" private Runnable getTask() {\n      boolean timedOut = false;\n      //\u4e0d\u65ad\u5c1d\u8bd5\u83b7\u5f97\u4efb\u52a1\n      for (;;) {\n          int c = ctl.get();\n          int rs = runStateOf(c);\n          // \u524d\u6587\u5df2\u6709\u76f8\u4f3c\u7684\u72b6\u6001\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\n          if (rs >= SHUTDOWN && (rs >= STOP || workQueue.isEmpty())) {\n              decrementWorkerCount();\n              return null;\n          }\n          int wc = workerCountOf(c);\n          //\u662f\u5426\u8bbe\u7f6e\u4e86\u5141\u8bb8\u6838\u5fc3\u7ebf\u7a0b\u8d85\u65f6\uff08\u8bbe\u7f6e\u4e86\u4e4b\u540e\u6838\u5fc3\u7ebf\u7a0b\u5728\u8d85\u65f6\u540e\u4f1a\u9500\u6bc1\uff09\uff0c\u6216\u8005\u5f53\u524dworker\u6570\u91cf\u6bd4\u6838\u5fc3\u6c60\u5927\n          boolean timed = allowCoreThreadTimeOut || wc > corePoolSize;\n        \n          if ((wc > maximumPoolSize || (timed && timedOut))&& (wc > 1 || workQueue.isEmpty())) {\n              if (compareAndDecrementWorkerCount(c))\n                  return null;\n              continue;\n          }\n          try {\n              //\u662f\u5426\u8bbe\u7f6e\u4e86\u5141\u8bb8\u6838\u5fc3\u7ebf\u7a0b\u8d85\u65f6\uff08\u8bbe\u7f6e\u4e86\u4e4b\u540e\u6838\u5fc3\u7ebf\u7a0b\u5728\u8d85\u65f6\u540e\u4f1a\u9500\u6bc1\uff09\uff0c\u6216\u8005\u5f53\u524dworker\u6570\u91cf\u6bd4\u6838\u5fc3\u6c60\u5927\n              //\u5982\u679c\u662f\u8c03\u7528queue\u7684poll(int,TimeUnit)\u65b9\u6cd5\uff0c\u5426\u5219\u76f4\u63a5\u8c03\u7528take\u65b9\u6cd5\n              Runnable r = timed ? workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take();\n              //\u80fd\u83b7\u53d6\u5230\u975e\u7a7a\u7684\u4efb\u52a1\u5c31\u8fd4\u56de\n              //\u5bf9\u4e8e\u4e0d\u8bbe\u7f6e\u5141\u8bb8\u6838\u5fc3\u7ebf\u7a0b\u8d85\u65f6\u7684\u60c5\u51b5\uff0c\u6838\u5fc3\u7ebf\u7a0b\u5c31\u4e00\u76f4\u5728getTask\u7684\u8fd9\u4e2a\u5faa\u73af\u4e2d\n              //\u4e00\u76f4\u7b49\u5f85\u6709\u65b0\u7684\u4efb\u52a1\u6765\u6267\u884c\n              if (r != null)\n                  return r;\n              timedOut = true;\n          } catch (InterruptedException retry) {\n              timedOut = false;\n          }\n      }\n  }\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,t.jsx)(e.p,{children:"\u6211\u4e00\u5411\u4e0d\u559c\u6b22\u5199\u603b\u7ed3\uff0c\u56e0\u4e3a\u6211\u628a\u6240\u6709\u9700\u8981\u8868\u8fbe\u7684\u90fd\u5199\u5728\u6b63\u6587\u4e2d\u4e86\uff0c\u5199\u5c0f\u7bc7\u5e45\u7684\u603b\u7ed3\u5e76\u4e0d\u80fd\u771f\u6b63\u5c06\u8bdd\u8bf4\u6e05\u695a\uff0c\u672c\u6587\u7684\u603b\u7ed3\u90e8\u5206\u4e3a\u51c6\u5907\u9762\u8bd5\u7684\u8bfb\u8005\u800c\u5199\uff0c\u5e0c\u671b\u80fd\u5e2e\u5230\u9762\u8bd5\u8005\u6216\u8005\u6ca1\u6709\u8db3\u591f\u7684\u65f6\u95f4\u770b\u5b8c\u5168\u6587\u7684\u8bfb\u8005\u3002"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"java \u7ebf\u7a0b\u6c60\u6709\u54ea\u4e9b\u5173\u952e\u5c5e\u6027\uff1f"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"corePoolSize\uff0cmaximumPoolSize\uff0cworkQueue\uff0ckeepAliveTime\uff0crejectedExecutionHandler"}),"\n",(0,t.jsx)(e.p,{children:"corePoolSize \u5230 maximumPoolSize \u4e4b\u95f4\u7684\u7ebf\u7a0b\u4f1a\u88ab\u56de\u6536\uff0c\u5f53\u7136 corePoolSize \u7684\u7ebf\u7a0b\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u800c\u5f97\u5230\u56de\u6536\uff08allowCoreThreadTimeOut(true)\uff09\u3002"}),"\n",(0,t.jsx)(e.p,{children:"workQueue \u7528\u4e8e\u5b58\u653e\u4efb\u52a1\uff0c\u6dfb\u52a0\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6570\u8d85\u8fc7\u4e86 corePoolSize\uff0c\u90a3\u4e48\u5f80\u8be5\u961f\u5217\u4e2d\u63d2\u5165\u4efb\u52a1\uff0c\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u4f1a\u8d1f\u8d23\u5230\u961f\u5217\u4e2d\u62c9\u53d6\u4efb\u52a1\u3002"}),"\n",(0,t.jsx)(e.p,{children:"keepAliveTime \u7528\u4e8e\u8bbe\u7f6e\u7a7a\u95f2\u65f6\u95f4\uff0c\u5982\u679c\u7ebf\u7a0b\u6570\u8d85\u51fa\u4e86 corePoolSize\uff0c\u5e76\u4e14\u6709\u4e9b\u7ebf\u7a0b\u7684\u7a7a\u95f2\u65f6\u95f4\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u503c\uff0c\u4f1a\u6267\u884c\u5173\u95ed\u8fd9\u4e9b\u7ebf\u7a0b\u7684\u64cd\u4f5c"}),"\n",(0,t.jsxs)(e.p,{children:["rejectedExecutionHandler \u7528\u4e8e\u5904\u7406\u5f53\u7ebf\u7a0b\u6c60\u4e0d\u80fd\u6267\u884c\u6b64\u4efb\u52a1\u65f6\u7684\u60c5\u51b5\uff0c\u9ed8\u8ba4\u6709",(0,t.jsx)(e.strong,{children:"\u629b\u51fa RejectedExecutionException \u5f02\u5e38"}),"\u3001",(0,t.jsx)(e.strong,{children:"\u5ffd\u7565\u4efb\u52a1"}),"\u3001",(0,t.jsx)(e.strong,{children:"\u4f7f\u7528\u63d0\u4ea4\u4efb\u52a1\u7684\u7ebf\u7a0b\u6765\u6267\u884c\u6b64\u4efb\u52a1"}),"\u548c",(0,t.jsx)(e.strong,{children:"\u5c06\u961f\u5217\u4e2d\u7b49\u5f85\u6700\u4e45\u7684\u4efb\u52a1\u5220\u9664\uff0c\u7136\u540e\u63d0\u4ea4\u6b64\u4efb\u52a1"}),"\u8fd9\u56db\u79cd\u7b56\u7565\uff0c\u9ed8\u8ba4\u4e3a\u629b\u51fa\u5f02\u5e38\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"\u8bf4\u8bf4\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u521b\u5efa\u65f6\u673a\uff1f"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6570\u5c11\u4e8e corePoolSize\uff0c\u90a3\u4e48\u63d0\u4ea4\u4efb\u52a1\u7684\u65f6\u5019\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u5e76\u7531\u8fd9\u4e2a\u7ebf\u7a0b\u6267\u884c\u8fd9\u4e2a\u4efb\u52a1\uff1b"}),"\n",(0,t.jsx)(e.li,{children:"\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6570\u5df2\u7ecf\u8fbe\u5230 corePoolSize\uff0c\u90a3\u4e48\u5c06\u63d0\u4ea4\u7684\u4efb\u52a1\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\uff0c\u7b49\u5f85\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u53bb\u961f\u5217\u4e2d\u53d6\u4efb\u52a1\uff1b"}),"\n",(0,t.jsx)(e.li,{children:"\u5982\u679c\u961f\u5217\u5df2\u6ee1\uff0c\u90a3\u4e48\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u6765\u6267\u884c\u4efb\u52a1\uff0c\u9700\u8981\u4fdd\u8bc1\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u4e0d\u4f1a\u8d85\u8fc7 maximumPoolSize\uff0c\u5982\u679c\u6b64\u65f6\u7ebf\u7a0b\u6570\u8d85\u8fc7\u4e86 maximumPoolSize\uff0c\u90a3\u4e48\u6267\u884c\u62d2\u7edd\u7b56\u7565\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u6ce8\u610f\uff1a\u5982\u679c\u5c06\u961f\u5217\u8bbe\u7f6e\u4e3a\u65e0\u754c\u961f\u5217\uff0c\u90a3\u4e48\u7ebf\u7a0b\u6570\u8fbe\u5230 corePoolSize \u540e\uff0c\u5176\u5b9e\u7ebf\u7a0b\u6570\u5c31\u4e0d\u4f1a\u518d\u589e\u957f\u4e86\u3002\u56e0\u4e3a\u540e\u9762\u7684\u4efb\u52a1\u76f4\u63a5\u5f80\u961f\u5217\u585e\u5c31\u884c\u4e86\uff0c\u6b64\u65f6 maximumPoolSize \u53c2\u6570\u5c31\u6ca1\u6709\u4ec0\u4e48\u610f\u4e49\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Executors.newFixedThreadPool(\u2026) \u548c Executors.newCachedThreadPool() \u6784\u9020\u51fa\u6765\u7684\u7ebf\u7a0b\u6c60\u6709\u4ec0\u4e48\u5dee\u522b\uff1f"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u7ec6\u8bf4\u592a\u957f\uff0c\u5f80\u4e0a\u6ed1\u4e00\u70b9\u70b9\uff0c\u5728 Executors \u7684\u5c0f\u8282\u8fdb\u884c\u4e86\u8be6\u5c3d\u7684\u63cf\u8ff0\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"\u4efb\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u5f02\u5e38\u600e\u4e48\u5904\u7406\uff1f"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u5982\u679c\u67d0\u4e2a\u4efb\u52a1\u6267\u884c\u51fa\u73b0\u5f02\u5e38\uff0c\u90a3\u4e48\u6267\u884c\u4efb\u52a1\u7684\u7ebf\u7a0b\u4f1a\u88ab\u5173\u95ed\uff0c\u800c\u4e0d\u662f\u7ee7\u7eed\u63a5\u6536\u5176\u4ed6\u4efb\u52a1\u3002\u7136\u540e\u4f1a\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u6765\u4ee3\u66ff\u5b83\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"\u4ec0\u4e48\u65f6\u5019\u4f1a\u6267\u884c\u62d2\u7edd\u7b56\u7565\uff1f"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"workers \u7684\u6570\u91cf\u8fbe\u5230\u4e86 corePoolSize\uff08\u4efb\u52a1\u6b64\u65f6\u9700\u8981\u8fdb\u5165\u4efb\u52a1\u961f\u5217\uff09\uff0c\u4efb\u52a1\u5165\u961f\u6210\u529f\uff0c\u4e0e\u6b64\u540c\u65f6\u7ebf\u7a0b\u6c60\u88ab\u5173\u95ed\u4e86\uff0c\u800c\u4e14\u5173\u95ed\u7ebf\u7a0b\u6c60\u5e76\u6ca1\u6709\u5c06\u8fd9\u4e2a\u4efb\u52a1\u51fa\u961f\uff0c\u90a3\u4e48\u6267\u884c\u62d2\u7edd\u7b56\u7565\u3002\u8fd9\u91cc\u8bf4\u7684\u662f\u975e\u5e38\u8fb9\u754c\u7684\u95ee\u9898\uff0c\u5165\u961f\u548c\u5173\u95ed\u7ebf\u7a0b\u6c60\u5e76\u53d1\u6267\u884c\uff0c\u8bfb\u8005\u4ed4\u7ec6\u770b\u770b execute \u65b9\u6cd5\u662f\u600e\u4e48\u8fdb\u5230\u7b2c\u4e00\u4e2a reject(command) \u91cc\u9762\u7684\u3002"}),"\n",(0,t.jsx)(e.li,{children:"workers \u7684\u6570\u91cf\u5927\u4e8e\u7b49\u4e8e corePoolSize\uff0c\u5c06\u4efb\u52a1\u52a0\u5165\u5230\u4efb\u52a1\u961f\u5217\uff0c\u53ef\u662f\u961f\u5217\u6ee1\u4e86\uff0c\u4efb\u52a1\u5165\u961f\u5931\u8d25\uff0c\u90a3\u4e48\u51c6\u5907\u5f00\u542f\u65b0\u7684\u7ebf\u7a0b\uff0c\u53ef\u662f\u7ebf\u7a0b\u6570\u5df2\u7ecf\u8fbe\u5230 maximumPoolSize\uff0c\u90a3\u4e48\u6267\u884c\u62d2\u7edd\u7b56\u7565\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u56e0\u4e3a\u672c\u6587\u5b9e\u5728\u592a\u957f\u4e86\uff0c\u6240\u4ee5\u6211\u6ca1\u6709\u8bf4\u6267\u884c\u7ed3\u679c\u662f\u600e\u4e48\u83b7\u53d6\u7684\uff0c\u4e5f\u6ca1\u6709\u8bf4\u5173\u95ed\u7ebf\u7a0b\u6c60\u76f8\u5173\u7684\u90e8\u5206\uff0c\u8fd9\u4e2a\u5c31\u7559\u7ed9\u8bfb\u8005\u5427\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u6587\u7bc7\u5e45\u662f\u6709\u70b9\u957f\uff0c\u5982\u679c\u8bfb\u8005\u53d1\u73b0\u4ec0\u4e48\u4e0d\u5bf9\u7684\u5730\u65b9\uff0c\u6216\u8005\u6709\u9700\u8981\u8865\u5145\u7684\u5730\u65b9\uff0c\u8bf7\u4e0d\u541d\u63d0\u51fa\uff0c\u8c22\u8c22\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\uff08\u5168\u6587\u5b8c\uff09"})]})}function d(n={}){const{wrapper:e}={...(0,o.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(a,{...n})}):a(n)}},88672:(n,e,r)=>{r.d(e,{Z:()=>c,a:()=>l});var t=r(50959);const o={},i=t.createContext(o);function l(n){const e=t.useContext(i);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:l(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);