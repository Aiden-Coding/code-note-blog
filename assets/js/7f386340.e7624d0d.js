"use strict";(self.webpackChunkcode_note_blog=self.webpackChunkcode_note_blog||[]).push([[4543],{42986:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>a});var c=r(11527),s=r(88672);const o={},i=void 0,t={id:"Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u5341\uff09\uff1a\u542f\u52a8\u5b8c\u6210\u7684\u5904\u7406",title:"Spring\u542f\u52a8\u6d41\u7a0b\uff08\u5341\uff09\uff1a\u542f\u52a8\u5b8c\u6210\u7684\u5904\u7406",description:"\u63a5\u4e0a\u6587\uff0c\u7ee7\u7eed\u5206\u6790 spring \u7684\u542f\u52a8\u6d41\u7a0b\u3002",source:"@site/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u5341\uff09\uff1a\u542f\u52a8\u5b8c\u6210\u7684\u5904\u7406.md",sourceDirName:"Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b",slug:"/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u5341\uff09\uff1a\u542f\u52a8\u5b8c\u6210\u7684\u5904\u7406",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u5341\uff09\uff1a\u542f\u52a8\u5b8c\u6210\u7684\u5904\u7406",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u5341\uff09\uff1a\u542f\u52a8\u5b8c\u6210\u7684\u5904\u7406.md",tags:[],version:"current",frontMatter:{},sidebar:"spring",previous:{title:"Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e09\uff09\uff1a\u5305\u7684\u626b\u63cf\u6d41\u7a0b",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u4e09\uff09\uff1a\u5305\u7684\u626b\u63cf\u6d41\u7a0b"},next:{title:"Spring\u542f\u52a8\u6d41\u7a0b\uff08\u5341\u4e00\uff09\uff1a\u542f\u52a8\u6d41\u7a0b\u603b\u7ed3",permalink:"/code-note-blog/docs/Spring\u5168\u5bb6\u6876/Spring\u6e90\u7801\u5206\u6790/Spring\u542f\u52a8\u6d41\u7a0b/Spring\u542f\u52a8\u6d41\u7a0b\uff08\u5341\u4e00\uff09\uff1a\u542f\u52a8\u6d41\u7a0b\u603b\u7ed3"}},l={},a=[];function p(e){const n={a:"a",code:"code",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.p,{children:"\u63a5\u4e0a\u6587\uff0c\u7ee7\u7eed\u5206\u6790 spring \u7684\u542f\u52a8\u6d41\u7a0b\u3002"}),"\n",(0,c.jsxs)(n.ol,{start:"12",children:["\n",(0,c.jsx)(n.li,{children:"\u5b8c\u6210\u542f\u52a8\u64cd\u4f5c: finishRefresh()"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"AbstractApplicationContext#finishRefresh \u65b9\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"    protected void finishRefresh() {\n        // \u770b\u540d\u5b57\u5c31\u77e5\u9053\u4e86\uff0c\u6e05\u7406\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u4e00\u7cfb\u5217\u64cd\u4f5c\u4f7f\u7528\u5230\u7684\u8d44\u6e90\u7f13\u5b58\n        clearResourceCaches();\n        // \u521d\u59cb\u5316LifecycleProcessor\n        initLifecycleProcessor();\n        // \u8fd9\u4e2a\u65b9\u6cd5\u7684\u5185\u90e8\u5b9e\u73b0\u662f\u542f\u52a8\u6240\u6709\u5b9e\u73b0\u4e86Lifecycle\u63a5\u53e3\u7684bean\n        getLifecycleProcessor().onRefresh();\n        // \u53d1\u5e03ContextRefreshedEvent\u4e8b\u4ef6\n        publishEvent(new ContextRefreshedEvent(this));\n        // \u68c0\u67e5spring.liveBeansView.mbeanDomain\u662f\u5426\u5b58\u5728\uff0c\u6709\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2aMBeanServer\n        LiveBeansView.registerApplicationContext(this);\n    }\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8fd9\u4e2a\u65b9\u6cd5\u4ee3\u7801\u4e0d\u591a\uff0c\u5c31\u51e0\u4e2a\u65b9\u6cd5\uff0c\u6211\u4eec\u5206\u522b\u6765\u770b\u770b\u3002"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u6e05\u7406\u8d44\u6e90\u7f13\u5b58\uff1aclearResourceCaches()"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"clearResourceCaches() \u65b9\u6cd5\u5185\u5bb9\u5982\u4e0b\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"    public class DefaultResourceLoader implements ResourceLoader {\n    \n        private final Map<Class<?>, Map<Resource, ?>> resourceCaches\n            = new ConcurrentHashMap<>(4);\n    \n        public void clearResourceCaches() {\n            this.resourceCaches.clear();\n        }\n    \n        // \u7701\u7565\u4e86\u8fd9\u4e2a\u7c7b\u7684\u597d\u591a\u4ee3\u7801\n        ...\n    \n    }\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8fd9\u4e2a\u65b9\u6cd5\u5c31\u662f\u7528\u6765\u6e05\u7406 resourceCaches \u7684\uff0c\u8fd9\u662f\u4e2a Map\uff0c\u91cc\u9762\u5b58\u5165\u7684\u5185\u5bb9\u662f Resource\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u90a3\u4ec0\u4e48\u662f Resource \u5462\uff1f\u5728\u524d\u9762\u4ecb\u7ecd\u626b\u63cf\u5305\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4f1a\u5148\u628a class \u6587\u4ef6\u8bfb\u53d6\u51fa\u6765\uff0c\u8f6c\u6362\u6210 Resource \u540e\u518d\u8fdb\u4e00\u6b65\u5904\u7406\uff0c\u5e38\u89c1\u7684 Resource \u7c7b\u578b\u6709 FileSystemResource\u3001UrlResource \u7b49\uff0cresourceCaches \u5c31\u662f\u5b58\u653e\u8fd9\u4e9b Resource \u7684\u3002"}),"\n",(0,c.jsxs)(n.ol,{start:"2",children:["\n",(0,c.jsx)(n.li,{children:"\u5904\u7406 LifecycleProcessor"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u6211\u4eec\u5148\u6765\u770b\u770b\u4ec0\u4e48\u662f LifecycleProcessor\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"    /**\n     * \u5904\u7406\u5bb9\u5668\u7684\u542f\u52a8\u4e0e\u5173\u95ed\u64cd\u4f5c\n     */\n    public interface LifecycleProcessor extends Lifecycle {\n    \n        /**\n         * \u5bb9\u5668\u542f\u52a8\u5b8c\u6210\u65f6\u8c03\u7528\n         */\n        void onRefresh();\n    \n        /**\n         * \u5bb9\u5668\u5173\u95ed\u65f6\u8c03\u7528\n         */\n        void onClose();\n    \n    }\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8fd9\u4e2a\u63a5\u53e3\u7528\u6765\u5904\u7406\u5bb9\u5668\u5904\u7406\u5bb9\u5668\u7684\u542f\u52a8\u4e0e\u5173\u95ed\u64cd\u4f5c\uff0c\u6bd4\u5982\u6211\u4eec\u81ea\u5df1\u5b9e\u73b0\u8be5\u63a5\u53e3\uff0c\u7136\u540e\u91cd\u5199 onRefresh() \u4e0e onClose()\uff0c\u4ee5\u4fbf\u5728\u5bb9\u5668\u542f\u52a8\u4e0e\u5173\u95ed\u65f6\u505a\u4e00\u4e9b\u64cd\u4f5c\uff0c\u50cf\u8fd9\u6837\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'    @Component\n    public class MyLifecycleProcessor implements LifecycleProcessor {\n    \n        @Override\n        public void onRefresh() {\n            System.out.println("\u5bb9\u5668\u542f\u52a8");\n        }\n    \n        @Override\n        public void onClose() {\n            System.out.println("\u5bb9\u5668\u5173\u95ed");\n        }\n    }\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u4e0e LifecycleProcessor \u76f8\u5173\u7684\u65b9\u6cd5\u6709\u4e24\u4e2a\uff1ainitLifecycleProcessor()\u3001getLifecycleProcessor()\uff0c\u6211\u4eec\u4e00\u8d77\u4e00\u4e3a\u770b\u770b\u8fd9\u4e24\u4e2a\u65b9\u6cd5\uff1a"}),"\n",(0,c.jsx)(n.p,{children:"AbstractApplicationContext"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"    private LifecycleProcessor lifecycleProcessor;\n    \n    /**\n     * \u521d\u59cb\u5316 LifecycleProcessor\n     */\n    protected void initLifecycleProcessor() {\n        ConfigurableListableBeanFactory beanFactory = getBeanFactory();\n        // \u5b58\u5728\uff0c\u76f4\u63a5\u4f7f\u7528\n        if (beanFactory.containsLocalBean(LIFECYCLE_PROCESSOR_BEAN_NAME)) {\n            this.lifecycleProcessor =\n                    beanFactory.getBean(LIFECYCLE_PROCESSOR_BEAN_NAME, LifecycleProcessor.class);\n        }\n        // \u4e0d\u5b58\u5728\u5219\u521b\u5efa\uff0c\u9ed8\u8ba4\u4f7f\u7528DefaultLifecycleProcessor\n        else {\n            DefaultLifecycleProcessor defaultProcessor = new DefaultLifecycleProcessor();\n            defaultProcessor.setBeanFactory(beanFactory);\n            this.lifecycleProcessor = defaultProcessor;\n            beanFactory.registerSingleton(LIFECYCLE_PROCESSOR_BEAN_NAME, this.lifecycleProcessor);\n        }\n    }\n    \n    /**\n     * \u8fd4\u56de lifecycleProcessor\n     */\n    LifecycleProcessor getLifecycleProcessor() throws IllegalStateException {\n        if (this.lifecycleProcessor == null) {\n            throw new IllegalStateException(...);\n        }\n        return this.lifecycleProcessor;\n    }\n"})}),"\n",(0,c.jsx)(n.p,{children:"initLifecycleProcessor \u6240\u505a\u7684\u5c31\u662f\u8bbe\u7f6e AbstractApplicationContext#lifecycleProcessor \u5c5e\u6027\uff0c\u5982\u679c beanFactory \u4e2d\u5b58\u5728 initLifecycleProcessor \u5219\u76f4\u63a5\u4f7f\u7528\uff0c\u5426\u5219\u5c31\u521b\u5efa\u4e00\u4e2a\u3002"}),"\n",(0,c.jsx)(n.p,{children:"getLifecycleProcessor() \u4ec5\u4ec5\u53ea\u662f\u8fd4\u56de\u4e86 AbstractApplicationContext#lifecycleProcessor \u5c5e\u6027\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u5728 getLifecycleProcessor().onRefresh() \u4e2d\uff0c\u8fd8\u8c03\u7528\u4e86 onRefresh() \u65b9\u6cd5\uff0c\u6211\u4eec\u4e00\u8d77\u6765\u770b\u770b DefaultLifecycleProcessor#onRefresh \u505a\u4e86\u4ec0\u4e48\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"    @Override\n    public void onRefresh() {\n        startBeans(true);\n        this.running = true;\n    }\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u4ece\u53d8\u91cf\u6765\u770b\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4ec5\u4ec5\u53ea\u662f\u6539\u4e86\u4e00\u4e2a\u8fd0\u884c\u72b6\u6001\u3002"}),"\n",(0,c.jsxs)(n.ol,{start:"3",children:["\n",(0,c.jsx)(n.li,{children:"\u53d1\u5e03 ContextRefreshedEvent \u4e8b\u4ef6"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u4ee3\u7801 publishEvent(new ContextRefreshedEvent(this)) \u53d1\u5e03\u4e86 ContextRefreshedEvent\uff0c\u6211\u4eec\u81ea\u5df1\u4e5f\u53ef\u4ee5\u6765\u76d1\u542c\u8be5\u4e8b\u4ef6\u3002\u5173\u4e8e\u4e8b\u4ef6\uff0c\u672c\u6587\u5e76\u4e0d\u6253\u7b97\u6df1\u5165\uff0c\u5173\u4e8e spring \u4e8b\u4ef6\u7684\u8be6\u7ec6\u5206\u6790\uff0c\u53ef\u4ee5\u53c2\u8003 spring \u63a2\u79d8\u4e4b spring \u4e8b\u4ef6\u673a\u5236\u3002"}),"\n",(0,c.jsxs)(n.ol,{start:"13",children:["\n",(0,c.jsx)(n.li,{children:"\u6e05\u9664\u7f13\u5b58: resetCommonCaches()"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u8be5\u65b9\u6cd5\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"    protected void resetCommonCaches() {\n        ReflectionUtils.clearCache();\n        AnnotationUtils.clearCache();\n        ResolvableType.clearCache();\n        CachedIntrospectionResults.clearClassLoader(getClassLoader());\n    }\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u4ece\u65b9\u6cd5\u6765\u770b\uff0c\u5c31\u662f\u6267\u884c\u5404\u79cd\u7f13\u5b58\uff0c\u6267\u884c\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u4e0d\u6df1\u7a76\u4e86\u3002"}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsxs)(n.p,{children:["\u672c\u6587\u539f\u6587\u94fe\u63a5\uff1a",(0,c.jsx)(n.a,{href:"https://my.oschina.net/funcy/blog/4892555",children:"https://my.oschina.net/funcy/blog/4892555"})," \uff0c\u9650\u4e8e\u4f5c\u8005\u4e2a\u4eba\u6c34\u5e73\uff0c\u6587\u4e2d\u96be\u514d\u6709\u9519\u8bef\u4e4b\u5904\uff0c\u6b22\u8fce\u6307\u6b63\uff01\u539f\u521b\u4e0d\u6613\uff0c\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002"]})]})}function d(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(p,{...e})}):p(e)}},88672:(e,n,r)=>{r.d(n,{Z:()=>t,a:()=>i});var c=r(50959);const s={},o=c.createContext(s);function i(e){const n=c.useContext(o);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),c.createElement(o.Provider,{value:n},e.children)}}}]);