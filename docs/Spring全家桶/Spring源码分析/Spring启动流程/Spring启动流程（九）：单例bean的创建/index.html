<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（九）：单例bean的创建" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">Spring启动流程（九）：单例bean的创建 | Tommy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（九）：单例bean的创建"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spring启动流程（九）：单例bean的创建 | Tommy"><meta data-rh="true" name="description" content="接上文，本文依旧是分析 finishBeanFactoryInitialization(beanFactory)，本文将重点分析单例 bean 的创建流程。"><meta data-rh="true" property="og:description" content="接上文，本文依旧是分析 finishBeanFactoryInitialization(beanFactory)，本文将重点分析单例 bean 的创建流程。"><link data-rh="true" rel="icon" href="/code-note-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（九）：单例bean的创建"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（九）：单例bean的创建" hreflang="en"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（九）：单例bean的创建" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/code-note-blog/blog/rss.xml" title="Tommy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/code-note-blog/blog/atom.xml" title="Tommy Atom Feed"><link rel="stylesheet" href="/code-note-blog/assets/css/styles.dd5372db.css">
<script src="/code-note-blog/assets/js/runtime~main.f999fb27.js" defer="defer"></script>
<script src="/code-note-blog/assets/js/main.a0bfbaed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XYiV" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/code-note-blog/"><b class="navbar__title text--truncate">Tommy</b></a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Java/basic/抽象类和接口">java</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/JavaWeb/走进JavaWeb技术世界：JavaWeb的由来和基础知识">javaweb</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">cache</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/backend/后端技术杂谈：白话虚拟化技术">backend</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cs/algorithms/剑指offer">cs</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">database</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/distributed/basic/分布式系统理论基础 ：CAP">distributed</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/interview/BATJ-Experience/面阿里,终获offer">interview</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mq/kafka/消息队列kafka详解：如何实现死信队列">mq</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">spring</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mianshi/collection">面试</a><a href="https://aiden-coding.github.io/code-note-blog/SpringCloud%E7%AC%AC3%E5%AD%A32024.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_XbAW colorModeToggle_r5NY"><button class="clean-btn toggleButton_Jx0n toggleButtonDisabled_zYO7" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FjAw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qmEt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_wJfS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LABv"><div class="docsWrapper_pdvB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Jioa" type="button"></button><div class="docRoot_qx_v"><aside class="theme-doc-sidebar-container docSidebarContainer_NHKT"><div class="sidebarViewport_uyYB"><div class="sidebar_SZG4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VP_k"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">Spring</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：初探SpringIOC核心流程">Spring源码分析</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：初探SpringIOC核心流程">Spring源码剖析：初探SpringIOC核心流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：懒加载的单例Bean获取过程分析">Spring源码剖析：懒加载的单例Bean获取过程分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：AOP实现原理详解">Spring源码剖析：AOP实现原理详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：JDK和cglib动态代理原理详解">Spring源码剖析：JDK和cglib动态代理原理详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：Spring事务概述">Spring源码剖析：Spring事务概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：Spring事务源码剖析">Spring源码剖析：Spring事务源码剖析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：SpringAOP概述">Spring源码剖析：SpringAOP概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：SpringIOC容器的加载过程">Spring源码剖析：SpringIOC容器的加载过程</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（八）：完成BeanFactory的初始化">Spring启动流程</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（八）：完成BeanFactory的初始化">Spring启动流程（八）：完成BeanFactory的初始化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（二）：ApplicationContext的创建">Spring启动流程（二）：ApplicationContext的创建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（九）：单例bean的创建">Spring启动流程（九）：单例bean的创建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（六）：注册BeanPostProcessor">Spring启动流程（六）：注册BeanPostProcessor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（七）：国际化与事件处理">Spring启动流程（七）：国际化与事件处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（三）：包的扫描流程">Spring启动流程（三）：包的扫描流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（十）：启动完成的处理">Spring启动流程（十）：启动完成的处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（十一）：启动流程总结">Spring启动流程（十一）：启动流程总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（四）：启动前的准备工作">Spring启动流程（四）：启动前的准备工作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（五）：执行BeanFactoryPostProcessor">Spring启动流程（五）：执行BeanFactoryPostProcessor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（一）：启动流程概览">Spring启动流程（一）：启动流程概览</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring事务/Spring事务（二）：事务的执行流程">Spring事务</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解">Spring重要机制探秘</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring组件分析/Spring组件之ApplicationContext">Spring组件分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/SpringAOP/AnnotationAwareAspectJAutoProxyCreator分析（上）">SpringAOP</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot/给你一份SpringBoot知识清单">SpringBoot</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot源码解析/SpringBoot启动流程（四）：启动IOC容器">SpringBoot源码解析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud/SpringCloudConsul">SpringCloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud源码分析/SpringCloudConfig源码分析">SpringCloud源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibaba概览">SpringCloudAlibaba</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba源码分析/SpringCloudAlibabaNacos源码分析：服务发现">SpringCloudAlibaba源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC/SpringMVC常见注解">SpringMVC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（二）之执行Handler方法">SpringMVC源码分析</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_SejT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_j3Yw"><div class="docItemContainer_XOSC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_F6gm" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/code-note-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YCxa"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Spring源码分析</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Spring启动流程</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spring启动流程（九）：单例bean的创建</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ToOY theme-doc-toc-mobile tocMobile_suYB"><button type="button" class="clean-btn tocCollapsibleButton_VzP_">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spring启动流程（九）：单例bean的创建</h1></header><p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-1f1ac8f3d8241fad9693d9684048ab7f3ae.png" alt="" class="img_kGBN"></p>
<p>接上文，本文依旧是分析 <code>finishBeanFactoryInitialization(beanFactory)</code>，本文将重点分析单例 bean 的创建流程。</p>
<p>在上一篇文章中，我们介绍了 <code>AbstractApplicationContext#finishBeanFactoryInitialization</code> 的执行过程，本文将深入细节，分析 spring bean 的创建过程。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">|-AnnotationConfigApplicationContext#AnnotationConfigApplicationContext(String...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |-AbstractApplicationContext#refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-AbstractApplicationContext#finishBeanFactoryInitialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |-DefaultListableBeanFactory#preInstantiateSingletons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-AbstractBeanFactory#getBean(java.lang.String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |-AbstractBeanFactory#doGetBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们直接看 <code>AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])</code>，精简后的代码如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected Object createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	throws BeanCreationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RootBeanDefinition mbdToUse = mbd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 确保 BeanDefinition 中的 Class 被加载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (resolvedClass != null &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mbdToUse = new RootBeanDefinition(mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mbdToUse.setBeanClass(resolvedClass);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 准备方法覆写，如果bean中定义了 &lt;lookup-method /&gt; 和 &lt;replaced-method /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mbdToUse.prepareMethodOverrides();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (BeanDefinitionValidationException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果有代理的话直接返回</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object bean = resolveBeforeInstantiation(beanName, mbdToUse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (bean != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 创建 bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object beanInstance = doCreateBean(beanName, mbdToUse, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return beanInstance;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (BeanCreationException | ImplicitlyAppearedSingletonException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，该方法做了四件事：</p>
<ol>
<li>确保 class 被加载</li>
<li>覆写方法</li>
<li>查找代理对象，若有则返回</li>
<li>创建 spring bean</li>
</ol>
<p>对于前面三个操作，本文不关注，我们仅看第四个操作。进入 <code>AbstractAutowireCapableBeanFactory#doCreateBean</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected Object doCreateBean(final String beanName, final RootBeanDefinition mbd, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          final @Nullable Object[] args)  throws BeanCreationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BeanWrapper instanceWrapper = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mbd.isSingleton()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //如果是 factoryBean则从缓存删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        instanceWrapper = this.factoryBeanInstanceCache.remove(beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (instanceWrapper == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         // 实例化 Bean，这个方法里面才是终点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         instanceWrapper = createBeanInstance(beanName, mbd, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //bean实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final Object bean = instanceWrapper.getWrappedInstance();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //bean类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (beanType != NullBean.class) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mbd.resolvedTargetType = beanType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    synchronized (mbd.postProcessingLock) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!mbd.postProcessed) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 循环调用MergedBeanDefinitionPostProcessor的postProcessMergedBeanDefinition方法。例如，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 1\. 调用 AutowiredAnnotationBeanPostProcessor.postProcessMergedBeanDefinition 为了找到</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //  带有@Autowired、@Value 注解的属性和方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 2\. 调用 CommonAnnotationBeanPostProcessor.postProcessMergedBeanDefinition 为了找到</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 	带有@Resource 注解的属性和方  法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mbd.postProcessed = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 解决循环依赖问题, 是否允许循环依赖, allowCircularReferences默认为true，可以关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            isSingletonCurrentlyInCreation(beanName));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (earlySingletonExposure) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 循环依赖的解决，后面会单独分析</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object exposedObject = bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 负责属性装配, 也就是我们常常说的自动注入，很重要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        populateBean(beanName, mbd, instanceWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 这里是处理bean初始化完成后的各种回调，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 例如init-method、InitializingBean 接口、BeanPostProcessor 接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exposedObject = initializeBean(beanName, exposedObject, mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //同样的，如果存在循环依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (earlySingletonExposure) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 循环依赖的解决，后面会单独分析</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 把bean注册到相应的Scope中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registerDisposableBeanIfNecessary(beanName, bean, mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (BeanDefinitionValidationException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return exposedObject;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，spring 在创建 bean 时，主要做了如下三件事：</p>
<ol>
<li>创建实例</li>
<li>查找属性</li>
<li>注入属性</li>
<li>初始化 bean</li>
</ol>
<p>接下来，咱们就主要分析这四个步骤。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="1-创建实例">1. 创建实例<a href="#1-创建实例" class="hash-link" aria-label="Direct link to 1. 创建实例" title="Direct link to 1. 创建实例">​</a></h4>
<p>spring 创建实例的方法是 <code>AbstractAutowireCapableBeanFactory#createBeanInstance</code>，内容如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Nullable Object[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 确保已经加载了此 class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 校验类的访问权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (beanClass != null &amp;&amp; !Modifier.isPublic(beanClass.getModifiers()) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &amp;&amp; !mbd.isNonPublicAccessAllowed()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new BeanCreationException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 是否设置了bean创建的Supplier，Supplier是java8提供的类，可以传入一个lambda表达式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 调用 AbstractBeanDefinition#setInstanceSupplier 指定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Supplier&lt;?&gt; instanceSupplier = mbd.getInstanceSupplier();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (instanceSupplier != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return obtainFromSupplier(instanceSupplier, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mbd.getFactoryMethodName() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 采用工厂方法实例化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return instantiateUsingFactoryMethod(beanName, mbd, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 是否第一次</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean resolved = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 是否采用构造函数注入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean autowireNecessary = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (args == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        synchronized (mbd.constructorArgumentLock) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (mbd.resolvedConstructorOrFactoryMethod != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resolved = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                autowireNecessary = mbd.constructorArgumentsResolved;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (resolved) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (autowireNecessary) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return autowireConstructor(beanName, mbd, null, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 无参构造函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return instantiateBean(beanName, mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Candidate constructors for autowiring?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 判断是否采用有参构造函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return autowireConstructor(beanName, mbd, ctors, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctors = mbd.getPreferredConstructors();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ctors != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 构造函数依赖注入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return autowireConstructor(beanName, mbd, ctors, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 调用无参构造函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return instantiateBean(beanName, mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从以上代码来看，spring 在实例化 bean 时，有 4 种方式：</p>
<ol>
<li>使用实例化方法：obtainFromSupplier</li>
<li>使用工厂方法：instantiateUsingFactoryMethod</li>
<li>使用有参构造 ：autowireConstructor</li>
<li>使用无参构造：instantiateBean</li>
</ol>
<p>对于前面两个方法，这是开发者指定的方法，没啥好说的，后面两个方法是 spring 根据类的实际情况来选择构造方法进行实例化的。对于一个 bean 来说，如果未提供任何构造方法或提供了无参构造方法，则调用 <code>AbstractAutowireCapableBeanFactory#instantiateBean</code> 来进行实例化，否则调用 <code>AbstractAutowireCapableBeanFactory#autowireConstructor</code> 进行实例化。实际上，这两个方法最终都会执行到 <code>BeanUtils#instantiateClass(Constructor&lt;T&gt;, Object...)</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public static &lt;T&gt; T instantiateClass(Constructor&lt;T&gt; ctor, Object... args) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws BeanInstantiationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Assert.notNull(ctor, &quot;Constructor must not be null&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ReflectionUtils.makeAccessible(ctor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (KotlinDetector.isKotlinReflectPresent() </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   &amp;&amp; KotlinDetector.isKotlinType(ctor.getDeclaringClass())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return KotlinDelegate.instantiateClass(ctor, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Class&lt;?&gt;[] parameterTypes = ctor.getParameterTypes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Assert.isTrue(args.length &lt;= parameterTypes.length, &quot;...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object[] argsWithDefaultValues = new Object[args.length];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0 ; i &lt; args.length; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (args[i] == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Class&lt;?&gt; parameterType = parameterTypes[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    argsWithDefaultValues[i] = (parameterType.isPrimitive() </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        ? DEFAULT_TYPE_VALUES.get(parameterType) : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    argsWithDefaultValues[i] = args[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 这里进行实例化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ctor.newInstance(argsWithDefaultValues);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，最终调用的是 <code>java.lang.reflect.Constructor#newInstance</code>，这就是 jdk 的反射了。</p>
<p>另外，当 bean 提供了多 个构造方法时，spring 会进行一套复杂的推断机制，推断出最佳的构造方法，这里就不展开了。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="2-查找属性">2. 查找属性<a href="#2-查找属性" class="hash-link" aria-label="Direct link to 2. 查找属性" title="Direct link to 2. 查找属性">​</a></h4>
<p>对象创建后，接下来就是进行属性注入了，不过在注入属性前，需要知道类中有哪些属性需要注入。spring 属性查找是在 <code>AbstractAutowireCapableBeanFactory#applyMergedBeanDefinitionPostProcessors</code> 中调用后置处理器进行操作的：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected void applyMergedBeanDefinitionPostProcessors(RootBeanDefinition mbd, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; beanType, String beanName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (BeanPostProcessor bp : getBeanPostProcessors()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (bp instanceof MergedBeanDefinitionPostProcessor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 调用后置处理器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MergedBeanDefinitionPostProcessor bdp = (MergedBeanDefinitionPostProcessor) bp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bdp.postProcessMergedBeanDefinition(mbd, beanType, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在这些后置处理器中，</p>
<ol>
<li>调用 <code>AutowiredAnnotationBeanPostProcessor.postProcessMergedBeanDefinition</code> 查找带有 <code>@Autowired</code>、<code>@Value</code> 注解的属性和方法</li>
<li>调用 <code>CommonAnnotationBeanPostProcessor.postProcessMergedBeanDefinition</code> 查找带有 <code>@Resource</code> 注解的属性和方法</li>
</ol>
<p>这里为了方便说明 <code>@Autowired</code> 的注入流程，我们在 demo01 的 <code>org.springframework.learn.demo01.BeanObj1</code> 添加两行行代码：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">package org.springframework.learn.demo01;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Service;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanObj1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 以下两行为新加入的代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private BeanObj2 beanObj2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj1() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;调用beanObj1的构造方法&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String toString() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;BeanObj1{}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>进入 <code>AutowiredAnnotationBeanPostProcessor#postProcessMergedBeanDefinition</code> 方法：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void postProcessMergedBeanDefinition(RootBeanDefinition beanDefinition, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; beanType, String beanName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找属性与方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    InjectionMetadata metadata = findAutowiringMetadata(beanName, beanType, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 验证查找到的属性与方法，并注册到beanDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata.checkConfigMembers(beanDefinition);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>一路跟进 <code>AutowiredAnnotationBeanPostProcessor#findAutowiringMetadata</code> 方法，跟到了 <code>AutowiredAnnotationBeanPostProcessor#buildAutowiringMetadata</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">private InjectionMetadata buildAutowiringMetadata(final Class&lt;?&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里跑了一个循环，找完当前类找当前类的父类，直到Object类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    do {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final List&lt;InjectionMetadata.InjectedElement&gt; currElements = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 查找属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ReflectionUtils.doWithLocalFields(targetClass, field -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MergedAnnotation&lt;?&gt; ann = findAutowiredAnnotation(field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (ann != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (Modifier.isStatic(field.getModifiers())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                boolean required = determineRequiredStatus(ann);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 属性封装成 AutowiredFieldElement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                currElements.add(new AutowiredFieldElement(field, required));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 查找方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ReflectionUtils.doWithLocalMethods(targetClass, method -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Method bridgedMethod = BridgeMethodResolver.findBridgedMethod(method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!BridgeMethodResolver.isVisibilityBridgeMethodPair(method, bridgedMethod)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MergedAnnotation&lt;?&gt; ann = findAutowiredAnnotation(bridgedMethod);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (ann != null &amp;&amp; method.equals(ClassUtils.getMostSpecificMethod(method, clazz))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (Modifier.isStatic(method.getModifiers())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (method.getParameterCount() == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                boolean required = determineRequiredStatus(ann);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PropertyDescriptor pd = BeanUtils.findPropertyForMethod(bridgedMethod, clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 方法封装成 AutowiredMethodElement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                currElements.add(new AutowiredMethodElement(method, required, pd));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elements.addAll(0, currElements);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetClass = targetClass.getSuperclass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (targetClass != null &amp;&amp; targetClass != Object.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return InjectionMetadata.forElements(elements, clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上代码就是查找过程，总结如下：</p>
<ul>
<li>循环查询父类，从当前类开始，找完当前类就找当前类的父类，直接 Object 为止；</li>
<li>查找属性与方法，属性找到后封装为 <code>AutowiredFieldElement</code>，方法找到后封装为 <code>AutowiredMethodElement</code>；</li>
<li>无论是查找属性还是方法，使用的都是 <code>findAutowiredAnnotation</code> 方法</li>
</ul>
<p>接下来，我们就看看 <code>findAutowiredAnnotation</code> 方法是如何进行查找的。进入 <code>AutowiredAnnotationBeanPostProcessor#findAutowiredAnnotation</code> 方法，内容如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">private final Set&lt;Class&lt;? extends Annotation&gt;&gt; autowiredAnnotationTypes </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        = new LinkedHashSet&lt;&gt;(4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 默认构造方法中指定了@Autowired、@Value注解</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SuppressWarnings(&quot;unchecked&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public AutowiredAnnotationBeanPostProcessor() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.autowiredAnnotationTypes.add(Autowired.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.autowiredAnnotationTypes.add(Value.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 这里就是查找方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Nullable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private MergedAnnotation&lt;?&gt; findAutowiredAnnotation(AccessibleObject ao) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MergedAnnotations annotations = MergedAnnotations.from(ao);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // autowiredAnnotationTypes 包含了 @Autowired、@Value注解</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (Class&lt;? extends Annotation&gt; type : this.autowiredAnnotationTypes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MergedAnnotation&lt;?&gt; annotation = annotations.get(type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (annotation.isPresent()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return annotation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上代码注解得很明白了，这里就不多说了。</p>
<p>找到属性与方法后，接着就是注册到 <code>beanDefinition</code> 了，这是 <code>InjectionMetadata#checkConfigMembers</code> 所做的工作：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public void checkConfigMembers(RootBeanDefinition beanDefinition) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;InjectedElement&gt; checkedElements = new LinkedHashSet&lt;&gt;(this.injectedElements.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (InjectedElement element : this.injectedElements) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Member member = element.getMember();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!beanDefinition.isExternallyManagedConfigMember(member)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 注册到 beanDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDefinition.registerExternallyManagedConfigMember(member);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            checkedElements.add(element);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.checkedElements = checkedElements;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>所谓的注册，其实也相当简单，就是往 <code>beanDefinition</code> 持有的 <code>externallyManagedConfigMembers</code> 集合中添加一条记录：</p>
<blockquote>
<p>RootBeanDefinition#registerExternallyManagedConfigMember</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public void registerExternallyManagedConfigMember(Member configMember) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    synchronized (this.postProcessingLock) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (this.externallyManagedConfigMembers == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.externallyManagedConfigMembers = new HashSet&lt;&gt;(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 往set集合中添加一条记录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.externallyManagedConfigMembers.add(configMember);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="3-注入属性">3. 注入属性<a href="#3-注入属性" class="hash-link" aria-label="Direct link to 3. 注入属性" title="Direct link to 3. 注入属性">​</a></h4>
<p>spring 的属性注入是在方法 <code>AbstractAutowireCapableBeanFactory#populateBean</code> 中处理的，内容如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bw == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (mbd.hasPropertyValues()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BeanCreationException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (BeanPostProcessor bp : getBeanPostProcessors()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (bp instanceof InstantiationAwareBeanPostProcessor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 调用具体的后置处理器完成属性填充</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // AutowiredAnnotationBeanPostProcessor.postProcessProperties 处理 @Autowired、@Value 注解</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // CommonAnnotationBeanPostProcessor.postProcessProperties 处理 @Resource注解</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 如果返回 false，代表不需要进行后续的属性设值，也不需要再经过其他的 BeanPostProcessor 的处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (!ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // bean的所有属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int resolvedAutowireMode = mbd.getResolvedAutowireMode();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 属性注入类型为byType还是byName，注：@Autowired 既不是byType也不是byName,因此这里返回false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MutablePropertyValues newPvs = new MutablePropertyValues(pvs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 通过名字找到所有属性值，如果是 bean 依赖，先初始化依赖的 bean。记录依赖关系</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (resolvedAutowireMode == AUTOWIRE_BY_NAME) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            autowireByName(beanName, mbd, bw, newPvs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 通过类型装配。复杂一些</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (resolvedAutowireMode == AUTOWIRE_BY_TYPE) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            autowireByType(beanName, mbd, bw, newPvs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pvs = newPvs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean hasInstAwareBpps = hasInstantiationAwareBeanPostProcessors();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean needsDepCheck = (mbd.getDependencyCheck() != AbstractBeanDefinition.DEPENDENCY_CHECK_NONE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PropertyDescriptor[] filteredPds = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (hasInstAwareBpps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (pvs == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pvs = mbd.getPropertyValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (BeanPostProcessor bp : getBeanPostProcessors()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (bp instanceof InstantiationAwareBeanPostProcessor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 调用后置处理器完成注释的属性填充</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 处理@Autowired注解的是 AutowiredAnnotationBeanPostProcessor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PropertyValues pvsToUse = ibp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (pvsToUse == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (filteredPds == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 这里就是上方曾经提到过得对@Autowired处理的一个BeanPostProcessor了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 它会对所有标记@Autowired、@Value 注解的属性进行设值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pvsToUse = ibp.postProcessPropertyValues(pvs, filteredPds, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        bw.getWrappedInstance(), beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (pvsToUse == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pvs = pvsToUse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (needsDepCheck) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (filteredPds == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        checkDependencies(beanName, mbd, filteredPds, pvs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (pvs != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 设置 bean 实例的属性值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        applyPropertyValues(beanName, mbd, bw, pvs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>spring 的属性填充是在后置处理器中进行的，<code>@Autowired</code> 的属性填充方法为 <code>AutowiredAnnotationBeanPostProcessor#postProcessProperties</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     // 调用 findAutowiringMetadata 方法，确保标注 @Autowired @Value 注解的属性与方法获取成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     // findAutowiringMetadata 可以发现，里面做了一个缓存，只有第一次才会真正去获取，之后都从缓存中获取</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     InjectionMetadata metadata = findAutowiringMetadata(beanName, bean.getClass(), pvs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         // 这里进行属性注入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         metadata.inject(bean, beanName, pvs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     catch (...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们再进入 <code>InjectionMetadata#inject</code>：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public void inject(Object target, @Nullable String beanName, @Nullable PropertyValues pvs) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Collection&lt;InjectedElement&gt; checkedElements = this.checkedElements;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Collection&lt;InjectedElement&gt; elementsToIterate =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (checkedElements != null ? checkedElements : this.injectedElements);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!elementsToIterate.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 这里的 InjectedElement，就是在 AutowiredAnnotationBeanPostProcessor#findAutowiringMetadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 中查找到的，field 会封装为 AutowiredFieldElement，method 会会封装为 AutowiredMethodElement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (InjectedElement element : elementsToIterate) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            element.inject(target, beanName, pvs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们再跟进 <code>element.inject(target, beanName, pvs)</code>，这里调用到的是 <code>AutowiredAnnotationBeanPostProcessor.AutowiredFieldElement#inject</code>：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected void inject(Object bean, @Nullable String beanName, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                @Nullable PropertyValues pvs) throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Field field = (Field) this.member;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (this.cached) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            value = resolvedCachedArgument(beanName, this.cachedFieldValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DependencyDescriptor desc = new DependencyDescriptor(field, this.required);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            desc.setContainingClass(bean.getClass());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Set&lt;String&gt; autowiredBeanNames = new LinkedHashSet&lt;&gt;(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Assert.state(beanFactory != null, &quot;No BeanFactory available&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TypeConverter typeConverter = beanFactory.getTypeConverter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 这一行就是获取注入的bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                value = beanFactory.resolveDependency(desc, beanName, autowiredBeanNames, typeConverter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            catch (BeansException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 通过反射给属性设置值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (value != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ReflectionUtils.makeAccessible(field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            field.set(bean, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上代码有点多，但我们只要主要关注两行代码就行了：</p>
<ol>
<li>获取需要注入的 bean: <code>value = beanFactory.resolveDependency(desc, beanName, autowiredBeanNames, typeConverter)</code></li>
<li>使用反射设置 bean：<code>ReflectionUtils.makeAccessible(field);field.set(bean, value);</code></li>
</ol>
<p>对于第 2 点，最终调用的是 jdk 提供的反射方法，没什么好说的。这里我们重点来看看 spring 是如何获取需要注入的 bean。</p>
<p>跟进 <code>beanFactory.resolveDependency(desc, beanName, autowiredBeanNames, typeConverter)</code>，这里对不重要的代码仅给出调用链，调用如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">|-AnnotationConfigApplicationContext#AnnotationConfigApplicationContext(String...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |-AbstractApplicationContext#refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-AbstractApplicationContext#finishBeanFactoryInitialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |-DefaultListableBeanFactory#preInstantiateSingletons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-AbstractBeanFactory#getBean(String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |-AbstractBeanFactory#doGetBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-DefaultSingletonBeanRegistry#getSingleton(String, ObjectFactory&lt;?&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |-AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |-AbstractAutowireCapableBeanFactory#doCreateBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         |-AbstractAutowireCapableBeanFactory#populateBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          |-AutowiredAnnotationBeanPostProcessor#postProcessProperties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           |-InjectionMetadata#inject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            |-AutowiredAnnotationBeanPostProcessor.AutowiredFieldElement#inject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |-DefaultListableBeanFactory#resolveDependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              |-DefaultListableBeanFactory#doResolveDependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终运行到 <code>DefaultListableBeanFactory#doResolveDependency</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Nullable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Object doResolveDependency(DependencyDescriptor descriptor, @Nullable String beanName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         @Nullable Set&lt;String&gt; autowiredBeanNames, @Nullable TypeConverter typeConverter) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    InjectionPoint previousInjectionPoint = ConstructorResolver.setCurrentInjectionPoint(descriptor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 1\.  根据类型查找所有的beanClass，map中保存的内容为：beanName -&gt; Class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, type, descriptor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String autowiredBeanName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object instanceCandidate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 2\. 如果找到的bean有多个，即数量大于1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (matchingBeans.size() &gt; 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 则获取注入的属性名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            autowiredBeanName = determineAutowireCandidate(matchingBeans, descriptor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (autowiredBeanName == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (isRequired(descriptor) || !indicatesMultipleBeans(type)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return descriptor.resolveNotUnique(descriptor.getResolvableType(), matchingBeans);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 3\. 根据注入的属性名从 根据类型找出来的map&lt;beanName, Class&gt;当中找，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 得到bean的Class对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instanceCandidate = matchingBeans.get(autowiredBeanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map.Entry&lt;String, Object&gt; entry = matchingBeans.entrySet().iterator().next();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            autowiredBeanName = entry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instanceCandidate = entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (autowiredBeanNames != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            autowiredBeanNames.add(autowiredBeanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (instanceCandidate instanceof Class) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 根据class 获取 bean，如果bean不存在，则会创建bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            instanceCandidate = descriptor.resolveCandidate(autowiredBeanName, type, this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object result = instanceCandidate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (result instanceof NullBean) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (isRequired(descriptor)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                raiseNoMatchingBeanFound(type, descriptor.getResolvableType(), descriptor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            result = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!ClassUtils.isAssignableValue(type, result)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BeanNotOfRequiredTypeException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConstructorResolver.setCurrentInjectionPoint(previousInjectionPoint);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对于 bean 的获取，这里再总结下：</p>
<ol>
<li>根据 bean 类型从 spring 中获取 bean 的 Class 对象，注意：这里得到的对象为 Class，且获取到的 Class 对象从 spring 中获取 beanClass 可能有多个；</li>
<li>如果得到的 Class 对象有多个，则获取注入的属性名，根据属性名查找从第 1 步得到的 Class 对象中查找符合条件的 1 个 Class 对象；</li>
<li>根据 Class 对象从 spring 中获取 bean.</li>
</ol>
<p>例如，现在接口 <code>Inter</code>、实现类 <code>A</code> 与 <code>B</code>，三者关系如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">interface Inter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class A implements Inter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class B implements Inter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在类 <code>C</code> 中，注入 <code>Inter</code> 类型：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class C {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Inter b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在注入时，</p>
<ol>
<li>spring 会通过 <code>Inter.class</code> 查找，得到两个类：<code>A.class</code> 与 <code>B.class</code>，出现了多个 bean Class 对象；</li>
<li>得到注入的属性名，这里是 <code>b</code>，然后使用 <code>b</code> 在以上得到的 bean Class 对象找到符合的 bean Class 对象，显然，<code>B.class</code> 符合；</li>
<li>从 spring 容器中获取 <code>B.class</code> 对应的 bean.</li>
</ol>
<p>这里会有个小问题：如果在 <code>C</code> 中这样注入:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class C {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Inter inter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>即 <code>Inter</code> 的属性名为 <code>inter</code>，而 spring 中又没有名称为 <code>inter</code> 的 bean Class 对象，这样能注入成功吗？</p>
<p>事实上，这样注入不会成功，且 spring 会报异常，感兴趣的小伙伴可以自己试试。</p>
<p>最后，我们再来看看如何根据 class 从 spring 中获取对应的 bean，即 <code>instanceCandidate = descriptor.resolveCandidate(autowiredBeanName, type, this)</code>，跟进去：</p>
<blockquote>
<p>DependencyDescriptor#resolveCandidate</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public Object resolveCandidate(String beanName, Class&lt;?&gt; requiredType, BeanFactory beanFactory)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 调用的上 AbstractBeanFactory#getBean(String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return beanFactory.getBean(beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个方法相当简单，就只有一行：<code>beanFactory.getBean(beanName)</code>，回顾下调用链：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">|-AnnotationConfigApplicationContext#AnnotationConfigApplicationContext(String...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |-AbstractApplicationContext#refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-AbstractApplicationContext#finishBeanFactoryInitialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |-DefaultListableBeanFactory#preInstantiateSingletons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里第一次调用了AbstractBeanFactory#getBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 此时传入的参数为beanObj1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-AbstractBeanFactory#getBean(String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |-AbstractBeanFactory#doGetBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-DefaultSingletonBeanRegistry#getSingleton(String, ObjectFactory&lt;?&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |-AbstractAutowireCapableBeanFactory#createBean(String, RootBeanDefinition, Object[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |-AbstractAutowireCapableBeanFactory#doCreateBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         |-AbstractAutowireCapableBeanFactory#populateBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          |-AutowiredAnnotationBeanPostProcessor#postProcessProperties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           |-InjectionMetadata#inject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            |-AutowiredAnnotationBeanPostProcessor.AutowiredFieldElement#inject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |-DefaultListableBeanFactory#resolveDependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              |-DefaultListableBeanFactory#doResolveDependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               |-DependencyDescriptor#resolveCandidate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 这里第一次调用了AbstractBeanFactory#getBean，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 此时传入的参数为beanObj2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                |-AbstractBeanFactory#getBean(String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 .. 下面开始进行`beanObj2`的实例化与初始化操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>结合调用链及前面分析可以看出，</p>
<ul>
<li>在获取 <code>beanObj1</code> 时第一次调用 <code>AbstractBeanFactory#getBean(String)</code>，由于此时 spring 中不存在 <code>beanObj1</code>，就开始了 <code>beanObj1</code> 的创建；</li>
<li><code>beanObj1</code> 实例化完成后，接着就进行属性注入，<code>beanObj1</code> 中有个属性 <code>BeanObj2 beanObj2</code>，同样调用 <code>AbstractBeanFactory#getBean(String)</code> 从 spring 中获取 <code>beanObj2</code> 对象；</li>
<li>由于此时 spring 中不存在 <code>beanObj2</code>，接着就进入了 <code>beanObj2</code> 对象的创建过程；创建对象后，同样也会对 <code>beanObj2</code> 属性注入、运行初始化方法等操作，这与 <code>beanObj1</code> 的操作类似；</li>
<li>得到 <code>beanObj2</code> 对象后，注入到 <code>beanObj1</code> 的 <code>BeanObj2 beanObj2</code> 属性中，然后进行 <code>beanObj1</code> 的后续操作。</li>
</ul>
<p>从这里可以看出，属性注入时，可能会使 bean 初始化提前；同时，对于依赖层次多的情况，调用链将会非常长，如 A 需要注入 B，B 要注入 C，那么在 A 的属性注入时，将会初始化 B，而 B 在初始化时，又会初始化 C。</p>
<p>对于 bean 的实例化与初始化，这里需要明确下：</p>
<ul>
<li>实例化：仅指创建对象的操作，可以使用 new 或反射机制，未处理 spring 属性注入及之后的运行初始化方法、保存到 spring 容器等一系列操作；</li>
<li>初始化：对实例化后的对象进行属性注入、运行初始化方法，最终保存到 spring 容器；</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="4-初始化-bean">4. 初始化 bean<a href="#4-初始化-bean" class="hash-link" aria-label="Direct link to 4. 初始化 bean" title="Direct link to 4. 初始化 bean">​</a></h4>
<p>spring 初始化 bean 的方法是 <code>AbstractAutowireCapableBeanFactory#initializeBean(String, Object, RootBeanDefinition)</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected Object initializeBean(final String beanName, final Object bean, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             @Nullable RootBeanDefinition mbd) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1\. 运行 invokeAwareMethods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (System.getSecurityManager() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             invokeAwareMethods(beanName, bean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }, getAccessControlContext());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        invokeAwareMethods(beanName, bean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2\. 运行 applyBeanPostProcessorsBeforeInitialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object wrappedBean = bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mbd == null || !mbd.isSynthetic()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 执行 spring 当中的内置处理器——xxxPostProcessor-------@PostConstruct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 3\. 执行 InitializingBean 初始化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        invokeInitMethods(beanName, wrappedBean, mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mbd == null || !mbd.isSynthetic()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 4\. 运行 applyBeanPostProcessorsAfterInitialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return wrappedBean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上代码主要是用来运行 4 个方法：</p>
<ol>
<li>invokeAwareMethods(beanName, bean);</li>
<li>applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);</li>
<li>invokeInitMethods(beanName, wrappedBean, mbd);</li>
<li>applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_HWLp" id="41-调用-aware-bean-的方法">4.1 调用 Aware bean 的方法<a href="#41-调用-aware-bean-的方法" class="hash-link" aria-label="Direct link to 4.1 调用 Aware bean 的方法" title="Direct link to 4.1 调用 Aware bean 的方法">​</a></h5>
<p><code>invokeAwareMethods</code> 就是执行 Aware bean 的相关方法：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">private void invokeAwareMethods(final String beanName, final Object bean) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bean instanceof Aware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (bean instanceof BeanNameAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ((BeanNameAware) bean).setBeanName(beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (bean instanceof BeanClassLoaderAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ClassLoader bcl = getBeanClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (bcl != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ((BeanClassLoaderAware) bean).setBeanClassLoader(bcl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (bean instanceof BeanFactoryAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ((BeanFactoryAware) bean).setBeanFactory(AbstractAutowireCapableBeanFactory.this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上方法比较简单，就不多说了。</p>
<h5 class="anchor anchorWithStickyNavbar_HWLp" id="42-运行后置处理器的-postprocessbeforeinitialization-方法">4.2 运行后置处理器的 <code>postProcessBeforeInitialization</code> 方法<a href="#42-运行后置处理器的-postprocessbeforeinitialization-方法" class="hash-link" aria-label="Direct link to 42-运行后置处理器的-postprocessbeforeinitialization-方法" title="Direct link to 42-运行后置处理器的-postprocessbeforeinitialization-方法">​</a></h5>
<p>接着来看看 <code>AbstractAutowireCapableBeanFactory#applyBeanPostProcessorsBeforeInitialization</code> 的运行：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public Object applyBeanPostProcessorsBeforeInitialization(Object existingBean, String beanName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object result = existingBean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (BeanPostProcessor processor : getBeanPostProcessors()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 调用后置处理器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object current = processor.postProcessBeforeInitialization(result, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (current == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = current;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里主要运行 <code>ApplicationContextAwareProcessor#postProcessBeforeInitialization</code> 方法，内容如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Nullable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!(bean instanceof EnvironmentAware || bean instanceof EmbeddedValueResolverAware ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              bean instanceof ResourceLoaderAware || bean instanceof ApplicationEventPublisherAware ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              bean instanceof MessageSourceAware || bean instanceof ApplicationContextAware)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AccessControlContext acc = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (System.getSecurityManager() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        acc = this.applicationContext.getBeanFactory().getAccessControlContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (acc != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           invokeAwareInterfaces(bean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }, acc);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 运行方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        invokeAwareInterfaces(bean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void invokeAwareInterfaces(Object bean) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bean instanceof EnvironmentAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((EnvironmentAware) bean).setEnvironment(this.applicationContext.getEnvironment());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bean instanceof EmbeddedValueResolverAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((EmbeddedValueResolverAware) bean).setEmbeddedValueResolver(this.embeddedValueResolver);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bean instanceof ResourceLoaderAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((ResourceLoaderAware) bean).setResourceLoader(this.applicationContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bean instanceof ApplicationEventPublisherAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((ApplicationEventPublisherAware) bean).setApplicationEventPublisher(this.applicationContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bean instanceof MessageSourceAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((MessageSourceAware) bean).setMessageSource(this.applicationContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 装配 实现了ApplicationContextAware的类的 applicationContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bean instanceof ApplicationContextAware) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((ApplicationContextAware) bean).setApplicationContext(this.applicationContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其实这个方法就是给各种 <code>XxxAware</code> 赋值，比如大名鼎鼎的 <code>ApplicationContextAware</code> 赋值也是在这里进行。</p>
<p>顺带一提的是，如果在 bean 中，方法上有 <code>@PostConstruct</code> 注解：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@PostConstruct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void test() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(&quot;PostConstruct&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>该方法将会在 <code>InitDestroyAnnotationBeanPostProcessor#postProcessBeforeInitialization</code> 中进行调用，代码比较简单，也是利用了 jdk 的反射机制，这里就不多说了。</p>
<h5 class="anchor anchorWithStickyNavbar_HWLp" id="43-调用-bean-的初始化方法">4.3 调用 bean 的初始化方法<a href="#43-调用-bean-的初始化方法" class="hash-link" aria-label="Direct link to 4.3 调用 bean 的初始化方法" title="Direct link to 4.3 调用 bean 的初始化方法">​</a></h5>
<p>接着来看看 <code>AbstractAutowireCapableBeanFactory#invokeInitMethods</code> 方法:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected void invokeInitMethods(String beanName, final Object bean, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Nullable RootBeanDefinition mbd)  throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 执行 InitializingBean#afterPropertiesSet 方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean isInitializingBean = (bean instanceof InitializingBean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (isInitializingBean &amp;&amp; (mbd == null || </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 !mbd.isExternallyManagedInitMethod(&quot;afterPropertiesSet&quot;))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (System.getSecurityManager() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                AccessController.doPrivileged((PrivilegedExceptionAction&lt;Object&gt;) () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ((InitializingBean) bean).afterPropertiesSet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }, getAccessControlContext());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            catch (PrivilegedActionException pae) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw pae.getException();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 如果bean实现了 InitializingBean 接口，则调用 afterPropertiesSet()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ((InitializingBean) bean).afterPropertiesSet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 执行自定义的初始化方法，即在xml中，通过 init-method 指定的方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mbd != null &amp;&amp; bean.getClass() != NullBean.class) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String initMethodName = mbd.getInitMethodName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StringUtils.hasLength(initMethodName) &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                !(isInitializingBean &amp;&amp; &quot;afterPropertiesSet&quot;.equals(initMethodName)) &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                !mbd.isExternallyManagedInitMethod(initMethodName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            invokeCustomInitMethod(beanName, bean, mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里主要是运行两个方法：</p>
<ol>
<li>如果 bean 实现了 InitializingBean 接口，则调用 afterPropertiesSet ()</li>
<li>如果指定了 init-method，则在 <code>invokeCustomInitMethod</code> 中运行，也是通过 jdk 反射机制来运行的，就不多说了。</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_HWLp" id="44-运行后置处理器的-postprocessafterinitialization-方法">4.4 运行后置处理器的 <code>postProcessAfterInitialization</code> 方法<a href="#44-运行后置处理器的-postprocessafterinitialization-方法" class="hash-link" aria-label="Direct link to 44-运行后置处理器的-postprocessafterinitialization-方法" title="Direct link to 44-运行后置处理器的-postprocessafterinitialization-方法">​</a></h5>
<p>这一步主要是运行 <code>BeanPostProcessor#postProcessAfterInitialization</code>，所运行的 <code>BeanPostProcessor</code> 是 <code>ApplicationListenerDetector</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Object postProcessAfterInitialization(Object bean, String beanName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (bean instanceof ApplicationListener) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Boolean flag = this.singletonNames.get(beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Boolean.TRUE.equals(flag)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.applicationContext.addApplicationListener((ApplicationListener&lt;?&gt;) bean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (Boolean.FALSE.equals(flag)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.singletonNames.remove(beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个方法是用来处理 <code>ApplicationListener</code> 的，如果有 bean 实现了 <code>ApplicationListener</code>，就是在这里添加到 spring 的监听器列表的。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="5-总结">5. 总结<a href="#5-总结" class="hash-link" aria-label="Direct link to 5. 总结" title="Direct link to 5. 总结">​</a></h4>
<p>本文主要介绍了 spring bean 创建过程，相关流程总结如下：</p>
<ol>
<li>
<p>实例化 bean，指定了初始化方法、指定了 <code>factory method</code>、自主推断构造方法等方式；</p>
</li>
<li>
<p>查询待注入的属性或方法，即哪些属性或方法上标注了 <code>@Autowird</code>/<code>@Value</code>/<code>@Resource</code></p>
<ul>
<li><code>AutowiredAnnotationBeanPostProcessor.postProcessMergedBeanDefinition</code> 用来查找带有 @Autowired、@Value 注解的属性和方法</li>
<li><code>CommonAnnotationBeanPostProcessor.postProcessMergedBeanDefinition</code> 用来查找带有 @Resource 注解的属性和方法</li>
</ul>
</li>
<li>
<p>属性填充</p>
<ul>
<li><code>AutowiredAnnotationBeanPostProcessor.postProcessProperties</code> 处理 <code>@Autowired</code>、<code>@Value</code> 注解，<code>CommonAnnotationBeanPostProcessor.postProcessProperties</code> 处理 <code>@Resource</code> 注解</li>
<li>处理 <code>@Autowired</code> 时，先根据类型找到所有的 <code>Class</code>，如果有多个，再根据注入属性的名称查找符合的 <code>Class</code>，最后调用 <code>beanFactory.getBean(...)</code> 从 spring 获取要注入的对象，通过反射机制为对应的属性设置值；</li>
</ul>
</li>
<li>
<p>初始化 bean</p>
<ol>
<li>执行 Aware bean 的相关方法</li>
<li>调用 <code>BeanPostProcessor#postProcessBeforeInitialization</code> 方法<!-- -->
<ul>
<li>在 <code>ApplicationContextAwareProcessor#postProcessBeforeInitialization</code> 中执行 Aware bean 的相关方法</li>
<li>在 <code>InitDestroyAnnotationBeanPostProcessor#postProcessBeforeInitialization</code> 中处理 <code>@PostConstruct</code> 注解</li>
</ul>
</li>
<li>执行初始化方法<!-- -->
<ul>
<li>执行 <code>InitializingBean#afterPropertiesSet</code> 方法</li>
<li>执行自定义的 <code>init-method</code> 方法</li>
</ul>
</li>
<li>运行 <code>BeanPostProcessor#postProcessAfterInitialization</code> 方法<!-- -->
<ul>
<li>在 <code>ApplicationListenerDetector#postProcessAfterInitialization</code> 中处理 spring 监听器</li>
</ul>
</li>
</ol>
</li>
</ol>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-b7a4d4bc1bfbd76537e40cf843b0d18df93.png" alt="" class="img_kGBN"></p>
<p>关于 spring bean 的创建流程就先分析到这里了，不过 spring 在创建 bean 的过程中，有一个无法忽视的情况：循环依赖，关于这方面的处理，可以参考：</p>
<ul>
<li><a href="https://my.oschina.net/funcy/blog/4659555" target="_blank" rel="noopener noreferrer">spring 探秘之循环依赖的解决（一）：理论基石</a></li>
<li><a href="https://my.oschina.net/funcy/blog/4815992" target="_blank" rel="noopener noreferrer">spring 探秘之循环依赖的解决（ 二）：源码分析</a></li>
</ul>
<hr>
<p><em>本文原文链接：<a href="https://my.oschina.net/funcy/blog/4659524" target="_blank" rel="noopener noreferrer">https://my.oschina.net/funcy/blog/4659524</a> ，限于作者个人水平，文中难免有错误之处，欢迎指正！原创不易，商业转载请联系作者获得授权，非商业转载请注明出处。</em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（九）：单例bean的创建.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_EYjg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_eevz"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（二）：ApplicationContext的创建"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Spring启动流程（二）：ApplicationContext的创建</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（六）：注册BeanPostProcessor"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Spring启动流程（六）：注册BeanPostProcessor</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lc2k thin-scrollbar theme-doc-toc-desktop"></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>