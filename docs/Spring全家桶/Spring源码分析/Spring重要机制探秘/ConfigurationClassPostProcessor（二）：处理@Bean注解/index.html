<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">ConfigurationClassPostProcessor（二）：处理@Bean注解 | Tommy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ConfigurationClassPostProcessor（二）：处理@Bean注解 | Tommy"><meta data-rh="true" name="description" content="������ ConfigurationClassPostProcessor �����ĵڶ�ƪ����Ҫ�Ƿ��� spring �� @Bean ע��Ĵ������̡�"><meta data-rh="true" property="og:description" content="������ ConfigurationClassPostProcessor �����ĵڶ�ƪ����Ҫ�Ƿ��� spring �� @Bean ע��Ĵ������̡�"><link data-rh="true" rel="icon" href="/code-note-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解" hreflang="en"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/code-note-blog/blog/rss.xml" title="Tommy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/code-note-blog/blog/atom.xml" title="Tommy Atom Feed"><link rel="stylesheet" href="/code-note-blog/assets/css/styles.dd5372db.css">
<script src="/code-note-blog/assets/js/runtime~main.f999fb27.js" defer="defer"></script>
<script src="/code-note-blog/assets/js/main.a0bfbaed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XYiV" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/code-note-blog/"><b class="navbar__title text--truncate">Tommy</b></a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Java/basic/抽象类和接口">java</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/JavaWeb/走进JavaWeb技术世界：JavaWeb的由来和基础知识">javaweb</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">cache</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/backend/后端技术杂谈：白话虚拟化技术">backend</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cs/algorithms/剑指offer">cs</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">database</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/distributed/basic/分布式系统理论基础 ：CAP">distributed</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/interview/BATJ-Experience/面阿里,终获offer">interview</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mq/kafka/消息队列kafka详解：如何实现死信队列">mq</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">spring</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mianshi/collection">面试</a><a href="https://aiden-coding.github.io/code-note-blog/SpringCloud%E7%AC%AC3%E5%AD%A32024.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_XbAW colorModeToggle_r5NY"><button class="clean-btn toggleButton_Jx0n toggleButtonDisabled_zYO7" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FjAw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qmEt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_wJfS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LABv"><div class="docsWrapper_pdvB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Jioa" type="button"></button><div class="docRoot_qx_v"><aside class="theme-doc-sidebar-container docSidebarContainer_NHKT"><div class="sidebarViewport_uyYB"><div class="sidebar_SZG4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VP_k"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">Spring</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：初探SpringIOC核心流程">Spring源码分析</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：初探SpringIOC核心流程">Spring源码剖析：初探SpringIOC核心流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：懒加载的单例Bean获取过程分析">Spring源码剖析：懒加载的单例Bean获取过程分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：AOP实现原理详解">Spring源码剖析：AOP实现原理详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：JDK和cglib动态代理原理详解">Spring源码剖析：JDK和cglib动态代理原理详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：Spring事务概述">Spring源码剖析：Spring事务概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：Spring事务源码剖析">Spring源码剖析：Spring事务源码剖析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：SpringAOP概述">Spring源码剖析：SpringAOP概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：SpringIOC容器的加载过程">Spring源码剖析：SpringIOC容器的加载过程</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（八）：完成BeanFactory的初始化">Spring启动流程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring事务/Spring事务（二）：事务的执行流程">Spring事务</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解">Spring重要机制探秘</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解">ConfigurationClassPostProcessor（二）：处理@Bean注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（三）：处理@Import注解">ConfigurationClassPostProcessor（三）：处理@Import注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（四）：处理@Conditional注解">ConfigurationClassPostProcessor（四）：处理@Conditional注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（一）：处理@ComponentScan注解">ConfigurationClassPostProcessor（一）：处理@ComponentScan注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之监听器注解EventListener">Spring探秘之监听器注解EventListener</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之循环依赖的解决（二）：源码分析">Spring探秘之循环依赖的解决（二）：源码分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之循环依赖的解决（一）：理论基石">Spring探秘之循环依赖的解决（一）：理论基石</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之组合注解的处理">Spring探秘之组合注解的处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之AOP的执行顺序">Spring探秘之AOP的执行顺序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之Spring事件机制">Spring探秘之Spring事件机制</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring组件分析/Spring组件之ApplicationContext">Spring组件分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/SpringAOP/AnnotationAwareAspectJAutoProxyCreator分析（上）">SpringAOP</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot/给你一份SpringBoot知识清单">SpringBoot</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot源码解析/SpringBoot启动流程（四）：启动IOC容器">SpringBoot源码解析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud/SpringCloudConsul">SpringCloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud源码分析/SpringCloudConfig源码分析">SpringCloud源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibaba概览">SpringCloudAlibaba</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba源码分析/SpringCloudAlibabaNacos源码分析：服务发现">SpringCloudAlibaba源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC/SpringMVC常见注解">SpringMVC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（二）之执行Handler方法">SpringMVC源码分析</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_SejT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_j3Yw"><div class="docItemContainer_XOSC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_F6gm" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/code-note-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YCxa"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Spring源码分析</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Spring重要机制探秘</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ConfigurationClassPostProcessor（二）：处理@Bean注解</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ToOY theme-doc-toc-mobile tocMobile_suYB"><button type="button" class="clean-btn tocCollapsibleButton_VzP_">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ConfigurationClassPostProcessor（二）：处理@Bean注解</h1></header><p>������ <code>ConfigurationClassPostProcessor</code> �����ĵڶ�ƪ����Ҫ�Ƿ��� spring �� <code>@Bean</code> ע��Ĵ������̡�</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="3-spring-δ-bean-עģ">3. spring ����δ��� <code>@Bean</code> ע��ģ�<a href="#3-spring-δ-bean-עģ" class="hash-link" aria-label="Direct link to 3-spring-δ-bean-עģ" title="Direct link to 3-spring-δ-bean-עģ">​</a></h2>
<p>�н����ģ����Ǽ������� spring �� <code>@Bean</code> ע��Ĵ������̡�</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="31-demo-">3.1 demo ׼��<a href="#31-demo-" class="hash-link" aria-label="Direct link to 3.1 demo ׼��" title="Direct link to 3.1 demo ׼��">​</a></h3>
<p>Ϊ��˵�����⣬����ֱ���ϴ��룺</p>
<p>����׼������ Bean:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanObj1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj1() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;����beanObj1�Ĺ��췽��&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String toString() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;BeanObj1{}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanObj2 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj2() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;����beanObj2�Ĺ��췽��&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String toString() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;BeanObj2{}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ע�⣺���������඼û�� <code>Component</code>��<code>@Service</code> ��ע�⡣</p>
<p>��׼��һ�������࣬ͨ�� <code>@Bean</code> ע��ķ����������� bean��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanConfigs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj1 beanObj1() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new BeanObj1();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj2 beanObj2() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ��������� beanObj1() ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanObj1();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new BeanObj2();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>����������ࣺ</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@ComponentScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Demo02Main {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ApplicationContext context </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                = new AnnotationConfigApplicationContext(Demo02Main.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object obj1 = context.getBean(&quot;beanObj1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object obj2 = context.getBean(&quot;beanObj2&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;obj1:&quot; + obj1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;obj2:&quot; + obj2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(context.getBean(&quot;beanConfigs&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>������ ���룬�����¼�����Ҫ˵����</p>
<ul>
<li><code>BeanConfigs</code> ��ʹ�õ�ע����� <code>@Component</code>������<a href="https://my.oschina.net/funcy/blog/4836178" target="_blank" rel="noopener noreferrer">��һƪ����</a>�ķ�����<code>@Component</code> Ҳ���������࣬��������ͬ <code>@Configuration</code> ע�⣻</li>
<li>�� <code>Demo02Main</code> �У����� <code>AnnotationConfigApplicationContext</code> ��Ϊ <code>Demo02Main</code>��������һ��ע�� <code>@ComponentScan</code>�����ע��ûָ����ɨ��·��������<a href="https://my.oschina.net/funcy/blog/4836178" target="_blank" rel="noopener noreferrer">��һƪ����</a>�ķ�������ָ����ɨ��·����spring ��Ĭ��ɨ�����������ڰ���</li>
<li>���ǲ�û��ֱ�Ӱ� <code>BeanConfigs</code> ע�ᵽ�����У��� <code>new AnnotationConfigApplicationContext(BeanConfigs.class)</code> ����������<a href="https://my.oschina.net/funcy/blog/4836178" target="_blank" rel="noopener noreferrer">��һƪ����</a>�ķ�����֪��spring ���Ƚ��� <code>Demo02Main</code> �࣬�������ϵ� <code>@Component</code> ע�⣬�Ӷ�ɨ�赽 <code>BeanConfigs</code> �࣬Ȼ������ <code>BeanConfigs</code>�������ڲ��� <code>@Bean</code> ���������� ������ǽ�����Ҳ��ͨ�����Եķ�ʽ������֤��</li>
</ul>
<p>�������ϴ��룬������£�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">����beanObj1�Ĺ��췽��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����beanObj1�Ĺ��췽��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����beanObj2�Ĺ��췽��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj1:BeanObj1{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj2:BeanObj2{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.springframework.learn.explore.demo05.BeanConfigs@2b71e916</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��������������� demo ���з�����</p>
<p><strong>ע��</strong>�������� <code>ConfigurationClassPostProcessor</code> �����ĵڶ�ƪ������<a href="https://my.oschina.net/funcy/blog/4836178" target="_blank" rel="noopener noreferrer">��һƪ</a>��ͬ�Ĵ��룬����ֻһ�ʴ����������ٽ�����ϸ������</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="32-ࣺconfigurationclasspostprocessorprocessconfigbeandefinitions">3.2 ���������ࣺConfigurationClassPostProcessor#processConfigBeanDefinitions<a href="#32-ࣺconfigurationclasspostprocessorprocessconfigbeandefinitions" class="hash-link" aria-label="Direct link to 3.2 ���������ࣺConfigurationClassPostProcessor#processConfigBeanDefinitions" title="Direct link to 3.2 ���������ࣺConfigurationClassPostProcessor#processConfigBeanDefinitions">​</a></h3>
<p>����ֱ�ӽ��� <code>ConfigurationClassPostProcessor#processConfigBeanDefinitions</code> ���������������£�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">AnnotationConfigApplicationContext#AnnotationConfigApplicationContext(Class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |-AbstractApplicationContext#refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-AbstractApplicationContext#invokeBeanFactoryPostProcessors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |-PostProcessorRegistrationDelegate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      #invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory, List)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-PostProcessorRegistrationDelegate#invokeBeanDefinitionRegistryPostProcessors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |-ConfigurationClassPostProcessor#postProcessBeanDefinitionRegistry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-ConfigurationClassPostProcessor#processConfigBeanDefinitions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��ʱ�� <code>candidates</code> ֻ��һ�� Ԫ�أ�</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-0d50f32d5ea1d2b79b8e17612d30693f753.png" alt="" class="img_kGBN"></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="32--demo02mainconfigurationclassparserdoprocessconfigurationclass">3.2 ���� <code>demo02Main</code>��ConfigurationClassParser#doProcessConfigurationClass<a href="#32--demo02mainconfigurationclassparserdoprocessconfigurationclass" class="hash-link" aria-label="Direct link to 32--demo02mainconfigurationclassparserdoprocessconfigurationclass" title="Direct link to 32--demo02mainconfigurationclassparserdoprocessconfigurationclass">​</a></h3>
<p>��һ����ǽ��� <code>@ComponentScan</code> ע��Ĺ��̣�<a href="https://my.oschina.net/funcy/blog/4836178" target="_blank" rel="noopener noreferrer">��һƪ</a>����ϸ������������ֻ��������ջ��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">AnnotationConfigApplicationContext#AnnotationConfigApplicationContext(Class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |-AbstractApplicationContext#refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-AbstractApplicationContext#invokeBeanFactoryPostProcessors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |-PostProcessorRegistrationDelegate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      #invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory, List)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-PostProcessorRegistrationDelegate#invokeBeanDefinitionRegistryPostProcessors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |-ConfigurationClassPostProcessor#postProcessBeanDefinitionRegistry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-ConfigurationClassPostProcessor#processConfigBeanDefinitions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |-ConfigurationClassParser#parse(Set&lt;BeanDefinitionHolder&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |-ConfigurationClassParser#parse(AnnotationMetadata, String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          |-ConfigurationClassParser#processConfigurationClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           |-ConfigurationClassParser#doProcessConfigurationClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���� <code>Demo02Main</code> �� <code>@ComponentScan</code> ֮�󣬿��Կ��� <code>beanConfigs</code> �Ѿ�ɨ�赽�ˣ�</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-7fef6007424562f63dda7f2a0b25e9c293b.png" alt="" class="img_kGBN"></p>
<p>���� <code>beanConfigs</code> �������࣬��˻������н�����</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-fba3821df9cf2926b16bd064cf164e83471.png" alt="" class="img_kGBN"></p>
<p>���ջ��ǻ�ص� <code>ConfigurationClassParser#doProcessConfigurationClass</code>�����еĵ��������£�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">AnnotationConfigApplicationContext#AnnotationConfigApplicationContext(Class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> |-AbstractApplicationContext#refresh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-AbstractApplicationContext#invokeBeanFactoryPostProcessors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |-PostProcessorRegistrationDelegate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      #invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory, List)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-PostProcessorRegistrationDelegate#invokeBeanDefinitionRegistryPostProcessors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |-ConfigurationClassPostProcessor#postProcessBeanDefinitionRegistry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-ConfigurationClassPostProcessor#processConfigBeanDefinitions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       |-ConfigurationClassParser#parse(Set&lt;BeanDefinitionHolder&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |-ConfigurationClassParser#parse(AnnotationMetadata, String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          |-ConfigurationClassParser#processConfigurationClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           |-ConfigurationClassParser#doProcessConfigurationClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            |-ConfigurationClassParser#parse(String, String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             |-ConfigurationClassParser#processConfigurationClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              |-ConfigurationClassParser#doProcessConfigurationClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��ʱ�� <code>ConfigurationClassParser#doProcessConfigurationClass</code>�����ǾͲ����� <code>demo02Main</code>������ <code>beanConfigs</code> �ˡ�</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="33--beanconfigsconfigurationclassparserdoprocessconfigurationclass">3.3 ���� <code>beanConfigs</code>��ConfigurationClassParser#doProcessConfigurationClass<a href="#33--beanconfigsconfigurationclassparserdoprocessconfigurationclass" class="hash-link" aria-label="Direct link to 33--beanconfigsconfigurationclassparserdoprocessconfigurationclass" title="Direct link to 33--beanconfigsconfigurationclassparserdoprocessconfigurationclass">​</a></h3>
<p>���������������� <code>ConfigurationClassParser#doProcessConfigurationClass</code> �� <code>@Bean</code> ע��Ĵ���  ���������£�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * ������������������������ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected final SourceClass doProcessConfigurationClass(ConfigurationClass configClass, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SourceClass sourceClass) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1\. ����� @Component ע�⣬�ݹ鴦���ڲ��࣬���Ĳ���ע</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2\. ����@PropertySourceע�⣬���Ĳ���ע</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3\. ���� @ComponentScan/@ComponentScans ע�⣬���Ĳ���ע</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 4\. ����@Importע�⣬���Ĳ���ע</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 5\. ����@ImportResourceע�⣬���Ĳ���ע</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 6\. ����@Bean��ע��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ����Ľ�������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (MethodMetadata methodMetadata : beanMethods) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���ӵ� configClass �У������ٴ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configClass.addBeanMethod(new BeanMethod(methodMetadata, configClass));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 7\. ����������ĸ��࣬���� processConfigurationClass(...) ��������һ��ѭ��ʱ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��ȡ <code>@Bean</code> �ķ������õ��� <code>retrieveBeanMethodMetadata(...)</code>�����Ǹ���ȥ��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">private Set&lt;MethodMetadata&gt; retrieveBeanMethodMetadata(SourceClass sourceClass) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AnnotationMetadata original = sourceClass.getMetadata();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ��ȡ���� @Bean ע��ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;MethodMetadata&gt; beanMethods = original.getAnnotatedMethods(Bean.class.getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return beanMethods;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�ٸ���ȥ�����յ��õ��� <code>StandardAnnotationMetadata#getAnnotatedMethods</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public Set&lt;MethodMetadata&gt; getAnnotatedMethods(String annotationName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Set&lt;MethodMetadata&gt; annotatedMethods = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (AnnotationUtils.isCandidateClass(getIntrospectedClass(), annotationName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 1\. ͨ��������Ļ�ȡ���еķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Method[] methods = ReflectionUtils.getDeclaredMethods(getIntrospectedClass());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Method method : methods) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 2\. �ж��Ƿ��� @Bean ע��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (isAnnotatedMethod(method, annotationName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (annotatedMethods == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        annotatedMethods = new LinkedHashSet&lt;&gt;(4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    annotatedMethods.add(new StandardMethodMetadata(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        method, this.nestedAnnotationsAsMap));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalStateException(������);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return annotatedMethods != null ? annotatedMethods : Collections.emptySet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��������ܺ����⣬�ؼ���������</p>
<ol>
<li>ͨ�������ȡ�������з�����</li>
<li>�����õ��ķ�������һ�жϸ÷����Ƿ��� <code>@Bean</code> ע�⣻</li>
</ol>
<p>�������<code>beanConfigs</code> �е������������ڻ�ȡ���ˣ������� <code>ConfigurationClass</code> ����� <code>beanMethods</code> ���ԣ���</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-121f4d518fa57c8932e6b7fd3e7def8704b.png" alt="" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-a4d91c1f52703b8c911bdb9d9afaf697d92.png" alt="" class="img_kGBN"></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="34--bean-ǵķص-beandefinitionmap">3.4 ���� <code>@Bean</code> ��ǵķ������ص� <code>BeanDefinitionMap</code><a href="#34--bean-ǵķص-beandefinitionmap" class="hash-link" aria-label="Direct link to 34--bean-ǵķص-beandefinitionmap" title="Direct link to 34--bean-ǵķص-beandefinitionmap">​</a></h3>
<p>�����ȡ���� <code>beanMethod</code> ��ʱ��ֻ���� <code>ConfigurationClass</code> ����� <code>beanMethods</code> �����У���û�м��ص� <code>beanFactory</code> �� <code>BeanDefinitionMap</code> �У���С����̽���������Ǻ�ʱ���뵽 <code>BeanDefinitionMap</code> �С�</p>
<p>���ǵ� <code>ConfigurationClassPostProcessor#processConfigBeanDefinition</code> ����������ôһ�д��룺</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public void processConfigBeanDefinitions(BeanDefinitionRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // �������ν�������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // �� @Import ������ࡢ�������д�@Bean�ķ�����@ImportResource �������Դ��ת����BeanDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.reader.loadBeanDefinitions(configClasses);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>����Ǽ�������� <code>BeanDefinition</code> �ĵط������� <code>@Import</code> ������ࡢ�������д� <code>@Bean</code> �ķ�����<code>@ImportResource</code> �������Դ��ת���� <code>BeanDefinition</code>�������ص��ע <code>@Bean</code> �����Ĵ������������£�</p>
<blockquote>
<p>ConfigurationClassBeanDefinitionReader</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    public void loadBeanDefinitions(Set&lt;ConfigurationClass&gt; configurationModel) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TrackedConditionEvaluator trackedConditionEvaluator = new TrackedConditionEvaluator();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ������������� configurationModel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (ConfigurationClass configClass : configurationModel) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            loadBeanDefinitionsForConfigurationClass(configClass, trackedConditionEvaluator);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * �����������ظ��� ConfigurationClass ����� BeanDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 1\. @Import �������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 2\. �������е� @Bean ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 3\. @ImportResource �������Դ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 4\. @Import ����� ImportBeanDefinitionRegistrar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void loadBeanDefinitionsForConfigurationClass(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ConfigurationClass configClass, TrackedConditionEvaluator trackedConditionEvaluator) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (trackedConditionEvaluator.shouldSkip(configClass)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���� @Import �����������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (configClass.isImported()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            registerBeanDefinitionForImportedConfigurationClass(configClass);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���� @Bean ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (BeanMethod beanMethod : configClass.getBeanMethods()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            loadBeanDefinitionsForBeanMethod(beanMethod);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���� @ImportResource �������Դ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loadBeanDefinitionsFromImportedResources(configClass.getImportedResources());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���� @Import ����� ImportBeanDefinitionRegistrar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loadBeanDefinitionsFromRegistrars(configClass.getImportBeanDefinitionRegistrars());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ���� @Bean ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 1\. ����BeanDefinition��beanMethod ʹ�õ��� ConfigurationClassBeanDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 2\. ���� @Bean �ĸ������ԣ����õ� BeanDefinition ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 3\. �� BeanDefinition ע�ᵽ beanFactory ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void loadBeanDefinitionsForBeanMethod(BeanMethod beanMethod) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurationClass configClass = beanMethod.getConfigurationClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MethodMetadata metadata = beanMethod.getMetadata();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String methodName = metadata.getMethodName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 1\. beanMethodʹ�õ���ConfigurationClassBeanDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurationClassBeanDefinition beanDef = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new ConfigurationClassBeanDefinition(configClass, metadata);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanDef.setResource(configClass.getResource());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanDef.setSource(this.sourceExtractor.extractSource(metadata, configClass.getResource()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 2\. ���� @Bean �ĸ�������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (metadata.isStatic()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ��̬ @Bean ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (configClass.getMetadata() instanceof StandardAnnotationMetadata) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                beanDef.setBeanClass(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ((StandardAnnotationMetadata) configClass.getMetadata()).getIntrospectedClass());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                beanDef.setBeanClassName(configClass.getMetadata().getClassName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDef.setUniqueFactoryMethodName(methodName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ��ͨ�� @Bean ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDef.setFactoryBeanName(configClass.getBeanName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDef.setUniqueFactoryMethodName(methodName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (metadata instanceof StandardMethodMetadata) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDef.setResolvedFactoryMethod(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ((StandardMethodMetadata) metadata).getIntrospectedMethod());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanDef.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_CONSTRUCTOR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanDef.setAttribute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SKIP_REQUIRED_CHECK_ATTRIBUTE, Boolean.TRUE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AnnotationConfigUtils.processCommonDefinitionAnnotations(beanDef, metadata);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Autowire autowire = bean.getEnum(&quot;autowire&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (autowire.isAutowire()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDef.setAutowireMode(autowire.value());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean autowireCandidate = bean.getBoolean(&quot;autowireCandidate&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!autowireCandidate) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDef.setAutowireCandidate(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String initMethodName = bean.getString(&quot;initMethod&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StringUtils.hasText(initMethodName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDef.setInitMethodName(initMethodName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String destroyMethodName = bean.getString(&quot;destroyMethod&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanDef.setDestroyMethodName(destroyMethodName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 3\. ��BeanDefinitionע�ᵽbeanFactory��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.registry.registerBeanDefinition(beanName, beanDefToRegister);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>ConfigurationClassBeanDefinitionReader#loadBeanDefinitions</code> �ֵ������������������մ������� <code>ConfigurationClassBeanDefinitionReader#loadBeanDefinitionsForBeanMethod</code>���ⲿ���߼����£�</p>
<ol>
<li>��������� <code>configClass</code> ���ϣ���ÿ�� <code>configClass</code> ���� <code>Definitions</code> ���ش�����</li>
<li>�� <code>configClass</code> ���� <code>Definitions</code> ���ش���ʱ������һ���� <code>@Import</code>/<code>@Bean</code>/<code>@ImportResource</code> ��ע�⣬��С�����ǽ���ע <code>@Bean</code> �Ĵ�����</li>
<li>���� <code>@Bean</code> ����ʱ���ȴ��� <code>BeanDefinition</code>(<code>@Bean</code> ������Ӧ�� <code>BeanDefinition</code> �� <code>ConfigurationClassBeanDefinition</code>)��Ȼ����� <code>@Bean</code> �����ԣ����õ� <code>BeanDefinition</code> �У������ǰ� <code>BeanDefinition</code> ע�ᵽ <code>beanFactory</code> ��.</li>
</ol>
<p>�� �ˣ�ִ���� <code>ConfigurationClassBeanDefinitionReader#loadBeanDefinitions</code> ��<code>BeanDefinition</code> �ͼ��ص� <code>beanFactory</code> �ˣ���Ӧ�� <code>BeanDefinition</code> ������ <code>ConfigurationClassBeanDefinition</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="35-bean-ʵ">3.5 <code>@Bean</code> ����ʵ��<a href="#35-bean-ʵ" class="hash-link" aria-label="Direct link to 35-bean-ʵ" title="Direct link to 35-bean-ʵ">​</a></h3>
<p>ʵ���Ĵ�������ͬ��ͨ�� <code>@Component</code> ��һ�£���ͬ������ͨ�� <code>@Component</code> ����õ��ǹ��췽������ <code>@Bean</code> ʹ�õ��� <code>factoryMethod</code>���������£�</p>
<blockquote>
<p>AbstractAutowireCapableBeanFactory#createBeanInstance</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * ʵ���Ĵ�����ʽ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 1\. ʹ�� instanceSupplier��Supplier��java8�ṩ���࣬���Դ���һ��lambda����ʽ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2\. ʹ�ù����������� @Bean ע���Ӧ�ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 3\. ʹ�õ��ǹ��췽��ע�룬�����췽������ @Autowired ע��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 4\. ���췽��ע�룬�������޲ι��죬Ҳ�������вι���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected BeanWrapper createBeanInstance(String beanName, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RootBeanDefinition mbd, @Nullable Object[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ȷ���Ѿ������˴� class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // �Ƿ�������bean������Supplier��Supplier��java8�ṩ���࣬���Դ���һ��lambda����ʽ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ���� AbstractBeanDefinition#setInstanceSupplier ָ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Supplier&lt;?&gt; instanceSupplier = mbd.getInstanceSupplier();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (instanceSupplier != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return obtainFromSupplier(instanceSupplier, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mbd.getFactoryMethodName() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���ù�������ʵ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return instantiateUsingFactoryMethod(beanName, mbd, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // �Ƿ��һ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean resolved = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // �Ƿ���ù��캯��ע��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean autowireNecessary = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (resolved) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (autowireNecessary) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return autowireConstructor(beanName, mbd, null, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // �޲ι��캯��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return instantiateBean(beanName, mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Candidate constructors for autowiring?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // �ж��Ƿ�����вι��캯��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanClass, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return autowireConstructor(beanName, mbd, ctors, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctors = mbd.getPreferredConstructors();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ctors != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���캯������ע��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return autowireConstructor(beanName, mbd, ctors, null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // �����޲ι��캯��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return instantiateBean(beanName, mbd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�Ӵ�����������spring ʵ������ķ�ʽ�� 4 �֣�</p>
<ol>
<li>ʹ�� <code>instanceSupplier</code>��<code>Supplier</code> �� <code>java8</code> �ṩ���࣬���Դ� ��һ�� <code>lambda</code> ����ʽ</li>
<li>ʹ�ù����������� <code>@Bean</code> ע���Ӧ�ķ���</li>
<li>ʹ�õ��ǹ��췽��ע�룬�����췽������ <code>@Autowired</code> ע��</li>
<li>���췽��ע�룬�������޲ι��죬Ҳ�������вι���</li>
</ol>
<p>����������Ҫ��ע <code>@Bean</code> ��ʵ����ʽ��Ҳ���ǹ�������ʵ������ʽ�����ǽ�ȥ���£�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public BeanWrapper instantiateUsingFactoryMethod(String beanName, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             RootBeanDefinition mbd, @Nullable Object[] explicitArgs) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BeanWrapperImpl bw = new BeanWrapperImpl();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.beanFactory.initBeanWrapper(bw);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object factoryBean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt; factoryClass;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean isStatic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String factoryBeanName = mbd.getFactoryBeanName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (factoryBeanName != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factoryBean = this.beanFactory.getBean(factoryBeanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factoryClass = factoryBean.getClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        isStatic = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Method factoryMethodToUse = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ArgumentsHolder argsHolderToUse = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object[] argsToUse = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ���� factoryMethod �Ĳ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (explicitArgs != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        argsToUse = explicitArgs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (factoryMethodToUse == null || argsToUse == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factoryClass = ClassUtils.getUserClass(factoryClass);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;Method&gt; candidates = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (mbd.isFactoryMethodUnique) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (factoryMethodToUse == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                factoryMethodToUse = mbd.getResolvedFactoryMethod();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (factoryMethodToUse != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                candidates = Collections.singletonList(factoryMethodToUse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ʡ���˺ö����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bw.setBeanInstance(instantiate(beanName, mbd, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            factoryBean, factoryMethodToUse, argsToUse));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return bw;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���Ϸ����Ǿ������Ĵ��룬ԭ����������Ƚ϶࣬�󲿷ִ��������ڴ��� <code>argsToUse</code> �� <code>factoryMethodToUse</code> ������ϸ�ڷǳ��࣬�Ͳ�չ�������ˣ�����������Ҫ��ע���¼���������</p>
<ol>
<li><code>factoryBean</code>�� <code>@Bean</code> �����������ʵ���������� <code>beanConfig</code>;</li>
<li><code>factoryMethodToUse</code>: ʵ�������õķ�����Ҳ���Ǳ� <code>@Bean</code> ע��ķ����������� <code>BeanConfigs#beanObj1</code>;</li>
<li><code>argsToUse</code>���� <code>@Bean</code> ע��ķ���Ҫ�õĲ��������� <code>BeanConfigs#beanObj1</code> û��ָ�������������� null;</li>
</ol>
<p>��������������������ʵ�����ı�����ʵ�����  �ʽ����Ҳ���뵽�ˣ�ʵ�����������������������ˣ����������ǵ��÷������ʵ�����ˣ�</p>
<blockquote>
<p>ConstructorResolver#instantiate(...)</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">private Object instantiate(String beanName, RootBeanDefinition mbd,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Nullable Object factoryBean, Method factoryMethod, Object[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.beanFactory.getInstantiationStrategy().instantiate(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mbd, beanName, this.beanFactory, factoryBean, factoryMethod, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>SimpleInstantiationStrategy#instantiate(...)</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Object instantiate(RootBeanDefinition bd, @Nullable String beanName, BeanFactory owner,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Nullable Object factoryBean, final Method factoryMethod, Object... args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            currentlyInvokedFactoryMethod.set(factoryMethod);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ������൱�ڵ��� beanConfigs.beanObj1()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object result = factoryMethod.invoke(factoryBean, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (result == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                result = new NullBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�������� <code>SimpleInstantiationStrategy#instantiate(...)</code> �����н��з���ʵ�����ˣ�</p>
<p>ʵ������ɺ󣬺�������ע�롢��ʼ���ȶ�����ͨ�� spring bean һ�£�����Ͳ��ٷ����ˡ�</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="36-configuration--bean-ʹ">3.6 <code>@Configuration</code> �� <code>@Bean</code> ���ʹ��<a href="#36-configuration--bean-ʹ" class="hash-link" aria-label="Direct link to 36-configuration--bean-ʹ" title="Direct link to 36-configuration--bean-ʹ">​</a></h3>
<p>��������� <code>@Component</code> �� <code>@Bean</code> ʹ��ʱ�Ĵ����������</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanConfigs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Xxx xxx() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ʵ���ϣ���������������ʹ�õ��� <code>@Configuration</code> �� <code>@Bean</code> ����ϣ�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanConfigs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Xxx xxx() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��������ǰ��ʹ�õ� <code>@Component</code> �кβ���أ��������Ǿ��������¡�</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="1-demo-">1. demo ׼��<a href="#1-demo-" class="hash-link" aria-label="Direct link to 1. demo ׼��" title="Direct link to 1. demo ׼��">​</a></h4>
<p>demo ׼����</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">//@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanConfigs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj1 beanObj1() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new BeanObj1();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj2 beanObj2() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ��������� beanObj1() ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanObj1();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new BeanObj2();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��� demo ����ֻ�ǽ� <code>@Component</code> �滻 Ϊ <code>@Configuration</code>��ִ���£�������£�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">����beanObj1�Ĺ��췽��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">����beanObj2�Ĺ��췽��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj1:BeanObj1{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj2:BeanObj2{}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.springframework.learn.explore.demo02.BeanConfigs$$EnhancerBySpringCGLIB$$dca1c55b@75c072cb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���������������ǽ�֮ǰ��ִ��Ҳ�������</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-88e5047479e4f30e70d09397d2631c0c6a5.png" alt="" class="img_kGBN"></p>
<p>�����Ƚϣ�������������ͬ��</p>
<ol>
<li><code>beanObj1</code> �Ĺ��췽����������һ�Σ�</li>
<li><code>beanConfigs</code> ��Ӧ������ <code>BeanConfigs$$EnhancerBySpringCGLIB$$dca1c55b@75c072cb</code>��˵������һ����������ʹ���� cglib ������</li>
</ol>
<p>ʵ���ϣ�����������ͬ�㶼���Թ��Ϊһ��ԭ��spring �� <code>beanConfigs</code> �����˴��������� <code>BeanConfigs#beanObj1</code> ʵ�ʵ��õ��Ǵ����������� <strong>spring ��Ա� <code>@Configuration</code> ��ǵ������ cglib ����</strong>��</p>
<p>��ô��������ô���������е��أ����Ǽ���̽����</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="2-ĵconfigurationclasspostprocessorenhanceconfigurationclasses">2. ������Ĵ�����<code>ConfigurationClassPostProcessor#enhanceConfigurationClasses</code><a href="#2-ĵconfigurationclasspostprocessorenhanceconfigurationclasses" class="hash-link" aria-label="Direct link to 2-ĵconfigurationclasspostprocessorenhanceconfigurationclasses" title="Direct link to 2-ĵconfigurationclasspostprocessorenhanceconfigurationclasses">​</a></h4>
<p>��<a href="https://my.oschina.net/funcy/blog/4836178" target="_blank" rel="noopener noreferrer">��һƪ����</a>�Ŀ�ƪ�����Ǿ��ᵽ�� <code>ConfigurationClassPostProcessor</code> ��ִ��ʱ����õ�����������<code>processConfigBeanDefinitions(...)</code> �� <code>enhanceConfigurationClasses(...)</code>��<code>processConfigBeanDefinitions(...)</code> ������ spring �� <code>@Import</code>��<code>@Configuration</code> ��ע��Ľ�����ǰ���Ѿ��������ˣ��� <code>enhanceConfigurationClasses(...)</code> ���Ǳ � <code>@Configuration</code> ��ǵ�����������Ĺؼ����ڣ�</p>
<p><code>enhanceConfigurationClasses(...)</code> �����������£�</p>
<blockquote>
<p>ConfigurationClassPostProcessor#enhanceConfigurationClasses</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public void enhanceConfigurationClasses(ConfigurableListableBeanFactory beanFactory) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Map&lt;String, AbstractBeanDefinition&gt; configBeanDefs = new LinkedHashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (String beanName : beanFactory.getBeanDefinitionNames()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BeanDefinition beanDef = beanFactory.getBeanDefinition(beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object configClassAttr = beanDef.getAttribute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ConfigurationClassUtils.CONFIGURATION_CLASS_ATTRIBUTE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 1\. �ж��Ƿ�Ϊһ��ȫ������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ConfigurationClassUtils.CONFIGURATION_CLASS_FULL.equals(configClassAttr)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            configBeanDefs.put(beanName, (AbstractBeanDefinition) beanDef);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ȫ�����ࣺ��������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ConfigurationClassEnhancer enhancer = new ConfigurationClassEnhancer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (Map.Entry&lt;String, AbstractBeanDefinition&gt; entry : configBeanDefs.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AbstractBeanDefinition beanDef = entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanDef.setAttribute(AutoProxyUtils.PRESERVE_TARGET_CLASS_ATTRIBUTE, Boolean.TRUE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���� BeanClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; configClass = beanDef.getBeanClass();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 2\. ���� enhancedClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Class&lt;?&gt; enhancedClass = enhancer.enhance(configClass, this.beanClassLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (configClass != enhancedClass) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 3\. ���� BeanClass��ֵΪenhancedClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanDef.setBeanClass(enhancedClass);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��������Ƚϼ򵥣��������£�</p>
<ol>
<li>�ж��������Ƿ�Ϊȫ�����࣬����<a href="https://my.oschina.net/funcy/blog/4836178" target="_blank" rel="noopener noreferrer">��һƪ����</a>�����У������ᵽ spring ��Ѵ��� <code>@Configuration</code> ע���� <code>proxyBeanMethods != false</code> ������Ϊ <code>Full</code> �����࣬�������Ǹ���ǰ��ı�����жϷ�Ϊȫ�����࣬�����ԣ���ʱ�� <code>beanConfigs</code> ����һ��ȫ�����ࣻ</li>
<li>��ȫ�����࣬������� <code>configClass</code> ���ɶ�Ӧ�� <code>enhancedClass</code>��</li>
<li>�����ɵ� <code>enhancedClass</code> ���õ� <code>beanDefinition</code> �� <code>beanClass</code> �С�</li>
</ol>
<p>ִ����˷�����<code>beanConfigs</code> ��Ӧ�� <code>beanDefinition</code> �� <code>beanClass</code> ���Ǵ������ˣ�</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-f617fc93f72b13b8f785ccf5a12624dec0b.png" alt="" class="img_kGBN"></p>
<p>���洴���� <code>beanConfigs</code> ��������������ʵ���ˡ�</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="3-ִдķ">3. ִ�д�������ķ���<a href="#3-ִдķ" class="hash-link" aria-label="Direct link to 3. ִ�д�������ķ���" title="Direct link to 3. ִ�д�������ķ���">​</a></h4>
<p>���ɴ�������󣬴������������ִ�е��أ��� spring �����ִ�� <code>beanConfigs.beanObj1()</code> ���أ�˵�����������Ҫ̸�� cglib ��������ķ���ִ���ˡ�����ֱ���������������ɣ����� <code>enhancer.enhance(configClass, this.beanClassLoader)</code>��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public Class&lt;?&gt; enhance(Class&lt;?&gt; configClass, @Nullable ClassLoader classLoader) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (EnhancedConfiguration.class.isAssignableFrom(configClass)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return configClass;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // newEnhancer(...) �������ǹؼ�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt; enhancedClass = createClass(newEnhancer(configClass, classLoader));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return enhancedClass;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�������룺</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">private static final Callback[] CALLBACKS = new Callback[] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // �����������֤ @Bean �����ĵ  ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new BeanMethodInterceptor(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new BeanFactoryAwareMethodInterceptor(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NoOp.INSTANCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ���� CallbackFilter������Ķ���ΪCallback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private static final ConditionalCallbackFilter CALLBACK_FILTER </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        = new ConditionalCallbackFilter(CALLBACKS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ����cglib��ǿ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private Enhancer newEnhancer(Class&lt;?&gt; configSuperClass, @Nullable ClassLoader classLoader) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Enhancer enhancer = new Enhancer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enhancer.setSuperclass(configSuperClass);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enhancer.setInterfaces(new Class&lt;?&gt;[] {EnhancedConfiguration.class});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enhancer.setUseFactory(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enhancer.setNamingPolicy(SpringNamingPolicy.INSTANCE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enhancer.setStrategy(new BeanFactoryAwareGeneratorStrategy(classLoader));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ����������callbackFilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enhancer.setCallbackFilter(CALLBACK_FILTER);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enhancer.setCallbackTypes(CALLBACK_FILTER.getCallbackTypes());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return enhancer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���� cglib ���������ݣ��� <a href="https://my.oschina.net/funcy/blog/4696655" target="_blank" rel="noopener noreferrer">spring aop ֮ cglib ����</a>һ��������ϸ�������ˣ��ⲻ�ٷ���������ֱ��˵���ۣ�cglib ִ�д�������ʱ��ִ�е��� <code>Enhancer</code> �� <code>callbackFilter</code> ���Ե� <code>MethodInterceptor#intercept</code> �������� <code>CALLBACKS</code> �����е� <code>BeanMethodInterceptor</code>���������Ǿ��������������ݣ�</p>
<blockquote>
<p>ConfigurationClassEnhancer.BeanMethodInterceptor</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">private static class BeanMethodInterceptor implements MethodInterceptor, ConditionalCallback {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Nullable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object intercept(Object enhancedConfigInstance, Method beanMethod, Object[] beanMethodArgs,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                MethodProxy cglibMethodProxy) throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurableBeanFactory beanFactory = getBeanFactory(enhancedConfigInstance);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String beanName = BeanAnnotationHelper.determineBeanNameFor(beanMethod);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ����ǵ��õ�ǰ�� factoryMethod ������ֱ�ӵ��ø���ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (isCurrentlyInvokedFactoryMethod(beanMethod)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ���ø���ķ�����Ҳ����Ŀ�귽��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return cglibMethodProxy.invokeSuper(enhancedConfigInstance, beanMethodArgs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ����ֱ�ӻ�ȡ beanFactory�����еĶ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return resolveBeanReference(beanMethod, beanMethodArgs, beanFactory, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Object resolveBeanReference(Method beanMethod, Object[] beanMethodArgs,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ConfigurableBeanFactory beanFactory, String beanName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ���õĵ��� beanFactory.getBean(...) ������������������Ѿ��ǳ���Ϥ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object beanInstance = (useArgs ? beanFactory.getBean(beanName, beanMethodArgs) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    beanFactory.getBean(beanName));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return beanInstance;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * �ж��ܷ�ִ�е�ǰ MethodInterceptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean isMatch(Method candidateMethod) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (candidateMethod.getDeclaringClass() != Object.class &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                !BeanFactoryAwareMethodInterceptor.isSetBeanFactory(candidateMethod) &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                BeanAnnotationHelper.isBeanAnnotated(candidateMethod));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>BeanMethodInterceptor</code> ʵ���� <code>MethodInterceptor</code> �� <code>ConditionalCallback</code>��<code>ConditionalCallback#isMatch</code> �����жϵ�ǰ <code>MethodInterceptor</code> �ܷ�ִ�У�<code>MethodInterceptor#intercept</code> ����ִ�еķ������ݣ�ִ���߼�Ϊ��</p>
<ol>
<li>�����ֱ�ӵ��õ�ǰ�� <code>factoryMethod</code> ������ֱ�ӵ��ø���ķ�����Ҳ���� <code>beanConfigs.beanObj1()</code>��������̻�ʵ���� <code>beanObj1</code> ʱ�����ã�</li>
<li>�������ֱ�ӵ��õ�ǰ�� <code>factoryMethod</code> �����������ڱ�ķ����е��ã�������� <code>beanFactory.getBean(...)</code> ��ȡ bean��������̻���ʵ� ��� <code>beanObj1</code> ʱ�� �����á�</li>
</ol>
<p>���Ͼ���Ϊʲô <code>beanObj1</code> �Ĺ��췽��ֻ������һ�Σ��Լ�Ϊʲô <code>beanConfigs</code> �Ǵ������ԭ�������ˡ�</p>
<p>�������һ�䣬<code>@Configuration</code> �ṩ�� <code>proxyBeanMethods()</code> ������������ѡ���Ƿ���������Ĵ�����Ĭ��ֵ�� true��������������ã�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration(proxyBeanMethods=false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanConfigs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>BeanConfigs</code> � Ͳ�����д����ˣ����н��ͬ <code>@Component</code> ע��һ��������Ͳ�չʾ�ˡ�</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="4-с">4. ����С����<a href="#4-с" class="hash-link" aria-label="Direct link to 4. ����С����" title="Direct link to 4. ����С����">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_HWLp" id="1-ڲҳܱ">1. �ڲ���������Ҳ�ܱ�������<a href="#1-ڲҳܱ" class="hash-link" aria-label="Direct link to 1. �ڲ���������Ҳ�ܱ�������" title="Direct link to 1. �ڲ���������Ҳ�ܱ�������">​</a></h5>
<p>��ʾ���У��������������õģ�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj2 beanObj2() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ��������� beanObj1() ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanObj1();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new BeanObj2();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���� <code>beanObj2()</code> �е����� <code>beanObj1()</code>�����������ڲ��������ã�<code>beanObj1()</code> Ҳ�ܱ�������</p>
<p><strong>�ش�</strong>��cglib �����ĵ��÷��������֣�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Object intercept(Object proxyObj, Method method, Object[] objects, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MethodProxy proxy) throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ����1�� ʹ��Ŀ�����ֱ�ӵ���Ŀ�����ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // return proxy.invoke(target, objects);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ����2�� ʹ�ô������󣬵����丸��ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return proxy.invokeSuper(proxyObj, objects);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>beanObj2()</code> �ĵ���ʹ����<code>����2</code>��Ҳ����ʹ�ô���������� <code>beanObj2()</code>��<code>beanObj2()</code> �� <code>this</code> Ϊ��������</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-7ef891450ace815d22a5bf5c8e78e65c2db.png" alt="" class="img_kGBN"></p>
<p>����� <code>beanObj2()</code> ��ֱ�ӵ��� <code>beanObj1()</code>�����൱��ʹ�ô���������� <code>beanObj1()</code>����Ȼ�ܱ������ˡ�</p>
<p>������ӡ���У��������ڲ����ò��ܱ�������������Ϊ spring �ڴ��� Aop ʱ��ʹ�õ��Ƿ��� 1 �ĵ��÷�ʽ����ʱ�� <code>this</code> Ϊԭʼ���󣬵�Ȼ���ܱ������ˡ�</p>
<h5 class="anchor anchorWithStickyNavbar_HWLp" id="2-ע룿">2. ˽���������ע�룿<a href="#2-ע룿" class="hash-link" aria-label="Direct link to 2. ˽���������ע�룿" title="Direct link to 2. ˽���������ע�룿">​</a></h5>
<p>���磬����������һ�� <code>BeanObj3</code>:</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanObj3 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj3() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;����beanObj3�Ĺ��췽��&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String toString() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;BeanObj3{}&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ȼ���� <code>BeanConfigs</code> ��ע�룺</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BeanConfigs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private BeanObj3 beanObj3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj1 beanObj1() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new BeanObj1();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BeanObj2 beanObj2() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ��������� beanObj1() ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beanObj1();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;beanObj3��&quot; + this.beanObj3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new BeanObj2();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�� <code>BeanConfigs</code> ���Զ�ע���� <code>beanObj3</code> ���ԣ�Ȼ���� <code>beanObj2()</code> ���ִ�ӡ�� <code>beanObj3</code> ���ԡ����У�������£�</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-e21bf76da41fcf12e674fa155de4b636253.png" alt="" class="img_kGBN"></p>
<p>���Կ�����ע��� <code>beanObj3</code> Ҳ�ܻ�ȡ���ˡ�������и������ˣ�<code>beanObj3</code> ������Ŀ�����ģ��� <code>this</code> �Ǵ��������Ѳ��ɴ����������õ�Ŀ������˽�����ԣ�</p>
<p>���ȣ����ӵ� <code>beanFactory</code> �� <code>beanDefinitionMap</code> �е����� <code>BeanConfigs$$EnhancerBySpringCGLIB$$Xxx</code> �ࣨ�����ࣩ�������� <code>BeanConfigs</code>��spring �ڽ�������ע��ʱ������ҵ�ǰ�༰�丸������е�ע�����Խ���ע�룬��ˣ���Ȼ���ӵ� spring �����е� �� <code>BeanConfigs$$EnhancerBySpringCGLIB$$Xxx</code> �࣬�� <code>BeanConfigs</code> �е� <code>beanObj3</code> һ���ᱻע�룬����ԭ������� cglib �Ĵ�����ϵ��<code>BeanConfigs</code> �� <code>BeanConfigs$$EnhancerBySpringCGLIB$$Xxx</code> �ĸ��ࡣ</p>
<p>�� <code>BeanConfigs$$EnhancerBySpringCGLIB$$Xxx</code> ��̳� <code>beanObj3</code> ����������ֱ�ӿ����н���ɣ�</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-27ebdebfd8c958f1de362ca1b30f2d0fc7c.png" alt="" class="img_kGBN"></p>
<p>�������յõ��� <code>beanConfigs</code> ���󣬿��Կ��������������һ�� <code>beanObj3</code> ���ԣ����һ���ֵ��</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="37-ܽ">3.7 �ܽ�<a href="#37-ܽ" class="hash-link" aria-label="Direct link to 3.7 �ܽ�" title="Direct link to 3.7 �ܽ�">​</a></h3>
<p>������Ҫ������ <code>ConfigurationClassPostProcessor</code> ���� <code>@Bean</code> ע��Ĺ��̣��ܽ����£�</p>
<ol>
<li>���������࣬ͨ�������ȡ�����������б� <code>@Bean</code> ��ǵķ�����</li>
<li>������Щ�����������װ��һ���� <code>BeanDefinition</code> ע�ᵽ <code>beanFactory</code> �У���Ӧ <code>BeanDefinition</code> ��������Ϊ <code>ConfigurationClassBeanDefinition</code>��</li>
<li>�����������ȫ�����࣬������������ cglib ������</li>
<li>ʵ����ʱ��ʹ�÷�����ö�Ӧ�ķ�������ʵ�����õ�ʵ����spring ���ٶ����������ע�롢��ʼ���ȣ���</li>
<li>�ڱ�� <code>@Bean</code> �����е��õ�ǰ <code>@Bean</code> ����ʱ�������ǰ <code>@Bean</code> �������ڵ�����ȫ�����࣬���ȥ <code>beanFactory</code> �в��Ҷ�Ӧ�� <code>bean</code>(���ҵĹ����ǣ��ҵ��򷵻أ��Ҳ����򴴽��ٷ��أ�<strong>���ص� bean �������� spring bean ����������</strong>)������������� cglib ������ɣ������ǰ <code>@Bean</code> �������ڵ��಻��ȫ�����࣬��ᰴ����ͨ�ķ������ã����� bean ��ʵ�����أ�<strong>���ص� bean û�������� spring bean ����������</strong>����</li>
</ol>
<p>���ĵķ����͵������ˣ����������Ǽ������� <code>ConfigurationClassPostProcessor</code> �������� ע������̡�</p>
<hr>
<p><em>����ԭ�����ӣ�<a href="https://my.oschina.net/funcy/blog/4492878" target="_blank" rel="noopener noreferrer">https://my.oschina.net/funcy/blog/4492878</a> ���������߸���ˮƽ�����������д���֮������ӭָ����ԭ�����ף���ҵת������ϵ���߻����Ȩ������ҵת����ע��������</em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_EYjg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_eevz"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring事务/Spring事务（一）：认识事务组件"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Spring事务（一）：认识事务组件</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（三）：处理@Import注解"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ConfigurationClassPostProcessor（三）：处理@Import注解</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lc2k thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#3-spring-δ-bean-עģ" class="table-of-contents__link toc-highlight">3. spring ����δ��� <code>@Bean</code> ע��ģ�</a><ul><li><a href="#31-demo-" class="table-of-contents__link toc-highlight">3.1 demo ׼��</a></li><li><a href="#32-ࣺconfigurationclasspostprocessorprocessconfigbeandefinitions" class="table-of-contents__link toc-highlight">3.2 ���������ࣺConfigurationClassPostProcessor#processConfigBeanDefinitions</a></li><li><a href="#32--demo02mainconfigurationclassparserdoprocessconfigurationclass" class="table-of-contents__link toc-highlight">3.2 ���� <code>demo02Main</code>��ConfigurationClassParser#doProcessConfigurationClass</a></li><li><a href="#33--beanconfigsconfigurationclassparserdoprocessconfigurationclass" class="table-of-contents__link toc-highlight">3.3 ���� <code>beanConfigs</code>��ConfigurationClassParser#doProcessConfigurationClass</a></li><li><a href="#34--bean-ǵķص-beandefinitionmap" class="table-of-contents__link toc-highlight">3.4 ���� <code>@Bean</code> ��ǵķ������ص� <code>BeanDefinitionMap</code></a></li><li><a href="#35-bean-ʵ" class="table-of-contents__link toc-highlight">3.5 <code>@Bean</code> ����ʵ��</a></li><li><a href="#36-configuration--bean-ʹ" class="table-of-contents__link toc-highlight">3.6 <code>@Configuration</code> �� <code>@Bean</code> ���ʹ��</a></li><li><a href="#37-ܽ" class="table-of-contents__link toc-highlight">3.7 �ܽ�</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>