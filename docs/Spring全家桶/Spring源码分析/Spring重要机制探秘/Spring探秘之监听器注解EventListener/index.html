<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之监听器注解EventListener" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">Spring探秘之监听器注解EventListener | Tommy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之监听器注解EventListener"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spring探秘之监听器注解EventListener | Tommy"><meta data-rh="true" name="description" content="��������� BeanFactoryPostProcessor ����ʱ�������˴����¼���������һ�ִ�����ʽ��ʹ�� @EventListener ע�⣬��������� EventListenerMethodProcessor�������ȴ�һ��ʾ�����������𲽷��� @EventListener �Ĵ������̡�"><meta data-rh="true" property="og:description" content="��������� BeanFactoryPostProcessor ����ʱ�������˴����¼���������һ�ִ�����ʽ��ʹ�� @EventListener ע�⣬��������� EventListenerMethodProcessor�������ȴ�һ��ʾ�����������𲽷��� @EventListener �Ĵ������̡�"><link data-rh="true" rel="icon" href="/code-note-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之监听器注解EventListener"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之监听器注解EventListener" hreflang="en"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之监听器注解EventListener" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/code-note-blog/blog/rss.xml" title="Tommy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/code-note-blog/blog/atom.xml" title="Tommy Atom Feed"><link rel="stylesheet" href="/code-note-blog/assets/css/styles.dd5372db.css">
<script src="/code-note-blog/assets/js/runtime~main.f999fb27.js" defer="defer"></script>
<script src="/code-note-blog/assets/js/main.a0bfbaed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XYiV" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/code-note-blog/"><b class="navbar__title text--truncate">Tommy</b></a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Java/basic/抽象类和接口">java</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/JavaWeb/走进JavaWeb技术世界：JavaWeb的由来和基础知识">javaweb</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">cache</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/backend/后端技术杂谈：白话虚拟化技术">backend</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cs/algorithms/剑指offer">cs</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">database</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/distributed/basic/分布式系统理论基础 ：CAP">distributed</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/interview/BATJ-Experience/面阿里,终获offer">interview</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mq/kafka/消息队列kafka详解：如何实现死信队列">mq</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">spring</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mianshi/collection">面试</a><a href="https://aiden-coding.github.io/code-note-blog/SpringCloud%E7%AC%AC3%E5%AD%A32024.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_XbAW colorModeToggle_r5NY"><button class="clean-btn toggleButton_Jx0n toggleButtonDisabled_zYO7" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FjAw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qmEt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_wJfS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LABv"><div class="docsWrapper_pdvB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Jioa" type="button"></button><div class="docRoot_qx_v"><aside class="theme-doc-sidebar-container docSidebarContainer_NHKT"><div class="sidebarViewport_uyYB"><div class="sidebar_SZG4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VP_k"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">Spring</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：初探SpringIOC核心流程">Spring源码分析</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：初探SpringIOC核心流程">Spring源码剖析：初探SpringIOC核心流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：懒加载的单例Bean获取过程分析">Spring源码剖析：懒加载的单例Bean获取过程分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：AOP实现原理详解">Spring源码剖析：AOP实现原理详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：JDK和cglib动态代理原理详解">Spring源码剖析：JDK和cglib动态代理原理详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：Spring事务概述">Spring源码剖析：Spring事务概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：Spring事务源码剖析">Spring源码剖析：Spring事务源码剖析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：SpringAOP概述">Spring源码剖析：SpringAOP概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：SpringIOC容器的加载过程">Spring源码剖析：SpringIOC容器的加载过程</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring启动流程/Spring启动流程（八）：完成BeanFactory的初始化">Spring启动流程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring事务/Spring事务（二）：事务的执行流程">Spring事务</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解">Spring重要机制探秘</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（二）：处理@Bean注解">ConfigurationClassPostProcessor（二）：处理@Bean注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（三）：处理@Import注解">ConfigurationClassPostProcessor（三）：处理@Import注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（四）：处理@Conditional注解">ConfigurationClassPostProcessor（四）：处理@Conditional注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（一）：处理@ComponentScan注解">ConfigurationClassPostProcessor（一）：处理@ComponentScan注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之监听器注解EventListener">Spring探秘之监听器注解EventListener</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之循环依赖的解决（二）：源码分析">Spring探秘之循环依赖的解决（二）：源码分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之循环依赖的解决（一）：理论基石">Spring探秘之循环依赖的解决（一）：理论基石</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之组合注解的处理">Spring探秘之组合注解的处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之AOP的执行顺序">Spring探秘之AOP的执行顺序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之Spring事件机制">Spring探秘之Spring事件机制</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring组件分析/Spring组件之ApplicationContext">Spring组件分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/SpringAOP/AnnotationAwareAspectJAutoProxyCreator分析（上）">SpringAOP</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot/给你一份SpringBoot知识清单">SpringBoot</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot源码解析/SpringBoot启动流程（四）：启动IOC容器">SpringBoot源码解析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud/SpringCloudConsul">SpringCloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud源码分析/SpringCloudConfig源码分析">SpringCloud源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibaba概览">SpringCloudAlibaba</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba源码分析/SpringCloudAlibabaNacos源码分析：服务发现">SpringCloudAlibaba源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC/SpringMVC常见注解">SpringMVC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（二）之执行Handler方法">SpringMVC源码分析</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_SejT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_j3Yw"><div class="docItemContainer_XOSC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_F6gm" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/code-note-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YCxa"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Spring源码分析</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Spring重要机制探秘</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spring探秘之监听器注解EventListener</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ToOY theme-doc-toc-mobile tocMobile_suYB"><button type="button" class="clean-btn tocCollapsibleButton_VzP_">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spring探秘之监听器注解EventListener</h1></header><p>��������� <code>BeanFactoryPostProcessor</code> ����ʱ�������˴����¼���������һ�ִ�����ʽ��ʹ�� <code>@EventListener</code> ע�⣬��������� <code>EventListenerMethodProcessor</code>�������ȴ�һ��ʾ�����������𲽷��� <code>@EventListener</code> �Ĵ������̡�</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="1-eventlistener-ʹʾ">1. <code>@EventListener</code> ʹ��ʾ��<a href="#1-eventlistener-ʹʾ" class="hash-link" aria-label="Direct link to 1-eventlistener-ʹʾ" title="Direct link to 1-eventlistener-ʹʾ">​</a></h3>
<p>�ȶ���һ���¼���</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class MyApplicationEvent extends ApplicationEvent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final long serialVersionUID = -1L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public MyApplicationEvent(Object source) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>��׼��һ���¼������������ʹ�� <code>@EventListener</code> ָ����������</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Demo08Config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ���Ǹ��¼�������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @EventListener(MyApplicationEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void listener(MyApplicationEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;@EventListener���������¼���&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                + Thread.currentThread().getName() + &quot; | &quot; + event.getSource());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ȼ�󷢲��¼���</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@ComponentScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Demo08Main {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ApplicationContext context = new AnnotationConfigApplicationContext(Demo08Config.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // �����¼�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.publishEvent(new MyApplicationEvent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread.currentThread().getName() + &quot; | �Զ����¼� ...&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���У�������£�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@EventListener���������¼���main | main | �Զ����¼� ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���Կ������� <code>@EventListener</code> ��ǵķ���ȷʵ������¼��ļ�����</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="2-eventlistener-">2. <code>@EventListener</code> ����<a href="#2-eventlistener-" class="hash-link" aria-label="Direct link to 2-eventlistener-" title="Direct link to 2-eventlistener-">​</a></h3>
<p>ʹ�� <code>@EventListener</code> �����������ʵ�� <code>ApplicationListener</code> ����ʵ���¼����������˴���Ŀ������������������� <code>@EventListener</code> ��Ϊ������Щʲô��</p>
<p><code>@EventListener</code> �Ĵ������£�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RetentionPolicy.RUNTIME)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Documented</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface EventListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * classes �ı���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ����ָ���������¼�������ͬʱ��������¼� </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @AliasFor(&quot;classes&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt;[] value() default {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * value �ı���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ����ָ ���������¼�������ͬʱ��������¼� </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @AliasFor(&quot;value&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt;[] classes() default {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ����ָ��һ����������������ʱ�����Ż�ִ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ֧��spring el ����ʽ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String condition() default &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�Ӵ���������<code>@EventListener</code> �ṩ�������ܣ�</p>
<ul>
<li>ָ���������¼�������ָ������¼�</li>
<li>ָ��һ����������������ʱ�����Ż�ִ�У�����֧�� spring EL ����ʽ</li>
</ul>
<p>�˽� <code>@EventListener</code> �ṩ�Ĺ��ܺ󣬽��������������� spring ����δ������ע��ġ�</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="3-eventlistener-ĵeventlistenermethodprocessor">3. <code>@EventListener</code> �Ĵ�����<code>EventListenerMethodProcessor</code><a href="#3-eventlistener-ĵeventlistenermethodprocessor" class="hash-link" aria-label="Direct link to 3-eventlistener-ĵeventlistenermethodprocessor" title="Direct link to 3-eventlistener-ĵeventlistenermethodprocessor">​</a></h3>
<p>���¿�ƪ��˵�������� <code>@EventListener</code> �Ĺ��ܣ����������� <code>BeanFactoryPostProcessor</code> ����ʱ���ֵģ���ʱ���� <code>BeanFactoryPostProcessor</code> ��ʵ���� <code>EventListenerMethodProcessor</code> �ᴦ�� <code>@EventListener</code> ע�⣬�������ʹӴ���Ƕ������� <code>EventListenerMethodProcessor</code> ���� <code>@EventListener</code> �����̡�</p>
<p>������������ʶ�� <code>EventListenerMethodProcessor</code>��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class EventListenerMethodProcessor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        implements SmartInitializingSingleton, ApplicationContextAware, BeanFactoryPostProcessor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>����Ҫ��ʵ���������ӿڣ�</p>
<ul>
<li><code>BeanFactoryPostProcessor</code>������������ <code>BeanFactoryPostProcessor</code> �������Զ��ƻ� <code>BeanFactory</code> ��һЩ��Ϊ��</li>
<li><code>SmartInitializingSingleton</code>���������� bean �ĳ�ʼ��������ִ��ʱ������ <code>bean</code> ��ʼ�����֮��</li>
</ul>
<p>���������������� <code>BeanFactoryPostProcessor#postProcessBeanFactory</code> ��ʵ�֣�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    @Nullable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;EventListenerFactory&gt; eventListenerFactories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ���� BeanFactoryPostProcessor �� postProcessBeanFactory(...) ����.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * �������������ǻ�ȡ�� EventListenerFactory��Ȼ�󱣴��� eventListenerFactories��.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * spring Ĭ���ṩ�� EventListenerFactory ��������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *     1\. DefaultEventListenerFactory��spring Ĭ�ϵ�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *     2\. TransactionalEventListenerFactory���������������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * �ⲿ�ֲ�û����ʲô��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.beanFactory = beanFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, EventListenerFactory&gt; beans = beanFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .getBeansOfType(EventListenerFactory.class, false, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;EventListenerFactory&gt; factories = new ArrayList&lt;&gt;(beans.values());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AnnotationAwareOrderComparator.sort(factories);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.eventListenerFactories = factories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>����������ǱȽϼ򵥵ģ���ֻ�Ǵ������л�ȡ�� <code>EventListenerFactory</code> ����ֵ���� <code>eventListenerFactories</code>��</p>
<p><code>EventListenerFactory</code> �Ĺ������������� <code>ApplicationListener</code>���������ǻ���� spring ����ΰ� <code>@EventListener</code> ��ǵķ���ת���� <code>ApplicationListener</code> ����ġ��Ӵ���������spring �ṩ�� <code>EventListenerFactory</code> ��������</p>
<ul>
<li><code>DefaultEventListenerFactory</code>��spring Ĭ�ϵ�</li>
<li><code>TransactionalEventListenerFactory</code>���������������</li>
</ul>
<p>���������������������� <code>SmartInitializingSingleton#afterSingletonsInstantiated()</code> ��ʵ�֣�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ��������� SmartInitializingSingleton �� afterSingletonsInstantiated() ����.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ����bean��ʼ����ɺ���á�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ����������У���Ҫ�ǽ������ @EventListener �ķ���ת���� ApplicationListener ���󣬲�ע�ᵽ��������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void afterSingletonsInstantiated() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConfigurableListableBeanFactory beanFactory = this.beanFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.state(this.beanFactory != null, &quot;No ConfigurableListableBeanFactory set&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String[] beanNames = beanFactory.getBeanNamesForType(Object.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (String beanName : beanNames) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!ScopedProxyUtils.isScopedTarget(beanName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Class&lt;?&gt; type = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // ��ȡ aop ������Ӧ��Ŀ���࣬�� beanName ��Ӧ�� BeanDefinition �л�ȡ.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // �����ȡ��������ʾ�ǲ��Ǵ�������ʹ�� beanFactory.getType(beanName) ��ȡ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    type = AutoProxyUtils.determineTargetClass(beanFactory, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (type != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (ScopedObject.class.isAssignableFrom(type)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Class&lt;?&gt; targetClass = AutoProxyUtils.determineTargetClass(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    beanFactory, ScopedProxyUtils.getTargetBeanName(beanName));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            if (targetClass != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                type = targetClass;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ����Ĵ�������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        processBean(beanName, type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���������ִ���������£�</p>
<ol>
<li>��ȡ��ǰ <code>beanFactory</code> �е����� <code>bean</code>�����õ��� <code>beanFactory.getBeanNamesForType(Object.class)</code> ������ע�⴫��� <code>class</code> �� <code>Object</code>���������ó������е� <code>bean</code>��</li>
<li>������Щ <code>bean</code>����ÿһ�� <code>bean</code>������Ǵ������������ <code>AutoProxyUtils.determineTargetClass(beanFactory, beanName)</code> ������ȡ��Ŀ���࣬����֪��ע���ǲ��ܼ̳еģ�Ҫ��ȡ <code>@EventListener</code> ��ǵķ�������Ҫ��Ŀ����ȥ��ȡ��������Ǵ���������Ŀ������� <code>bean</code> ��Ӧ���ࣻ</li>
<li>���� <code>processBean(beanName, type)</code> ������һ������.</li>
</ol>
<p>�����ؼ����� <code>EventListenerMethodProcessor#processBean</code> �����ˣ�</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * ���� bean�� ��������Ὣ @EventListener ע���ǵķ���ת��Ϊ ApplicationListener ���󣬲�ע�ᵽ������.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param beanName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param targetType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void processBean(final String beanName, final Class&lt;?&gt; targetType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!this.nonAnnotatedClasses.contains(targetType) &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            AnnotationUtils.isCandidateClass(targetType, EventListener.class) &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            !isSpringContainerClass(targetType)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;Method, EventListener&gt; annotatedMethods = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 1\. �ҵ���� @EventListener �ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            annotatedMethods = MethodIntrospector.selectMethods(targetType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                (MethodIntrospector.MetadataLookup&lt;EventListener&gt;) method -&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    AnnotatedElementUtils.findMergedAnnotation(method, EventListener.class));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (CollectionUtils.isEmpty(annotatedMethods)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.nonAnnotatedClasses.add(targetType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ConfigurableApplicationContext context = this.applicationContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Assert.state(context != null, &quot;No ApplicationContext set&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;EventListenerFactory&gt; factories = this.eventListenerFactories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Assert.state(factories != null, &quot;EventListenerFactory List not initialized&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 2\. ʹ�� EventListenerFactory ������ ApplicationListener ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Method method : annotatedMethods.keySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (EventListenerFactory factory : factories) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // �жϵ�ǰ EventListenerFactory �Ƿ�֧�ֵ�ǰ����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (factory.supportsMethod(method)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ����Ǵ���������õ�������ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        Method methodToUse = AopUtils.selectInvocableMethod(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                method, context.getType(beanName));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ���� ApplicationListener��������Ǵ�����ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ApplicationListener&lt;?&gt; applicationListener = factory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .createApplicationListener(beanName, targetType, methodToUse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ��ʼ����������һ����Ҫ�Ƕ������ж�����ֵ��this.evaluator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        if (applicationListener instanceof ApplicationListenerMethodAdapter) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            ((ApplicationListenerMethodAdapter) applicationListener)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    .init(context, this.evaluator);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ���ӵ��������У����� Listener ��Set�����Զ�ȥ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        context.addApplicationListener(applicationListener);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ������һ������� EventListenerFactory �Ͳ�����ִ���ˣ�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ����ʱ��ͻᷢ�� factories ��˳�����Ҫ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // ������ EventListenerFactory ��ָ��˳��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�� <code>processBean(...)</code> �����Ĺؼ�����������ע�ͣ��������ܽ��´������̣�</p>
<ol>
<li>�ҵ���� <code>@EventListener</code> �ķ���������ʹ�õ��� <code>MethodIntrospector#selectMethods(...)</code> �������в��ң����������鵽��ǰ��ķ������丸��ķ����Լ��ӿڵ�Ĭ�Ϸ�����һֱ�� Object Ϊֹ����Щ�������������� <code>@EventListener</code>�����ᱻ�ҵ������ջ���ҵ������з����ŵ�һ�� Map �У�</li>
<li>���������õ��� map����ÿ������ת��Ϊ <code>ApplicationListener</code> ���������ӵ� <code>applicationContext</code> �� <code>ApplicationListener</code> �У������������£�<!-- -->
<ol>
<li>����ǰ��õ��� <code>EventListenerFactory</code>��</li>
<li>������ǰ�� <code>EventListenerFactory</code> �Ƿ�֧�ָ÷�����֧���������һ������֧���򲻴�����</li>
<li>���ڴ��������ҵ���ǰ�����Ĵ�������������ִ�е�Ҳ�Ǵ���������</li>
<li>���� <code>ApplicationListener</code> ���󣬹��췽���Ĳ����ᴫ�� <code>method</code>�����ڴ���������� <code>method</code> �Ǵ�������� <code>method</code>��</li>
<li>���� <code>ApplicationListenerMethodAdapter</code> ʵ�������г�ʼ����������Ҫ�Ǹ�ֵ��this.evaluator��</li>
<li>���õ��� <code>ApplicationListener</code> ���ӵ��������У����� <code>Listener</code> ��һ�� <code>Set</code>�����Զ�ȥ�ء�</li>
</ol>
</li>
</ol>
<p>������������ <code>@EventListener</code> ��ǵķ���֮�����ܶ��¼����м���������Ϊ spring ���÷�����װ��һ�� <code>ApplicationListener</code> ���ӵ��������ˣ�֮������������͸�ʵ���� <code>ApplicationListener</code> �ӿڵļ�����һ���ܶ��¼����м����ˡ�</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="5-applicationlistener-">5. <code>ApplicationListener</code> ���������<a href="#5-applicationlistener-" class="hash-link" aria-label="Direct link to 5-applicationlistener-" title="Direct link to 5-applicationlistener-">​</a></h3>
<p>ǰ������� <code>@EventListener</code> �Ĵ������̣����ڽ������� <code>ApplicationListener</code> ��������ɣ���Ӧ�Ĵ���Ϊ��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">// EventListenerMethodProcessor#processBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ApplicationListener&lt;?&gt; applicationListener = factory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .createApplicationListener(beanName, targetType, methodToUse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ǰ�����ǽ��ܹ� spring �ṩ�� <code>EventListenerFactory</code> ��������</p>
<ul>
<li><code>DefaultEventListenerFactory</code>��spring Ĭ�ϵ�</li>
<li><code>TransactionalEventListenerFactory</code>���������������</li>
</ul>
<p>���������Ǿ������������� <code>EventListenerFactory</code>��</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="51-defaulteventlistenerfactory">5.1 <code>DefaultEventListenerFactory</code><a href="#51-defaulteventlistenerfactory" class="hash-link" aria-label="Direct link to 51-defaulteventlistenerfactory" title="Direct link to 51-defaulteventlistenerfactory">​</a></h4>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class DefaultEventListenerFactory implements EventListenerFactory, Ordered {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ������Ĭ�ϵ�ʵ�֣���֧�����еķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean supportsMethod(Method method) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ��������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ApplicationListener&lt;?&gt; createApplicationListener(String beanName, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Class&lt;?&gt; type, Method method) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new ApplicationListenerMethodAdapter(beanName, type, method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�����ϴ���˵�����£�</p>
<ol>
<li><code>DefaultEventListenerFactory</code> �� spring �ṩ��Ĭ��ʵ�֣���֧�����б���� <code>@EventListener</code> �ķ�����</li>
<li>���� <code>ApplicationListener</code> �ķ����� <code>createApplicationListener</code>�������õ��� <code>ApplicationListenerMethodAdapter</code> �Ĺ��췽����</li>
</ol>
<p>���Ǽ����� <code>ApplicationListenerMethodAdapter</code>��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationListenerMethodAdapter implements GenericApplicationListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ApplicationListenerMethodAdapter(String beanName, Class&lt;?&gt; targetClass, Method method) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.beanName = beanName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ��������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.method = BridgeMethodResolver.findBridgedMethod(method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.targetMethod = (!Proxy.isProxyClass(targetClass) ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                AopUtils.getMostSpecificMethod(method, targetClass) : this.method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.methodKey = new AnnotatedElementKey(this.targetMethod, targetClass);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EventListener ann = AnnotatedElementUtils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .findMergedAnnotation(this.targetMethod, EventListener.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ����֧�ֵ��¼�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.declaredEventTypes = resolveDeclaredEventTypes(method, ann);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ע��ָ��������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.condition = (ann != null ? ann.condition() : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.order = resolveOrder(this.targetMethod);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>ApplicationListenerMethodAdapter</code> �Ĺ��췽������һ�ѵĸ�ֵ���������������ص�����ע���¼��Ĵ�����</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationListenerMethodAdapter implements GenericApplicationListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ���������ܼ������¼�����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static List&lt;ResolvableType&gt; resolveDeclaredEventTypes(Method method, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Nullable EventListener ann) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // �������ֻ����һ���������������¼������� @EventListener ָ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int count = method.getParameterCount();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (count &gt; 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalStateException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;Maximum one parameter is allowed for event listener method: &quot; + method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ann != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // �¼�����ָ���������ȡ���� classes ����ֵ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Class&lt;?&gt;[] classes = ann.classes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (classes.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                List&lt;ResolvableType&gt; types = new ArrayList&lt;&gt;(classes.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (Class&lt;?&gt; eventType : classes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    types.add(ResolvableType.forClass(eventType));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return types;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (count == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalStateException(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;Event parameter is mandatory for event listener method: &quot; + method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Collections.singletonList(ResolvableType.forMethodParameter(method, 0));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�Ӵ�����Եó����½��ۣ�</p>
<ol>
<li>�� <code>@EventListener</code> ��ǵķ������������ֻ����һ��</li>
<li>�����ܼ������¼������ж������ <code>@EventListener</code> ָ��</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="52-transactionaleventlistenerfactory">5.2 <code>TransactionalEventListenerFactory</code><a href="#52-transactionaleventlistenerfactory" class="hash-link" aria-label="Direct link to 52-transactionaleventlistenerfactory" title="Direct link to 52-transactionaleventlistenerfactory">​</a></h4>
<p>������������������ <code>TransactionalEventListenerFactory</code>��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class TransactionalEventListenerFactory implements EventListenerFactory, Ordered {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ֻ֧�ֱ���� @TransactionalEventListener ע��ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean supportsMethod(Method method) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return AnnotatedElementUtils.hasAnnotation(method, TransactionalEventListener.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * �����Ķ����� ApplicationListenerMethodTransactionalAdapter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ApplicationListener&lt;?&gt; createApplicationListener(String beanName, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Class&lt;?&gt; type, Method method) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new ApplicationListenerMethodTransactionalAdapter(beanName, type, method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�Ӵ���������<code>TransactionalEventListenerFactory</code> �� <code>DefaultEventListenerFactory</code> ������£�</p>
<ul>
<li><code>ApplicationListenerMethodTransactionalAdapter</code> ֻ֧�ֱ���� <code>@TransactionalEventListener</code> �ķ�����</li>
<li>������ <code>ApplicationListener</code> ʵ������Ϊ <code>ApplicationListenerMethodTransactionalAdapter</code>��</li>
</ul>
<p>������������ <code>@TransactionalEventListener</code> �Ǹ�ɶ��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Target({ElementType.METHOD, ElementType.ANNOTATION_TYPE})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RetentionPolicy.RUNTIME)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Documented</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * ����� @EventListener ע��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EventListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface TransactionalEventListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TransactionPhase phase() default TransactionPhase.AFTER_COMMIT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean fallbackExecution() default false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ָ�������¼�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @AliasFor(annotation = EventListener.class, attribute = &quot;classes&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt;[] value() default {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ָ�������¼�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @AliasFor(annotation = EventListener.class, attribute = &quot;classes&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt;[] classes() default {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ָ������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String condition() default &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���Կ��������ע������ <code>@EventListener</code>����˾����� <code>@EventListener</code> ��ͬ�Ĺ��ܡ����⣬�� <code>@EventListener</code> ��ȣ������������ԣ�<code>phase()</code> �� <code>fallbackExecution()</code>��������������������ġ�</p>
<p>�˽��� <code>TransactionalEventListener</code> ֮�������������� <code>ApplicationListenerMethodTransactionalAdapter</code>��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * �̳��� ApplicationListenerMethodAdapter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApplicationListenerMethodTransactionalAdapter extends ApplicationListenerMethodAdapter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final TransactionalEventListener annotation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ApplicationListenerMethodTransactionalAdapter(String beanName, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Class&lt;?&gt; targetClass, Method method) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ���ø���ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(beanName, targetClass, method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // �����ע���� @TransactionalEventListener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TransactionalEventListener ann = AnnotatedElementUtils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .findMergedAnnotation(method, TransactionalEventListener.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ann == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalStateException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.annotation = ann;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�Ӵ�����������<code>ApplicationListenerMethodTransactionalAdapter</code> �̳��� <code>ApplicationListenerMethodAdapter</code>���乹�췽��Ҳ���ȵ��� <code>ApplicationListenerMethodAdapter</code> �Ĺ��췽����Ȼ���ٸ� <code>annotation</code> ��ֵ��</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="6-">6. �¼�����<a href="#6-" class="hash-link" aria-label="Direct link to 6. �¼�����" title="Direct link to 6. �¼�����">​</a></h3>
<p>�����������������¼��ļ���������</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="61-applicationlistenermethodadapter-">6.1 <code>ApplicationListenerMethodAdapter</code> �����¼�<a href="#61-applicationlistenermethodadapter-" class="hash-link" aria-label="Direct link to 61-applicationlistenermethodadapter-" title="Direct link to 61-applicationlistenermethodadapter-">​</a></h4>
<p>��ǰ��������У�����֪�� <code>ApplicationListener</code> Ҫ����һ���¼��������������������</p>
<ol>
<li>�жϵ�ǰ <code>ApplicationListener</code> �Ƿ�֧�ֵ�ǰ�¼�</li>
<li>���֧�֣�������¼�����</li>
</ol>
<p>���������� <code>ApplicationListenerMethodAdapter</code> ��������������</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationListenerMethodAdapter implements GenericApplicationListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ��ǰ listener �Ƿ�֧�ִ�����¼�.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * ʹ�õķ����� ResolvableType#isAssignableFrom(ResolvableType)�����Խ��÷���������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Ϊ�Ƕ� Class#isAssignableFrom ���ܵ���չ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean supportsEventType(ResolvableType eventType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (ResolvableType declaredEventType : this.declaredEventTypes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (declaredEventType.isAssignableFrom(eventType)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (PayloadApplicationEvent.class.isAssignableFrom(eventType.toClass())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ResolvableType payloadType = eventType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .as(PayloadApplicationEvent.class).getGeneric();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (declaredEventType.isAssignableFrom(payloadType)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return eventType.hasUnresolvableGenerics();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * �¼�����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onApplicationEvent(ApplicationEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processEvent(event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void processEvent(ApplicationEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ��������</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object[] args = resolveArguments(event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // shouldHandle���ж��������� EventListener.condition() �ṩ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (shouldHandle(event, args)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ������÷���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object result = doInvoke(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (result != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // ����ִ�н���������صĽ�������¼�������ȥ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                handleResult(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.trace(&quot;No result object given - no result to handle&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>���Կ������жϵ�ǰ��ǰ <code>ApplicationListener</code> �Ƿ�֧�ֵ�ǰ�¼�ʱ��ʹ�õ��� <code>ResolvableType#isAssignableFrom(ResolvableType)</code>����������������Ĳ�������������������Լ򵥵ؽ��÷�������Ϊ�Ƕ� <code>Class#isAssignableFrom</code> ���ܵ���չ��</p>
<p><code>ApplicationListenerMethodAdapter</code> �����¼��������������£�</p>
<ol>
<li>����������������� <code>event</code> ת��Ϊ���������о����ֵ</li>
<li>ͨ��������ñ� <code>@EventListener</code> ��ǵķ���</li>
<li>���� <code>@EventListener</code> �����ķ��ؽ������ <code>handleResult(...)</code> ��������Խ����صĽ�������¼��ٷ�����ȥ</li>
</ol>
<p>���� <code>ApplicationListenerMethodAdapter</code> �����¼������ͷ����������ˡ�</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="62-applicationlistenermethodtransactionaladapter-">6.2 <code>ApplicationListenerMethodTransactionalAdapter</code> �����¼�<a href="#62-applicationlistenermethodtransactionaladapter-" class="hash-link" aria-label="Direct link to 62-applicationlistenermethodtransactionaladapter-" title="Direct link to 62-applicationlistenermethodtransactionaladapter-">​</a></h4>
<p><code>ApplicationListenerMethodTransactionalAdapter</code> ���¼������� <code>ApplicationListenerMethodAdapter</code> Ҫ��һЩ��</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * �̳��� ApplicationListenerMethodAdapter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApplicationListenerMethodTransactionalAdapter extends ApplicationListenerMethodAdapter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // supportsEventType(...) Ҳ�Ǽ̳�������ķ�������������ʵ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * �¼�����</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onApplicationEvent(ApplicationEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ������ڴ�������Ĳ����������л������о�</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (TransactionSynchronizationManager.isSynchronizationActive()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &amp;&amp; TransactionSynchronizationManager.isActualTransactionActive()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TransactionSynchronization transactionSynchronization </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    = createTransactionSynchronization(event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TransactionSynchronizationManager.registerSynchronization(transactionSynchronization);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else if (this.annotation.fallbackExecution()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ���õ��Ǹ���ķ���</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            processEvent(event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ֻ��log ��ӡ��ʡ��</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>�����ϴ���˵�����£�</p>
<ol>
<li><code>ApplicationListenerMethodTransactionalAdapter</code> �� <code>ApplicationListenerMethodAdapter</code> �����࣬��̳����� <code>ApplicationListenerMethodAdapter</code> �ķ���</li>
<li><code>ApplicationListenerMethodTransactionalAdapter</code> ��û����д <code>supportsEventType(...)</code> ���������Ҳ��ʹ�� <code>ApplicationListenerMethodAdapter</code> �� <code>supportsEventType(...)</code> �������ж��¼���֧�����</li>
<li>�ڴ����¼�ʱ��<code>ApplicationListenerMethodTransactionalAdapter</code> �����������صĴ���������Ĵ����߼����ľͲ�������</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="7-ܽ">7. �ܽ�<a href="#7-ܽ" class="hash-link" aria-label="Direct link to 7. �ܽ�" title="Direct link to 7. �ܽ�">​</a></h3>
<p>������Ҫ������ <code>@EventListener</code> �Ĵ������̣��ܽ����£�</p>
<ol>
<li><code>@EventListener</code> ����ָ���������¼����¼�����������</li>
<li>���� <code>@EventListener</code> ������ <code>EventListenerMethodProcessor</code>�������ѱ� <code>@EventListener</code> ��ǵķ���ת����һ�� <code>ApplicationListener</code> ����Ȼ�����ӵ� <code>ApplicationContext</code> �ļ�������</li>
<li>����ת���� <code>ApplicationListener</code> ����Ĳ����� <code>EventListenerFactory</code> �ṩ��spring �ṩ������ <code>EventListenerFactory</code>��<!-- -->
<ul>
<li><code>DefaultEventListenerFactory</code>��spring Ĭ�ϵģ�ת  ���ɵ� <code>ApplicationListener</code> Ϊ <code>ApplicationListenerMethodAdapter</code></li>
<li><code>TransactionalEventListenerFactory</code>��������������ģ�ת���ɵ� <code>ApplicationListener</code> Ϊ <code>ApplicationListenerMethodTransactionalAdapter</code></li>
</ul>
</li>
</ol>
<hr>
<p><em>����ԭ�����ӣ�<a href="https://my.oschina.net/funcy/blog/4926344" target="_blank" rel="noopener noreferrer">https://my.oschina.net/funcy/blog/4926344</a> ���������߸���ˮƽ�����������д���֮������ӭָ����ԭ�����ף���ҵת������ϵ���߻����Ȩ������ҵת����ע��������</em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之监听器注解EventListener.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_EYjg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_eevz"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/ConfigurationClassPostProcessor（一）：处理@ComponentScan注解"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ConfigurationClassPostProcessor（一）：处理@ComponentScan注解</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring重要机制探秘/Spring探秘之循环依赖的解决（二）：源码分析"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Spring探秘之循环依赖的解决（二）：源码分析</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lc2k thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-eventlistener-ʹʾ" class="table-of-contents__link toc-highlight">1. <code>@EventListener</code> ʹ��ʾ��</a></li><li><a href="#2-eventlistener-" class="table-of-contents__link toc-highlight">2. <code>@EventListener</code> ����</a></li><li><a href="#3-eventlistener-ĵeventlistenermethodprocessor" class="table-of-contents__link toc-highlight">3. <code>@EventListener</code> �Ĵ�����<code>EventListenerMethodProcessor</code></a></li><li><a href="#5-applicationlistener-" class="table-of-contents__link toc-highlight">5. <code>ApplicationListener</code> ���������</a></li><li><a href="#6-" class="table-of-contents__link toc-highlight">6. �¼�����</a></li><li><a href="#7-ܽ" class="table-of-contents__link toc-highlight">7. �ܽ�</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>