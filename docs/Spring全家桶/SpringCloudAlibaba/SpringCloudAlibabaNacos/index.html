<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaNacos" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">SpringCloudAlibabaNacos | Tommy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaNacos"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SpringCloudAlibabaNacos | Tommy"><meta data-rh="true" name="description" content="Nacos 英文全称为 Dynamic Naming and Configuration Service，是一个由阿里巴巴团队使用 Java 语言开发的开源项目。"><meta data-rh="true" property="og:description" content="Nacos 英文全称为 Dynamic Naming and Configuration Service，是一个由阿里巴巴团队使用 Java 语言开发的开源项目。"><link data-rh="true" rel="icon" href="/code-note-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaNacos"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaNacos" hreflang="en"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaNacos" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/code-note-blog/blog/rss.xml" title="Tommy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/code-note-blog/blog/atom.xml" title="Tommy Atom Feed"><link rel="stylesheet" href="/code-note-blog/assets/css/styles.dd5372db.css">
<script src="/code-note-blog/assets/js/runtime~main.f999fb27.js" defer="defer"></script>
<script src="/code-note-blog/assets/js/main.a0bfbaed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XYiV" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/code-note-blog/"><b class="navbar__title text--truncate">Tommy</b></a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Java/basic/抽象类和接口">java</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/JavaWeb/走进JavaWeb技术世界：JavaWeb的由来和基础知识">javaweb</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">cache</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/backend/后端技术杂谈：白话虚拟化技术">backend</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cs/algorithms/剑指offer">cs</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">database</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/distributed/basic/分布式系统理论基础 ：CAP">distributed</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/interview/BATJ-Experience/面阿里,终获offer">interview</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mq/kafka/消息队列kafka详解：如何实现死信队列">mq</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">spring</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mianshi/collection">面试</a><a href="https://aiden-coding.github.io/code-note-blog/SpringCloud%E7%AC%AC3%E5%AD%A32024.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_XbAW colorModeToggle_r5NY"><button class="clean-btn toggleButton_Jx0n toggleButtonDisabled_zYO7" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FjAw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qmEt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_wJfS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LABv"><div class="docsWrapper_pdvB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Jioa" type="button"></button><div class="docRoot_qx_v"><aside class="theme-doc-sidebar-container docSidebarContainer_NHKT"><div class="sidebarViewport_uyYB"><div class="sidebar_SZG4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VP_k"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">Spring</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：初探SpringIOC核心流程">Spring源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot/给你一份SpringBoot知识清单">SpringBoot</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot源码解析/SpringBoot启动流程（四）：启动IOC容器">SpringBoot源码解析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud/SpringCloudConsul">SpringCloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud源码分析/SpringCloudConfig源码分析">SpringCloud源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibaba概览">SpringCloudAlibaba</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibaba概览">SpringCloudAlibaba概览</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaNacos">SpringCloudAlibabaNacos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaRocketMQ">SpringCloudAlibabaRocketMQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaSeata">SpringCloudAlibabaSeata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaSentinel">SpringCloudAlibabaSentinel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaSkywalking">1\. SkyWalking 简介</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba源码分析/SpringCloudAlibabaNacos源码分析：服务发现">SpringCloudAlibaba源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC/SpringMVC常见注解">SpringMVC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（二）之执行Handler方法">SpringMVC源码分析</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_SejT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_j3Yw"><div class="docItemContainer_XOSC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_F6gm" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/code-note-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YCxa"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">SpringCloudAlibaba</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">SpringCloudAlibabaNacos</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ToOY theme-doc-toc-mobile tocMobile_suYB"><button type="button" class="clean-btn tocCollapsibleButton_VzP_">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>SpringCloudAlibabaNacos</h1></header><p>Nacos 英文全称为 Dynamic Naming and Configuration Service，是一个由阿里巴巴团队使用 Java 语言开发的开源项目。</p>
<p>Nacos  是一个更易于帮助构建云原生应用的动态服务发现、配置和服务管理平台（参考自 <a href="https://nacos.io/zh-cn/index.html" target="_blank" rel="noopener noreferrer">Nacos 官网</a>）。</p>
<p>Nacos 的命名是由 3 部分组成：</p>
<table><thead><tr><th>组成部分</th><th>全称</th><th>描述</th></tr></thead><tbody><tr><td>Na</td><td>naming/nameServer</td><td>即服务注册中心，与 Spring Cloud Eureka 的功能类似。</td></tr><tr><td>co</td><td>configuration</td><td>即配置中心，与 Spring Cloud Config+Spring Cloud Bus 的功能类似。</td></tr><tr><td>s</td><td>service</td><td>即服务，表示 Nacos 实现的服务注册中心和配置中心都是以服务为核心的。</td></tr></tbody></table>
<p>我们可以将 Nacos 理解成服务注册中心和配置中心的组合体，它可以替换 <a href="http://c.biancheng.net/springcloud/eureka.html" target="_blank" rel="noopener noreferrer">Eureka</a> 作为服务注册中心，实现服务的注册与发现；还可以替换 <a href="http://c.biancheng.net/springcloud/config.html" target="_blank" rel="noopener noreferrer">Spring Cloud Config</a> 作为配置中心，实现配置的动态刷新。</p>
<p>Nacos 作为服务注册中心经历了十年“双十一”的洪峰考验，具有简单易用、稳定可靠、性能卓越等优点，可以帮助用户更敏捷、容易地构建和管理微服务应用。</p>
<p>Nacos 支持几乎所有主流类型“服务”的发现、配置和管理：</p>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreferrer">Kubernetes Service</a></li>
<li><a href="https://grpc.io/docs/what-is-grpc/core-concepts#service-definition" target="_blank" rel="noopener noreferrer">gRPC </a>&amp; <a href="https://dubbo.apache.org/zh/" target="_blank" rel="noopener noreferrer">Dubbo RPC Service</a></li>
<li>Spring Cloud RESTful Service</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="nacos-的特性">Nacos 的特性<a href="#nacos-的特性" class="hash-link" aria-label="Direct link to Nacos 的特性" title="Direct link to Nacos 的特性">​</a></h2>
<p>Nacos 提供了一系列简单易用的特性，能够帮助我们快速地实现动态服务发现、服务配置等功能。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="服务发现">服务发现<a href="#服务发现" class="hash-link" aria-label="Direct link to 服务发现" title="Direct link to 服务发现">​</a></h4>
<p>Nacos 支持基于 DNS 和 RPC 的服务发现。当服务提供者使用原生 SDK、OpenAPI 或一个独立的 Agent TODO 向 Nacos 注册服务后，服务消费者可以在 Nacos 上通过 DNS TODO 或 HTTP&amp;API 查找、发现服务。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="服务健康监测">服务健康监测<a href="#服务健康监测" class="hash-link" aria-label="Direct link to 服务健康监测" title="Direct link to 服务健康监测">​</a></h4>
<p>Nacos 提供对服务的实时健康检查，能够阻止请求发送到不健康主机或服务实例上。Nacos 还提供了一个健康检查仪表盘，能够帮助我们根据健康状态管理服务的可用性及流量。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="动态配置服务">动态配置服务<a href="#动态配置服务" class="hash-link" aria-label="Direct link to 动态配置服务" title="Direct link to 动态配置服务">​</a></h4>
<p>动态配置服务可以让我们以中心化、外部化和动态化的方式，管理所有环境的应用配置和服务配置。</p>
<p>动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效、敏捷。</p>
<p>配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。</p>
<p>Nacos 提供了一个简洁易用的 UI 帮助我们管理所有服务和应用的配置。Nacos 还提供包括配置版本跟踪、金丝雀发布、一键回滚配置以及客户端配置更新状  态跟踪在内的一系列开箱即用的配置管理特性，帮助我们更安全地在生产环境中管理配置变更和降低配置变更带来的风险。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="动态-dns-服务">动态 DNS 服务<a href="#动态-dns-服务" class="hash-link" aria-label="Direct link to 动态 DNS 服务" title="Direct link to 动态 DNS 服务">​</a></h4>
<p>Nacos 提供了动态 DNS 服务，能够让我们更容易地实现负载均衡、流量控制以及数据中心内网的简单 DNS 解析服务。</p>
<p>Nacos 提供了一些简单的 DNS APIs TODO，可以帮助我们管理服务的关联域名和可用的 IP<!-- -->:PORT<!-- --> 列表。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="服务及其元数据管理">服务及其元数据管理<a href="#服务及其元数据管理" class="hash-link" aria-label="Direct link to 服务及其元数据管理" title="Direct link to 服务及其元数据管理">​</a></h4>
<p>Nacos 能让我们从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略、服务的 SLA 以及 metrics 统计数据。</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="nacos-两大组件">Nacos 两大组件<a href="#nacos-两大组件" class="hash-link" aria-label="Direct link to Nacos 两大组件" title="Direct link to Nacos 两大组件">​</a></h2>
<p>与 Eureka 类似，Nacos 也采用 CS（Client/Server，客户端/服务器）架构，它包含两大组件，如下表。
、</p>
<table><thead><tr><th>组件</th><th>描述</th><th>功能</th></tr></thead><tbody><tr><td>Nacos Server</td><td>Nacos 服务端，与 Eureka Server 不同，Nacos Server 由阿里巴巴团队使用 Java 语言编写并将 Nacos Server 的下载地址给用户，用户只需要直接下载并运行即可。</td><td>Nacos Server 可以作为服务注册中心，帮助 Nacos Client 实现服务的注册与发现。</td></tr><tr><td>Nacos Server 可以作为配置中心，帮助 Nacos Client 在不重启的情况下，实现配置的动态刷新。</td><td></td><td></td></tr><tr><td>Nacos Client</td><td>Nacos 客户端，通常指的是微服务架构中的各个服务，由用户自己搭建，可以使用多种语言编写。</td><td>Nacos Client 通过添加依赖 spring-cloud-starter-alibaba-nacos-discovery，在服务注册中心（Nacos Server）中实现服务的注册与发现。</td></tr><tr><td>Nacos Client 通过添加依赖 spring-cloud-starter-alibaba-nacos-config，在配置中心（Nacos Server）中实现配置的动态刷新。</td><td></td><td></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="nacos-服务注册中心">Nacos 服务注册中心<a href="#nacos-服务注册中心" class="hash-link" aria-label="Direct link to Nacos 服务注册中心" title="Direct link to Nacos 服务注册中心">​</a></h2>
<p>Nacos 作为服务注册中心可以实现服务的注册与发现，流程如下图。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/1022563360-0.png" alt="Nacos 服务注册与发现" class="img_kGBN">
图1：Nacos 服务注册与发现</p>
<p>在图 1 中共涉及到以下 3 个角色：</p>
<ul>
<li>服务注册中心（Register Service）：它是一个 Nacos Server，可以为服务提供者和服务消费者提供服务注册和发现功能。</li>
<li>服务提供者（Provider Service）：它是一个 Nacos Client，用于对外服务。它将自己提供的服务注册到服务注册中心，以供服务消费者发现和调用。</li>
<li>服务消费者（Consumer Service）：它是一个 Nacos Client，用于消费服务。它可以从服务注册中心获取服务列表，调用所需的服务。</li>
</ul>
<p>Nacos 实现服务注册与发现的流程如下：</p>
<ol>
<li>从 Nacos 官方提供的下载页面中，下载 Nacos Server 并运行。</li>
<li>服务提供者 Nacos Client 启动  时，会把服务以服务名（spring.application.name）的方式注册到服务注册中心（Nacos Server）；</li>
<li>服务消费者 Nacos Client 启动时，也会将自己的服务注册到服务注册中心；</li>
<li>服务消费者在注册服务的同时，它还会从服务注册中心获取一份服务注册列表信息，该列表中包含了所有注册到服务注册中心上的服务的信息（包括服务提供者和自身的信息）；</li>
<li>在获取了服务提供者的信息后，服务消费者通过 HTTP 或消息中间件远程调用服务提供者提供的服务。</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="安装和运行-nacos-server">安装和运行 Nacos Server<a href="#安装和运行-nacos-server" class="hash-link" aria-label="Direct link to 安装和运行 Nacos Server" title="Direct link to 安装和运行 Nacos Server">​</a></h4>
<p>下面我们以 Nacos 2.0.3 为例，演示下如何安装和运行 Nacos Server，步骤如下。</p>
<p>1. 使用浏览器访问 <a href="https://github.com/alibaba/nacos/releases/tag/2.0.3" target="_blank" rel="noopener noreferrer">Nacos Server 下载页面</a>，并在页面最下方点击链接 nacos-server-2.0.3.zip，如下图。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/1022562c6-1.png" alt="Nacos 下载" class="img_kGBN">
图2：Nacos Server 下载</p>
<p>2. 下载完成后，解压 nacos-server-2.0.3.zip，目录结构如下。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/1022563922-2.png" alt="" class="img_kGBN">
图3：Nacos Server 目录结构</p>
<p>Nacos Server 下各目录说明如下：</p>
<ul>
<li>bin：用于存放 Nacos 的可执行命令。</li>
<li>conf：用于存放 Nacos 配置文件。</li>
<li>target：用于存放 Nacos 应用的 jar 包。</li>
</ul>
<p>3. 打开命令行窗口，跳转到 Nacos Server 安装目录的 bin 下，执行以下命令，以单机模式启动 Nacos Server。</p>
<p>startup.cmd -m standalone</p>
<p>4. Nacos Server 启动日志如下。</p>
<p>&quot;nacos is starting with standalone&quot;</p>
<p>,--.
,--.&#x27;|</p>
<p>,--,:  : |                                           Nacos 2.0.3
,<code>--.&#x27;</code>|  &#x27; :                       ,---.               Running in stand alone mode, All function modules
|   :  :  | |                      &#x27;   ,&#x27;\   .--.--.    Port: 8848
:   |   \ | :  ,--.--.     ,---.  /   /   | /  /    &#x27;   Pid: 27512
|   : &#x27;  &#x27;; | /       \   /     .   ; ,. :|  :  /<code>./   Console: http://192.168.3.138:8848/nacos/index.html &#x27;   &#x27; ;.    ;.--.  .-. | /    / &#x27;&#x27;   | |: :|  :  ;_ |   | | \   | \__\/: . ..    &#x27; / &#x27;   | .; : \  \    </code>.      <a href="https://nacos.io" target="_blank" rel="noopener noreferrer">https://nacos.io</a>
&#x27;   : |  ; .&#x27; ,&quot; .--.; |&#x27;   ; :__|   :    |  <code>----.   \ |   | &#x27;</code>--&#x27;  /  /  ,.  |&#x27;   | &#x27;.&#x27;|\   \  /  /  /<code>--&#x27;  / &#x27;   : |     ;  :   .&#x27;   \   :    : </code>----&#x27;  &#x27;--&#x27;.     /
;   |.&#x27;     |  ,     .-./\   \  /            <code>--&#x27;---&#x27; &#x27;---&#x27;        </code>--<code>---&#x27;     </code>----&#x27;</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:38,877 INFO Bean &#x27;org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler@5ab9b447&#x27; of type [org.springframework.security.access.expression.method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.DefaultMethodSecurityExpressionHandler] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:38,884 INFO Bean &#x27;methodSecurityMetadataSource&#x27; of type [org.springframework.security.access.method.DelegatingMethodSecurityMetadataSource] is not eligible for getting processed by al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">l BeanPostProcessors (for example: not eligible for auto-proxying)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:40,001 INFO Tomcat initialized with port(s): 8848 (http)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:40,713 INFO Root WebApplicationContext: initialization completed in 14868 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:52,351 INFO Initializing ExecutorService &#x27;applicationTaskExecutor&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:52,560 INFO Adding welcome page: class path resource [static/index.html]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:54,239 INFO Creating filter chain: Ant [pattern=&#x27;/**&#x27;], []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:54,344 INFO Creating filter chain: any request, [org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@7dd611c8, org.springframework.security.web.con</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">text.SecurityContextPersistenceFilter@5c7668ba, org.springframework.security.web.header.HeaderWriterFilter@fb713e7, org.springframework.security.web.csrf.CsrfFilter@6ec7bce0, org.springframework.secur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ity.web.authentication.logout.LogoutFilter@7d9ba6c, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@158f4cfe, org.springframework.security.web.servletapi.SecurityContextHolderAwa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reRequestFilter@6c6333cd, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5d425813, org.springframework.security.web.session.SessionManagementFilter@13741d5a, org.springf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ramework.security.web.access.ExceptionTranslationFilter@3727f0ee]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:54,948 INFO Initializing ExecutorService &#x27;taskScheduler&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:54,977 INFO Exposing 16 endpoint(s) beneath base path &#x27;/actuator&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:55,309 INFO Tomcat started on port(s): 8848 (http) with context path &#x27;/nacos&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-08 16:16:55,319 INFO Nacos started successfully in stand alone mode. use embedded storage</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5. 使用浏览器访问“<a href="http://localhost:8848/nacos%E2%80%9D%EF%BC%8C%E8%B7%B3%E8%BD%AC%E5%88%B0" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos”，跳转到</a> Nacos Server 登陆页面，如下图。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/1022562045-3.png" alt="Nacos 登陆页面" class="img_kGBN">
图4：Nacos Server 登陆页面</p>
<p>6. 在登陆页输入登录名和密码（默认都是 nacos），点击提交按钮，跳转到 Nacos Server 控制台主页，如下图。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225633C-4.png" alt="Nacos Server 主页" class="img_kGBN">
图5：Nacos Server 控制台</p>
<p>自此，我们就完成了 Nacos Server 的下载、安装和运行工作。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="搭建服务提供者">搭建服务提供者<a href="#搭建服务提供者" class="hash-link" aria-label="Direct link to 搭建服务提供者" title="Direct link to 搭建服务提供者">​</a></h4>
<p>接下来，我们来搭建一个服务提供者，步骤如下。</p>
<ol>
<li>创建一个名为 spring-cloud-alibaba-demo 的 Maven 工程 ，该工程的 pom.xml 内容如下。</li>
</ol>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;packaging&gt;pom&lt;/packaging&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spring-boot-starter-parent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;2.5.6&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spring-cloud-alibaba-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;junit.version&gt;4.12&lt;/junit.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;spring-cloud.version&gt;2020.0.4&lt;/spring-cloud.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependencyManagement&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;!--Spring Cloud Alibaba 的版本信息--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spring-cloud-alibaba-dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;version&gt;2021.1&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;type&gt;pom&lt;/type&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;scope&gt;import&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;!--Spring Cloud 的版本信息--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spring-cloud-dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;type&gt;pom&lt;/type&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;scope&gt;import&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependencyManagement&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/project&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>在该工程的 pom.xml 中，我们通过 dependencyManagement 对 Spring Cloud Alibaba 的版本信息进行管理，该工程下的各个子模块在引入 Spring Cloud Alibaba 的各个组件时就不要单独指定版本号了。</p>
</blockquote>
<p>2. 在 spring-cloud-alibaba-demo 下，创建一个名为 spring-cloud-alibaba-provider-8001 的 Spring Boot 模块，并在其 pom.xml 中添加以下依赖，内容如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;!--父工程--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spring-cloud-alibaba-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spring-cloud-alibaba-provider-8001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;spring-cloud-alibaba-provider-8001&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-starter-web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-devtools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;optional&gt;true&lt;/optional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lombok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;optional&gt;true&lt;/optional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-starter-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!--Spring Cloud Alibaba Nacos discovery --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-cloud-starter-alibaba-nacos-discovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;build&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spring-boot-maven-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;excludes&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;exclude&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            lombok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;/exclude&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;/excludes&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;/configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/build&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/project&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3. 在 spring-cloud-alibaba-provider-8001 的配置文件 application.properties 中添加以下配置，内容如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">#端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server.port=8001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#服务名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.application.name=spring-cloud-alibaba-provider</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Nacos Server 的地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">management.endpoints.web.exposure.include=*</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>4. 在 net.biacheng.c.controller 包下，创建一个名为 DeptController 的 Controller 类，代码如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">package net.biancheng.c.controller;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.GetMapping;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.PathVariable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RestController;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DeptController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;${server.port}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String serverPort;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(value = &quot;/dept/nacos/{id}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getPayment(@PathVariable(&quot;id&quot;) Integer id) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;&lt;h2&gt;c语言中文网提醒您，服务访问成功！&lt;/h2&gt;服务名：spring-cloud-alibaba-provider&lt;br /&gt; 端口号： &quot; + serverPort + &quot;&lt;br /&gt; 传入的参数：&quot; + id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5. 在 spring-cloud-alibaba-provider-8001 的主启动类上，使用 @EnableDiscoveryClient 注解开启 Nacos 服务发现功能，代码如下。</p>
<p>package net.biancheng.c;</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableDiscoveryClient //开启服务发现功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SpringCloudAlibabaProvider8001Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(SpringCloudAlibabaProvider8001Application.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>6. 启动 spring-cloud-alibaba-provider-8001，使用浏览器访问“<a href="http://localhost:8001/dept/nacos/1%E2%80%9D%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:8001/dept/nacos/1”，结果如下图。</a></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225C033-5.png" alt="访问服务提供者的服务" class="img_kGBN">
图6：服务提  供者</p>
<p>7. 使用浏览器访问“<a href="http://localhost:8848/nacos%E2%80%9D%EF%BC%8C%E6%9F%A5%E7%9C%8B%E2%80%9C%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E2%80%9D%E4%B8%8B%E7%9A%84%E2%80%9C%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8%E2%80%9D%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:8848/nacos”，查看“服务管理”下的“服务列表”，如下图。</a></p>
<p><a href="http://new-local.weixueyuan.net/uploads/allimg/211108/6-21110QJ12b02.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225Ab5-6.png" alt="Nacos 服务列表" class="img_kGBN"></a>
图7：服务注册列表</p>
<p>从图 7 可以看到，我们搭建的服务提供者 spring-cloud-alibaba-provider-8001 所提供的服务已经被注册到了 Nacos Server 上了。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="搭建服务消费者">搭建服务消费者<a href="#搭建服务消费者" class="hash-link" aria-label="Direct link to 搭建服务消费者" title="Direct link to 搭建服务消费者">​</a></h4>
<p>下面，我们就来搭建一个服务消费者来消费 spring-cloud-alibaba-provider-8001 提供的服务，步骤如下。</p>
<p>1. 在主工程 spring-cloud-alibaba-demo 下，创建一个名为 spring-cloud-alibaba-consumer-nacos-8801 的 Spring Boot 模块，并在其 pom.xml 中添加以下依赖。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spring-cloud-alibaba-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spring-cloud-alibaba-consumer-nacos-8081</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;spring-cloud-alibaba-consumer-nacos-8081&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!--SpringCloud ailibaba nacos discovery--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-cloud-starter-alibaba-nacos-discovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!--由于 Netflix Ribbon 进入停更维护阶段，因此新版本的 Nacos discovery 都已经移除了 Ribbon ，此时我们需要引入 loadbalancer 代替 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-cloud-loadbalancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-starter-web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-devtools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;optional&gt;true&lt;/optional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lombok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;optional&gt;true&lt;/optional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-starter-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;build&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spring-boot-maven-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;excludes&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;exclude&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            lombok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;/exclude&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;/excludes&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;/configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/build&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/project&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>注意：由于 Netflix Ribbon 已经进入停更维护状态，Nacos Discovery 已经停了对 Ribbon 的支持，因此我们需要在服务消费者的 pom.xml 中引入 spring-cloud-loadbalancer 才能调用服务提供者提供的服务。</p>
</blockquote>
<p>2. 在 spring-cloud-alibaba-consumer-nacos-8801 的配置文件 application.yml 中，添加以下配置。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 8801  #端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: spring-cloud-alibaba-consumer #服务名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cloud:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nacos:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      discovery:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server-addr: localhost:8848  #Nacos server 的地址</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>#以下配置信息并不是默认配置，而是我们自定义的配置，目的是不在 Controller 内硬编码服务提供者的服务名</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">service-url:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nacos-user-service: http://spring-cloud-alibaba-provider #服务提供者的服务名</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3. 在 spring-cloud-alibaba-consumer-nacos-8801 的主启动类上，使用 @EnableDiscoveryClient 注解开启服务发现功能，代码如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">package net.biancheng.c;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableDiscoveryClient // 开启服务注册与发现功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SpringCloudAlibabaConsumerNacos8801Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(SpringCloudAlibabaConsumerNacos8081Application.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>4. 在 net.biancheng.c.config 包下创建一个名为 ApplicationContextBean 的配置类，并使用 @LoadBalanced 注解与 Ribbon 进行集成开启负载均衡功能，代码如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">package net.biancheng.c.config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.client.RestTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApplicationContextBean {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @LoadBalanced //与 Ribbon 集成，并开启负载均衡功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RestTemplate getRestTemplate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new RestTemplate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5. 在 net.biancheng.c.controller 包下，创建一个名为 DeptController_Consumer 的 Controller 类，代码如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">package net.biancheng.c.controller;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.GetMapping;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.PathVariable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RestController;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.client.RestTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.annotation.Resource;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DeptController_Consumer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RestTemplate restTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;${service-url.nacos-user-service}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String serverURL; //服务提供者的服务名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/consumer/dept/nacos/{id}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String paymentInfo(@PathVariable(&quot;id&quot;) Long id) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return restTemplate.getForObject(serverURL + &quot;/dept/nacos/&quot; + id, String.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>6. 启动 spring-cloud-alibaba-consumer-nacos-8801，查看 Nacos Server 的服务列表，如下图。</p>
<p><a href="http://new-local.weixueyuan.net/uploads/allimg/211109/6-21110Z91435H1.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225621N-7.png" alt="服务消费者这 Nacos Server " class="img_kGBN"></a>
图8：服务消费者</p>
<p>7. 使用浏览器访问“<a href="http://localhost:8801/consumer/dept/nacos/1%E2%80%9D%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:8801/consumer/dept/nacos/1”，结果如下图。</a></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225B156-8.png" alt="Nacos 服务消费者消费服务" class="img_kGBN">
图9：服务消费者调用服务</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="nacos-配置中心">Nacos 配置中心<a href="#nacos-配置中心" class="hash-link" aria-label="Direct link to Nacos 配置中心" title="Direct link to Nacos 配置中心">​</a></h2>
<p>Nacos Server 还可以作为配置中心，对 Spring Cloud 应用的外部配置进行统一地集中化管理。而我们只需要在应用的 POM 文件中引入 spring-cloud-starter-alibaba-nacos-config 即可实现配置的获取与动态刷新。</p>
<p>从配置管理的角度看，Nacos 可以说是 Spring Cloud Config 的替代方案，但相比后者 Nacos 的使用更简单，操作步骤也更少。</p>
<p>接下来，我们通过一个实例来演示下 Nacos 是如何实现配置的统一管理和动态刷新的。</p>
<p>1. 在主工程 spring-cloud-alibaba-demo 下，创建一个名为 spring-cloud-alibaba-config-client-3377 的 Spring Boot 模块，并在其 pom.xml 中添加以下依赖。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spring-cloud-alibaba-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/parent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spring-cloud-alibaba-config-client-3377</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;name&gt;spring-cloud-alibaba-nacos-config-client-3377&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/properties&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-starter-web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!--SpringCloud2020及以后的版本默认不启用 bootstrap 配置，我们需要在pom里面显式地引入：--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-cloud-starter-bootstrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-devtools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;optional&gt;true&lt;/optional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lombok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;optional&gt;true&lt;/optional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-starter-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;scope&gt;test&lt;/scope&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!--Spring Cloud Alibaba Config 依赖--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-cloud-starter-alibaba-nacos-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!--SpringCloud ailibaba nacos 服务注册与发现模块 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-cloud-starter-alibaba-nacos-discovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;!--Spring Boot 监控模块--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            spring-boot-starter-actuator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;build&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                spring-boot-maven-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;excludes&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;exclude&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            lombok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;/exclude&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;/excludes&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;/configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;/plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/build&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/project&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>注意：我们使用的 Spring Cloud 2020 版本默认不启用 bootstrap，若想要在应用启动时加载 bootstrap 配置（例如 bootstrap.yml 或 bootstrap.properties），就需要我们在 pom.xml 中显式的引入 spring-cloud-starter-bootstrap 依赖。</p>
</blockquote>
<p>2. 在 spring-cloud-alibaba-config-client-3377 的类路径（例如 /resources 目录）下，添加一个 bootstrap.yml，配置内容如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 3377 #端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: config-client #服务名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cloud:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nacos:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      discovery:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server-addr: 127.0.0.1:8848 #Nacos服务注册中心地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server-addr: 127.0.0.1:8848 #Nacos作为配置中心地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        file-extension: yaml #指定yaml格式的配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3. 在 spring-cloud-alibaba-config-client-3377 的类路径（例如 /resources 目录）下，添加一个 application.yml，配置内容如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    active: dev #激活 dev 的配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>4. 在 net.biancheng.c.controller 包下，创建一个名为 ConfigClientController 的 Controller 类，并在该类上使用 @RefreshScope 注解实现配置的自动更新，代码如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">package net.biancheng.c.controller;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cloud.context.config.annotation.RefreshScope;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.GetMapping;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RestController;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RefreshScope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ConfigClientController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;${config.info}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String ConfigInfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/config/info&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getConfigInfo(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ConfigInfo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5. 在 spring-cloud-alibaba-config-client-3377 的主启动类上，使用 @EnableDiscoveryClient 注解开启服务发现功能，代码如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">package net.biancheng.c;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableDiscoveryClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SpringCloudAlibabaNacosConfigClient3377Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(SpringCloudAlibabaNacosConfigClient3377Application.class, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>6. 启动 Nacos Server，并在 Nacos Server 控制台的“配置管理”下的“配置列表”中，点击“+”按钮，新建如下配置。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">Data ID:        config-client-dev.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Group  :        DEFAULT_GROUP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">配置格式:        YAML</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">配置内容:      config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  info: c.biancheng.net</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 Nacos Server 中，配置的 dataId（即 Data ID）的完整格式如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">${prefix}-${spring.profiles.active}.${file-extension}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>dataId 格式中各参数说明如下：</p>
<ul>
<li><code>${prefix}</code>：默认取值为微服务的服务名，即配置文件中 spring.application.name 的值，我们可以在配置文件中通过配置 spring.cloud.nacos.config.prefix 来指定。</li>
<li><code>${spring.profiles.active}</code>：表示当前环境对应的 Profile，例如 dev、test、prod 等。当没有指定环境的 Profile 时，其对应的连接符也将不存在， dataId 的格式变成 <code>${prefix}.${file-extension}</code>。</li>
<li><code>${file-extension}</code>：表示配置内容的数据格式，我们可以在配置文件中通过配置项 spring.cloud.nacos.config.file-extension 来配置，例如 properties 和 yaml。</li>
</ul>
<p>7. 启动 spring-cloud-alibaba-config-client-3377，并使用浏览器访问“<a href="http://localhost:3377/config/info%E2%80%9D%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:3377/config/info”，结果如下图。</a></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225B3C-9.png" alt="Nacos Config" class="img_kGBN">
图10：Nacos Config</p>
<p>8. 在 Nacos Server 中，将 config-client-dev.yaml 中的配置修改成如下内容。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    info: this is c.biancheng.net</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>9. 在不重启 spring-cloud-alibaba-config-client-3377 的情况下，使用浏览器再次访问“<a href="http://localhost:3377/config/info%E2%80%9D%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:3377/config/info”，结果如下图。</a></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/1022563A7-10.png" alt="" class="img_kGBN">
图11：Nacos Cofig</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="nacos-server-集群化部署">Nacos Server 集群化部署<a href="#nacos-server-集群化部署" class="hash-link" aria-label="Direct link to Nacos Server 集群化部署" title="Direct link to Nacos Server 集群化部署">​</a></h2>
<p>在实际的项目开发中，一个微服务系统往往由十几，几十个甚至几百个微服务组成。 这些服务若全部注册到同一台 Nacos Server，就极有可能导致 Nacos Server 因为不堪重负而崩溃，最终导  致整个微服务系统瘫痪。解决这个问题最直接的办法就是使用 Nacos Server 集群。</p>
<p>Nacos Server 的集群化部署有一个十分明显的优点，那就是可以保障系统的高可用性。在集群化部署中，只要不是所有的 Nacos Server 都停止工作，Nacos Client 就还可以从集群中正常的 Nacos Server 上获取服务信息及配置，而不会导致系统的整体瘫痪，这就是 Nacos Server 集群化部署的高可用性。</p>
<p>下图展示了 Nacos Server 集群化部署的基本架构。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/1022563543-11.png" alt="Nacos Server 集群架构" class="img_kGBN">
图12：Nacos Server 集群架构</p>
<p>下面我们以 Windows 系统为例，演示如何部署 Nacos Server 集群。</p>
<p>1. 在 MySQL 中，新建一个名为 nacos_config 的数据库实例，并在该数据库下执行以下 SQL 语句。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   数据库全名 = nacos_config   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   表名称 = config_info   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `config_info` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `data_id` varchar(255) NOT NULL COMMENT &#x27;data_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `group_id` varchar(255) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `content` longtext NOT NULL COMMENT &#x27;content&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `md5` varchar(32) DEFAULT NULL COMMENT &#x27;md5&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;修改时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `src_user` text COMMENT &#x27;source user&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `src_ip` varchar(50) DEFAULT NULL COMMENT &#x27;source ip&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `app_name` varchar(128) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_id` varchar(128) DEFAULT &#x27;&#x27; COMMENT &#x27;租户字段&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `c_desc` varchar(256) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `c_use` varchar(64) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `effect` varchar(64) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `type` varchar(64) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `c_schema` text,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;config_info&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   数据库全名 = nacos_config   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   表名称 = config_info_aggr   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `config_info_aggr` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `data_id` varchar(255) NOT NULL COMMENT &#x27;data_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `group_id` varchar(255) NOT NULL COMMENT &#x27;group_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `datum_id` varchar(255) NOT NULL COMMENT &#x27;datum_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `content` longtext NOT NULL COMMENT &#x27;内容&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_modified` datetime NOT NULL COMMENT &#x27;修改时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `app_name` varchar(128) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_id` varchar(128) DEFAULT &#x27;&#x27; COMMENT &#x27;租户字段&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;增加租户字段&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   数据库全名 = nacos_config   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   表名称 = config_info_beta   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `config_info_beta` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `data_id` varchar(255) NOT NULL COMMENT &#x27;data_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `group_id` varchar(128) NOT NULL COMMENT &#x27;group_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `app_name` varchar(128) DEFAULT NULL COMMENT &#x27;app_name&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `content` longtext NOT NULL COMMENT &#x27;content&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `beta_ips` varchar(1024) DEFAULT NULL COMMENT &#x27;betaIps&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `md5` varchar(32) DEFAULT NULL COMMENT &#x27;md5&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;修改时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `src_user` text COMMENT &#x27;source user&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `src_ip` varchar(50) DEFAULT NULL COMMENT &#x27;source ip&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_id` varchar(128) DEFAULT &#x27;&#x27; COMMENT &#x27;租户字段&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;config_info_beta&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   数据库全名 = nacos_config   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   表名称 = config_info_tag   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `config_info_tag` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `data_id` varchar(255) NOT NULL COMMENT &#x27;data_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `group_id` varchar(128) NOT NULL COMMENT &#x27;group_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_id` varchar(128) DEFAULT &#x27;&#x27; COMMENT &#x27;tenant_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tag_id` varchar(128) NOT NULL COMMENT &#x27;tag_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `app_name` varchar(128) DEFAULT NULL COMMENT &#x27;app_name&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `content` longtext NOT NULL COMMENT &#x27;content&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `md5` varchar(32) DEFAULT NULL COMMENT &#x27;md5&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;修改时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `src_user` text COMMENT &#x27;source user&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `src_ip` varchar(50) DEFAULT NULL COMMENT &#x27;source ip&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;config_info_tag&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   数据库全名 = nacos_config   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   表名称 = config_tags_relation   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `config_tags_relation` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(20) NOT NULL COMMENT &#x27;id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tag_name` varchar(128) NOT NULL COMMENT &#x27;tag_name&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tag_type` varchar(64) DEFAULT NULL COMMENT &#x27;tag_type&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `data_id` varchar(255) NOT NULL COMMENT &#x27;data_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `group_id` varchar(128) NOT NULL COMMENT &#x27;group_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_id` varchar(128) DEFAULT &#x27;&#x27; COMMENT &#x27;tenant_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `nid` bigint(20) NOT NULL AUTO_INCREMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`nid`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KEY `idx_tenant_id` (`tenant_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;config_tag_relation&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   数据库全名 = nacos_config   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   表名称 = group_capacity   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `group_capacity` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `group_id` varchar(128) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;Group ID，空字符表示整个集群&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `quota` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;配额，0表示使用默认值&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `usage` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;使用量&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `max_size` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;单个配置大小上限，单位为字节，0表示使用默认值&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;聚合子配置最大个数，，0表示使用默认值&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `max_history_count` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;最大变更历史数量&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;修改时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UNIQUE KEY `uk_group_id` (`group_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;集群、各Group容量信息表&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   数据库全名 = nacos_config   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   表名称 = his_config_info   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `his_config_info` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(64) unsigned NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `data_id` varchar(255) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `group_id` varchar(128) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `app_name` varchar(128) DEFAULT NULL COMMENT &#x27;app_name&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `content` longtext NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `md5` varchar(32) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `src_user` text,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `src_ip` varchar(50) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `op_type` char(10) DEFAULT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_id` varchar(128) DEFAULT &#x27;&#x27; COMMENT &#x27;租户字段&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`nid`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KEY `idx_gmt_create` (`gmt_create`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KEY `idx_gmt_modified` (`gmt_modified`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KEY `idx_did` (`data_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;多租户改造&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   数据库全名 = nacos_config   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*   表名称 = tenant_capacity   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/******************************************/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `tenant_capacity` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_id` varchar(128) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;Tenant ID&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `quota` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;配额，0表示使用默认值&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `usage` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;使用量&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `max_size` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;单个配置大小上限，单位为字节，0表示使用默认值&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;聚合子配置最大个数&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `max_history_count` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;最大变更历史数量&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;修改时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UNIQUE KEY `uk_tenant_id` (`tenant_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;租户容量信息表&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `tenant_info` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `kp` varchar(128) NOT NULL COMMENT &#x27;kp&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_id` varchar(128) default &#x27;&#x27; COMMENT &#x27;tenant_id&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_name` varchar(128) default &#x27;&#x27; COMMENT &#x27;tenant_name&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `tenant_desc` varchar(256) DEFAULT NULL COMMENT &#x27;tenant_desc&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `create_source` varchar(32) DEFAULT NULL COMMENT &#x27;create_source&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_create` bigint(20) NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `gmt_modified` bigint(20) NOT NULL COMMENT &#x27;修改时间&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIMARY KEY (`id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KEY `idx_tenant_id` (`tenant_id`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#x27;tenant_info&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `users` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`username` varchar(50) NOT NULL PRIMARY KEY,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`password` varchar(500) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`enabled` boolean NOT NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `roles` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`username` varchar(50) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`role` varchar(50) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UNIQUE INDEX `idx_user_role` (`username` ASC, `role` ASC) USING BTREE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE TABLE `permissions` (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `role` varchar(50) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `resource` varchar(255) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `action` varchar(8) NOT NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UNIQUE INDEX `uk_role_permission` (`role`,`resource`,`action`) USING BTREE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO users (username, password, enabled) VALUES (&#x27;nacos&#x27;, &#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;, TRUE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSERT INTO roles (username, role) VALUES (&#x27;nacos&#x27;, &#x27;ROLE_ADMIN&#x27;);</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2. 在 Nacos Server 安装目录下的 conf 文件夹中，将 cluster.conf.example 重命名为 cluster.conf，然后在该文件中添加以下内容。</p>
<p>192.168.3.138:3333
192.168.3.138:4444
192.168.3.138:5555</p>
<p>配置说明如下：</p>
<ul>
<li>192.168.138 为本地电脑主机的 IP 地址，这里最好不要写成 localhost 或 127.0.0.1，否则 Nacos Server 集群可能会搭建失败！</li>
<li>本次搭建的 Nacos Server 集群的端口分别为：3333、4444、5555。</li>
</ul>
<p>3. 在 config 目录下的 application.properties 中，将 server.port（端口号）修改为 3333，并在该文件中添加 MySQL 数据库配置，具体修改内容如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">server.port=3333</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">################ MySQL 数据库配置##################</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring.datasource.platform=mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.num=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.user=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.password=root</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>4. 将该 Nacos Server 目录复制到另外两台机器上，并将它们的端口号分别修改为： 4444 和 5555。</p>
<p>5. 下载 Nginx，并修改 Nginx 中 conf 目录下的 nginx.conf 的配置，内容如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">#user  nobody;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_processes  1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#error_log  logs/error.log;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#error_log  logs/error.log  notice;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#error_log  logs/error.log  info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#pid        logs/nginx.pid;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">events {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker_connections  1024;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    include       mime.types;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default_type  application/octet-stream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sendfile        on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keepalive_timeout  65;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    upstream cluster{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server 127.0.0.1:3333;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server 127.0.0.1:4444;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server 127.0.0.1:5555;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen       1111;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name  localhost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #charset koi8-r;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #access_log  logs/host.access.log  main;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_pass http://cluster;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>6. 启动集群中所有的 Nacos Server，当出现以下内容时，表示 Nacos Server 启动成功。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;nacos is starting with cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ,--.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ,--.&#x27;|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ,--,:  : |                                           Nacos 2.0.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">,`--.&#x27;`|  &#x27; :                       ,---.               Running in cluster mode, All function modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   :  :  | |                      &#x27;   ,&#x27;\   .--.--.    Port: ****</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:   |   \ | :  ,--.--.     ,---.  /   /   | /  /    &#x27;   Pid: 21592</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   : &#x27;  &#x27;; | /       \   /     \.   ; ,. :|  :  /`./   Console: http://192.168.3.138:3333/nacos/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   &#x27; ;.    ;.--.  .-. | /    / &#x27;&#x27;   | |: :|  :  ;_</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   | | \   | \__\/: . ..    &#x27; / &#x27;   | .; : \  \    `.      https://nacos.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   : |  ; .&#x27; ,&quot; .--.; |&#x27;   ; :__|   :    |  `----.   \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   | &#x27;`--&#x27;  /  /  ,.  |&#x27;   | &#x27;.&#x27;|\   \  /  /  /`--&#x27;  /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;   : |     ;  :   .&#x27;   \   :    : `----&#x27;  &#x27;--&#x27;.     /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;   |.&#x27;     |  ,     .-./\   \  /            `--&#x27;---&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;---&#x27;        `--`---&#x27;     `----&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-09 16:25:00,993 INFO The server IP list of Nacos is [192.168.3.138:3333, 192.168.3.138:4444, 192.168.3.138:5555]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-09 16:27:07,318 INFO Nacos is starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-09 16:27:08,325 INFO Nacos is starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-09 16:27:09,340 INFO Nacos is starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-09 16:27:10,343 INFO Nacos is starting...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2021-11-09 16:27:10,742 INFO Nacos started successfully in cluster mode. use external storage</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>7. 当集群中的所有 Nacos Server 都启动成功后，双击 Nignx 安装目录下的 nginx.exe，启动 Nginx。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225BO0-12.png" alt="Nginx " class="img_kGBN">
图13：Nginx 启动脚本</p>
<p>8. 使用浏览器访问“<a href="http://localhost:1111/nacos/%E2%80%9D%EF%BC%8C%E8%8B%A5%E6%88%90%E5%8A%9F%E8%AE%BF%E9%97%AE" target="_blank" rel="noopener noreferrer">http://localhost:1111/nacos/”，若成功访问</a> Nacos Server 的控制台，则说明 Nacos 集群部署成功，如下图。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225C554-13.png" alt="" class="img_kGBN">
图14：Nacos 集群</p>
<p>9. 将主工程 spring-cloud-alibaba-demo 下所有子模块配置文件中的 Nacos Server 地址统一修改为：localhost:1111。我们以 spring-cloud-alibaba-consumer-nacos-8801 为例，配置文件 application.yml 的配置内容如下。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">server:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  port: 8801  #端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  application:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: spring-cloud-alibaba-consumer #服务名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cloud:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nacos:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      discovery:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #server-addr: localhost:8848  #单机版 Nacos Server 的地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server-addr: localhost:1111  #集群版 Nacos Server 的地址</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>#以下配置信息并不是默认配置，而是我们自定义的配置，目的是不在 Controller 内硬编码服务提供者的服务名</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">service-url:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nacos-user-service: http://spring-cloud-alibaba-provider #服务提供者的服务名</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>10. 重启 spring-cloud-alibaba-consumer-nacos-8801，并使用浏览器访问“<a href="http://localhost:1111/nacos%E2%80%9D%EF%BC%8C%E6%9F%A5%E7%9C%8B%E2%80%9C%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86%E2%80%9D%E4%B8%8B%E7%9A%84%E2%80%9C%E6%9C%8D%E5%8A%A1%E5%88%97%E8%A1%A8%E2%80%9D%EF%BC%8C%E7%BB%93%E6%9E%9C%E5%A6%82%E4%B8%8B%E5%9B%BE%E3%80%82" target="_blank" rel="noopener noreferrer">http://localhost:1111/nacos”，查看“服务管理”下的“服务列表”，结果如下图。</a></p>
<p><a href="http://new-local.weixueyuan.net/uploads/allimg/211109/6-2111091H412N8.png" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/10225A913-14.png" alt="Nacos 集群 2" class="img_kGBN"></a>
图15：服务注册到 Nacos Server 集群上</p>
<h1>参考文章</h1>
<p><a href="https://lijunyi.xyz/docs/SpringCloud/SpringCloud.html#_2-2-x-%E5%88%86%E6%94%AF" target="_blank" rel="noopener noreferrer">https://lijunyi.xyz/docs/SpringCloud/SpringCloud.html#_2-2-x-%E5%88%86%E6%94%AF</a>
<a href="https://mp.weixin.qq.com/s/2jeovmj77O9Ux96v3A0NtA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/2jeovmj77O9Ux96v3A0NtA</a>
<a href="https://juejin.cn/post/6931922457741770760" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6931922457741770760</a>
<a href="https://github.com/D2C-Cai/herring" target="_blank" rel="noopener noreferrer">https://github.com/D2C-Cai/herring</a>
<a href="http://c.biancheng.net/springcloud" target="_blank" rel="noopener noreferrer">http://c.biancheng.net/springcloud</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaNacos.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_EYjg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_eevz"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibaba概览"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SpringCloudAlibaba概览</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibabaRocketMQ"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SpringCloudAlibabaRocketMQ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lc2k thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#nacos-的特性" class="table-of-contents__link toc-highlight">Nacos 的特性</a></li><li><a href="#nacos-两大组件" class="table-of-contents__link toc-highlight">Nacos 两大组件</a></li><li><a href="#nacos-服务注册中心" class="table-of-contents__link toc-highlight">Nacos 服务注册中心</a></li><li><a href="#nacos-配置中心" class="table-of-contents__link toc-highlight">Nacos 配置中心</a></li><li><a href="#nacos-server-集群化部署" class="table-of-contents__link toc-highlight">Nacos Server 集群化部署</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>