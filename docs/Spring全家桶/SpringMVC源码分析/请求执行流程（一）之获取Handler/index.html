<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Spring全家桶/SpringMVC源码分析/请求执行流程（一）之获取Handler" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">请求执行流程（一）之获取Handler | Tommy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（一）之获取Handler"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="请求执行流程（一）之获取Handler | Tommy"><meta data-rh="true" name="description" content="上一篇文章我们分析 RequestMapping 初始化流程，本文将分析 spring mvc 的请求执行流程。"><meta data-rh="true" property="og:description" content="上一篇文章我们分析 RequestMapping 初始化流程，本文将分析 spring mvc 的请求执行流程。"><link data-rh="true" rel="icon" href="/code-note-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（一）之获取Handler"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（一）之获取Handler" hreflang="en"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（一）之获取Handler" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/code-note-blog/blog/rss.xml" title="Tommy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/code-note-blog/blog/atom.xml" title="Tommy Atom Feed"><link rel="stylesheet" href="/code-note-blog/assets/css/styles.dd5372db.css">
<script src="/code-note-blog/assets/js/runtime~main.f999fb27.js" defer="defer"></script>
<script src="/code-note-blog/assets/js/main.a0bfbaed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XYiV" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/code-note-blog/"><b class="navbar__title text--truncate">Tommy</b></a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Java/basic/抽象类和接口">java</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/JavaWeb/走进JavaWeb技术世界：JavaWeb的由来和基础知识">javaweb</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">cache</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/backend/后端技术杂谈：白话虚拟化技术">backend</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cs/algorithms/剑指offer">cs</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">database</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/distributed/basic/分布式系统理论基础 ：CAP">distributed</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/interview/BATJ-Experience/面阿里,终获offer">interview</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mq/kafka/消息队列kafka详解：如何实现死信队列">mq</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">spring</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mianshi/collection">面试</a><a href="https://aiden-coding.github.io/code-note-blog/SpringCloud%E7%AC%AC3%E5%AD%A32024.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_XbAW colorModeToggle_r5NY"><button class="clean-btn toggleButton_Jx0n toggleButtonDisabled_zYO7" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FjAw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qmEt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_wJfS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LABv"><div class="docsWrapper_pdvB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Jioa" type="button"></button><div class="docRoot_qx_v"><aside class="theme-doc-sidebar-container docSidebarContainer_NHKT"><div class="sidebarViewport_uyYB"><div class="sidebar_SZG4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VP_k"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">Spring</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/Spring源码分析/Spring源码剖析：初探SpringIOC核心流程">Spring源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot/给你一份SpringBoot知识清单">SpringBoot</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringBoot源码解析/SpringBoot启动流程（四）：启动IOC容器">SpringBoot源码解析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud/SpringCloudConsul">SpringCloud</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloud源码分析/SpringCloudConfig源码分析">SpringCloud源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba/SpringCloudAlibaba概览">SpringCloudAlibaba</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringCloudAlibaba源码分析/SpringCloudAlibabaNacos源码分析：服务发现">SpringCloudAlibaba源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/Spring全家桶/SpringMVC/SpringMVC常见注解">SpringMVC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（二）之执行Handler方法">SpringMVC源码分析</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（二）之执行Handler方法">请求执行流程（二）之执行Handler方法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（一）之获取Handler">请求执行流程（一）之获取Handler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/DispatcherServlet初始化流程">DispatcherServlet初始化流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源  码分析/RequestMapping初始化流程">RequestMapping初始化流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/Spring容器启动Tomcat">Spring容器启动Tomcat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/SpringMVC的Demo与@EnableWebMvc注解">SpringMVC的Demo与@EnableWebMvc注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/SpringMVC源码分析：消息转换器HttpMessageConverter与@ResponseBody注解">SpringMVC源码分析：消息转换器HttpMessageConverter与@ResponseBody注解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/SpringMVC源码分析：DispatcherServlet的初始化与请求转发">SpringMVC源码分析：DispatcherServlet的初始化与请求转发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/SpringMVC源码分析：DispatcherServlet如何找到正确的Controller">SpringMVC源码分析：DispatcherServlet如何找到正确的Controller</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/SpringMVC源码分析：SpringMVC的视图解析原理">SpringMVC源码分析：SpringMVC的视图解析原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/SpringMVC源码分析：SpringMVC概述">SpringMVC源码分析：SpringMVC概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/SpringMVC源码分析：SpringMVC设计理念与DispatcherServlet">SpringMVC源码分析：SpringMVC设计理念与DispatcherServlet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/SpringMVC整体源码结构总结">SpringMVC整体源码结构总结</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_SejT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_j3Yw"><div class="docItemContainer_XOSC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_F6gm" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/code-note-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YCxa"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">SpringMVC源码分析</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">请求执行流程（一）之获取Handler</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ToOY theme-doc-toc-mobile tocMobile_suYB"><button type="button" class="clean-btn tocCollapsibleButton_VzP_">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>请求执行流程（一）之获取Handler</h1></header><p>上一篇文章我们分析 <code>RequestMapping</code> 初始化流程，本文将分析 spring mvc 的请求执行流程。</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="1-请求的执行入口">1. 请求的执行入口<a href="#1-请求的执行入口" class="hash-link" aria-label="Direct link to 1. 请求的执行入口" title="Direct link to 1. 请求的执行入口">​</a></h3>
<p>在 <a href="https://my.oschina.net/funcy/blog/4710330" target="_blank" rel="noopener noreferrer" title="spring mvc之DispatcherServlet 初始化流程">spring mvc 之 DispatcherServlet 初始化流程</a>一文中，我们深入分析了向 <code>servlet</code> 容器添加了 <code>DispatcherServlet</code> 后，引发的一系列初始化流程，本文将继续围绕这个 <code>servlet</code> 分析 <code>springmvc</code> 的请求流程。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="11-回顾-servlet-的执行入口">1.1 回顾 servlet 的执行入口：<a href="#11-回顾-servlet-的执行入口" class="hash-link" aria-label="Direct link to 1.1 回顾 servlet 的执行入口：" title="Direct link to 1.1 回顾 servlet 的执行入口：">​</a></h4>
<p>在分析 <code>DispatcherServlet</code> 前首先要回顾下 servlet 的执行入口。</p>
<p>在我们实现自定义的 servlet 时，一般是实现 <code>HttpServlet</code>，然后重写 <code>doGet(xxx)</code>、<code>doPost()</code> 方法，而实际上 servlet 为 <code>HttpServlet#service(ServletRequest, ServletResponse)</code>：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class HttpServlet extends GenericServlet {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这个方法仅做了参数类型转换</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void service(ServletRequest req, ServletResponse res)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws ServletException, IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletRequest  request;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletResponse response;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 在这里处理参数的类型转换</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            request = (HttpServletRequest) req;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response = (HttpServletResponse) res;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (ClassCastException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new ServletException(lStrings.getString(&quot;http.non_http&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        service(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 在这里处理请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 从代码可以看到，这个类其实是做一个转发：判断请求方法，然后调用具体的方法执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void service(HttpServletRequest req, HttpServletResponse resp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws ServletException, IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String method = req.getMethod();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 判断的请求方法，然后找到对应的方法去执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (method.equals(METHOD_GET)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            long lastModified = getLastModified(req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (lastModified == -1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                doGet(req, resp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                doGet(req, resp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_HEAD)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            long lastModified = getLastModified(req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            maybeSetLastModified(resp, lastModified);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            doHead(req, resp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_POST)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            doPost(req, resp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_PUT)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            doPut(req, resp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_DELETE)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            doDelete(req, resp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_OPTIONS)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            doOptions(req,resp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (method.equals(METHOD_TRACE)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            doTrace(req,resp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 没有对应的方法，报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上是 servlet 源码，方法比较简单，重点部分都做了注释，这里有两个需要再次强调下：</p>
<ol>
<li>servlet 的执行入口为 <code>HttpServlet#service(ServletRequest, ServletResponse)</code>；</li>
<li><code>HttpServlet#service(HttpServletRequest, HttpServletResponse)</code> 方法会根据请求方法找到对应的处理方法执行，一般来说，我们自定义 servlet，只要重写 <code>doGet(xxx)</code>、<code>doPost(xxx)</code> 等方法即可。</li>
</ol>
<p>请求流程大概如下：</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-60d0e2afcbdb75a175c6f28471fc467f0e5.png" alt="" class="img_kGBN"></p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="12-dispatcherservlet-的父类frameworkservlet">1.2 <code>DispatcherServlet</code> 的父类：<code>FrameworkServlet</code><a href="#12-dispatcherservlet-的父类frameworkservlet" class="hash-link" aria-label="Direct link to 12-dispatcherservlet-的父类frameworkservlet" title="Direct link to 12-dispatcherservlet-的父类frameworkservlet">​</a></h4>
<p>了解完 servlet 的请求入口后，接下来就得分析一个不得不提的类了：<code>FrameworkServlet</code>。<code>FrameworkServlet</code> 是 <code>HttpServlet</code> 的子类，实现了 <code>HttpServlet</code> 的各种 <code>doXxx()</code>，同时也实现了 <code>service(HttpServletRequest, HttpServletResponse)</code>：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  FrameworkServlet继承了HttpServletBean，而HttpServletBean继承了HttpServlet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  因此FrameworkServlet也是HttpServlet的子类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class FrameworkServlet extends HttpServletBean implements ApplicationContextAware {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected final void doGet(HttpServletRequest request, HttpServletResponse response)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws ServletException, IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processRequest(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected final void doPost(HttpServletRequest request, HttpServletResponse response)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws ServletException, IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processRequest(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected final void doPut(HttpServletRequest request, HttpServletResponse response)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws ServletException, IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processRequest(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected final void doDelete(HttpServletRequest request, HttpServletResponse response)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws ServletException, IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processRequest(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void service(HttpServletRequest request, HttpServletResponse response)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws ServletException, IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpMethod httpMethod = HttpMethod.resolve(request.getMethod());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (httpMethod == HttpMethod.PATCH || httpMethod == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            processRequest(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // GET/POST/PUT/DELETE 等请求方法，还是会调用父类的方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            super.service(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，以上代码中，有一个方法的出镜率相当高：<code>FrameworkServlet#processRequest</code>，不管是 <code>doXxx(xxx)</code>，还是 <code>service(xxx)</code>，都会调用 <code>processRequest(xxx)</code>，接下来我们就来看看这个方法做了什么：</p>
<blockquote>
<p>FrameworkServlet#processRequest</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected final void processRequest(HttpServletRequest request, HttpServletResponse response)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws ServletException, IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 记录开始时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long startTime = System.currentTimeMillis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Throwable failureCause = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 记录当前线程的信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LocaleContext localeContext = buildLocaleContext(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ServletRequestAttributes requestAttributes = buildRequestAttributes(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            request, response, previousAttributes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             new RequestBindingInterceptor());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initContextHolders(request, localeContext, requestAttributes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 核心处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        doService(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (ServletException | IOException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        failureCause = ex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw ex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (Throwable ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        failureCause = ex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new NestedServletException(&quot;Request processing failed&quot;, ex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 清除线程绑定信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resetContextHolders(request, previousLocaleContext, previousAttributes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (requestAttributes != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            requestAttributes.requestCompleted();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logResult(request, response, failureCause, asyncManager);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 发送事件通知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publishRequestHandledEvent(request, response, startTime, failureCause);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个方法虽然有点长，但大部分与请求处理流程关系不大，与请求处理流程相关的只有几行：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 核心处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        doService(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (ServletException | IOException ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        failureCause = ex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw ex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由此可以看到，实际处理请求的方法是在 <code>FrameworkServlet#doService</code> 中。不过，<code>FrameworkServlet#doService</code> 是个抽象方法：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected abstract void doService(HttpServletRequest request, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletResponse response) throws Exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>真正的实现是在子类，也就是 <code>DispatcherServlet#doService</code> 中。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="13-dispatcherservletdoservice">1.3 <code>DispatcherServlet#doService</code><a href="#13-dispatcherservletdoservice" class="hash-link" aria-label="Direct link to 13-dispatcherservletdoservice" title="Direct link to 13-dispatcherservletdoservice">​</a></h4>
<p>来看看 <code>DispatcherServlet#doService</code> 做了啥事：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class DispatcherServlet extends FrameworkServlet {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void doService(HttpServletRequest request, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HttpServletResponse response) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logRequest(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 省略了一大段属性设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 具体的处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            doDispatch(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这人方法也没干什么事实，只是调用了一下 <code>doDispatch</code> 方法，然后就没了。事实上，<code>DispatcherServlet#doDispatch</code> 就是最终处理请求的逻辑，接下来我们重点分析这个方法 。</p>
<p>这一节我们来总结下 <code>DispatcherServlet</code> 的请求流程：</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-f854710c25924666cd5ab755c2983a9baf7.png" alt="" class="img_kGBN"></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="2-springmvc-请求分发dispatcherservletdodispatch">2. springmvc 请求分发：<code>DispatcherServlet#doDispatch</code><a href="#2-springmvc-请求分发dispatcherservletdodispatch" class="hash-link" aria-label="Direct link to 2-springmvc-请求分发dispatcherservletdodispatch" title="Direct link to 2-springmvc-请求分发dispatcherservletdodispatch">​</a></h3>
<p>上一节的最后，我们发现 springmvc 处理请求的方法是 <code>DispatcherServlet#doDispatch</code>，本节就从这个方法入手，看看这个方法的逻辑：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected void doDispatch(HttpServletRequest request, HttpServletResponse response) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HttpServletRequest processedRequest = request;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HandlerExecutionChain mappedHandler = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean multipartRequestParsed = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ModelAndView mv = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception dispatchException = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //如果是文件上传请求则进行特殊处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            processedRequest = checkMultipart(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            multipartRequestParsed = (processedRequest != request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 1\. 获取对应的handler, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Handler中包含真正地处理器（Controller中的方法）和一组HandlerInterceptor拦截器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mappedHandler = getHandler(processedRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (mappedHandler == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 如果没找到，报个404</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                noHandlerFound(processedRequest, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 2\. 获取对应的handlerAdapter，用来运行 handler(xxx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 处理last-modified情况</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String method = request.getMethod();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            boolean isGet = &quot;GET&quot;.equals(method);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (isGet || &quot;HEAD&quot;.equals(method)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                long lastModified = ha.getLastModified(request, mappedHandler.getHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 3\. 运行spring的拦截器, 运行 HandlerInterceptor#preHandle 方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!mappedHandler.applyPreHandle(processedRequest, response)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 4\. 通过上面获取到的handlerAdapter来调用handle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (asyncManager.isConcurrentHandlingStarted()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 如果函数调用没有返回视图则使用默认的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            applyDefaultViewName(processedRequest, mv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 5\. 执行拦截器，运行 HandlerInterceptor#postHandle 方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        catch (Exception ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatchException = ex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        catch (Throwable err) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dispatchException = new NestedServletException(&quot;Handler dispatch failed&quot;, err);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 6\. 处理返回结果，在这个方法里会渲染视图，以及执行 HandlerInterceptor#afterCompletion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    catch (...) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 这里会执行 HandlerInterceptor#afterCompletion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (asyncManager.isConcurrentHandlingStarted()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (mappedHandler != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 回调拦截器，执行方法 AsyncHandlerInterceptor#afterConcurrentHandlingStarted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (multipartRequestParsed) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                cleanupMultipart(processedRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个方法在点长，不过流程很清晰，springmvc 的整个请求流程都在这里了，这里把关键步骤展示如下：</p>
<ol>
<li>获取对应的 <code>HandlerExecutionChain</code>, 获取的 <code>HandlerExecutionChain</code> 中包含真正地处理器（<code>Controller</code> 中的方法）和一组 <code>HandlerInterceptor</code> 拦截器；</li>
<li>获取对应的 <code>handlerAdapter</code>，该对象用来运行 <code>handler(xxx)</code> 方法；</li>
<li>执行 spring 的拦截器，运行 <code>HandlerInterceptor#preHandle</code> 方法；</li>
<li>处理请求，也 就是通过上面获取到的 <code>handlerAdapter</code> 来调用 <code>handle(xxx)</code> 方法；</li>
<li>执行 spring 的拦截器，运行 <code>HandlerInterceptor#postHandle</code> 方法；</li>
<li>处理返回结果，这里会渲染视图，以及执行 spring 拦截器的 <code>HandlerInterceptor#afterCompletion</code>。</li>
</ol>
<p>总的流程梳理清楚了，接下来就是逐个流程分析了。</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="3-获取-handlerexecutionchain">3. 获取 <code>HandlerExecutionChain</code><a href="#3-获取-handlerexecutionchain" class="hash-link" aria-label="Direct link to 3-获取-handlerexecutionchain" title="Direct link to 3-获取-handlerexecutionchain">​</a></h3>
<p>获取 <code>HandlerExecutionChain</code> 的方法在 <code>DispatcherServlet#getHandler</code> 中：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (this.handlerMappings != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 遍历所有的handlerMapping，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 这里的 handlerMapping 是在WebMvcConfigurationSupport中引入的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (HandlerMapping mapping : this.handlerMappings) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 这里调用具体的handler，哪个handler能够处理就直接返回</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HandlerExecutionChain handler = mapping.getHandler(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (handler != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return handler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里的 <code>handlerMappings</code> 是在 <code>WebMvcConfigurationSupport</code> 中引入的，关于这一块的分析，可能参考 <a href="https://my.oschina.net/funcy/blog/4678093" target="_blank" rel="noopener noreferrer" title="springmvc demo 与 @EnableWebMvc 注解">springmvc demo 与 @EnableWebMvc 注解</a>一文，这  里来看看这个 <code>handlerMappings</code> 有些啥：</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-4465a638ca6c52f24f8c9343986be0bbee9.png" alt="" class="img_kGBN"></p>
<p>对于 <code>RequestMappingHandlerMapping</code> 相信大家已经很熟悉，对于 <code>@Controller</code>/<code>@RequestMapping</code> 方式实现的 <code>controller</code>，对应的 <code>HandlerMapping</code> 就是 <code>RequestMappingHandlerMapping</code>。至于另外的两个 <code>HandlerMapping</code>，则分别对应不同方式实现的 <code>controller</code>，关于这一点，感兴趣的小伙伴可以自行百度，这里就不展开了。</p>
<p>我们继续看 <code>AbstractHandlerMapping#getHandler</code> 方法：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public final HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1\. 调用具体的实现去获取handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object handler = getHandlerInternal(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果为空使用默认的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (handler == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handler = getDefaultHandler();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 没有默认的返回空</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (handler == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 尝试通过BeanName去获取handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (handler instanceof String) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String handlerName = (String) handler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handler = obtainApplicationContext().getBean(handlerName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2\. 获取 executionChain，其实就是找到 uri 对应的 Interceptors,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 然后与上面找到的handler一起封装到HandlerExecutionChain对象中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里的Interceptors，也是在WebMvcConfigurationSupport中配置的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HandlerExecutionChain executionChain = getHandlerExecutionChain(handler, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3\. 处理路域相关的配置：CorsHandlerExecutionChain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里可以看到，所谓的cors跨域配置，也是由拦截器实现的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (hasCorsConfigurationSource(handler)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CorsConfiguration config = (this.corsConfigurationSource != null </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ? this.corsConfigurationSource.getCorsConfiguration(request) : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CorsConfiguration handlerConfig = getCorsConfiguration(handler, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config = (config != null ? config.combine(handlerConfig) : handlerConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 将跨域相关的配置添加到 Interceptors，加到拦截器List的第一个中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executionChain = getCorsHandlerExecutionChain(request, executionChain, config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return executionChain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个方法主要做了三件事：</p>
<ol>
<li>调用具体的实现去获取 handler，这个方法是重点，下面会继续讲；</li>
<li>获取 <code>executionChain</code>，这个 <code>executionChain</code> 除了包含了上一步的 <code>handler</code> 外，还包含 <code>uri</code> 对应的 <code>Interceptors</code>，获取方法为获取所有的 <code>Interceptors</code> 配置（在 <code>WebMvcConfigurationSupport</code> 中配置的），再逐一判断 uri 是否符合 <code>Interceptor</code> 的 uri 配置；</li>
<li>获取 cors 跨域配置，然后添加到 <code>executionChain</code> 中的 <code>Interceptors</code> 列表的第一位。嗯，没错，cors 跨域配置也是在 <code>WebMvcConfigurationSupport</code> 中配置的。</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="31-查找-handlermethod">3.1 查找 <code>HandlerMethod</code><a href="#31-查找-handlermethod" class="hash-link" aria-label="Direct link to 31-查找-handlermethod" title="Direct link to 31-查找-handlermethod">​</a></h4>
<p>我们进入 <code>getHandlerInternal(xxx)</code> 方法：</p>
<blockquote>
<p>AbstractHandlerMethodMapping#getHandlerInternal</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected HandlerMethod getHandlerInternal(HttpServletRequest request) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取请求的url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String lookupPath = getUrlPathHelper().getLookupPathForRequest(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    request.setAttribute(LOOKUP_PATH, lookupPath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.mappingRegistry.acquireReadLock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 在这里查找uri对应的handlerMethod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HandlerMethod handlerMethod = lookupHandlerMethod(lookupPath, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果handlerMethod不为空，则重新创建一个HandlerMethod返回</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (handlerMethod != null ? handlerMethod.createWithResolvedBean() : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.mappingRegistry.releaseReadLock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里还是调用 <code>lookupHandlerMethod(xxx)</code> 来查找 <code>handlerMethod</code>，继续</p>
<blockquote>
<p>AbstractHandlerMethodMapping#lookupHandlerMethod</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected HandlerMethod lookupHandlerMethod(String lookupPath, HttpServletRequest request) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;Match&gt; matches = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 先从urlLookup中找，urlLookup是一个map，key是url，value是LinkedList&lt;RequestMappingInfo&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;T&gt; directPathMatches = this.mappingRegistry.getMappingsByUrl(lookupPath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (directPathMatches != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 由于返回的是一个 list，这里会把所有的匹配的结果放入一个matches中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addMatchingMappings(directPathMatches, matches, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (matches.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果通过url没找到，则遍历所有的 mappings 匹配，匹配类似于 /test/{name} 的url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // mappings也是一个map，key是RequestMappingInfo， value是HandlerMethod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addMatchingMappings(this.mappingRegistry.getMappings().keySet(), matches, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 找到最佳匹配的mapping,返回其对应的HandlerMethod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 比较规则来自于 RequestMappingInfo#compareTo方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!matches.isEmpty()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Comparator&lt;Match&gt; comparator = new MatchComparator(getMappingComparator(request));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        matches.sort(comparator);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Match bestMatch = matches.get(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (matches.size() &gt; 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (CorsUtils.isPreFlightRequest(request)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return PREFLIGHT_AMBIGUOUS_MATCH;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Match secondBestMatch = matches.get(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 找到了两个最佳匹配，抛出异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (comparator.compare(bestMatch, secondBestMatch) == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Method m1 = bestMatch.handlerMethod.getMethod();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Method m2 = secondBestMatch.     .,m.bvc .getMethod();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String uri = request.getRequestURI();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new IllegalStateException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }W</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request.setAttribute(BEST_MATCHING_HANDLER_ATTRIBUTE, bestMatch.handlerMethod);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handleMatch(bestMatch.mapping, lookupPath, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return bestMatch.handlerMethod;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return handleNoMatch(this.mappingRegistry.getMappings().keySet(), lookupPath, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个方法就是处理 handler 的获取了。这里的获取分为几个步骤：</p>
<ol>
<li>先从 <code>urlLookup</code> 中找，<code>urlLookup</code> 是一个 <code>map</code>，<code>key</code> 是 <code>url</code>，<code>value</code> 是 <code>LinkedList&lt;RequestMappingInfo&gt;</code>，这个操作就是 <code>map.get(xxx)</code> 方法；</li>
<li>如果通过 <code>url</code> 没找到，则遍历所有的 <code>mappings</code> 匹配，匹配类似于 <code>/test/{name}</code> 的 <code>url</code>，<code>mappings</code> 也是一个 <code>map</code>，<code>key</code> 是 <code>RequestMappingInfo</code>， <code>value</code> 是 <code>HandlerMethod</code>；</li>
<li>如果找到了多个 <code>HandlerMethod</code>，则根据 <code>RequestMappingInfo#compareTo</code> 方法提供的方法，找到最佳的 <code>RequestMappingInfo</code> 对应的 <code>HandlerMethod</code>。</li>
</ol>
<p>我们来看看在 <code>mappings</code> 里是如何找到匹配的 <code>RequestMappingInfo</code> 的：</p>
<blockquote>
<p>AbstractHandlerMethodMapping#addMatchingMappings</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">private void addMatchingMappings(Collection&lt;T&gt; mappings, List&lt;Match&gt; matches, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (T mapping : mappings) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 匹配其他条件，找到其中所有符合条件的 mappings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        T match = getMatchingMapping(mapping, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (match != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            matches.add(new Match(match, this.mappingRegistry.getMappings().get(mapping)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终发现匹配的处理是在 <code>RequestMappingInfo#getMatchingCondition</code> 方法中，<code>RequestMappingInfo</code> 还有一个 <code>compareTo</code> 方法，我们也一并查看下：</p>
<blockquote>
<p>RequestMappingInfo</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 匹配规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 会分别匹配 请求方法(get,post等)、请求参数、请求头等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public RequestMappingInfo getMatchingCondition(HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RequestMethodsRequestCondition methods = this.methodsCondition.getMatchingCondition(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (methods == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ParamsRequestCondition params = this.paramsCondition.getMatchingCondition(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (params == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HeadersRequestCondition headers = this.headersCondition.getMatchingCondition(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (headers == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ConsumesRequestCondition consumes = this.consumesCondition.getMatchingCondition(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (consumes == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProducesRequestCondition produces = this.producesCondition.getMatchingCondition(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (produces == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PatternsRequestCondition patterns = this.patternsCondition.getMatchingCondition(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (patterns == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RequestConditionHolder custom = this.customConditionHolder.getMatchingCondition(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (custom == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new RequestMappingInfo(this.name, patterns,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            methods, params, headers, consumes, produces, custom.getCondition());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 比较规则，找到最佳匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 会分别比较 请求方法(get,post等)、请求参数、请求头等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public int compareTo(RequestMappingInfo other, HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (HttpMethod.HEAD.matches(request.getMethod())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = this.methodsCondition.compareTo(other.getMethodsCondition(), request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (result != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result = this.patternsCondition.compareTo(other.getPatternsCondition(), request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result = this.paramsCondition.compareTo(other.getParamsCondition(), request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result = this.headersCondition.compareTo(other.getHeadersCondition(), request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result = this.consumesCondition.compareTo(other.getConsumesCondition(), request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result = this.producesCondition.compareTo(other.getProducesCondition(), request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result = this.methodsCondition.compareTo(other.getMethodsCondition(), request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result = this.customConditionHolder.compareTo(other.customConditionHolder, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>无论匹配，还是比较，都会对请求方法 (get,post 等)、请求参数、请求头等一一进行处理。</p>
<p>到这里，我们就明白了 springmvc 是如何找到 <code>HandlerMethod</code> 的了。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="32-查找-interceptors">3.2 查找 <code>Interceptors</code><a href="#32-查找-interceptors" class="hash-link" aria-label="Direct link to 32-查找-interceptors" title="Direct link to 32-查找-interceptors">​</a></h4>
<p>我们回到 <code>AbstractHandlerMapping#getHandler</code>，看看是如何获取 <code>Interceptor</code> 的：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public final HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2\. 获取 executionChain，其实就是找到 uri 对应的 Interceptors,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 然后与上面找到的handler一起封装到HandlerExecutionChain对象中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里的Interceptors，也是在WebMvcConfigurationSupport中配置的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HandlerExecutionChain executionChain = getHandlerExecutionChain(handler, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return executionChain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>进入 <code>getHandlerExecutionChain</code> 方法：</p>
<blockquote>
<p>AbstractHandlerMapping#getHandlerExecutionChain</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected HandlerExecutionChain getHandlerExecutionChain(Object handler, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HandlerExecutionChain chain = (handler instanceof HandlerExecutionChain ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (HandlerExecutionChain) handler : new HandlerExecutionChain(handler));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取当前的请求路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String lookupPath = this.urlPathHelper.getLookupPathForRequest(request, LOOKUP_PATH);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (HandlerInterceptor interceptor : this.adaptedInterceptors) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (interceptor instanceof MappedInterceptor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MappedInterceptor mappedInterceptor = (MappedInterceptor) interceptor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 判断当前请求路径是否满足interceptor里配置的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (mappedInterceptor.matches(lookupPath, this.pathMatcher)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                chain.addInterceptor(mappedInterceptor.getInterceptor());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            chain.addInterceptor(interceptor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return chain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个方法比较简单，相关内容已经在代码中做了注释，就不多说了 。</p>
<h4 class="anchor anchorWithStickyNavbar_HWLp" id="33-处理-cors-跨域配置">3.3 处理 cors 跨域配置<a href="#33-处理-cors-跨域配置" class="hash-link" aria-label="Direct link to 3.3 处理 cors 跨域配置" title="Direct link to 3.3 处理 cors 跨域配置">​</a></h4>
<p>我们再来看看跨域配置的处理：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public final HandlerExecutionChain getHandler(HttpServletRequest request) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 3\. 处理路域相关的配置：CorsHandlerExecutionChain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里可以  看到，所谓的cors跨域配置，也是由拦截器实现的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (hasCorsConfigurationSource(handler)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取跨域配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CorsConfiguration config = (this.corsConfigurationSource != null </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ? this.corsConfigurationSource.getCorsConfiguration(request) : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CorsConfiguration handlerConfig = getCorsConfiguration(handler, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config = (config != null ? config.combine(handlerConfig) : handlerConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 将跨域相关的配置添加到 Interceptors，加到拦截器List的第一个中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executionChain = getCorsHandlerExecutionChain(request, executionChain, config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return executionChain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>跨域相关配置也可以 <code>WebMvcConfigurationSupport</code> 中配置：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected void addCorsMappings(CorsRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>springmvc 获取到跨域配置后，会把相关配置添加到 <code>HandlerExecutionChain</code> 中：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain"># AbstractHandlerMapping#getCorsHandlerExecutionChain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected HandlerExecutionChain getCorsHandlerExecutionChain(HttpServletRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HandlerExecutionChain chain, @Nullable CorsConfiguration config) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (CorsUtils.isPreFlightRequest(request)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HandlerInterceptor[] interceptors = chain.getInterceptors();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chain = new HandlerExecutionChain(new PreFlightHandler(config), interceptors);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 添加到Interceptors的首位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        chain.addInterceptor(0, new CorsInterceptor(config));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return chain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># HandlerExecutionChain#addInterceptor(int, HandlerInterceptor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void addInterceptor(int index, HandlerInterceptor interceptor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 其实就是操作一个list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initInterceptorList().add(index, interceptor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 <code>HandlerExecutionChain</code> 中，有一个 <code>List</code> 用来存入 <code>Interceptor</code>，获取到的跨域配置，会添加到这个 <code>List</code> 的 <code>index=0</code> 的位置。</p>
<p>到这里，<code>handler</code> 就获取完成了，这个 <code>handler</code> 包含两部分：</p>
<ul>
<li><code>HandlerMethod</code>: 处理请求的方法，由于本文只分析 <code>@Controller</code> 方式的 controller，可以简单理解为有 <code>@RequestMapping</code> 注解的方法；</li>
<li><code>List&lt;Interceptor&gt;</code>: 拦截器链，如果有跨域配置，那么跨域配置会放在这个 List 的第一位。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="4-获取-handleradapter">4. 获取 <code>HandlerAdapter</code><a href="#4-获取-handleradapter" class="hash-link" aria-label="Direct link to 4-获取-handleradapter" title="Direct link to 4-获取-handleradapter">​</a></h3>
<p>再回到 <code>DispatcherServlet#doDispatch</code> 方法，我们来看看获取 <code>HandlerAdapter</code> 的方法：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected void doDispatch(HttpServletRequest request, HttpServletResponse response) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 2\. 获取对应的handlerAdapter，用来运行 handler(xxx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>进入 <code>getHandlerAdapter(xxx)</code> 方法：</p>
<blockquote>
<p>DispatcherServlet#getHandlerAdapter</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected HandlerAdapter getHandlerAdapter(Object handler) throws ServletException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // handlerAdapters 里的bean，也是由WebMvcConfigurationSupport引入的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (this.handlerAdapters != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (HandlerAdapter adapter : this.handlerAdapters) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 不同的handlerAdapter的判断方法不同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (adapter.supports(handler)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return adapter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new ServletException(...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，这里会找到当前所有的 <code>adapter</code>，然后遍历，逐个判断是否能处理当前的 <code>handler</code>，所有的 <code>adapter</code> 如下：</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/up-dedb2d58b9e99091aeb559f6c5a4aab4ccc.png" alt="" class="img_kGBN"></p>
<p>再来看看如何判断是否能处理当前的 <code>handler</code> 的，我们看其中一个 <code>handler</code>，进入 <code>AbstractHandlerMethodAdapter#supports</code> 方法：</p>
<blockquote>
<p>AbstractHandlerMethodAdapter#supports</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public final boolean supports(Object handler) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 判断handler是否为HandlerMethod的实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (handler instanceof HandlerMethod &amp;&amp; supportsInternal((HandlerMethod) handler));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里仅做了一个简单的判断，然后再调用 <code>supportsInternal</code> 方法，继续：</p>
<blockquote>
<p>RequestMappingHandlerAdapter#supportsInternal</p>
</blockquote>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">protected boolean supportsInternal(HandlerMethod handlerMethod) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个方法直接返回 true, 由于可见，如果 <code>handler</code> 的实例是 <code>HandlerMethod</code>，那么就会返回 <code>RequestMappingHandlerAdapter</code>.</p>
<p>这一步找到的 <code>adapter</code> 为 <code>RequestMappingHandlerAdapter</code>，这个 <code>adapter</code> 有什么用呢？限于篇幅，本文就先到这里了，剩下的流程下篇文章继续分析。</p>
<hr>
<p><em>本文原文链接：<a href="https://my.oschina.net/funcy/blog/4717420" target="_blank" rel="noopener noreferrer">https://my.oschina.net/funcy/blog/4717420</a> ，限于作者个人水平，文中难免有错误之处，欢迎指正！原创不易，商业转载请联系作者获得授权，非商业转载请注明出处。</em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（一）之获取Handler.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_EYjg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_eevz"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/请求执行流程（二）之执行Handler方法"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">请求执行流程（二）之执行Handler方法</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/code-note-blog/docs/Spring全家桶/SpringMVC源码分析/DispatcherServlet初始化流程"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DispatcherServlet初始化流程</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lc2k thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-请求的执行入口" class="table-of-contents__link toc-highlight">1. 请求的执行入口</a></li><li><a href="#2-springmvc-请求分发dispatcherservletdodispatch" class="table-of-contents__link toc-highlight">2. springmvc 请求分发：<code>DispatcherServlet#doDispatch</code></a></li><li><a href="#3-获取-handlerexecutionchain" class="table-of-contents__link toc-highlight">3. 获取 <code>HandlerExecutionChain</code></a></li><li><a href="#4-获取-handleradapter" class="table-of-contents__link toc-highlight">4. 获取 <code>HandlerAdapter</code></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>