<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cache/探索Redis设计与实现：数据库redisDb与键过期删除策略" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">探索Redis设计与实现：数据库redisDb与键过期删除策略 | Tommy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aiden-coding.github.io/code-note-blog/docs/cache/探索Redis设计与实现：数据库redisDb与键过期删除策略"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="探索Redis设计与实现：数据库redisDb与键过期删除策略 | Tommy"><meta data-rh="true" name="description" content="本文转自互联网"><meta data-rh="true" property="og:description" content="本文转自互联网"><link data-rh="true" rel="icon" href="/code-note-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aiden-coding.github.io/code-note-blog/docs/cache/探索Redis设计与实现：数据库redisDb与键过期删除策略"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/cache/探索Redis设计与实现：数据库redisDb与键过期删除策略" hreflang="en"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/cache/探索Redis设计与实现：数据库redisDb与键过期删除策略" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/code-note-blog/blog/rss.xml" title="Tommy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/code-note-blog/blog/atom.xml" title="Tommy Atom Feed"><link rel="stylesheet" href="/code-note-blog/assets/css/styles.dd5372db.css">
<script src="/code-note-blog/assets/js/runtime~main.f999fb27.js" defer="defer"></script>
<script src="/code-note-blog/assets/js/main.a0bfbaed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XYiV" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/code-note-blog/"><b class="navbar__title text--truncate">Tommy</b></a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Java/basic/抽象类和接口">java</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/JavaWeb/走进JavaWeb技术世界：JavaWeb的由来和基础知识">javaweb</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">cache</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/backend/后端技术杂谈：白话虚拟化技术">backend</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cs/algorithms/剑指offer">cs</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">database</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/distributed/basic/分布式系统理论基础 ：CAP">distributed</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/interview/BATJ-Experience/面阿里,终获offer">interview</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mq/kafka/消息队列kafka详解：如何实现死信队列">mq</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">spring</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mianshi/collection">面试</a><a href="https://aiden-coding.github.io/code-note-blog/SpringCloud%E7%AC%AC3%E5%AD%A32024.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_XbAW colorModeToggle_r5NY"><button class="clean-btn toggleButton_Jx0n toggleButtonDisabled_zYO7" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FjAw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qmEt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_wJfS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LABv"><div class="docsWrapper_pdvB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Jioa" type="button"></button><div class="docRoot_qx_v"><aside class="theme-doc-sidebar-container docSidebarContainer_NHKT"><div class="sidebarViewport_uyYB"><div class="sidebar_SZG4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VP_k"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">探索Redis设计与实现：连接底层与表面的数据结构robj</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：浅析Redis主从复制">探索Redis设计与实现：浅析Redis主从复制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：使用快照和AOF将Redis数据持久化到硬盘中">探索Redis设计与实现：使用快照和AOF将Redis数据持久化到硬盘中</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/code-note-blog/docs/cache/探索Redis设计与实现：数据库redisDb与键过期删除策略">探索Redis设计与实现：数据库redisDb与键过期删除策略</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis 的基础数据结构概览">探索Redis设计与实现：Redis 的基础数据结构概览</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis的事件驱动模型与命令执行过程">探索Redis设计与实现：Redis的事件驱动模型与命令执行过程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis分布式锁进化史">探索Redis设计与实现：Redis分布式锁进化史</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis集群机制及一个Redis架构演进实例">探索Redis设计与实现：Redis集群机制及一个Redis架构演进实例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis内部数据结构详解——dict">探索Redis设计与实现：Redis内部数据结构详解——dict</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis内部数据结构详解——intset">探索Redis设计与实现：Redis内部数据结构详解——intset</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis内部数据结构详解——quicklist">探索Redis设计与实现：Redis内部数据结构详解——quicklist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis内部数据结构详解——sds">探索Redis设计与实现：Redis内部数据结构详解——sds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis内部数据结构详解——skiplist">探索Redis设计与实现：Redis内部数据结构详解——skiplist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis内部数据结构详解——ziplist">探索Redis设计与实现：Redis内部数据结构详解——ziplist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis事务浅析与ACID特性介绍">探索Redis设计与实现：Redis事务浅析与ACID特性介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/探索Redis设计与实现开篇：什么是Redis">探索Redis设计与实现开篇：什么是Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/cache/Redis原理与实践总结">Redis原理与实践总结</a></li></ul></nav></div></div></aside><main class="docMainContainer_SejT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_j3Yw"><div class="docItemContainer_XOSC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_F6gm" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/code-note-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YCxa"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">探索Redis设计与实现：数据库redisDb与键过期删除策略</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ToOY theme-doc-toc-mobile tocMobile_suYB"><button type="button" class="clean-btn tocCollapsibleButton_VzP_">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>探索Redis设计与实现：数据库redisDb与键过期删除策略</h1></header><p>本文转自互联网
本文将整理到我在GitHub上的《Java面试指南》仓库，更多精彩内容请到我的仓库里查看</p>
<blockquote>
<p><a href="https://github.com/h2pl/Java-Tutorial" target="_blank" rel="noopener noreferrer">https://github.com/h2pl/Java-Tutorial</a></p>
</blockquote>
<p>喜欢的话麻烦点下Star哈</p>
<p>本文部分内容来源于网络，为了把本文主题讲得清晰透彻，也整合了很多我认为不错的技术博客内容，引用其中了一些比较好的博客文章，如有侵权，请联系作者。</p>
<p>该系列博文会告诉你如何从入门到进阶，Redis基本的使用方法，Redis的基本数据结构，以及一些进阶的使用方法，同时也需要进一步了解Redis的底层数据结构，再接着，还会带来Redis主从复制、集群、分布式锁等方面的相关内容，以及作为缓存的一些使用方法和注意事项，以便让你更完整地了解整个Redis相关的技术体系，形成自己的知识框架。</p>
<p>如果对本系列文章有什么建议，或者是有什么疑问的话，也可以关注公众号【Java技术江湖】联系作者，欢迎你参与本系列博文的创作和修订。</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="一-数据库">一. 数据库<a href="#一-数据库" class="hash-link" aria-label="Direct link to 一. 数据库" title="Direct link to 一. 数据库">​</a></h2>
<p>Redis的数据库使用字典作为底层实现，数据库的增、删、查、改都是构建在字典的操作之上的。
redis服务器将所有数据库都保存在服务器状态结构redisServer(redis.h/redisServer)的db数组（应该是一个链表）里：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    struct redisServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      //..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 数据库数组，保存着服务器中所有的数据库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        redisDb *db;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      //..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在初始化服务器时，程序会根据服务器状态的dbnum属性来决定应该创建多少个数据库：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    struct redisServer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //服务器中数据库的数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int dbnum;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>dbnum属性的值是由服务器配置的database选项决定的，默认值为16；</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="二切换数据库原理">二、切换数据库原理<a href="#二切换数据库原理" class="hash-link" aria-label="Direct link to 二、切换数据库原理" title="Direct link to 二、切换数据库原理">​</a></h2>
<p>每个Redis客户端都有自己的目标数据库，每当客户端执行数据库的读写命令时，目标数据库就会成为这些命令的操作对象。</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    127.0.0.1:6379&gt; set msg &#x27;Hello world&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    127.0.0.1:6379&gt; get msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Hello world&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    127.0.0.1:6379&gt; select 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    127.0.0.1:6379[2]&gt; get msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    127.0.0.1:6379[2]&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在服务器内部，客户端状态redisClient结构(redis.h/redisClient)的db属性记录了客户端当前的目标数据库，这个属性是一个指向redisDb结构(redis.h/redisDb)的指针：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    typedef struct redisClient {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 客户端当前正在使用的数据库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        redisDb *db;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } redisClient;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>redisClient.db指针指向redisServer.db数组中的一个元素，而被指向的元素就是当前客户端的目标数据库。
我们就可以通过修改redisClient指针，让他指向服务器中的不同数据库，从而实现切换数据库的功能–这就是select命令的实现原理。
实现代码：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    int selectDb(redisClient *c, int id) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 确保 id 在正确范围内</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (id &lt; 0 || id &gt;= server.dbnum)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return REDIS_ERR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 切换数据库（更新指针）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c-&gt;db = &amp;server.db[id];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return REDIS_OK;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="三数据库的键空间">三、数据库的键空间<a href="#三数据库的键空间" class="hash-link" aria-label="Direct link to 三、数据库的键空间" title="Direct link to 三、数据库的键空间">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="1数据库的结构我们只分析键空间和键过期时间">1、数据库的结构（我们只分析键空间和键过期时间）<a href="#1数据库的结构我们只分析键空间和键过期时间" class="hash-link" aria-label="Direct link to 1、数据库的结构（我们只分析键空间和键过期时间）" title="Direct link to 1、数据库的结构（我们只分析键空间和键过期时间）">​</a></h3>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    typedef struct redisDb {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 数据库键空间，保存着数据库中的所有键值对</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dict *dict;                 /* The keyspace for this DB */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 键的过期时间，字典的键为键，字典的值为过期事件 UNIX 时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dict *expires;              /* Timeout of keys with a timeout set */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 数据库号码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int id;                     /* Database ID */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 数据库的键的平均 TTL ，统计信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long long avg_ttl;          /* Average TTL, just for stats */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } redisDb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上图是一个RedisDb的示例，该数据库存放有五个键值对，分别是sRedis，INums，hBooks，SortNum和sNums，它们各自都有自己的值对象，另外，其中有三个键设置了过期时间，当前数据库是服务器的第0号数据库。现在，我们就从源码角度分析这个数据库结构：
我们知道，Redis是一个键值对数据库服务器，服务器中的每一个数据库都是一个redis.h/redisDb结构，其中，结构中的dict字典保存了数据库中所有的键值对，我们就将这个字典成为键空间。
Redis数据库的数据都是以键值对的形式存在，其充分利用了字典高效索引的特点。
a、键空间的键就是数据库中的键，一般都是字符串对象；
b、键空间的值就是数据库中的值，可以是5种类型对象（字符串、列表、哈希、集合和有序集合）之一。
数据库的键空间结构分析完了，我们先看看数据库的初始化。</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="2键空间的初始化">2、键空间的初始化<a href="#2键空间的初始化" class="hash-link" aria-label="Direct link to 2、键空间的初始化" title="Direct link to 2、键空间的初始化">​</a></h3>
<p>在redis.c中，我们可以找到键空间的初始化操作：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    //创建并初始化数据库结构</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     for (j = 0; j &lt; server.dbnum; j++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 创建每个数据库的键空间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server.db[j].dict = dictCreate(&amp;dbDictType,NULL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 设定当前数据库的编号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server.db[j].id = j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>初始化之后就是对键空间的操作了。</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="3键空间的操作">3、键空间的操作<a href="#3键空间的操作" class="hash-link" aria-label="Direct link to 3、键空间的操作" title="Direct link to 3、键空间的操作">​</a></h3>
<p>我先把一些常见的键空间操作函数列出来：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">    // 从数据库中取出键key的值对象，若不存在就返回NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    robj *lookupKey(redisDb *db, robj *key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 先删除过期键，以读操作的方式从数据库中取出指定键对应的值对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 并根据是否成功找到值，更新服务器的命中或不命中信息,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 如不存在则返回NULL，底层调用lookupKey函数 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    robj *lookupKeyRead(redisDb *db, robj *key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 先删除过期键，以写操作的方式从数据库中取出指定键对应的值对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 如不存在则返回NULL，底层调用lookupKey函数，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 不会更新服务器的命中或不命中信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    robj *lookupKeyWrite(redisDb *db, robj *key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 先删除过期键，以读操作的方式从数据库中取出指定键对应的值对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 如不存在则返回NULL，底层调用lookupKeyRead函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 此操作需要向客户端回复</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    robj *lookupKeyReadOrReply(redisClient *c, robj *key, robj *reply);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 先删除过期键，以写操作的方式从数据库中取出指定键对应的值对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 如不存在则返回NULL，底层调用lookupKeyWrite函数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 此操作需要向客户端回复</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    robj *lookupKeyWriteOrReply(redisClient *c, robj *key, robj *reply);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 添加元素到指定数据库 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void dbAdd(redisDb *db, robj *key, robj *val);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 重写指定键的值 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void dbOverwrite(redisDb *db, robj *key, robj *val);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 设定指定键的值 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void setKey(redisDb *db, robj *key, robj *val);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 判断指定键是否存在 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int dbExists(redisDb *db, robj *key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 随机返回数据库中的键 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    robj *dbRandomKey(redisDb *db);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 删除指定键 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int dbDelete(redisDb *db, robj *key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 清空所有数据库，返回键值对的个数 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long long emptyDb(void(callback)(void*));</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>下面我选取几个比较典型的操作函数分析一下：</p>
<p>查找键值对函数–lookupKey</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">robj *lookupKey(redisDb *db, robj *key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找键空间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dictEntry *de = dictFind(db-&gt;dict,key-&gt;ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 节点存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (de) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 取出该键对应的值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        robj *val = dictGetVal(de);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 更新时间信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (server.rdb_child_pid == -1 &amp;&amp; server.aof_child_pid == -1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            val-&gt;lru = LRU_CLOCK();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 返回值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return val;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 节点不存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>添加键值对–dbAdd
添加键值对使我们经常使用到的函数，底层由dbAdd()函数实现，传入的参数是待添加的数据库，键对象和值对象，源码如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">void dbAdd(redisDb *db, robj *key, robj *val) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 复制键名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sds copy = sdsdup(key-&gt;ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 尝试添加键值对</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int retval = dictAdd(db-&gt;dict, copy, val);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果键已经存在，那么停止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    redisAssertWithInfo(NULL,key,retval == REDIS_OK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果开启了集群模式，那么将键保存到槽里面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (server.cluster_enabled) slotToKeyAdd(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>好了，关于键空间操作函数就分析到这，其他函数(在文件db.c中)大家可以自己去分析，有问题的话可以回帖，我们可以一起讨论！</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="四数据库的过期键操作">四、数据库的过期键操作<a href="#四数据库的过期键操作" class="hash-link" aria-label="Direct link to 四、数据库的过期键操作" title="Direct link to 四、数据库的过期键操作">​</a></h2>
<p>在前面我们说到，redisDb结构中有一个expires指针（概况图可以看上图），该指针指向一个字典结构，字典中保存了所有键的过期时间，该字典称为过期字典。
过期字典的初始化：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">// 创建并初始化数据库结构</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> for (j = 0; j &lt; server.dbnum; j++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 创建每个数据库的过期时间字典</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server.db[j].expires = dictCreate(&amp;keyptrDictType,NULL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 设定当前数据库的编号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server.db[j].id = j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>a、过期字典的键是一个指针，指向键空间中的某一个键对象（就是某一个数据库键）；
b、过期字典的值是一个long long类型的整数，这个整数保存了键所指向的数据库键的时间戳–一个毫秒精度的unix时间戳。
下面我们就来分析过期键的处理函数：</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="1过期键处理函数">1、过期键处理函数<a href="#1过期键处理函数" class="hash-link" aria-label="Direct link to 1、过期键处理函数" title="Direct link to 1、过期键处理函数">​</a></h3>
<p>设置键的过期时间–setExpire()</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 将键 key 的过期时间设为 when</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void setExpire(redisDb *db, robj *key, long long when) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dictEntry *kde, *de;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 从键空间中取出键key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kde = dictFind(db-&gt;dict,key-&gt;ptr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果键空间找不到该键，报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    redisAssertWithInfo(NULL,key,kde != NULL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 向过期字典中添加该键</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    de = dictReplaceRaw(db-&gt;expires,dictGetKey(kde));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 设置键的过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 这里是直接使用整数值来保存过期时间，不是用 INT 编码的 String 对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dictSetSignedIntegerVal(de,when);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>获取键的过期时间–getExpire()</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">long long getExpire(redisDb *db, robj *key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dictEntry *de;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果过期键不存在，那么直接返回</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (dictSize(db-&gt;expires) == 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (de = dictFind(db-&gt;expires,key-&gt;ptr)) == NULL) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    redisAssertWithInfo(NULL,key,dictFind(db-&gt;dict,key-&gt;ptr) != NULL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 返回过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return dictGetSignedIntegerVal(de);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>删除键的过期时间–removeExpire()</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">// 移除键 key 的过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int removeExpire(redisDb *db, robj *key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 确保键带有过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    redisAssertWithInfo(NULL,key,dictFind(db-&gt;dict,key-&gt;ptr) != NULL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 删除过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return dictDelete(db-&gt;expires,key-&gt;ptr) == DICT_OK;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="2过期键删除策略">2、过期键删除策略<a href="#2过期键删除策略" class="hash-link" aria-label="Direct link to 2、过期键删除策略" title="Direct link to 2、过期键删除策略">​</a></h3>
<p>通过前面的介绍，大家应该都知道数据库键的过期时间都保存在过期字典里，那假如一个键过期了，那么这个过期键是什么时候被删除的呢？现在来看看redis的过期键的删除策略：
a、定时删除：在设置键的过期时间的同时，创建一个定时器，在定时结束的时候，将该键删除；
b、惰性删除：放任键过期不管，在访问该键的时候，判断该键的过期时间是否已经到了，如果过期时间已经到了，就执行删除操作；
c、定期删除：每隔一段时间，对数据库中的键进行一次遍历，删除过期的键。
其中定时删除可以及时删除数据库中的 过期键，并释放过期键所占用的内存，但是它为每一个设置了过期时间的键都开了一个定时器，使的cpu的负载变高，会对服务器的响应时间和吞吐量造成影响。
惰性删除有效的克服了定时删除对CPU的影响，但是，如果一个过期键很长时间没有被访问到，且若存在大量这种过期键时，势必会占用很大的内存空间，导致内存消耗过大。
定时删除可以算是上述两种策略的折中。设定一个定时器，每隔一段时间遍历数据库，删除其中的过期键，有效的缓解了定时删除对CPU的占用以及惰性删除对内存的占用。
在实际应用中，Redis采用了惰性删除和定时删除两种策略来对过期键进行处理，上面提到的lookupKeyWrite等函数中就利用到了惰性删除策略，定时删除策略则是在根据服务器的例行处理程序serverCron来执行删除操作，该程序每100ms调用一次。</p>
<p>惰性删除函数–expireIfNeeded()
源码如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/* 检查key是否已经过期，如果是的话，将它从数据库中删除 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 并将删除命令写入AOF文件以及附属节点(主从复制和AOF持久化相关)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 返回0代表该键还没有过期，或者没有设置过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 返回1代表该键因为过期而被删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int expireIfNeeded(redisDb *db, robj *key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取该键的过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mstime_t when = getExpire(db,key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mstime_t now;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 该键没有设定过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (when &lt; 0) return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 服务器正在加载数据的时候，不要处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (server.loading) return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // lua脚本相关</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    now = server.lua_caller ? server.lua_time_start : mstime();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 主从复制相关，附属节点不主动删除key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (server.masterhost != NULL) return now &gt; when;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 该键还没有过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (now &lt;= when) return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 删除过期键</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server.stat_expiredkeys++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 将删除命令传播到AOF文件和附属节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    propagateExpire(db,key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 发送键空间操作时间通知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    notifyKeyspaceEvent(NOTIFY_EXPIRED,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;expired&quot;,key,db-&gt;id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 将该键从数据库中删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return dbDelete(db,key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>定期删除策略
过期键的定期删除策略由redis.c/activeExpireCycle()函数实现，服务器周期性地操作redis.c/serverCron()（每隔100ms执行一次）时，会调用activeExpireCycle()函数，分多次遍历服务器中的各个数据库，从数据库中的expires字典中随机检查一部分键的过期时间，并删除其中的  过期键。
删除过期键的操作由activeExpireCycleTryExpire函数(activeExpireCycle()调用了该函数)执行，其源码如下：</p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">/* 检查键的过期时间，如过期直接删除*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int activeExpireCycleTryExpire(redisDb *db, dictEntry *de, long long now) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long long t = dictGetSignedIntegerVal(de);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (now &gt; t) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 执行到此说明过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 创建该键的副本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sds key = dictGetKey(de);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        robj *keyobj = createStringObject(key,sdslen(key));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 将删除命令传播到AOF和附属节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        propagateExpire(db,keyobj);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 在数据库中删除该键</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dbDelete(db,keyobj);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 发送事件通知</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        notifyKeyspaceEvent(NOTIFY_EXPIRED,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;expired&quot;,keyobj,db-&gt;id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 临时键对象的引用计数减1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decrRefCount(keyobj);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 服务器的过期键计数加1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 该参数影响每次处理的数据库个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server.stat_expiredkeys++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>删除过期键对AOF、RDB和主从复制都有影响，等到了介绍相关功能时再讨论。
今天就先到这里~</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/cache/探索Redis设计与实现：数据库redisDb与键过期删除策略.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_EYjg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_eevz"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/code-note-blog/docs/cache/探索Redis设计与实现：使用快照和AOF将Redis数据持久化到硬盘中"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">探索Redis设计与实现：使用快照和AOF将Redis数据持久化到硬盘中</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/code-note-blog/docs/cache/探索Redis设计与实现：Redis 的基础数据结构概览"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">探索Redis设计与实现：Redis 的基础数据结构概览</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lc2k thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一-数据库" class="table-of-contents__link toc-highlight">一. 数据库</a></li><li><a href="#二切换数据库原理" class="table-of-contents__link toc-highlight">二、切换数据库原理</a></li><li><a href="#三数据库的键空间" class="table-of-contents__link toc-highlight">三、数据库的键空间</a><ul><li><a href="#1数据库的结构我们只分析键空间和键过期时间" class="table-of-contents__link toc-highlight">1、数据库的结构（我们只分析键空间和键过期时间）</a></li><li><a href="#2键空间的初始化" class="table-of-contents__link toc-highlight">2、键空间的初始化</a></li><li><a href="#3键空间的操作" class="table-of-contents__link toc-highlight">3、键空间的操作</a></li></ul></li><li><a href="#四数据库的过期键操作" class="table-of-contents__link toc-highlight">四、数据库的过期键操作</a><ul><li><a href="#1过期键处理函数" class="table-of-contents__link toc-highlight">1、过期键处理函数</a></li><li><a href="#2过期键删除策略" class="table-of-contents__link toc-highlight">2、过期键删除策略</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>