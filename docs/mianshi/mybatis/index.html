<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-mianshi/mybatis" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">MyBatis | Tommy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aiden-coding.github.io/code-note-blog/docs/mianshi/mybatis"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MyBatis | Tommy"><meta data-rh="true" name="description" content="MyBatis面试题，20道MyBatis八股文（6千字30张手绘图），面渣逆袭必看👍"><meta data-rh="true" property="og:description" content="MyBatis面试题，20道MyBatis八股文（6千字30张手绘图），面渣逆袭必看👍"><link data-rh="true" rel="icon" href="/code-note-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aiden-coding.github.io/code-note-blog/docs/mianshi/mybatis"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/mianshi/mybatis" hreflang="en"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/mianshi/mybatis" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/code-note-blog/blog/rss.xml" title="Tommy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/code-note-blog/blog/atom.xml" title="Tommy Atom Feed"><link rel="stylesheet" href="/code-note-blog/assets/css/styles.dd5372db.css">
<script src="/code-note-blog/assets/js/runtime~main.f999fb27.js" defer="defer"></script>
<script src="/code-note-blog/assets/js/main.a0bfbaed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XYiV" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/code-note-blog/"><b class="navbar__title text--truncate">Tommy</b></a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Java/basic/抽象类和接口">java</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/JavaWeb/走进JavaWeb技术世界：JavaWeb的由来和基础知识">javaweb</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">cache</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/backend/后端技术杂谈：白话虚拟化技术">backend</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cs/algorithms/剑指offer">cs</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">database</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/distributed/basic/分布式系统理论基础 ：CAP">distributed</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/interview/BATJ-Experience/面阿里,终获offer">interview</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mq/kafka/消息队列kafka详解：如何实现死信队列">mq</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">spring</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/code-note-blog/docs/mianshi/collection">面试</a><a href="https://aiden-coding.github.io/code-note-blog/SpringCloud%E7%AC%AC3%E5%AD%A32024.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_XbAW colorModeToggle_r5NY"><button class="clean-btn toggleButton_Jx0n toggleButtonDisabled_zYO7" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FjAw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qmEt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_wJfS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LABv"><div class="docsWrapper_pdvB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Jioa" type="button"></button><div class="docRoot_qx_v"><aside class="theme-doc-sidebar-container docSidebarContainer_NHKT"><div class="sidebarViewport_uyYB"><div class="sidebar_SZG4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VP_k"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/collection">Java集合框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/fenbushi">分布式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/javabasic">Java 基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/javase">Java SE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/javathread">Java并发编程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/jvm">JVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/code-note-blog/docs/mianshi/mybatis">MyBatis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/mysql">MySQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/network">计算机网络</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/nixi">面渣逆袭</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/os">操作系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/redis">Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/rocketmq">RocketMQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/mianshi/weifuwu">微服务</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/code-note-blog/docs/test/b">b</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_SejT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_j3Yw"><div class="docItemContainer_XOSC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_F6gm" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/code-note-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YCxa"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MyBatis</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ToOY theme-doc-toc-mobile tocMobile_suYB"><button type="button" class="clean-btn tocCollapsibleButton_VzP_">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>MyBatis</h1></header><h2 class="anchor anchorWithStickyNavbar_HWLp" id="基础">基础<a href="#基础" class="hash-link" aria-label="Direct link to 基础" title="Direct link to 基础">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="1-说说什么是mybatis">1. 说说什么是MyBatis?<a href="#1-说说什么是mybatis" class="hash-link" aria-label="Direct link to 1. 说说什么是MyBatis?" title="Direct link to 1. 说说什么是MyBatis?">​</a></h3>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-494-26ca4d34fd147619ef6e73e44b881629.png" width="350" height="88" class="img_kGBN"></p>
<p><strong>先吹一下</strong>：</p>
<ul>
<li>Mybatis 是一个半 ORM（对象关系映射）框架，它内部封装了 JDBC，开发时只需要关注 SQL 语句本身，不需要花费精力去处理加载驱动、创建连接、创建statement 等繁杂的过程。程序员直接编写原生态 sql，可以严格控制 sql 执行性能，灵活度高。</li>
<li>MyBatis 可以使用 XML 或注解来配置和映射原生信息，将 POJO 映射成数据库中的记录，避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。</li>
</ul>
<p><strong>再说一下缺点</strong></p>
<ul>
<li>SQL语句的编写工作量较大，尤其当字段多、关联表多时，对开发人员编写SQL语句的功底有一定要求</li>
<li>SQL语句依赖于数据库，导致数据库移植性差，不能随意更换数据库</li>
</ul>
<blockquote>
<p><strong>ORM是什么?</strong></p>
</blockquote>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-495-535cc64ae6da3c49de3bb22333db8680.png" width="910" height="394" class="img_kGBN"></p>
<ul>
<li>ORM（Object Relational Mapping），对象关系映射，是一种为了解决关系型数据库数据与简单Java对象（POJO）的映射关系的技术。简单来说，ORM是通过使用描述对象和数据库之间映射的元数据，将程序中的对象自动持久化到关系型数据库中。</li>
</ul>
<blockquote>
<p><strong>为什么说Mybatis是半自动ORM映射工具？它与全自动的区别在哪里？</strong></p>
</blockquote>
<ul>
<li>Hibernate属于全自动ORM映射工具，使用Hibernate查询关联对象或者关联集合对象时，可以根据对象关系模型直接获取，所以它是全自动的。</li>
<li>而Mybatis在查询关联对象或关联集合对象时，需要手动编写SQL来完成，所以，被称之为半自动ORM映射工具。</li>
</ul>
<blockquote>
<p><strong>JDBC编程有哪些不足之处，MyBatis是如何解决的？</strong></p>
</blockquote>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-496-b980bf65046946ef1996269f3cad01d0.png" width="1318" height="764" class="img_kGBN"></p>
<ul>
<li>1、数据连接创建、释放频繁造成系统资源浪费从而影响系统性能，在mybatis-config.xml中配置数据链接池，使用连接池统一管理数据库连接。</li>
<li>2、sql语句写在代码中造成代码不易维护，将sql语句配置在XXXXmapper.xml文件中与java代码分离。</li>
<li>3、向sql语句传参数麻烦，因为sql语句的where条件不一定，可能多也可能少，占位符需要和参数一一对应。Mybatis自动将java对象映射至sql语句。</li>
<li>4、对结果集解析麻烦，sql变化导致解析代码变化，且解析前需要遍历，如果能将数据库记录封装成pojo对象解析比较方便。Mybatis自动将sql执行结果映射至java对象。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="2-hibernate-和-mybatis-有什么区别">2. Hibernate 和 MyBatis 有什么区别？<a href="#2-hibernate-和-mybatis-有什么区别" class="hash-link" aria-label="Direct link to 2. Hibernate 和 MyBatis 有什么区别？" title="Direct link to 2. Hibernate 和 MyBatis 有什么区别？">​</a></h3>
<p><strong>相同点</strong></p>
<ul>
<li>都是对jdbc的封装，都是应用于持久层的框架。</li>
</ul>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-497-47ddb4aada95b22eb3b5d5c793827ca4.png" width="300" height="300" class="img_kGBN"></p>
<p><strong>不同点</strong></p>
<p>1）映射关系</p>
<ul>
<li>MyBatis 是一个半自动映射的框架，配置Java对象与sql语句执行结果的对应关系，多表关联关系配置简单</li>
<li>Hibernate 是一个全表映射的框架，配置Java对象与数据库表的对应关系，多表关联关系配置复杂</li>
</ul>
<p>2）<strong>SQL优化和移植性</strong></p>
<ul>
<li>Hibernate 对SQL语句封装，提供了日志、缓存、级联（级联比 MyBatis 强大）等特性，此外还提供 HQL（Hibernate Query Language）操作数据库，数据库无关性支持好，但会多消耗性能。如果项目需要支持多种数据库，代码开发量少，但SQL语句优化困难。</li>
<li>MyBatis 需要手动编写 SQL，支持动态 SQL、处理列表、动态生成表名、支持存储过程。开发工作量相对大些。直接使用SQL语句操作数据库，不支持数据库无关性，但sql语句优化容易。</li>
</ul>
<p>3）<strong>MyBatis和Hibernate的适用场景不同</strong></p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-498-49d9078b41a601f59106db8d8f259e64.png" width="916" height="330" class="img_kGBN"></p>
<ul>
<li>Hibernate 是标准的ORM框架，SQL编写量较少，但不够灵活，适合于需求相对稳定，中小型的软件项目，比如：办公自动化系统</li>
<li>MyBatis 是半ORM框架，需要编写较多SQL，但是比较灵活，适合于需求变化频繁，快速迭代的项目，比如：电商网站</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="3-mybatis使用过程生命周期">3. MyBatis使用过程？生命周期？<a href="#3-mybatis使用过程生命周期" class="hash-link" aria-label="Direct link to 3. MyBatis使用过程？生命周期？" title="Direct link to 3. MyBatis使用过程？生命周期？">​</a></h3>
<p>MyBatis基本使用的过程大概可以分为这么几步：</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-499-04136daf0e57f9b7cb23f400a0a1c189.png" width="924" height="646" class="img_kGBN"></p>
<ul>
<li>1）创建SqlSessionFactory</li>
</ul>
<p>可以从配置或者直接编码来创建SqlSessionFactory</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">String resource = &quot;org/mybatis/example/mybatis-config.xml&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>2）通过SqlSessionFactory创建SqlSession</li>
</ul>
<p>SqlSession（会话）可以理解为程序和数据库之间的桥梁</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">SqlSession session = sqlSessionFactory.openSession();</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>3）通过sqlsession执行数据库操作</li>
</ul>
<p>可以通过 SqlSession 实例来直接执行已映射的 SQL 语句：</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">Blog blog = (Blog)session.selectOne(&quot;org.mybatis.example.BlogMapper.selectBlog&quot;, 101);</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>更常用的方式是先获取Mapper(映射)，然后再执行SQL语句：</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Blog blog = mapper.selectBlog(101);</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>4）调用session.commit()提交事务</li>
</ul>
<p>如果是更新、删除语句，我们还需要提交一下事务。</p>
<ul>
<li>5）调用session.close()关闭会话</li>
</ul>
<p>最后一定要记得关闭会话。</p>
<blockquote>
<p><strong>MyBatis生命周期？</strong></p>
</blockquote>
<p>上面提到了几个MyBatis的组件，一般说的MyBatis生命周期就是这些组件的生命周期。</p>
<ul>
<li>SqlSessionFactoryBuilder</li>
</ul>
<p>一旦创建了 SqlSessionFactory，就不再需要它了。 因此 SqlSessionFactoryBuilder 实例的生命周期只存在于方法的内部。</p>
<ul>
<li>SqlSessionFactory</li>
</ul>
<p>SqlSessionFactory 是用来创建SqlSession的，相当于一个数据库连接池，每次创建SqlSessionFactory都会使用数据库资源，多次创建和销毁是对资源的浪费。所以SqlSessionFactory是应用级的生命周期，而且应该是单例的。</p>
<ul>
<li>SqlSession</li>
</ul>
<p>SqlSession相当于JDBC中的Connection，SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的生命周期是一次请求或一个方法。</p>
<ul>
<li>Mapper</li>
</ul>
<p>映射器是一些绑定映射语句的接口。映射器接口的实例是从 SqlSession 中获得的，它的生命周期在sqlsession事务方法之内，一般会控制在方法级。</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-500-cabce6ed357298532e6e051dfcee66fb.png" width="1392" height="1060" class="img_kGBN"></p>
<p>当然，万物皆可集成Spring，MyBatis通常也是和Spring集成使用，Spring可以帮助我们创建线程安全的、基于事务的 SqlSession 和映射器，并将它们直接注入到我们的 bean 中，我们不需要关心它们的创建过程和生命周期，那就是另外的故事了。</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-501-89338a899d52240df3f9793a62feb6c6.png" width="300" height="300" class="img_kGBN"></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="4-在mapper中如何传递多个参数">4. 在mapper中如何传递多个参数？<a href="#4-在mapper中如何传递多个参数" class="hash-link" aria-label="Direct link to 4. 在mapper中如何传递多个参数？" title="Direct link to 4. 在mapper中如何传递多个参数？">​</a></h3>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-502-11cb79ae09bad3a6ad5b3bd22e62d042.png" width="1222" height="656" class="img_kGBN"></p>
<p><strong>方法1：顺序传参法</strong></p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public User selectUser(String name, int deptId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;selectUser&quot; resultMap=&quot;UserResultMap&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select * from user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where user_name = #{0} and dept_id = #{1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>\#{}</code>里面的数字代表传入参数的顺序。</li>
<li>这种方法不建议使用，sql层表达不直观，且一旦顺序调整容易出错。</li>
</ul>
<p><strong>方法2：@Param注解传参法</strong></p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public User selectUser(@Param(&quot;userName&quot;) String name, int @Param(&quot;deptId&quot;) deptId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;selectUser&quot; resultMap=&quot;UserResultMap&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select * from user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where user_name = #{userName} and dept_id = #{deptId}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>\#{}</code>里面的名称对应的是注解@Param括号里面修饰的名称。</li>
<li>这种方法在参数不多的情况还是比较直观的，（推荐使用）。</li>
</ul>
<p><strong>方法3：Map传参法</strong></p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public User selectUser(Map&lt;String, Object&gt; params);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;selectUser&quot; parameterType=&quot;java.util.Map&quot; resultMap=&quot;UserResultMap&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select * from user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where user_name = #{userName} and dept_id = #{deptId}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>\#{}</code>里面的名称对应的是Map里面的key名称。</li>
<li>这种方法适合传递多个参数，且参数易变能灵活传递的情况。</li>
</ul>
<p><strong>方法4：Java Bean传参法</strong></p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public User selectUser(User user);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;selectUser&quot; parameterType=&quot;com.jourwon.pojo.User&quot; resultMap=&quot;UserResultMap&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select * from user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where user_name = #{userName} and dept_id = #{deptId}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>\#{}</code>里面的名称对应的是User类里面的成员属性。</li>
<li>这种方法直观，需要建一个实体类，扩展不容易，需要加属性，但代码可读性强，业务逻辑处理方便，推荐使用。（推荐使用）。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="5-实体类属性名和表中字段名不一样-怎么办">5. 实体类属性名和表中字段名不一样 ，怎么办?<a href="#5-实体类属性名和表中字段名不一样-怎么办" class="hash-link" aria-label="Direct link to 5. 实体类属性名和表中字段名不一样 ，怎么办?" title="Direct link to 5. 实体类属性名和表中字段名不一样 ，怎么办?">​</a></h3>
<ul>
<li>第1种： 通过在查询的SQL语句中定义字段名的别名，让字段名的别名和实体类的属性名一致。</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;getOrder&quot; parameterType=&quot;int&quot; resultType=&quot;com.jourwon.pojo.Order&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       select order_id id, order_no orderno ,order_price price form orders where order_id=#{id};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>第2种： 通过resultMap  中的&lt;result&gt;来映射字段名和实体类属性名的一一对应的关系。</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;getOrder&quot; parameterType=&quot;int&quot; resultMap=&quot;orderResultMap&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  select * from orders where order_id=#{id}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;resultMap type=&quot;com.jourwon.pojo.Order&quot; id=&quot;orderResultMap&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;!–用id属性来映射主键字段–&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;id property=&quot;id&quot; column=&quot;order_id&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;!–用result属性来映射非主键字段，property为实体类属性名，column为数据库表中的属性–&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;result property =&quot;orderno&quot; column =&quot;order_no&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;result property=&quot;price&quot; column=&quot;order_price&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/resultMap&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="6-mybatis是否可以映射enum枚举类">6. Mybatis是否可以映射Enum枚举类？<a href="#6-mybatis是否可以映射enum枚举类" class="hash-link" aria-label="Direct link to 6. Mybatis是否可以映射Enum枚举类？" title="Direct link to 6. Mybatis是否可以映射Enum枚举类？">​</a></h3>
<ul>
<li>Mybatis当然可以映射枚举类，不单可以映射枚举类，Mybatis可以映射任何对象到表的一列上。映射方式为自定义一个TypeHandler，实现TypeHandler的setParameter()和getResult()接口方法。</li>
<li>TypeHandler有两个作用，一是完成从javaType至jdbcType的转换，二是完成jdbcType至javaType的转换，体现为setParameter()和getResult()两个方法，分别代表设置sql问号占位符参数和获取列查询结果。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="7-和的区别">7. <code>#{}和${}的区别</code>?<a href="#7-和的区别" class="hash-link" aria-label="Direct link to 7-和的区别" title="Direct link to 7-和的区别">​</a></h3>
<p><img loading="lazy" alt="Alt text" src="data:image/png;base64,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" width="578" height="154" class="img_kGBN"></p>
<ul>
<li><code>#{}</code>是占位符，预编译处理；<code>${}</code>是拼接符，字符串替换，没有预编译处理。</li>
<li>Mybatis在处理<code>#{}</code>时，<code>#{}</code>传入参数是以字符串传入，会将SQL中的<code>#{}</code>替换为?号，调用PreparedStatement的set方法来赋值。</li>
<li><code>#{}</code> 可以有效的防止SQL注入，提高系统安全性；<code>${}</code> 不能防止SQL 注入</li>
<li><code>#{}</code> 的变量替换是在DBMS 中；<code>${}</code> 的变量替换是在 DBMS 外</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="8-模糊查询like语句该怎么写">8. 模糊查询like语句该怎么写?<a href="#8-模糊查询like语句该怎么写" class="hash-link" aria-label="Direct link to 8. 模糊查询like语句该怎么写?" title="Direct link to 8. 模糊查询like语句该怎么写?">​</a></h3>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-504-d707a885aecc854207d395c0a57e7ce3.png" width="726" height="132" class="img_kGBN"></p>
<ul>
<li>1 ’<code>%${question}%</code>’ 可能引起SQL注入，不推荐</li>
<li>2 <code>&quot;%&quot;#{question}&quot;%&quot;</code> 注意：因为<code>#{…}</code>解析成sql语句时候，会在变量外侧自动加单引号’ &#x27;，所以这里 % 需要使用双引号&quot; &quot;，不能使用单引号 ’ &#x27;，不然会查不到任何结果。</li>
<li>3 <code>CONCAT(&#x27;%&#x27;,#{question},&#x27;%&#x27;)</code> 使用CONCAT()函数，（推荐✨）</li>
<li>4 使用bind标签（不推荐）</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;listUserLikeUsername&quot; resultType=&quot;com.jourwon.pojo.User&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;emsp;&amp;emsp;&lt;bind name=&quot;pattern&quot; value=&quot;&#x27;%&#x27; + username + &#x27;%&#x27;&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;emsp;&amp;emsp;select id,sex,age,username,password from person where username LIKE #{pattern}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="9-mybatis能执行一对一一对多的关联查询吗">9. Mybatis能执行一对一、一对多的关联查询吗？<a href="#9-mybatis能执行一对一一对多的关联查询吗" class="hash-link" aria-label="Direct link to 9. Mybatis能执行一对一、一对多的关联查询吗？" title="Direct link to 9. Mybatis能执行一对一、一对多的关联查询吗？">​</a></h3>
<p>当然可以，不止支持一对一、一对多的关联查询，还支持多对多、多对一的关联查询。</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-505-6b00cd028f2e8bc2e96138f0613b2764.png" width="1344" height="584" class="img_kGBN"></p>
<ul>
<li><strong>一对一&lt;association&gt;</strong></li>
</ul>
<p>比如订单和支付是一对一的关系，这种关联的实现：</p>
<p>实体类:</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class Order {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer orderId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String orderDesc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 支付对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Pay pay;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //……</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>结果映射</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- 订单resultMap --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;resultMap id=&quot;peopleResultMap&quot; type=&quot;cn.fighter3.entity.Order&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;id property=&quot;orderId&quot; column=&quot;order_id&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;result property=&quot;orderDesc&quot; column=&quot;order_desc&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;!--一对一结果映射--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;association property=&quot;pay&quot; javaType=&quot;cn.fighter3.entity.Pay&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;id column=&quot;payId&quot; property=&quot;pay_id&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;result column=&quot;account&quot; property=&quot;account&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/association&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/resultMap&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查询就是普通的关联查</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;getTeacher&quot; resultMap=&quot;getTeacherMap&quot; parameterType=&quot;int&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select * from order o </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     left join pay p on o.order_id=p.order_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where  o.order_id=#{orderId}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong>一对多<code>&lt;collection&gt;</code></strong></li>
</ul>
<p>比如商品分类和商品，是一对多的关系。</p>
<ul>
<li>实体类</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class Category {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int categoryId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String categoryName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 商品列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    **/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;Product&gt; products;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //……</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>结果映射</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;resultMap type=&quot;Category&quot; id=&quot;categoryBean&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;id column=&quot;categoryId&quot; property=&quot;category_id&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;result column=&quot;categoryName&quot; property=&quot;category_name&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;!-- 一对多的关系 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;!-- property: 指的是集合属性的值, ofType：指的是集合中元素的类型 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;collection property=&quot;products&quot; ofType=&quot;Product&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;id column=&quot;product_id&quot; property=&quot;productId&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;result column=&quot;productName&quot; property=&quot;productName&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;result column=&quot;price&quot; property=&quot;price&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/collection&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/resultMap&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>查询</li>
</ul>
<p>查询就是一个普通的关联查询</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- 关联查询分类和产品表 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;listCategory&quot; resultMap=&quot;categoryBean&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    select c.*, p.* from category_ c left join product_ p on c.id = p.cid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;  </span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>​    那么多对一、多对多怎么实现呢？还是利用&lt;association&gt;和&lt;collection&gt;，篇幅所限，这里就不展开了。</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="10-mybatis是否支持延迟加载原理">10. Mybatis是否支持延迟加载？原理？<a href="#10-mybatis是否支持延迟加载原理" class="hash-link" aria-label="Direct link to 10. Mybatis是否支持延迟加载？原理？" title="Direct link to 10. Mybatis是否支持延迟加载？原理？">​</a></h3>
<ul>
<li>Mybatis支持association关联对象和collection关联集合对象的延迟加载，association指的就是一对一，collection指的就是一对多查询。在Mybatis配置文件中，可以配置是否启用延迟加载lazyLoadingEnabled=true|false。</li>
<li>它的原理是，使用CGLIB创建目标对象的代理对象，当调用目标方法时，进入拦截器方法，比如调用a.getB().getName()，拦截器invoke()方法发现a.getB()是null值，那么就会单独发送事先保存好的查询关联B对象的sql，把B查询上来，然后调用a.setB(b)，于是a的对象b属性就有值了，接着完成a.getB().getName()方法的调用。这就是延迟加载的基本原理。</li>
<li>当然了，不光是Mybatis，几乎所有的包括Hibernate，支持延迟加载的原理都是一样的。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="11-如何获取生成的主键">11. 如何获取生成的主键?<a href="#11-如何获取生  成的主键" class="hash-link" aria-label="Direct link to 11. 如何获取生成的主键?" title="Direct link to 11. 如何获取生成的主键?">​</a></h3>
<ul>
<li>新增标签中添加：keyProperty=&quot; ID &quot;  即可</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;insert id=&quot;insert&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;userId&quot; &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert into user( </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_name, user_password, create_time) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    values(#{userName}, #{userPassword} , #{createTime, jdbcType= TIMESTAMP})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/insert&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>这时候就可以完成回填主键</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">mapper.insert(user);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user.getId;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="12-mybatis支持动态sql吗">12. MyBatis支持动态SQL吗？<a href="#12-mybatis支持动态sql吗" class="hash-link" aria-label="Direct link to 12. MyBatis支持动态SQL吗？" title="Direct link to 12. MyBatis支持动态SQL吗？">​</a></h3>
<p>MyBatis中有一些支持动态SQL的标签，它们的原理是使用OGNL从SQL参数对象中计算表达式的值，根据表达式的值动态拼接SQL，以此来完成动态SQL的功能。</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-506-20586b42e42a07a23daf11a793441de9.png" width="748" height="342" class="img_kGBN"></p>
<ul>
<li>if</li>
</ul>
<p>根据条件来组成where子句</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;findActiveBlogWithTitleLike&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   resultType=&quot;Blog&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM BLOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WHERE state = ‘ACTIVE’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;if test=&quot;title != null&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AND title like #{title}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>choose (when, otherwise)</li>
</ul>
<p>这个和Java 中的 switch 语句有点像</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;findActiveBlogLike&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   resultType=&quot;Blog&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM BLOG WHERE state = ‘ACTIVE’</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;choose&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;when test=&quot;title != null&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND title like #{title}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/when&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;when test=&quot;author != null and author.name != null&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND author_name like #{author.name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/when&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;otherwise&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AND featured = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/otherwise&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/choose&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>trim (where, set)</p>
</li>
<li>
<p>&lt;where&gt;可以用在所有的查询条件都是动态的情况</p>
</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;findActiveBlogLike&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   resultType=&quot;Blog&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM BLOG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;where&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;if test=&quot;state != null&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       state = #{state}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;if test=&quot;title != null&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AND title like #{title}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;if test=&quot;author != null and author.name != null&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AND author_name like #{author.name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/where&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>&lt;set&gt; 可以用在动态更新的时候</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;update id=&quot;updateAuthorIfNecessary&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update Author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;set&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;if test=&quot;username != null&quot;&gt;username=#{username},&lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;if test=&quot;password != null&quot;&gt;password=#{password},&lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;if test=&quot;email != null&quot;&gt;email=#{email},&lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;if test=&quot;bio != null&quot;&gt;bio=#{bio}&lt;/if&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/set&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  where id=#{id}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/update&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>foreach</p>
<p>看到名字就知道了，这个是用来循环的，可以对集合进行遍历</p>
</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;select id=&quot;selectPostIn&quot; resultType=&quot;domain.blog.Post&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM POST P</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;where&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      open=&quot;ID in (&quot; separator=&quot;,&quot; close=&quot;)&quot; nullable=&quot;true&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #{item}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/foreach&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/where&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/select&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="13-mybatis如何执行批量操作">13. MyBatis如何执行批量操作？<a href="#13-mybatis如何执行批量操作" class="hash-link" aria-label="Direct link to 13. MyBatis如何执行批量操作？" title="Direct link to 13. MyBatis如何执行批量操作？">​</a></h3>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-507-e27823b80aa551e7975dfd53017ba49d.png" width="1130" height="510" class="img_kGBN"></p>
<p><strong>第一种方法：使用foreach标签</strong></p>
<p>foreach的主要用在构建in条件中，它可以在SQL语句中进行迭代一个集合。foreach标签的属性主要有item，index，collection，open，separator，close。</p>
<ul>
<li>item      表示集合中每一个元素进行迭代时的别名，随便起的变量名；</li>
<li>index    指定一个名字，用于表示在迭代过程中，每次迭代到的位置，不常用；</li>
<li>open    表示该语句以什么开始，常用“(”；</li>
<li>separator 表示在每次进行迭代之间以什么符号作为分隔符，常用“,”；</li>
<li>close    表示以什么结束，常用“)”。</li>
</ul>
<p>在使用foreach的时候最关键的也是最容易出错的就是collection属性，该属性是必须指定的，但是在不同情况下，该属性的值是不一样的，主要有以下3种情况：</p>
<ol>
<li>如果传入的是单参数且参数类型是一个List的时候，collection属性值为list</li>
<li>如果传入的是单参数且参数类型是一个array数组的时候，collection的属性值为array</li>
<li>如果传入的参数是多个的时候，我们就需要把它们封装成一个Map了，当然单参数也可以封装成map，实际上如果你在传入参数的时候，在MyBatis里面也是会把它封装成一个Map的，map的key就是参数名，所以这个时候collection属性值就是传入的List或array对象在自己封装的map里面的key</li>
</ol>
<p>看看批量保存的两种用法：</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- MySQL下批量保存，可以foreach遍历 mysql支持values(),(),()语法 --&gt; //推荐使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;insert id=&quot;addEmpsBatch&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INSERT INTO emp(ename,gender,email,did)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    VALUES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;foreach collection=&quot;emps&quot; item=&quot;emp&quot; separator=&quot;,&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (#{emp.eName},#{emp.gender},#{emp.email},#{emp.dept.id})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/foreach&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/insert&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!-- 这种方式需要数据库连接属性allowMutiQueries=true的支持</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 如jdbc.url=jdbc:mysql://localhost:3306/mybatis?allowMultiQueries=true --&gt;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;insert id=&quot;addEmpsBatch&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;foreach collection=&quot;emps&quot; item=&quot;emp&quot; separator=&quot;;&quot;&gt;                                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        INSERT INTO emp(ename,gender,email,did)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        VALUES(#{emp.eName},#{emp.gender},#{emp.email},#{emp.dept.id})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/foreach&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/insert&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>第二种方法：使用ExecutorType.BATCH</strong></p>
<ul>
<li>Mybatis内置的ExecutorType有3种，默认为simple，该模式下它为每个语句的 执行创建一个新的预处理语句，单条提交sql；而batch模式重复使用已经预处理的语句，并且批量执行所有更新语句，显然batch性能将更优； 但batch模式也有自己的问题，比如在Insert操作时，在事务没有提交之前，是没有办法获取到自增的id，在某些情况下不符合业务的需求。</li>
</ul>
<p>具体用法如下：</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">//批量保存方法测试</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Test  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void testBatch() throws IOException{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //可以执行批量操作的sqlSession</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SqlSession openSession = sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //批量保存执行前时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long start = System.currentTimeMillis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 1000; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mapper.addEmp(new Employee(UUID.randomUUID().toString().substring(0, 5), &quot;b&quot;, &quot;1&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        openSession.commit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long end = System.currentTimeMillis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //批量保存执行后的时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;执行时长&quot; + (end - start));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //批量 预编译sql一次==》设置参数==》10000次==》执行1次   677</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //非批量  （预编译=设置参数=执行 ）==》10000次   1121</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        openSession.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>mapper和mapper.xml如下</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public interface EmployeeMapper {   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //批量保存员工</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Long addEmp(Employee employee);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;mapper namespace=&quot;com.jourwon.mapper.EmployeeMapper&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &lt;!--批量保存员工 --&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;insert id=&quot;addEmp&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        insert into employee(lastName,email,gender)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        values(#{lastName},#{email},#{gender})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/insert&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/mapper&gt;</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="14-说说mybatis的一级二级缓存">14. 说说Mybatis的一 级、二级缓存？<a href="#14-说说mybatis的一级二级缓存" class="hash-link" aria-label="Direct link to 14. 说说Mybatis的一级、二级缓存？" title="Direct link to 14. 说说Mybatis的一级、二级缓存？">​</a></h3>
<ol>
<li>一级缓存: 基于 PerpetualCache 的 HashMap 本地缓存，其存储作用域为SqlSession，各个SqlSession之间的缓存相互隔离，当 Session flush 或 close 之后，该 SqlSession 中的所有 Cache 就将清空，MyBatis默认打开一级缓存。</li>
</ol>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-508-8a280c3ff8c7ca15b3cfbae45a8c8b15.png" width="1502" height="618" class="img_kGBN"></p>
<ol start="2">
<li>二级缓存与一级缓存其机制相同，默认也是采用 PerpetualCache，HashMap 存储，不同之处在于其存储作用域为 Mapper(Namespace)，可以在多个SqlSession之间共享，并且可自定义存储源，如 Ehcache。默认不打开二级缓存，要开启二级缓存，使用二级缓存属性类需要实现Serializable序列化接口(可用来保存对象的状态),可在它的映射文件中配置。</li>
</ol>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-509-408e6accbed140fb15ece0eda2360251.png" width="1608" height="712" class="img_kGBN"></p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="原理">原理<a href="#原理" class="hash-link" aria-label="Direct link to 原理" title="Direct link to 原理">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="15-能说说mybatis的工作原理吗">15. 能说说MyBatis的工作原理吗？<a href="#15-能说说mybatis的工作原理吗" class="hash-link" aria-label="Direct link to 15. 能说说MyBatis的工作原理吗？" title="Direct link to 15. 能说说MyBatis的工作原理吗？">​</a></h3>
<p>我们已经大概知道了MyBatis的工作流程，按工作原理，可以分为两大步：<code>生成会话工厂</code>、<code>会话运行</code>。</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-510-da3033fddb5f9fc055ac28a1dbf9bd26.png" width="1530" height="436" class="img_kGBN"></p>
<p>MyBatis是一个成熟的框架，篇幅限制，这里抓大放小，来看看它的主要工作流程。</p>
<blockquote>
<p><strong>构建会话工厂</strong></p>
</blockquote>
<p>构造会话工厂也可以分为两步：</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-511-d6ac643cf95d1696d51584b1e8188140.png" width="1212" height="982" class="img_kGBN"></p>
<ul>
<li>获取配置</li>
</ul>
<p>获取配置这一步经过了几步转化，最终由生成了一个配置类Configuration实例，这个配置类实例非常重要，主要作用包括：</p>
<ul>
<li>读取配置文件，包括基础配置文件和映射文件</li>
<li>初始化基础配置，比如MyBatis的别名，还有其它的一些重要的类对象，像插件、映射器、ObjectFactory等等</li>
<li>提供一个单例，作为会话工厂构建的重要参数</li>
<li>它的构建过程也会初始化一些环境变量，比如数据源</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public SqlSessionFactory build(Reader reader, String environment, Properties properties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SqlSessionFactory var5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      //省略异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          //xml配置构建器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          XMLConfigBuilder parser = new XMLConfigBuilder(reader, environment, properties);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          //通过转化的Configuration构建SqlSessionFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          var5 = this.build(parser.parse());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>构建SqlSessionFactory</li>
</ul>
<p>SqlSessionFactory只是一个接口，构建出来的实际上是它的实现类的实例，一般我们用的都是它的实现类DefaultSqlSessionFactory，</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public SqlSessionFactory build(Configuration config) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new DefaultSqlSessionFactory(config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p><strong>会话运行</strong></p>
</blockquote>
<p>会话运行是MyBatis最复杂的部分，它的运行离不开四大组件的配合：</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-512-9c0cc370bf86b97dffb195055c26e977.png" width="617" height="349" class="img_kGBN"></p>
<ul>
<li>Executor（执行器）</li>
</ul>
<p>Executor起到了至关重要的作用，SqlSession只是一个门面，相当于客服，真正干活的是是Executor，就像是默默无闻的工程师。它提供了相应的查询和更新方法，以及事务方法。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">Environment environment = this.configuration.getEnvironment();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TransactionFactory transactionFactory = this.getTransactionFactoryFromEnvironment(environment);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//通过Configuration创建executor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Executor executor = this.configuration.newExecutor(tx, execType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var8 = new DefaultSqlSession(this.configuration, executor, autoCommit);</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>StatementHandler（数据库会话器）</li>
</ul>
<p>StatementHandler，顾名思义，处理数据库会话的。我们以SimpleExecutor为例，看一下它的查询方法，先生成了一个StatementHandler实例，再拿这个handler去执行query。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain"> public &lt;E&gt; List&lt;E&gt; doQuery(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, BoundSql boundSql) throws SQLException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Statement stmt = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List var9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Configuration configuration = ms.getConfiguration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StatementHandler handler = configuration.newStatementHandler(this.wrapper, ms, parameter, rowBounds, resultHandler, boundSql);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stmt = this.prepareStatement(handler, ms.getStatementLog());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var9 = handler.query(stmt, resultHandler);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.closeStatement(stmt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return var9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>再以最常用的PreparedStatementHandler看一下它的query方法，其实在上面的<code>prepareStatement</code>已经对参数进行了预编译处理，到了这里，就直接执行sql，使用ResultHandler处理返回结果。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public &lt;E&gt; List&lt;E&gt; query(Statement statement, ResultHandler resultHandler) throws SQLException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PreparedStatement ps = (PreparedStatement)statement;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ps.execute();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return this.resultSetHandler.handleResultSets(ps);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>ParameterHandler （参数处理器）</li>
</ul>
<p>PreparedStatementHandler里对sql进行了预编译处理</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public void parameterize(Statement statement) throws SQLException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.parameterHandler.setParameters((PreparedStatement)statement);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里用的就是ParameterHandler，setParameters的作用就是设置预编译SQL语句的参数。</p>
<p>里面还会用到typeHandler类型处理器，对类型进行处理。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public interface ParameterHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Object getParameterObject();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void setParameters(PreparedStatement var1) throws SQLException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>ResultSetHandler（结果处理器）</p>
<p>我们前面也看到了，最后的结果要通过ResultSetHandler来进行处理，handleResultSets这个方法就是用来包装结果集的。Mybatis为我们提供了一个DefaultResultSetHandler，通常都是用这个实现类去进行结果的处理的。</p>
</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public interface ResultSetHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;E&gt; List&lt;E&gt; handleResultSets(Statement var1) throws SQLException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;E&gt; Cursor&lt;E&gt; handleCursorResultSets(Statement var1) throws SQLException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void handleOutputParameters(CallableStatement var1) throws SQLException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>它会使用typeHandle处理类型，然后用ObjectFactory提供的规则组装对象，返回给调用者。</p>
<p>整体上总结一下会话运行：</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-513-d76921fdcc3815f02b5d0f7712adc631.png" width="769" height="776" class="img_kGBN"></p>
<blockquote>
<p>我们最后把整个的工作流程串联起来，简单总结一下：</p>
</blockquote>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-514-562d4b94d2a6065022ead8ab24fa08f8.png" width="748" height="797" class="img_kGBN"></p>
<ol>
<li>读取 MyBatis 配置文件——mybatis-config.xml 、加载映射文件——映射文件即 SQL  映射文件，文件中配置了操作数据库的 SQL 语句。最后生成一个配置对象。</li>
<li>构造会话工厂：通过 MyBatis 的环境等配置信息构建会话工厂 SqlSessionFactory。</li>
<li>创建会话对象：由会话工厂创建 SqlSession 对象，该对象中包含了执行 SQL 语句的所有方法。</li>
<li>Executor 执行器：MyBatis 底层定义了一个 Executor 接口来操作数据库，它将根据 SqlSession 传递的参数动态地生成需要执行的 SQL 语句，同时负责查询缓存的维护。</li>
<li>StatementHandler：数据库会话器，串联起参数映射的处理和运行结果映射的处理。</li>
<li>参数处理：对输入参数的类型进行处理，并预编译。</li>
<li>结果处理：对返回结果的类型进行处理，根据对象映射规则，返回相应的对象。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="16-mybatis的功能架构是什么样的">16. MyBatis的功能架构是什么样的？<a href="#16-mybatis的功能架构是什么样的" class="hash-link" aria-label="Direct link to 16. MyBatis的功能架构是什么样的？" title="Direct link to 16. MyBatis的功能架构是什么样的？">​</a></h3>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-515-dfbd2d7e3d352e6e2a956cb28b281ca2.png" width="785" height="515" class="img_kGBN"></p>
<p>我们一般把Mybatis的功能架构分为三层：</p>
<ul>
<li>API接口层：提供给外部使用的接口API，开发人员通过这些本地API来操纵数据库。接口层一接收到调用请求就会调用数据处理层来完成具体的数据处理。</li>
<li>数据处理层：负责具体的SQL查找、SQL解析、SQL执行和执行结果映射处理等。它主要的目的是根据调用的请求完成一次数据库操作。</li>
<li>基础支撑层：负责最基础的功能支撑，包括连接管理、事务管理、配置加载和缓存处理，这些都是共用的东西，将他们抽取出来作为最基础的组件。为上层的数据处理层提供最基础的支撑。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="17-为什么mapper接口不需要实现类">17. 为什么Mapper接口不需要实现类？<a href="#17-为什么mapper接口不需要实现类" class="hash-link" aria-label="Direct link to 17. 为什么Mapper接口不需要实现类？" title="Direct link to 17. 为什么Mapper接口不需要实现类？">​</a></h3>
<p>四个字回答：<strong>动态代理</strong>，我们来看一下获取Mapper的过程：</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-516-328918cc73bb7b141a7bb5e5a4684eea.png" width="710" height="538" class="img_kGBN"></p>
<ul>
<li>获取Mapper</li>
</ul>
<p>我们都知道定义的Mapper接口是没有实现类的，Mapper映射其实是通过<strong>动态代理</strong>实现的。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>七拐八绕地进去看一下，发现获取Mapper的过程，需要先获取MapperProxyFactory——Mapper代理工厂。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public &lt;T&gt; T getMapper(Class&lt;T&gt; type, SqlSession sqlSession) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MapperProxyFactory&lt;T&gt; mapperProxyFactory = (MapperProxyFactory)this.knownMappers.get(type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (mapperProxyFactory == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new BindingException(&quot;Type &quot; + type + &quot; is not known to the MapperRegistry.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return mapperProxyFactory.newInstance(sqlSession);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception var5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BindingException(&quot;Error getting mapper instance. Cause: &quot; + var5, var5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>MapperProxyFactory</li>
</ul>
<p>MapperProxyFactory的作用是生成MapperProxy（Mapper代理对象）。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class MapperProxyFactory&lt;T&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private final Class&lt;T&gt; mapperInterface;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ……</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  protected T newInstance(MapperProxy&lt;T&gt; mapperProxy) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return Proxy.newProxyInstance(this.mapperInterface.getClassLoader(), new Class[]{this.mapperInterface}, mapperProxy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public T newInstance(SqlSession sqlSession) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      MapperProxy&lt;T&gt; mapperProxy = new MapperProxy(sqlSession, this.mapperInterface, this.methodCache);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return this.newInstance(mapperProxy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里可以看到动态代理对接口的绑定，它的作用就是生成动态代理对象（占位），而代理的方法被放到了MapperProxy中。</p>
<ul>
<li>MapperProxy</li>
</ul>
<p>MapperProxy里，通常会生成一个MapperMethod对象，它是通过cachedMapperMethod方法对其进行初始化的，然后执行excute方法。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Object.class.equals(method.getDeclaringClass()) ? method.invoke(this, args) : this.cachedInvoker(method).invoke(proxy, method, args, this.sqlSession);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (Throwable var5) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw ExceptionUtil.unwrapThrowable(var5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>MapperMethod</li>
</ul>
<p>MapperMethod里的excute方法，会真正去执行sql。这里用到了命令模式，其实绕一圈，最终它还是通过SqlSession的实例去运行对象的sql。</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public Object execute(SqlSession sqlSession, Object[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Object result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Object param;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ……</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case SELECT:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          if (this.method.returnsVoid() &amp;&amp; this.method.hasResultHandler()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              this.executeWithResultHandler(sqlSession, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              result = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          } else if (this.method.returnsMany()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              result = this.executeForMany(sqlSession, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          } else if (this.method.returnsMap()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              result = this.executeForMap(sqlSession, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          } else if (this.method.returnsCursor()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              result = this.executeForCursor(sqlSession, args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              param = this.method.convertArgsToSqlCommandParam(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              result = sqlSession.selectOne(this.command.getName(), param);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              if (this.method.returnsOptional() &amp;&amp; (result == null || !this.method.getReturnType().equals(result.getClass()))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  result = Optional.ofNullable(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         ……</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="18mybatis都有哪些executor执行器">18.Mybatis都有哪些Executor执行器？<a href="#18mybatis都有哪些executor执行器" class="hash-link" aria-label="Direct link to 18.Mybatis都有哪些Executor执行器？" title="Direct link to 18.Mybatis都有哪些Executor  执行器？">​</a></h3>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-517-9a56d3cd026a06a4b5d01b3f916d6b6f.png" width="1012" height="272" class="img_kGBN"></p>
<p>Mybatis有三种基本的Executor执行器，SimpleExecutor、ReuseExecutor、BatchExecutor。</p>
<ul>
<li><strong>SimpleExecutor</strong>：每执行一次update或select，就开启一个Statement对象，用完立刻关闭Statement对象。</li>
<li><strong>ReuseExecutor</strong>：执行update或select，以sql作为key查找Statement对象，存在就使用，不存在就创建，用完后，不关闭Statement对象，而是放置于<code>Map&lt;String, Statement&gt;</code>内，供下一次使用。简言之，就是重复使用Statement对象。</li>
<li><strong>BatchExecutor</strong>：执行update（没有select，JDBC批处理不支持select），将所有sql都添加到批处理中（addBatch()），等待统一执行（executeBatch()），它缓存了多个Statement对象，每个Statement对象都是addBatch()完毕后，等待逐一执行executeBatch()批处理。与JDBC批处理相同。</li>
</ul>
<p>作用范围：Executor的这些特点，都严格限制在SqlSession生命周期范围内。</p>
<blockquote>
<p><strong>Mybatis中如何指定使用哪一种Executor执行器？</strong></p>
</blockquote>
<ul>
<li>在Mybatis配置文件中，在设置（settings）可以指定默认的ExecutorType执行器类型，也可以手动给DefaultSqlSessionFactory的创建SqlSession的方法传递ExecutorType类型参数，如<code>SqlSession openSession(ExecutorType execType)</code>。</li>
<li>配置默认的执行器。SIMPLE 就是普通的执行器；REUSE 执行器会重用预处理语句（prepared statements）； BATCH 执行器将重用语句并执行批量更新。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="插件">插件<a href="#插件" class="hash-link" aria-label="Direct link to 插件" title="Direct link to 插件">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="19-说说mybatis的插件运行原理如何编写一个插件">19. 说说Mybatis的插件运行原理，如何编写一个插件？<a href="#19-说说mybatis的插件运行原理如何编写一个插件" class="hash-link" aria-label="Direct link to 19. 说说Mybatis的插件运行原理，如何编写一个插件？" title="Direct link to 19. 说说Mybatis的插件运行原理，如何编写一个插件？">​</a></h3>
<blockquote>
<p><strong>插件的运行原理？</strong></p>
</blockquote>
<p>Mybatis会话的运行需要ParameterHandler、ResultSetHandler、StatementHandler、Executor这四大对象的配合，插件的原理就是在这四大对象调度的时候，插入一些我我们自己的代码。</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-518-1f4cea0e0acec3d16d4446f3a1f06541.png" width="867" height="586" class="img_kGBN"></p>
<p>Mybatis使用JDK的动态代理，为目标对象生成代理对象。它提供了一个工具类<code>Plugin</code>，实现了<code>InvocationHandler</code>接口。</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-519-85dd844dfdfe8b69297e4704104c2914.png" width="1018" height="325" class="img_kGBN"></p>
<p>使用<code>Plugin</code>生成代理对象，代理对象在调用方法的时候，就会进入invoke方法，在invoke方法中，如果存在签名的拦截方法，插件的intercept方法就会在这里被我们调用，然后就返回结果。如果不存在签名方法，那么将直接反射调用我们要执行的方法。</p>
<blockquote>
<p><strong>如何编写一个插件？</strong></p>
</blockquote>
<p>我们自己编写MyBatis 插件，只需要实现拦截器接口 <code>Interceptor (org.apache.ibatis. plugin Interceptor ）</code>，在实现类中对拦截对象和方法进行处理。</p>
<ul>
<li>实现Mybatis的Interceptor接口并重写intercept()方法</li>
</ul>
<p>这里我们只是在目标对象执行目标方法的前后进行了打印；</p>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">public class MyInterceptor implements Interceptor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties props=null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object intercept(Invocation invocation) throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;before……&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //如果当前代理的是一个非代理对象，那么就会调用真实拦截对象的方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果不是它就会调用下个插件代理对象的invoke方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object obj=invocation.proceed();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;after……&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return obj;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>然后再给插件编写注解，确定要拦截的对象，要拦截的方法</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">@Intercepts({@Signature(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        type = Executor.class,  //确定要拦截的对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        method = &quot;update&quot;,        //确定要拦截的方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        args = {MappedStatement.class,Object.class}   //拦截方法的参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyInterceptor implements Interceptor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties props=null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object intercept(Invocation invocation) throws Throwable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;before……&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //如果当前代理的是一个非代理对象，那么就会调用真实拦截对象的方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果不是它就会调用下个插件代理对象的invoke方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object obj=invocation.proceed();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;after……&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return obj;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>最后，再MyBatis配置文件里面配置 插件</li>
</ul>
<div class="language-java codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-java codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;plugins&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;plugin interceptor=&quot;xxx.MyPlugin&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &lt;property name=&quot;dbType&quot;,value=&quot;mysql&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/plugins&gt;    </span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="20-mybatis是如何进行分页的分页插件的原理是什么">20. MyBatis是如何进行分页的？分页插件的原理是什么？<a href="#20-mybatis是如何进行分页的分页插件的原理是什么" class="hash-link" aria-label="Direct link to 20. MyBatis是如何进行分页的？分页插件的原理是什么？" title="Direct link to 20. MyBatis是如何进行分页的？分页插件的原  理是什么？">​</a></h3>
<blockquote>
<p><strong>MyBatis是如何分页的？</strong></p>
</blockquote>
<p>MyBatis使用RowBounds对象进行分页，它是针对ResultSet结果集执行的内存分页，而非物理分页。可以在sql内直接书写带有物理分页的参数来完成物理分页功能，也可以使用分页插件来完成物理分页。</p>
<blockquote>
<p><strong>分页插件的原理是什么？</strong></p>
</blockquote>
<ul>
<li>分页插件的基本原理是使用Mybatis提供的插件接口，实现自定义插件，拦截Executor的query方法</li>
<li>在执行查询的时候，拦截待执行的sql，然后重写sql，根据dialect方言，添加对应的物理分页语句和物理分页参数。</li>
<li>举例：<code>select * from student</code>，拦截sql后重写为：<code>select t.* from (select * from student) t limit 0, 10</code></li>
</ul>
<p>可以看一下一个大概的MyBatis通用分页拦截器：</p>
<p><img loading="lazy" alt="Alt text" src="/code-note-blog/assets/images/image-520-0dbb82afcee334a4a9bd61d409c61a99.png" width="913" height="4029" class="img_kGBN"></p>
<hr>
<p><em>没有什么使我停留——除了目的，纵然岸旁有玫瑰、有绿荫、有宁静的港湾，我是不系之舟</em>。</p>
<p><strong>系列内容</strong>：</p>
<hr>
<p><em>没有什么使我停留——除了目的，纵然岸旁有玫瑰、有绿荫、有宁静的港湾，我是不系之舟</em>。</p>
<p><strong>系列内容</strong>：</p>
<ul>
<li><a href="/code-note-blog/docs/mianshi/javase">面渣逆袭 Java SE 篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/javathread">面渣逆袭 Java 集合框架篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/collection">面渣逆袭 Java 并发编程篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/jvm">面渣逆袭 JVM 篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/spring">面渣逆袭 Spring 篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/redis">面渣逆袭 Redis 篇   👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/mybatis">面渣逆袭 MyBatis 篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/mysql">面渣逆袭 MySQL 篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/os">面渣逆袭操作系统篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/network">面渣逆袭计算机网络篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/rocketmq">面渣逆袭RocketMQ篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/fenbushi">面渣逆袭分布式篇👍</a></li>
<li><a href="/code-note-blog/docs/mianshi/weifuwu">面渣逆袭微服务篇👍</a></li>
</ul>
<hr>
<blockquote>
<p>图文详解 20 道MyBatis面试高频题，这次吊打面试官，我觉得稳了（手动 dog）。整理：沉默王二，戳<a href="https://mp.weixin.qq.com/s/en2RgcVx52Ql3tYGLfv3Kw" target="_blank" rel="noopener noreferrer">转载链接</a>，作者：三分恶，戳<a href="https://mp.weixin.qq.com/s/O_5Id2o9IP4loPazJuiHng" target="_blank" rel="noopener noreferrer">原文链接</a>。</p>
</blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/mianshi/mybatis.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_EYjg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_eevz"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/code-note-blog/docs/mianshi/jvm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">JVM</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/code-note-blog/docs/mianshi/mysql"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">MySQL</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lc2k thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基础" class="table-of-contents__link toc-highlight">基础</a><ul><li><a href="#1-说说什么是mybatis" class="table-of-contents__link toc-highlight">1. 说说什么是MyBatis?</a></li><li><a href="#2-hibernate-和-mybatis-有什么区别" class="table-of-contents__link toc-highlight">2. Hibernate 和 MyBatis 有什么区别？</a></li><li><a href="#3-mybatis使用过程生命周期" class="table-of-contents__link toc-highlight">3. MyBatis使用过程？生命周期？</a></li><li><a href="#4-在mapper中如何传递多个参数" class="table-of-contents__link toc-highlight">4. 在mapper中如何传递多个参数？</a></li><li><a href="#5-实体类属性名和表中字段名不一样-怎么办" class="table-of-contents__link toc-highlight">5. 实体类属性名和表中字段名不一样 ，怎么办?</a></li><li><a href="#6-mybatis是否可以映射enum枚举类" class="table-of-contents__link toc-highlight">6. Mybatis是否可以映射Enum枚举类？</a></li><li><a href="#7-和的区别" class="table-of-contents__link toc-highlight">7. <code>#{}和${}的区别</code>?</a></li><li><a href="#8-模糊查询like语句该怎么写" class="table-of-contents__link toc-highlight">8. 模糊查询like语句该怎么写?</a></li><li><a href="#9-mybatis能执行一对一一对多的关联查询吗" class="table-of-contents__link toc-highlight">9. Mybatis能执行一对一、一对多的关联查询吗？</a></li><li><a href="#10-mybatis是否支持延迟加载原理" class="table-of-contents__link toc-highlight">10. Mybatis是否支持延迟加载？原理？</a></li><li><a href="#11-如何获取生成的主键" class="table-of-contents__link toc-highlight">11. 如何获取生成的主键?</a></li><li><a href="#12-mybatis支持动态sql吗" class="table-of-contents__link toc-highlight">12. MyBatis支持动态SQL吗？</a></li><li><a href="#13-mybatis如何执行批量操作" class="table-of-contents__link toc-highlight">13. MyBatis如何执行批量操作？</a></li><li><a href="#14-说说mybatis的一级二级缓存" class="table-of-contents__link toc-highlight">14. 说说Mybatis的一级、二级缓存？</a></li></ul></li><li><a href="#原理" class="table-of-contents__link toc-highlight">原理</a><ul><li><a href="#15-能说说mybatis的工作原理吗" class="table-of-contents__link toc-highlight">15. 能说说MyBatis的工作原理吗？</a></li><li><a href="#16-mybatis的功能架构是什么样的" class="table-of-contents__link toc-highlight">16. MyBatis的功能架构是什么样的？</a></li><li><a href="#17-为什么mapper接口不需要实现类" class="table-of-contents__link toc-highlight">17. 为什么Mapper接口不需要实现类？</a></li><li><a href="#18mybatis都有哪些executor执行器" class="table-of-contents__link toc-highlight">18.Mybatis都有哪些Executor执行器？</a></li></ul></li><li><a href="#插件" class="table-of-contents__link toc-highlight">插件</a><ul><li><a href="#19-说说mybatis的插件运行原理如何编写一个插件" class="table-of-contents__link toc-highlight">19. 说说Mybatis的插件运行原理，如何编写一个插件？</a></li><li><a href="#20-mybatis是如何进行分页的分页插件的原理是什么" class="table-of-contents__link toc-highlight">20. MyBatis是如何进行分页的？分页插件的原理是什么？</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>