<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-database/重新学习MySQL数据库：Mysql存储引擎与数据存储原理" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">重新学习MySQL数据库：Mysql存储引擎与数据存储原理 | Tommy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://aiden-coding.github.io/code-note-blog/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://aiden-coding.github.io/code-note-blog/docs/database/重新学习MySQL数据库：Mysql存储引擎与数据存储原理"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="重新学习MySQL数据库：Mysql存储引擎与数据存储原理 | Tommy"><meta data-rh="true" name="description" content="一、 MySQL记录存储（页为单位）"><meta data-rh="true" property="og:description" content="一、 MySQL记录存储（页为单位）"><link data-rh="true" rel="icon" href="/code-note-blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://aiden-coding.github.io/code-note-blog/docs/database/重新学习MySQL数据库：Mysql存储引擎与数据存储原理"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/database/重新学习MySQL数据库：Mysql存储引擎与数据存储原理" hreflang="en"><link data-rh="true" rel="alternate" href="https://aiden-coding.github.io/code-note-blog/docs/database/重新学习MySQL数据库：Mysql存储引擎与数据存储原理" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/code-note-blog/blog/rss.xml" title="Tommy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/code-note-blog/blog/atom.xml" title="Tommy Atom Feed"><link rel="stylesheet" href="/code-note-blog/assets/css/styles.dd5372db.css">
<script src="/code-note-blog/assets/js/runtime~main.f999fb27.js" defer="defer"></script>
<script src="/code-note-blog/assets/js/main.a0bfbaed.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XYiV" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/code-note-blog/"><b class="navbar__title text--truncate">Tommy</b></a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Java/basic/抽象类和接口">java</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/JavaWeb/走进JavaWeb技术世界：JavaWeb的由来和基础知识">javaweb</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cache/探索Redis设计与实现：连接底层与表面的数据结构robj">cache</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/backend/后端技术杂谈：白话虚拟化技术">backend</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/cs/algorithms/剑指offer">cs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">database</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/distributed/basic/分布式系统理论基础 ：CAP">distributed</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/interview/BATJ-Experience/面阿里,终获offer">interview</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mq/kafka/消息队列kafka详解：如何实现死信队列">mq</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/Spring全家桶/Spring/第一个Spring应用">spring</a><a class="navbar__item navbar__link" href="/code-note-blog/docs/mianshi/collection">面试</a><a href="https://aiden-coding.github.io/code-note-blog/SpringCloud%E7%AC%AC3%E5%AD%A32024.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_XbAW colorModeToggle_r5NY"><button class="clean-btn toggleButton_Jx0n toggleButtonDisabled_zYO7" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_FjAw"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_qmEt"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_wJfS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_LABv"><div class="docsWrapper_pdvB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Jioa" type="button"></button><div class="docRoot_qx_v"><aside class="theme-doc-sidebar-container docSidebarContainer_NHKT"><div class="sidebarViewport_uyYB"><div class="sidebar_SZG4"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VP_k"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB">重新学习MySQL数据库：『浅入浅出』MySQL和InnoDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：从实践sql语句优化开始">重新学习MySQL数据库：从实践sql语句优化开始</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：根据MySQL索引原理进行分析与优化">重新学习MySQL数据库：根据MySQL索引原理进行分析与优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：浅谈MySQL的中事务与锁">重新学习MySQL数据库：浅谈MySQL的中事务与锁</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：无废话MySQL入门">重新学习MySQL数据库：无废话MySQL入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：详解MyIsam与InnoDB引擎的锁实现">重新学习MySQL数据库：详解MyIsam与InnoDB引擎的锁实现</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：以Java的视角来聊聊SQL注入">重新学习MySQL数据库：以Java的视角来聊聊SQL注入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：Innodb中的事务隔离级别和锁的关系">重新学习MySQL数据库：Innodb中的事务隔离级别和锁的关系</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/code-note-blog/docs/database/重新学习MySQL数据库：Mysql存储引擎与数据存储原理">重新学习MySQL数据库：Mysql存储引擎与数据存储原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：MySQL的事务隔离级别实战">重新学习MySQL数据库：MySQL的事务隔离级别实战</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：MySQL里的那些日志们">重新学习MySQL数据库：MySQL里的那些日志们</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：Mysql索引实现原理和相关数据结构算法">重新学习MySQL数据库：Mysql索引实现原理和相关数据结构算法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/重新学习MySQL数据库：Mysql主从复制，读写分离，分表分库策略与实践">重新学习MySQL数据库：Mysql主从复制，读写分离，分表分库策略与实践</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/code-note-blog/docs/database/Mysql原理与实践总结">Mysql原理与实践总结</a></li></ul></nav></div></div></aside><main class="docMainContainer_SejT"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_j3Yw"><div class="docItemContainer_XOSC"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_F6gm" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/code-note-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YCxa"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">重新学习MySQL数据库：Mysql存储引擎与数据存储原理</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ToOY theme-doc-toc-mobile tocMobile_suYB"><button type="button" class="clean-btn tocCollapsibleButton_VzP_">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>重新学习MySQL数据库：Mysql存储引擎与数据存储原理</h1></header><h2 class="anchor anchorWithStickyNavbar_HWLp" id="一-mysql记录存储页为单位"><strong>一、 MySQL记录存储（页为单位）</strong><a href="#一-mysql记录存储页为单位" class="hash-link" aria-label="Direct link to 一-mysql记录存储页为单位" title="Direct link to 一-mysql记录存储页为单位">​</a></h2>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205306.png" alt="" class="img_kGBN"></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="页头"><strong>页头</strong><a href="#页头" class="hash-link" aria-label="Direct link to 页头" title="Direct link to 页头">​</a></h3>
<p>记录页面的控制信息，共占56字节，包括页的左右兄弟页面指针、页面空间使用情况等。</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="虚记录"><strong>虚记录</strong><a href="#虚记录" class="hash-link" aria-label="Direct link to 虚记录" title="Direct link to 虚记录">​</a></h3>
<p>最大虚记录：比页内最大主键还大 最小虚记录：比页内最小主键还小 (作用：比如说我们要查看一个记录是否在这个页面里，就要看这个记录是否在最大最小虚记录范围内)</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="记录堆"><strong>记录堆</strong><a href="#记录堆" class="hash-link" aria-label="Direct link to 记录堆" title="Direct link to 记录堆">​</a></h3>
<p>行记录存储区，分为有效记录和已删除记录两种</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="自由空间链表"><strong>自由空间链表</strong><a href="#自由空间链表" class="hash-link" aria-label="Direct link to 自由空间链表" title="Direct link to 自由空间链表">​</a></h3>
<p>已删除记录组成的链表 (重复利用空间)</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="未分配空间"><strong>未分配空间</strong><a href="#未分配空间" class="hash-link" aria-label="Direct link to 未分配空间" title="Direct link to 未分配空间">​</a></h3>
<p>页面未使用的存储空间；</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="slot区"><strong>Slot区</strong><a href="#slot区" class="hash-link" aria-label="Direct link to slot区" title="Direct link to slot区">​</a></h3>
<p>页尾 页面最后部分，占8个字节，主要存储页面的校验信息；</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="页内记录维护"><strong>页内记录维护</strong><a href="#页内记录维护" class="hash-link" aria-label="Direct link to 页内记录维护" title="Direct link to 页内记录维护">​</a></h3>
<p><strong>顺序保证</strong></p>
<p>物理有序(利于查询，不利于插入删除)</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-db41a4ce70476cb846cbcd92d3cb6efd_720w.webp" alt="img" class="img_kGBN"></p>
<p><strong>逻辑有序(插入删除性能高，查询效率低)</strong> 默认</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205330.png" alt="" class="img_kGBN"></p>
<p>所以<code>MySQL</code>是像下图所示这样子有序的组织数据的。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-5c927bccdfd6815a65b5bb1aebb13aae_720w.webp" alt="img" class="img_kGBN"></p>
<p><strong>2、插入策略</strong></p>
<p><strong>自由空间链表</strong>（优先利用自由空间链表）</p>
<p><strong>未使用空间</strong></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205347.png" alt="" class="img_kGBN"></p>
<p><strong>3、页内查询</strong></p>
<p><strong>遍历</strong></p>
<p><strong>二分查找(数据不一样大，不能用二分)</strong></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-0b09abe7fa1b04a6274003c2dd08f733_720w.webp" alt="img" class="img_kGBN"></p>
<p>利用槽位做二分，实现近似的二分查找，近似于跳表 。</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="二-mysql-innodb存储引擎内存管理"><strong>二、 MySQL InnoDB存储引擎内存管理</strong><a href="#二-mysql-innodb存储引擎内存管理" class="hash-link" aria-label="Direct link to 二-mysql-innodb存储引擎内存管理" title="Direct link to 二-mysql-innodb存储引擎内存管理">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="预分配内存空间"><strong>预分配内存空间</strong><a href="#预分配内存空间" class="hash-link" aria-label="Direct link to 预分配内存空间" title="Direct link to 预分配内存空间">​</a></h3>
<p>内存池</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="数据以页为单位加载-减少io访问次数"><strong>数据以页为单位加载 （减少io访问次数）</strong><a href="#数据以页为单位加载-减少io访问次数" class="hash-link" aria-label="Direct link to 数据以页为单位加载-减少io访问次数" title="Direct link to 数据以页为单位加载-减少io访问次数">​</a></h3>
<p>内存页面管理</p>
<ul>
<li>页面映射（记录哪块磁盘上的数据加载到哪块内存上了）</li>
<li>页面数据管理</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="数据内外存交换"><strong>数据内外存交换</strong><a href="#数据内外存交换" class="hash-link" aria-label="Direct link to 数据内外存交换" title="Direct link to 数据内外存交换">​</a></h3>
<p>数据淘汰</p>
<ul>
<li>内存页耗尽</li>
<li>需要加载新数据</li>
</ul>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-369ec920b95324b4f2359cbe505c9a75_720w.webp" alt="img" class="img_kGBN"></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="页面管理"><strong>页面管理</strong><a href="#页面管理" class="hash-link" aria-label="Direct link to 页面管理" title="Direct link to 页面管理">​</a></h3>
<ul>
<li>空闲页</li>
<li>数据页</li>
<li>脏页（需刷回磁盘）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="页面淘汰"><strong>页面淘汰</strong><a href="#页面淘汰" class="hash-link" aria-label="Direct link to 页面淘汰" title="Direct link to 页面淘汰">​</a></h3>
<p>LRU(淘汰冷数据)</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-065e91777cbc08461d0e5a6d6c5de606_720w.webp" alt="img" class="img_kGBN"></p>
<div class="codeBlockContainer_Ty55 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_zoWS"><pre tabindex="0" class="prism-code language-text codeBlock_Po6r thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Llrq"><span class="token-line" style="color:#393A34"><span class="token plain">某时刻状态-&gt;访问P2-&gt;访问新页P7</span><br></span></code></pre><div class="buttonGroup_EjFN"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_RXpO" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_sabX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_WdXf"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="全表扫描对内存的影响"><strong>全表扫描对内存的影响？</strong><a href="#全表扫描对内存的影响" class="hash-link" aria-label="Direct link to 全表扫描对内存的影响" title="Direct link to 全表扫描对内存的影响">​</a></h3>
<p>可能会把内存中的热数据淘汰掉（比如说对一个几乎没有访问量的表进行全表扫描）</p>
<p>所以<code>MySQL</code>不是单纯的利用<code>LRU算法</code></p>
<p>解决问题：如何避免热数据被淘汰？</p>
<p>解决方案：访问时间 + 频率(redis)</p>
<p>两个<code>LRU</code>表</p>
<p><code>MySQL</code>的解决方案</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-9bf6f401a22185ae7852b596f58c0fa4_720w.webp" alt="img" class="img_kGBN"></p>
<p>MySQL内存管理—LRU</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205410.png" alt="" class="img_kGBN"></p>
<p><strong>页面装载</strong></p>
<p>磁盘数据到内存</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-3ad4cc1b1a83d8a7c0ecc8f7b9befd12_720w.webp" alt="img" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205420.png" alt="" class="img_kGBN"></p>
<p>没有空闲页怎么办？<code>Free list中取 &gt; LRU中淘汰 &gt; LRU Flush</code></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="页面淘汰-1"><strong>页面淘汰</strong><a href="#页面淘汰-1" class="hash-link" aria-label="Direct link to 页面淘汰-1" title="Direct link to 页面淘汰-1">​</a></h3>
<p><code>LRU</code>尾部淘汰<code>Flush LRU</code>淘汰</p>
<p><code>LRU</code>链表中将第一个脏页刷盘并“释放”，放到<code>LRU</code>尾部？直接放<code>FreeList</code>？</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="位置移动"><strong>位置移动</strong><a href="#位置移动" class="hash-link" aria-label="Direct link to 位置移动" title="Direct link to 位置移动">​</a></h3>
<p>old 到 new new 到 old</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205431.png" alt="" class="img_kGBN"></p>
<p>思考：移动时机是什么？<code>innodb_old_blocks_time</code>old区存活时间，大于此值，有机会进入new区</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205437.png" alt="" class="img_kGBN"></p>
<p><code>LRU_new</code>的操作 链表操作效率很高，有访问移动到表头？<code>Lock！！！MySQL</code>设计思路：减少移动次数</p>
<p>两个重要参考：1、<code>freed_page_clock：Buffer Pool</code>淘汰页数 2、<code>LRU_new</code>长度1/4</p>
<p>当前<code>freed_page_clock</code> - 上次移动到Header时<code>freed_page_clock&gt;LRU_new长度1/4</code></p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="三mysql事务实现原理"><strong>三、MySQL事务实现原理</strong><a href="#三mysql事务实现原理" class="hash-link" aria-label="Direct link to 三mysql事务实现原理" title="Direct link to 三mysql事务实现原理">​</a></h2>
<p>MySQL事务基本概念。</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="1事务特性"><strong>1、事务特性</strong><a href="#1事务特性" class="hash-link" aria-label="Direct link to 1事务特性" title="Direct link to 1事务特性">​</a></h3>
<p>A（<code>Atomicity</code>原子性）：全部成功或全部失败</p>
<p>I（<code>Isolation</code>隔离性）：并行事务之间互不干扰</p>
<p>D（<code>Durability</code>持久性）：事务提交后，永久生效</p>
<p>C（<code>Consistency</code>一致性）：通过AID保证</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="2并发问题"><strong>2、并发问题</strong><a href="#2并发问题" class="hash-link" aria-label="Direct link to 2并发问题" title="Direct link to 2并发问题">​</a></h3>
<p>脏读(<code>Drity Read</code>)：读取到未提交的数据</p>
<p>不可重复读(<code>Non-repeatable read</code>)：两次读取结果不同</p>
<p>幻读(<code>Phantom Read</code>)：select 操作得到的结果所表征的数据  状态无法支撑后续的业务操作</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="3隔离级别"><strong>3、隔离级别</strong><a href="#3隔离级别" class="hash-link" aria-label="Direct link to 3隔离级别" title="Direct link to 3隔离级别">​</a></h3>
<p><code>Read Uncommitted</code>（未提交读）：最低隔离级别，会读取到其他事务未提交的数据。脏读；</p>
<p><code>Read Committed</code>（提交读）：事务过程中可以读取到其他事务已提交的数据。不可重复读；</p>
<p><code>Repeatable Read</code>（可重复读）：每次读取相同结果集，不管其他事务是否提交，幻读；（两次当前读不会产生幻读）</p>
<p><code>Serializable</code>（串行化）：事务排队，隔离级别最高，性能最差；</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="mysql事务实现原理事务管理机制"><strong>MySQL事务实现原理（事务管理机制）</strong><a href="#mysql事务实现原理事务管理机制" class="hash-link" aria-label="Direct link to mysql事务实现原理事务管理机制" title="Direct link to mysql事务实现原理事务管理机制">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="1mvcc-多版本并发控制"><strong>1、MVCC 多版本并发控制</strong><a href="#1mvcc-多版本并发控制" class="hash-link" aria-label="Direct link to 1mvcc-多版本并发控制" title="Direct link to 1mvcc-多版本并发控制">​</a></h3>
<p>解决读-写冲突 如何工作：隐藏列</p>
<p>–当前读（读在存储引擎中存储的那个数据）</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-241cfc7589ea0de0cac531355324d0a7_720w.webp" alt="img" class="img_kGBN"></p>
<p>RR级别下</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-70c832b4a5b81c944c99a96557bcddd6_720w.webp" alt="img" class="img_kGBN"></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="2undo-log"><strong>2、undo log</strong><a href="#2undo-log" class="hash-link" aria-label="Direct link to 2undo-log" title="Direct link to 2undo-log">​</a></h3>
<p>回滚日志 保证事务原子性 实现数据多版本<code>delete undo log</code>：用于回滚，提交即清理；<code>update undo log</code>：用于回滚，同时实现快照读，不能随便删除</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-1e9ecbc408164c034a73c3415aa9105d_720w.webp" alt="img" class="img_kGBN"></p>
<p>思考：undolog如何清理？依据系统活跃的最小活跃事务ID Read view 为什么InnoDB count（*）这么慢？因为</p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="3redo-log"><strong>3、redo log</strong><a href="#3redo-log" class="hash-link" aria-label="Direct link to 3redo-log" title="Direct link to 3redo-log">​</a></h3>
<p>实现事务持久性</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-029212b1ddd7fb111cefdfe9e6648bb7_720w.webp" alt="img" class="img_kGBN"></p>
<p>写入流程 l 记录页的修改，状态为prepare l 事务提交，讲事务记录为commit状态</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205454.png" alt="" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-7d685adf553d18f2e8dcdcd632d8696f_720w.webp" alt="img" class="img_kGBN"></p>
<h3 class="anchor anchorWithStickyNavbar_HWLp" id="意义"><strong>意义</strong><a href="#意义" class="hash-link" aria-label="Direct link to 意义" title="Direct link to 意义">​</a></h3>
<p>体积小，记录页的修改，比写入页代价低 末尾追加，随机写变顺序写，发生改变的页不固定</p>
<h2 class="anchor anchorWithStickyNavbar_HWLp" id="四mysql锁实现原理"><strong>四、MySQL锁实现原理</strong><a href="#四mysql锁实现原理" class="hash-link" aria-label="Direct link to 四mysql锁实现原理" title="Direct link to 四mysql锁实现原理">​</a></h2>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-44403b5fcb1bd988f68f72172c95627b_720w.webp" alt="img" class="img_kGBN"></p>
<p>所有当前读加排他锁，都有哪些是当前读？<code>SELECT FOR UPDATEUPDATEDELETE</code></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-6161f7636962904b6e17d57e1a2540dc_720w.webp" alt="img" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-c6b3c1d5c628b0c2fc104421ddc0faad_720w.webp" alt="img" class="img_kGBN"></p>
<p>唯一索引/非唯一索引 <code>* RC/RR</code>4种情况逐一分析</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-323f7b0fc7e2bfbdee1bb19e8f7dea0f_720w.webp" alt="img" class="img_kGBN"></p>
<p>会出现幻读问题，不可重复读了</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-3e9c8bda25b0b6788952f5024819e4ff_720w.webp" alt="img" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-7f9ba333592f1253ffa6adf619448aaf_720w.webp" alt="img" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-55b01d4fd841e1c417004c86a80746b7_720w.webp" alt="img" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-b155fff4fd294066127c2e6c2650f559_720w.webp" alt="img" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/20230405205509.png" alt="" class="img_kGBN"></p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/v2-e87ad5dc811f52789e20adb3b53b8ba1_720w.webp" alt="img" class="img_kGBN"></p>
<p>死锁在库表中有记录，通过kill 那个锁删除。</p>
<p><img loading="lazy" src="https://java-tutorial.oss-cn-shanghai.aliyuncs.com/%E5%86%B3%E5%AE%9A%E7%89%88.jpeg" alt="" class="img_kGBN"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/database/重新学习MySQL数据库：Mysql存储引擎与数据存储原理.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_EYjg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_eevz"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/code-note-blog/docs/database/重新学习MySQL数据库：Innodb中的事务隔离级别和锁的关系"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">重新学习MySQL数据库：Innodb中的事务隔离级别和锁的关系</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/code-note-blog/docs/database/重新学习MySQL数据库：MySQL的事务隔离级别实战"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">重新学习MySQL数据库：MySQL的事务隔离级别实战</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_lc2k thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一-mysql记录存储页为单位" class="table-of-contents__link toc-highlight"><strong>一、 MySQL记录存储（页为单位）</strong></a><ul><li><a href="#页头" class="table-of-contents__link toc-highlight"><strong>页头</strong></a></li><li><a href="#虚记录" class="table-of-contents__link toc-highlight"><strong>虚记录</strong></a></li><li><a href="#记录堆" class="table-of-contents__link toc-highlight"><strong>记录  堆</strong></a></li><li><a href="#自由空间链表" class="table-of-contents__link toc-highlight"><strong>自由空间链表</strong></a></li><li><a href="#未分配空间" class="table-of-contents__link toc-highlight"><strong>未分配空间</strong></a></li><li><a href="#slot区" class="table-of-contents__link toc-highlight"><strong>Slot区</strong></a></li><li><a href="#页内记录维护" class="table-of-contents__link toc-highlight"><strong>页内记录维护</strong></a></li></ul></li><li><a href="#二-mysql-innodb存储引擎内存管理" class="table-of-contents__link toc-highlight"><strong>二、 MySQL InnoDB存储引擎内存管理</strong></a><ul><li><a href="#预分配内存空间" class="table-of-contents__link toc-highlight"><strong>预分配内存空间</strong></a></li><li><a href="#数据以页为单位加载-减少io访问次数" class="table-of-contents__link toc-highlight"><strong>数据以页为单位加载 （减少io访问次数）</strong></a></li><li><a href="#数据内外存交换" class="table-of-contents__link toc-highlight"><strong>数据内外存交换</strong></a></li><li><a href="#页面管理" class="table-of-contents__link toc-highlight"><strong>页面管理</strong></a></li><li><a href="#页面淘汰" class="table-of-contents__link toc-highlight"><strong>页面淘汰</strong></a></li><li><a href="#全表扫描对内存的影响" class="table-of-contents__link toc-highlight"><strong>全表扫描对内存的影响？</strong></a></li><li><a href="#页面淘汰-1" class="table-of-contents__link toc-highlight"><strong>页面淘汰</strong></a></li><li><a href="#位置移动" class="table-of-contents__link toc-highlight"><strong>位置移动</strong></a></li></ul></li><li><a href="#三mysql事务实现原理" class="table-of-contents__link toc-highlight"><strong>三、MySQL事务实现原理</strong></a><ul><li><a href="#1事务特性" class="table-of-contents__link toc-highlight"><strong>1、事务特性</strong></a></li><li><a href="#2并发问题" class="table-of-contents__link toc-highlight"><strong>2、并发问题</strong></a></li><li><a href="#3隔离级别" class="table-of-contents__link toc-highlight"><strong>3、隔离级别</strong></a></li><li><a href="#mysql事务实现原理事务管理机制" class="table-of-contents__link toc-highlight"><strong>MySQL事务实现原理（事务管理机制）</strong></a></li><li><a href="#1mvcc-多版本并发控制" class="table-of-contents__link toc-highlight"><strong>1、MVCC 多版本并发控制</strong></a></li><li><a href="#2undo-log" class="table-of-contents__link toc-highlight"><strong>2、undo log</strong></a></li><li><a href="#3redo-log" class="table-of-contents__link toc-highlight"><strong>3、redo log</strong></a></li><li><a href="#意义" class="table-of-contents__link toc-highlight"><strong>意义</strong></a></li></ul></li><li><a href="#四mysql锁实现原理" class="table-of-contents__link toc-highlight"><strong>四、MySQL锁实现原理</strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/code-note-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_B3Gq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>